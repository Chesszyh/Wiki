# 构建系统

相关源文件

-   [AUTHORS](https://github.com/official-stockfish/Stockfish/blob/c27c1747/AUTHORS)
-   [src/Makefile](https://github.com/official-stockfish/Stockfish/blob/c27c1747/src/Makefile)

## 目的与范围

本文档描述了 Stockfish 的构建系统，它作为一个 GNU Makefile 实现，位于 [src/Makefile](https://github.com/official-stockfish/Stockfish/blob/c27c1747/src/Makefile)。构建系统负责使用适当的特定于架构的优化来编译引擎、管理配置文件引导优化 (PGO)、下载神经网络文件以及支持多种编译器和平台。关于网络文件本身的信息，请参阅 [NNUE 神经网络评估](/official-stockfish/Stockfish/5.1-nnue-neural-network-evaluation)。关于构建后的测试和基准测试信息，请参阅 [测试与基准测试](/official-stockfish/Stockfish/7.3-testing-and-benchmarking)。

## 构建系统架构

构建系统在 [src/Makefile18-1147](https://github.com/official-stockfish/Stockfish/blob/c27c1747/src/Makefile#L18-L1147) 中分为五个主要部分：

```mermaid
flowchart TD
    User["User Invocationmake -j profile-build ARCH=x86-64-avx2"]
    Section1["Section 1: General Configuration(lines 18-73)OS detection, executable name"]
    Section2["Section 2: High-level Configuration(lines 74-415)Architecture defaults, ARCH parsing"]
    Section3["Section 3: Low-level Configuration(lines 417-876)Compiler flags, SIMD, LTO"]
    Section4["Section 4: Public Targets(lines 878-1015)build, profile-build, net, clean"]
    Section5["Section 5: Private Targets(lines 1020-1147)Compiler-specific PGO, linking"]
    Binary["stockfish or stockfish.exe"]

    User --> Section1
    Section1 --> Section2
    Section2 --> Section3
    Section3 --> Section4
    Section4 --> Section5
    Section5 --> Binary
```
来源： [src/Makefile18-1147](https://github.com/official-stockfish/Stockfish/blob/c27c1747/src/Makefile#L18-L1147)

## 架构选择

构建系统通过 `ARCH` 参数支持广泛的 CPU 架构。如果未指定，`ARCH` 默认为 `native`，它使用 [../scripts/get\_native\_properties.sh](https://github.com/official-stockfish/Stockfish/blob/c27c1747/../scripts/get_native_properties.sh) 自动检测主机 CPU 功能。

### 架构检测与验证

```mermaid
flowchart TD
    Input["ARCH parameter(or 'native')"]
    NativeCheck["ARCH == 'native'?"]
    AutoDetect["Execute get_native_properties.shline 125"]
    Override["Use specified ARCH"]
    Validate["Validate against supported listlines 130-139"]
    ParseFlags["Parse into flagslines 175-414"]
    Flags["sse, sse2, ssse3, sse41avx2, avx512, popcntpext, neon, dotprod, etc."]

    Input --> NativeCheck
    NativeCheck --> AutoDetect
    NativeCheck --> Override
    AutoDetect --> Validate
    Override --> Validate
    Validate --> ParseFlags
    ParseFlags --> Flags
```
来源： [src/Makefile120-414](https://github.com/official-stockfish/Stockfish/blob/c27c1747/src/Makefile#L120-L414)

### 支持的架构类别

| 类别 | 示例架构 | 关键特性 |
| --- | --- | --- |
| **x86-64** | `x86-64-avx512icl`, `x86-64-avx2`, `x86-64-bmi2` | SSE, AVX, VNNI, PEXT 指令 |
| **x86-32** | `x86-32-sse41-popcnt`, `x86-32-sse2` | 具有各种 SIMD 级别的 32 位 x86 |
| **ARM** | `armv8-dotprod`, `armv7-neon`, `apple-silicon` | NEON, 点积支持 |
| **PowerPC** | `ppc-64-vsx`, `ppc-64-altivec` | Altivec, VSX SIMD |
| **其他** | `riscv64`, `loongarch64-lasx`, `e2k` | 各种其他架构 |

来源： [src/Makefile130-414](https://github.com/official-stockfish/Stockfish/blob/c27c1747/src/Makefile#L130-L414) [src/Makefile898-930](https://github.com/official-stockfish/Stockfish/blob/c27c1747/src/Makefile#L898-L930)

### 架构到标志的映射

Makefile 使用条件逻辑将架构规范转换为编译器标志：

```mermaid
flowchart TD
    ARCH["ARCH = x86-64-avx512icl"]
    Check1["findstring 'x86' in ARCH?"]
    Check2["findstring 'avx512icl' in ARCH?"]
    SetFlags["Set flags:popcnt=yes sse=yes sse2=yesssse3=yes sse41=yes avx2=yespext=yes avx512=yes vnni512=yesavx512icl=yes"]
    GenCXXFLAGS["Generate CXXFLAGS:-DUSE_AVX512 -DUSE_VNNI -DUSE_AVX512ICL-mavx512f -mavx512cd -mavx512vl-mavx512dq -mavx512bw ... (more)"]

    ARCH --> Check1
    Check1 --> Check2
    Check2 --> SetFlags
    SetFlags --> GenCXXFLAGS
```
来源： [src/Makefile283-294](https://github.com/official-stockfish/Stockfish/blob/c27c1747/src/Makefile#L283-L294) [src/Makefile736-741](https://github.com/official-stockfish/Stockfish/blob/c27c1747/src/Makefile#L736-L741)

## 编译器配置

构建系统通过 `COMP` 参数支持多种编译器，默认为 `gcc`。也可以使用 `COMPCXX` 直接覆盖编译器。

### 编译器选择流程

```mermaid
flowchart TD
    Input["COMP parameter(default: gcc)"]
    SelectComp["COMP value?"]
    GCC["comp=gccCXX=g++lines 436-463"]
    MINGW["comp=mingwCXX=x86_64-w64-mingw32-c++lines 469-486"]
    ICX["comp=icxCXX=icpxlines 488-493"]
    CLANG["comp=clangCXX=clang++lines 495-527"]
    NDK["comp=clang (NDK)CXX=*-android29-clang++lines 540-569"]
    Override["COMPCXX set?"]
    UseOverride["CXX=COMPCXXlines 572-574"]
    SetFlags["Set compiler-specific flags:CXXFLAGS, LDFLAGS"]
    DetectLLVM["Detect llvm-profdata pathlines 580-587"]

    Input --> SelectComp
    SelectComp --> GCC
    SelectComp --> MINGW
    SelectComp --> ICX
    SelectComp --> CLANG
    SelectComp --> NDK
    GCC --> Override
    MINGW --> Override
    ICX --> Override
    CLANG --> Override
    NDK --> Override
    Override --> UseOverride
    Override --> SetFlags
    UseOverride --> SetFlags
    SetFlags --> DetectLLVM
```
来源： [src/Makefile432-587](https://github.com/official-stockfish/Stockfish/blob/c27c1747/src/Makefile#L432-L587)

### 编译器特定标志

每个编译器都有特定的警告标志和优化设置：

| 编译器 | 关键标志 |
| --- | --- |
| **gcc** | `-pedantic -Wextra -Wshadow -Wmissing-declarations -Wstack-usage=128000` |
| **clang** | `-pedantic -Wextra -Wshadow -Wmissing-prototypes -Wconditional-uninitialized` |
| **icx** | `--intel -pedantic -Wextra -Wshadow -Wmissing-prototypes -Wabi -Wdeprecated` |
| **mingw** | `-pedantic -Wextra -Wshadow -Wmissing-declarations` |

来源： [src/Makefile439](https://github.com/official-stockfish/Stockfish/blob/c27c1747/src/Makefile#L439-L439) [src/Makefile485](https://github.com/official-stockfish/Stockfish/blob/c27c1747/src/Makefile#L485-L485) [src/Makefile491-492](https://github.com/official-stockfish/Stockfish/blob/c27c1747/src/Makefile#L491-L492) [src/Makefile502-503](https://github.com/official-stockfish/Stockfish/blob/c27c1747/src/Makefile#L502-L503)

## 构建目标

### 主要构建目标

```mermaid
flowchart TD
    Help["helpDisplay supported archs and compilerslines 882-955"]
    Build["buildStandard build without PGOlines 968-969"]
    ProfileBuild["profile-buildPGO-optimized build (4 steps)lines 971-985"]
    Net["netDownload NNUE network fileslines 1014-1015"]
    Strip["stripStrip debug symbolslines 987-988"]
    Install["installInstall to PREFIX/binlines 990-993"]
    Clean["cleanRemove all build artifactslines 996-997"]
    ObjClean["objcleanRemove object files onlylines 1000-1001"]
    ProfileClean["profilecleanRemove PGO profile datalines 1004-1011"]
    User["User invokes make"]

    User --> Help
    User --> Build
    User --> ProfileBuild
    User --> Net
    User --> Strip
    User --> Install
    User --> Clean
```
来源： [src/Makefile882-1015](https://github.com/official-stockfish/Stockfish/blob/c27c1747/src/Makefile#L882-L1015)

### 构建目标依赖

构建过程有几个依赖链：

```mermaid
flowchart TD
    ConfigSanity["config-sanityValidate parameterslines 1026-1092"]
    Net["netDownload networkslines 1014-1015"]
    ObjClean["objcleanClean objectslines 1000-1001"]
    Compile["Compile OBJSlines 1094-1095"]
    Link["Link EXElines 1094-1095"]
    ProfileBuild["profile-build"]

    ConfigSanity --> Net
    Net --> Compile
    Compile --> Link
    ProfileBuild --> Net
    ProfileBuild --> ConfigSanity
    ProfileBuild --> ObjClean
```
来源： [src/Makefile968-985](https://github.com/official-stockfish/Stockfish/blob/c27c1747/src/Makefile#L968-L985) [src/Makefile1026-1092](https://github.com/official-stockfish/Stockfish/blob/c27c1747/src/Makefile#L1026-L1092)

## 配置文件引导优化 (PGO)

`profile-build` 目标实现了四个步骤的 PGO 工作流，显著提高了性能：

### PGO 工作流

```mermaid
flowchart TD
    Start["make profile-build ARCH=... COMP=..."]
    Step1["Step 1: Build Instrumented Executablelines 973-974"]
    Instrument["Call profile_make target(gcc-profile-make, clang-profile-make, or icx-profile-make)"]
    Step2["Step 2: Run Benchmarklines 976-978"]
    Bench["Execute PGOBENCH(./stockfish bench)lines 52, 977"]
    GenProfile["Generate profile data(.gcda, .profraw files)"]
    Step3["Step 3: Build Optimized Executablelines 980-982"]
    CleanObj["Clean object filesline 981"]
    UseProfile["Call profile_use target(gcc-profile-use, clang-profile-use, or icx-profile-use)"]
    Step4["Step 4: Clean Profile Datalines 984-985"]
    CleanProfile["Remove .gcda, .profraw, profdir/"]
    Done["Optimized stockfish binary"]

    Start --> Step1
    Step1 --> Instrument
    Instrument --> Step2
    Step2 --> Bench
    Bench --> GenProfile
    GenProfile --> Step3
    Step3 --> CleanObj
    CleanObj --> UseProfile
    UseProfile --> Step4
    Step4 --> CleanProfile
    CleanProfile --> Done
```
来源： [src/Makefile971-985](https://github.com/official-stockfish/Stockfish/blob/c27c1747/src/Makefile#L971-L985)

### 编译器特定的 PGO 实现

不同的编译器使用不同的 PGO 机制：

**GCC Profile Targets** ([src/Makefile1114-1127](https://github.com/official-stockfish/Stockfish/blob/c27c1747/src/Makefile#L1114-L1127))：

-   `gcc-profile-make`：使用 `-fprofile-generate=profdir` 编译并链接 `-lgcov`
-   `gcc-profile-use`：使用 `-fprofile-use=profdir -fno-peel-loops -fno-tracer` 编译并链接 `-lgcov`

**Clang Profile Targets** ([src/Makefile1101-1112](https://github.com/official-stockfish/Stockfish/blob/c27c1747/src/Makefile#L1101-L1112))：

-   `clang-profile-make`：使用 `-fprofile-generate` 编译
-   `clang-profile-use`：使用 `llvm-profdata merge` 合并 `.profraw` 文件，然后使用 `-fprofile-use=stockfish.profdata` 编译

**ICX Profile Targets** ([src/Makefile1129-1140](https://github.com/official-stockfish/Stockfish/blob/c27c1747/src/Makefile#L1129-L1140))：

-   `icx-profile-make`：使用 `-fprofile-instr-generate` 编译
-   `icx-profile-use`：使用 `llvm-profdata merge` 合并 `.profraw` 文件，然后使用 `-fprofile-instr-use=stockfish.profdata` 编译

```mermaid
flowchart TD
    C1["Compile with -fprofile-generate"]
    C2["Run benchmark → *.profraw"]
    C3["llvm-profdata merge → stockfish.profdata"]
    C4["Compile with -fprofile-use=stockfish.profdata"]
    G1["Compile with -fprofile-generate=profdir"]
    G2["Run benchmark → profdir/*.gcda"]
    G3["Compile with -fprofile-use=profdir"]

    C1 --> C2
    C2 --> C3
    C3 --> C4
    G1 --> G2
    G2 --> G3
```
来源： [src/Makefile589-611](https://github.com/official-stockfish/Stockfish/blob/c27c1747/src/Makefile#L589-L611) [src/Makefile1101-1140](https://github.com/official-stockfish/Stockfish/blob/c27c1747/src/Makefile#L1101-L1140)

## SIMD 指令集配置

构建系统根据选定的架构配置 SIMD 指令集。这些会被转换为预处理器定义和编译器标志。

### SIMD 标志变量

Makefile 使用布尔变量来跟踪启用的指令集：

| 变量 | 预处理器定义 | 编译器标志 | 描述 |
| --- | --- | --- | --- |
| `sse` | N/A | `-msse` | 流式 SIMD 扩展 |
| `sse2` | `-DUSE_SSE2` | `-msse2` | SSE2 指令 |
| `ssse3` | `-DUSE_SSSE3` | `-mssse3` | 补充 SSE3 |
| `sse41` | `-DUSE_SSE41` | `-msse4.1` | SSE 4.1 指令 |
| `avx2` | `-DUSE_AVX2` | `-mavx2 -mbmi` | 高级矢量扩展 2 |
| `avxvnni` | `-DUSE_VNNI -DUSE_AVXVNNI` | `-mavxvnni` | AVX 矢量神经网络指令 |
| `avx512` | `-DUSE_AVX512` | `-mavx512f -mavx512bw -mavx512dq -mavx512vl` | AVX-512 基础 |
| `vnni512` | `-DUSE_VNNI` | `-mavx512vnni` (+ avx512 flags) | AVX-512 VNNI |
| `neon` | `-DUSE_NEON=<arm_version>` | `-mfpu=neon` (ARM32) | ARM NEON SIMD |
| `dotprod` | `-DUSE_NEON_DOTPROD` | `-march=armv8.2-a+dotprod` | ARM 点积 |
| `pext` | `-DUSE_PEXT` | `-mbmi2` | 并行位提取 |
| `popcnt` | `-DUSE_POPCNT` | `-mpopcnt` | 种群计数 (Population count) |

来源： [src/Makefile707-817](https://github.com/official-stockfish/Stockfish/blob/c27c1747/src/Makefile#L707-L817)

### SIMD 配置流程

```mermaid
flowchart TD
    Arch["Architecture selected(e.g., x86-64-avx512)"]
    SetBools["Set boolean flagsavx512=yes, vnni512=yesavx2=yes, pext=yes, etc.lines 260-294"]
    CheckSIMD["Check each SIMD flag"]
    AddDefine["Add -DUSE_XXX to CXXFLAGSlines 709-737"]
    AddCompilerFlag["Add -mxxx to CXXFLAGSlines 710-808"]
    FinalFlags["Final CXXFLAGS with all SIMD flags"]

    Arch --> SetBools
    SetBools --> CheckSIMD
    CheckSIMD --> AddDefine
    CheckSIMD --> AddCompilerFlag
    AddDefine --> FinalFlags
    AddCompilerFlag --> FinalFlags
```
来源： [src/Makefile260-294](https://github.com/official-stockfish/Stockfish/blob/c27c1747/src/Makefile#L260-L294) [src/Makefile707-817](https://github.com/official-stockfish/Stockfish/blob/c27c1747/src/Makefile#L707-L817)

## 网络文件管理

构建系统使用 `net` 目标自动下载所需的 NNUE 神经网络文件。

### 网络下载机制

```mermaid
flowchart TD
    Target["net targetlines 1014-1015"]
    Script["Execute ../scripts/net.shline 1015"]
    Download["Download network files:nn-*.nnue files"]
    Verify["Verify checksums"]
    Place["Place in expected location"]

    Target --> Script
    Script --> Download
    Download --> Verify
    Verify --> Place
```
`net` 目标是大多数构建操作的先决条件，确保编译前网络文件存在。它被以下目标调用：

-   `build` 目标 (行 968)
-   `profile-build` 目标 (行 971)
-   `config-sanity` 目标 (行 1026)
-   `analyze` 目标 (行 965)

来源： [src/Makefile1014-1015](https://github.com/official-stockfish/Stockfish/blob/c27c1747/src/Makefile#L1014-L1015) [src/Makefile968-971](https://github.com/official-stockfish/Stockfish/blob/c27c1747/src/Makefile#L968-L971)

## 配置选项

构建系统支持几个修改构建行为的高级配置标志：

### 配置变量

```mermaid
flowchart TD
    Debug["debug = yes/noDefault: no"]
    Optimize["optimize = yes/noDefault: yes"]
    Sanitize["sanitize = none/Default: none"]
    Bits["bits = 32/64Auto-detected"]
    DebugEffect["debug=yes → -g -D_GLIBCXX_ASSERTIONS -D_GLIBCXX_DEBUGdebug=no → -DNDEBUGlines 641-646"]
    OptEffect["optimize=yes → -O3 -funroll-loopslines 657-683"]
    SanEffect["sanitize= → -fsanitize=lines 649-652"]
    BitsEffect["bits=64 → -DIS_64BITlines 686-688"]

    Debug --> DebugEffect
    Optimize --> OptEffect
    Sanitize --> SanEffect
    Bits --> BitsEffect
```
来源： [src/Makefile141-165](https://github.com/official-stockfish/Stockfish/blob/c27c1747/src/Makefile#L141-L165) [src/Makefile640-688](https://github.com/official-stockfish/Stockfish/blob/c27c1747/src/Makefile#L640-L688)

### 配置验证

`config-sanity` 目标在构建前验证所有配置参数：

```mermaid
flowchart TD
    Start["config-sanity targetline 1026"]
    Print["Print configuration valueslines 1028-1062"]
    Check1["Verify debug = yes/noline 1065"]
    Check2["Verify optimize = yes/noline 1066"]
    Check3["Verify SUPPORTED_ARCH = trueline 1067"]
    Check4["Verify arch in valid listlines 1068-1071"]
    Check5["Verify bits = 32/64line 1072"]
    Check6["Verify all SIMD flagslines 1073-1088"]
    Check7["Verify comp in valid listlines 1090-1092"]
    Pass["Configuration valid"]
    Fail["Configuration invalid → exit"]

    Start --> Print
    Print --> Check1
    Check1 --> Check2
    Check2 --> Check3
    Check3 --> Check4
    Check4 --> Check5
    Check5 --> Check6
    Check6 --> Check7
    Check7 --> Pass
    Check1 --> Fail
    Check2 --> Fail
    Check3 --> Fail
```
来源： [src/Makefile1026-1092](https://github.com/official-stockfish/Stockfish/blob/c27c1747/src/Makefile#L1026-L1092)

## 链接时优化 (LTO)

当 `optimize=yes` 且 `debug=no` 时，构建系统为支持的编译器启用链接时优化 (LTO)：

### LTO 配置

```mermaid
flowchart TD
    Check["optimize=yes && debug=nolines 839-840"]
    CompCheck["Compiler?"]
    Clang["clang/icx:-flto=fulllines 841-849"]
    GCC["gcc:-flto -flto-partition=one-flto=jobserver for linkinglines 853-860"]
    MinGW["mingw:-flto -flto-partition=one-save-tempslines 864-866"]
    AddToFlags["Add LTO flags to CXXFLAGS and LDFLAGS"]

    Check --> CompCheck
    CompCheck --> Clang
    CompCheck --> GCC
    CompCheck --> MinGW
    Clang --> AddToFlags
    GCC --> AddToFlags
    MinGW --> AddToFlags
```
对于 GCC，`-flto=jobserver` 标志允许在链接阶段使用 make jobserver 进行并行 LTO 编译，从而高效利用多核。

来源： [src/Makefile836-869](https://github.com/official-stockfish/Stockfish/blob/c27c1747/src/Makefile#L836-L869)

## 平台特定处理

构建系统检测操作系统并应用特定于平台的配置：

### 操作系统检测与配置

```mermaid
flowchart TD
    DetectKernel["KERNEL = uname -sline 23"]
    DetectOS["OS = uname -o (Linux only)lines 24-26"]
    CheckWindows["Windows?"]
    CheckDarwin["macOS/Darwin?"]
    CheckAndroid["Android?"]
    Windows["target_windows = yesEXE = stockfish.exeLDFLAGS += -staticlines 29-46, 465-467"]
    Darwin["CXXFLAGS += -mmacosx-version-min=10.15CXXFLAGS += -arch lines 529-537"]
    Android["CXXFLAGS += -fPIELDFLAGS += -fPIE -pielines 873-876"]
    Unix["Default POSIX configurationCXXFLAGS += -DUSE_PTHREADSLDFLAGS += -lpthread -lrtlines 614-638"]

    DetectKernel --> DetectOS
    DetectOS --> CheckWindows
    CheckWindows --> Windows
    CheckWindows --> CheckDarwin
    CheckDarwin --> Darwin
    CheckDarwin --> CheckAndroid
    CheckAndroid --> Android
    CheckAndroid --> Unix
```
### 线程配置

除了使用 MinGW 的 Windows 外，构建系统在所有平台上都使用 POSIX 线程 (pthreads)：

-   **非 MinGW 编译器**：添加 `-DUSE_PTHREADS` 并链接 `-lpthread` (行 614-638)
-   **MinGW**：使用 Windows 线程（无 pthread 标志）
-   **Android**：Bionic C 库包含 pthread，因此无需显式链接 (行 617-637)

来源： [src/Makefile23-46](https://github.com/official-stockfish/Stockfish/blob/c27c1747/src/Makefile#L23-L46) [src/Makefile465-467](https://github.com/official-stockfish/Stockfish/blob/c27c1747/src/Makefile#L465-L467) [src/Makefile529-537](https://github.com/official-stockfish/Stockfish/blob/c27c1747/src/Makefile#L529-L537) [src/Makefile614-638](https://github.com/official-stockfish/Stockfish/blob/c27c1747/src/Makefile#L614-L638) [src/Makefile873-876](https://github.com/official-stockfish/Stockfish/blob/c27c1747/src/Makefile#L873-L876)

## 源文件与依赖

构建系统跟踪源文件并自动生成依赖关系：

### 源文件管理

```mermaid
flowchart TD
    SRCS["SRCS variableAll .cpp fileslines 55-60"]
    HEADERS["HEADERS variableAll .h fileslines 62-68"]
    OBJS["OBJS = notdir SRCS:.cpp=.oObject file listline 70"]
    VPATH["VPATH = syzygy:nnue:nnue/featuresSearch path for sourcesline 72"]
    Depend[".depend fileAuto-generated dependencieslines 1142-1146"]
    Compile["Compile each .cpp → .o"]
    Link["Link OBJS → EXElines 1094-1095"]

    SRCS --> OBJS
    SRCS --> Depend
    HEADERS --> Depend
    VPATH --> Compile
    OBJS --> Link
    Depend --> Compile
```
`.depend` 文件使用 `$(CXX) $(DEPENDFLAGS) -MM $(SRCS)` 自动重新生成，并且如果目标不是清理操作，则会包含在 Makefile 中。

来源： [src/Makefile54-72](https://github.com/official-stockfish/Stockfish/blob/c27c1747/src/Makefile#L54-L72) [src/Makefile1094-1095](https://github.com/official-stockfish/Stockfish/blob/c27c1747/src/Makefile#L1094-L1095) [src/Makefile1142-1147](https://github.com/official-stockfish/Stockfish/blob/c27c1747/src/Makefile#L1142-L1147)

## 版本信息

构建系统使用 Git 将版本信息嵌入到二进制文件中：

```mermaid
flowchart TD
    GitSHA["git rev-parse HEADGet commit SHA (8 chars)lines 820-823"]
    GitDate["git show --date=formatGet commit datelines 826-829"]
    ArchInfo["ARCH parameterlines 832-834"]
    SHA_Define["-DGIT_SHA="]
    Date_Define["-DGIT_DATE="]
    Arch_Define["-DARCH="]
    Binary["Embedded in stockfish binary"]

    GitSHA --> SHA_Define
    GitDate --> Date_Define
    ArchInfo --> Arch_Define
    SHA --> Define_Binary
    Date --> Define_Binary
    Arch --> Define_Binary
```
`misc.o` 目标在每次构建时都被强制重新编译 (行 1098-1099)，以确保版本信息始终是最新的。

来源： [src/Makefile819-834](https://github.com/official-stockfish/Stockfish/blob/c27c1747/src/Makefile#L819-L834) [src/Makefile1098-1099](https://github.com/official-stockfish/Stockfish/blob/c27c1747/src/Makefile#L1098-L1099)

## 示例构建命令

常见构建调用及其效果：

| 命令 | 描述 |
| --- | --- |
| `make -j profile-build ARCH=x86-64-avx2` | 为支持 AVX2 的 CPU 使用 PGO 构建 |
| `make -j profile-build ARCH=x86-64-sse41-popcnt` | 为较旧的 x86-64 CPU 使用 PGO 构建 |
| `make -j build ARCH=armv8-dotprod COMP=clang` | 使用 clang 为支持点积的 ARM 构建 |
| `make -j build ARCH=apple-silicon` | 为 Apple Silicon Mac 构建 |
| `make build ARCH=x86-64 debug=yes sanitize=address` | 使用地址消毒剂进行调试构建 |
| `make net` | 仅下载神经网络文件 |
| `make clean` | 删除所有构建产物 |

来源： [src/Makefile940-951](https://github.com/official-stockfish/Stockfish/blob/c27c1747/src/Makefile#L940-L951)
