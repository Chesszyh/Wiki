# React DOM Implementation

Relevant source files

-   [packages/react-art/src/ReactFiberConfigART.js](https://github.com/facebook/react/blob/65eec428/packages/react-art/src/ReactFiberConfigART.js)
-   [packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js](https://github.com/facebook/react/blob/65eec428/packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js)
-   [packages/react-native-renderer/src/ReactFiberConfigFabric.js](https://github.com/facebook/react/blob/65eec428/packages/react-native-renderer/src/ReactFiberConfigFabric.js)
-   [packages/react-native-renderer/src/ReactFiberConfigNative.js](https://github.com/facebook/react/blob/65eec428/packages/react-native-renderer/src/ReactFiberConfigNative.js)
-   [packages/react-noop-renderer/src/createReactNoop.js](https://github.com/facebook/react/blob/65eec428/packages/react-noop-renderer/src/createReactNoop.js)
-   [packages/react-reconciler/src/ReactFiberConfigWithNoMutation.js](https://github.com/facebook/react/blob/65eec428/packages/react-reconciler/src/ReactFiberConfigWithNoMutation.js)
-   [packages/react-reconciler/src/ReactFiberGestureScheduler.js](https://github.com/facebook/react/blob/65eec428/packages/react-reconciler/src/ReactFiberGestureScheduler.js)
-   [packages/react-reconciler/src/\_\_tests\_\_/ReactFiberHostContext-test.internal.js](https://github.com/facebook/react/blob/65eec428/packages/react-reconciler/src/__tests__/ReactFiberHostContext-test.internal.js)
-   [packages/react-reconciler/src/forks/ReactFiberConfig.custom.js](https://github.com/facebook/react/blob/65eec428/packages/react-reconciler/src/forks/ReactFiberConfig.custom.js)
-   [packages/react-test-renderer/src/ReactFiberConfigTestHost.js](https://github.com/facebook/react/blob/65eec428/packages/react-test-renderer/src/ReactFiberConfigTestHost.js)

## Purpose and Scope

This document describes the React DOM host configuration implementation (`ReactFiberConfigDOM`), which serves as the bridge between React's reconciler and the browser's DOM APIs. This implementation defines how React creates, updates, and manages DOM elements during rendering and commits.

For information about the host configuration abstraction itself, see [Host Configuration Abstraction](/facebook/react/4.6-host-configuration-abstraction). For hydration-specific functionality, see [Hydration System](/facebook/react/6.3-hydration-system). For view transition coordination, see [View Transitions and Gesture Scheduling](/facebook/react/6.4-view-transitions-and-gesture-scheduling).

**Sources:** [packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js1-150](https://github.com/facebook/react/blob/65eec428/packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js#L1-L150)

## Architecture Overview

The DOM host configuration implements the interface expected by the React reconciler, translating reconciler operations into browser DOM manipulations. It operates in mutation mode, directly modifying the DOM tree as changes occur.

```mermaid
flowchart TD
    Reconciler["React ReconcilerWork Loop & Commit"]
    HostConfigInterface["Host Config InterfacecreateInstance, commitUpdate, etc."]
    InstanceCreation["Instance CreationcreateInstance()createTextInstance()"]
    PropertyMgmt["Property ManagementsetInitialProperties()updateProperties()"]
    MutationOps["Mutation OperationsappendChild()insertBefore()commitUpdate()"]
    EventIntegration["Event IntegrationlistenToAllSupportedEvents()"]
    ResourceMgmt["Resource ManagementcreateHoistableInstance()"]
    HostContext["Host ContextNamespace Tracking"]
    DOM["DOM APIscreateElement, appendChild, etc."]
    EventSystem["Browser Event System"]

    Reconciler --> HostConfigInterface
    HostConfigInterface --> InstanceCreation
    HostConfigInterface --> PropertyMgmt
    HostConfigInterface --> MutationOps
    HostConfigInterface --> ResourceMgmt
    HostConfigInterface --> HostContext
    InstanceCreation --> DOM
    PropertyMgmt --> DOM
    MutationOps --> DOM
    EventIntegration --> EventSystem
    ResourceMgmt --> DOM
```
**Sources:** [packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js1-292](https://github.com/facebook/react/blob/65eec428/packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js#L1-L292)

## Type System

ReactFiberConfigDOM defines the core types that represent DOM constructs within the reconciler.

### Core Types

| Type | Definition | Description |
| --- | --- | --- |
| `Type` | `string` | Element type (e.g., 'div', 'span') |
| `Props` | `object` | React props object with DOM-specific properties |
| `Container` | `Element | Document | DocumentFragment` | Root container element with `_reactRootContainer` field |
| `Instance` | `Element` | A DOM element instance |
| `TextInstance` | `Text` | A DOM text node |
| `HostContext` | `HostContextDev | HostContextProd` | Namespace context (SVG, MathML, or HTML) |
| `UpdatePayload` | `Array<mixed>` | Array of alternating property keys and values |

**Sources:** [packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js153-248](https://github.com/facebook/react/blob/65eec428/packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js#L153-L248)

### Instance Types Diagram

```mermaid
flowchart TD
    Container["Container(Element/Document/DocumentFragment)"]
    Instance["Instance(Element)"]
    TextInstance["TextInstance(Text)"]
    HydratableInstance["HydratableInstance(Instance | TextInstance | SuspenseInstance | ActivityInstance)"]

    Container --> Instance
    Container --> TextInstance
    Instance --> TextInstance
    Instance --> HydratableInstance
    TextInstance --> HydratableInstance
```
**Sources:** [packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js211-237](https://github.com/facebook/react/blob/65eec428/packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js#L211-L237)

## Host Context Management

The host context tracks the current namespace (HTML, SVG, MathML) to ensure elements are created with the correct namespace URI. This is critical for proper rendering of SVG and MathML elements within HTML documents.

### Namespace Constants

```mermaid
flowchart TD
    HostContextNamespace["HostContextNamespaceopaque type: 0 | 1 | 2"]
    None["HostContextNamespaceNone = 0(HTML namespace)"]
    Svg["HostContextNamespaceSvg = 1(SVG namespace)"]
    Math["HostContextNamespaceMath = 2(MathML namespace)"]

    HostContextNamespace --> None
    HostContextNamespace --> Svg
    HostContextNamespace --> Math
```
### Context Flow

The reconciler calls `getRootHostContext` when entering a root container, then `getChildHostContext` for each child element to determine the appropriate namespace.

```mermaid
flowchart TD
    GetRoot["getRootHostContext(rootContainer)"]
    CheckNodeType["rootContainernodeType"]
    DocumentNode["DOCUMENT_NODE orDOCUMENT_FRAGMENT_NODE"]
    ElementNode["ELEMENT_NODE"]
    CheckDocElement["documentElementnamespaceURI"]
    ReturnSvg["Return HostContextNamespaceSvg"]
    ReturnMath["Return HostContextNamespaceMath"]
    ReturnNone["Return HostContextNamespaceNone"]
    GetOwnContext["getOwnHostContext(namespaceURI)"]
    GetChildContext["getChildHostContextProd(context, type)"]

    GetRoot --> CheckNodeType
    CheckNodeType --> DocumentNode
    CheckNodeType --> ElementNode
    DocumentNode --> CheckDocElement
    CheckDocElement --> ReturnSvg
    CheckDocElement --> ReturnMath
    CheckDocElement --> ReturnNone
    ElementNode --> GetOwnContext
    GetOwnContext --> GetChildContext
```
Key functions:

-   `getRootHostContext(rootContainerInstance)` [packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js302-355](https://github.com/facebook/react/blob/65eec428/packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js#L302-L355)
-   `getChildHostContext(parentHostContext, type)` [packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js391-406](https://github.com/facebook/react/blob/65eec428/packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js#L391-L406)
-   `getChildHostContextProd(parentNamespace, type)` [packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js368-389](https://github.com/facebook/react/blob/65eec428/packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js#L368-L389)

### Namespace Transitions

Special handling exists for namespace transitions:

-   Entering `<svg>` from HTML switches to SVG namespace
-   Entering `<math>` from HTML switches to MathML namespace
-   `<foreignObject>` within SVG returns to HTML namespace

**Sources:** [packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js284-406](https://github.com/facebook/react/blob/65eec428/packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js#L284-L406)

## Instance Creation

DOM instances are created during the reconciler's render phase and finalized during the commit phase.

### Regular Instance Creation

```mermaid
flowchart TD
    CreateInstance["createInstance(type, props, rootContainer, hostContext, fiber)"]
    CheckContext["hostContextnamespace"]
    CreateSvg["ownerDocument.createElementNS(SVG_NAMESPACE, type)"]
    CreateMath["ownerDocument.createElementNS(MATH_NAMESPACE, type)"]
    CheckSpecial["Special element?"]
    CreateScript["Create via innerHTMLto prevent execution"]
    CreateSelect["createElement('select')+ handle multiple/size"]
    CreateNormal["createElement(type)"]
    Cache["precacheFiberNode(fiber, element)"]
    UpdateProps["updateFiberProps(element, props)"]
    Return["Return element"]

    CreateInstance --> CheckContext
    CheckContext --> CreateSvg
    CheckContext --> CreateMath
    CheckContext --> CheckSpecial
    CheckSpecial --> CreateScript
    CheckSpecial --> CreateSelect
    CheckSpecial --> CreateNormal
    CreateSvg --> Cache
    CreateMath --> Cache
    CreateScript --> Cache
    CreateSelect --> Cache
    CreateNormal --> Cache
    Cache --> UpdateProps
    UpdateProps --> Return
```
The `createInstance` function:

1.  Determines the owner document from the root container
2.  Creates the element with the appropriate namespace
3.  Caches the fiber-to-DOM mapping via `precacheFiberNode`
4.  Stores props on the DOM node via `updateFiberProps`
5.  Does NOT call `setInitialProperties` (that happens in `finalizeInitialChildren`)

**Sources:** [packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js484-608](https://github.com/facebook/react/blob/65eec428/packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js#L484-L608)

### Hoistable Instance Creation

Hoistable instances are special DOM elements (like `<link>`, `<style>`, `<script>`) that can be "hoisted" to the document head for resource management.

```mermaid
flowchart TD
    CreateHoistable["createHoistableInstance(type, props, rootContainer, fiber)"]
    CreateElem["createElement(type)"]
    PrecacheAndProps["precacheFiberNode + updateFiberProps"]
    SetInitial["setInitialProperties(element, type, props)"]
    Mark["markNodeAsHoistable(element)"]
    Return["Return element"]

    CreateHoistable --> CreateElem
    CreateElem --> PrecacheAndProps
    PrecacheAndProps --> SetInitial
    SetInitial --> Mark
    Mark --> Return
```
**Sources:** [packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js452-468](https://github.com/facebook/react/blob/65eec428/packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js#L452-L468)

### Text Instance Creation

Text nodes are simpler:

```mermaid
flowchart TD
    CreateText["createTextInstance(text, rootContainer, hostContext, fiber)"]
    Validate["validateTextNesting(DEV only)"]
    CreateNode["ownerDocument.createTextNode(text)"]
    Precache["precacheFiberNode(fiber, textNode)"]
    Return["Return textNode"]

    CreateText --> Validate
    Validate --> CreateNode
    CreateNode --> Precache
    Precache --> Return
```
**Sources:** [packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js679-701](https://github.com/facebook/react/blob/65eec428/packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js#L679-L701)

## Property Management

Properties (React props) are translated into DOM attributes and properties through dedicated helper modules.

### Property Application Flow

```mermaid
flowchart TD
    Mount["Mount (New Element)"]
    Update["Update (Existing Element)"]
    AppendChild["appendInitialChild(parent, child)"]
    Finalize["finalizeInitialChildren(element, type, props)"]
    SetInitial["setInitialProperties(element, type, props)"]
    CommitUpdate["commitUpdate(element, type, oldProps, newProps)"]
    UpdateProps["updateProperties(element, type, oldProps, newProps)"]
    UpdateFiberProps["updateFiberProps(element, newProps)"]

    Mount --> AppendChild
    AppendChild --> Finalize
    Finalize --> SetInitial
    Update --> CommitUpdate
    CommitUpdate --> UpdateProps
    UpdateProps --> UpdateFiberProps
```
Key functions from `ReactDOMComponent`:

-   `setInitialProperties(domElement, tag, props)` - Applied during finalization [packages/react-dom-bindings/src/client/ReactDOMComponent.js](https://github.com/facebook/react/blob/65eec428/packages/react-dom-bindings/src/client/ReactDOMComponent.js)
-   `updateProperties(domElement, tag, lastProps, nextProps)` - Applied during commit update [packages/react-dom-bindings/src/client/ReactDOMComponent.js](https://github.com/facebook/react/blob/65eec428/packages/react-dom-bindings/src/client/ReactDOMComponent.js)

Special property handling includes:

-   `dangerouslySetInnerHTML` - Sets innerHTML
-   `children` (when string/number) - Sets textContent
-   `style` - Object converted to CSS string
-   `autoFocus` - Handled in `commitMount`
-   Event handlers - Registered with event system
-   `value`, `checked`, `selected` - Special form control properties

**Sources:** [packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js78-86](https://github.com/facebook/react/blob/65eec428/packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js#L78-L86) [packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js917-930](https://github.com/facebook/react/blob/65eec428/packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js#L917-L930)

## Mutation Operations

ReactFiberConfigDOM operates in mutation mode (`supportsMutation = true`), directly modifying the DOM tree. All mutation operations support the `moveBefore` API when available.

### Core Mutation Methods

| Method | Purpose | When Called |
| --- | --- | --- |
| `appendChild(parent, child)` | Append child to end | Repositioning during updates |
| `appendChildToContainer(container, child)` | Append to root container | Mounting root content |
| `insertBefore(parent, child, before)` | Insert child before sibling | Reordering, insertion |
| `insertInContainerBefore(container, child, before)` | Insert into root before sibling | Root-level insertions |
| `removeChild(parent, child)` | Remove child from parent | Deletions |
| `removeChildFromContainer(container, child)` | Remove from root | Root-level deletions |

### moveBefore Feature Detection

React detects and uses the `moveBefore` DOM API when available for more efficient repositioning:

```mermaid
flowchart TD
    AppendChild["appendChild(parentInstance, child)"]
    CheckMoveBefore["supportsMoveBefore &&child.parentNode !== null"]
    UseMoveBefore["parentInstance.moveBefore(child, null)"]
    UseAppend["parentInstance.appendChild(child)"]

    AppendChild --> CheckMoveBefore
    CheckMoveBefore --> UseMoveBefore
    CheckMoveBefore --> UseAppend
```
**Sources:** [packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js944-960](https://github.com/facebook/react/blob/65eec428/packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js#L944-L960)

### Commit Operations

```mermaid
flowchart TD
    CommitMount["commitMount(element, type, props, fiber)"]
    CommitUpdate["commitUpdate(element, type, oldProps, newProps, fiber)"]
    CommitTextUpdate["commitTextUpdate(textInstance, oldText, newText)"]
    CheckAutoFocus["type matches form element& autoFocus?"]
    Focus["element.focus()"]
    ReassignSrc["Reassign src/srcSetto trigger load event"]
    UpdateProperties["updateProperties(element, type, oldProps, newProps)"]
    UpdateFiberProps["updateFiberProps(element, newProps)"]
    SetNodeValue["textInstance.nodeValue = newText"]

    CommitMount --> CheckAutoFocus
    CheckAutoFocus --> Focus
    CheckAutoFocus --> ReassignSrc
    CommitUpdate --> UpdateProperties
    UpdateProperties --> UpdateFiberProps
    CommitTextUpdate --> SetNodeValue
```
**Sources:** [packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js813-872](https://github.com/facebook/react/blob/65eec428/packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js#L813-L872) [packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js917-942](https://github.com/facebook/react/blob/65eec428/packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js#L917-L942)

## Event System Integration

ReactFiberConfigDOM integrates with React's synthetic event system through several key functions.

### Event Setup

```mermaid
flowchart TD
    PrepareForCommit["prepareForCommit(container)"]
    DisableEvents["ReactBrowserEventEmitterSetEnabled(false)"]
    SaveSelection["getSelectionInformation(container)"]
    ResetAfterCommit["resetAfterCommit(container)"]
    RestoreSelection["restoreSelection(selectionInfo, container)"]
    EnableEvents["ReactBrowserEventEmitterSetEnabled(true)"]
    PreparePortal["preparePortalMount(portalInstance)"]
    ListenAll["listenToAllSupportedEvents(portalInstance)"]

    PrepareForCommit --> DisableEvents
    DisableEvents --> SaveSelection
    ResetAfterCommit --> RestoreSelection
    RestoreSelection --> EnableEvents
    PreparePortal --> ListenAll
```
The event system is temporarily disabled during commits to prevent unwanted event dispatching while the DOM is being mutated.

**Sources:** [packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js412-450](https://github.com/facebook/react/blob/65eec428/packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js#L412-L450) [packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js767-769](https://github.com/facebook/react/blob/65eec428/packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js#L767-L769)

### Priority and Event Tracking

```mermaid
flowchart TD
    TrackEvent["trackSchedulerEvent()"]
    SaveEvent["schedulerEvent = window.event"]
    ResolveType["resolveEventType()"]
    CheckEvent["event && event !== schedulerEvent?"]
    ReturnType["Return event.type"]
    ReturnNull["Return null"]
    ResolveTimestamp["resolveEventTimeStamp()"]
    CheckEvent2["event && event !== schedulerEvent?"]
    ReturnTS["Return event.timeStamp"]
    ReturnDefault["Return -1.1"]

    TrackEvent --> SaveEvent
    ResolveType --> CheckEvent
    CheckEvent --> ReturnType
    CheckEvent --> ReturnNull
    ResolveTimestamp --> CheckEvent2
    CheckEvent2 --> ReturnTS
    CheckEvent2 --> ReturnDefault
```
These functions help the reconciler determine the priority and nature of the current event for scheduling purposes.

**Sources:** [packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js734-747](https://github.com/facebook/react/blob/65eec428/packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js#L734-L747)

### Eager Transitions

```mermaid
flowchart TD
    ShouldAttempt["shouldAttemptEagerTransition()"]
    CheckEventType["event.type === 'popstate'"]
    ReturnFalse["Return false"]
    CheckCached["event === currentPopstateTransitionEvent?"]
    ReturnFalse2["Return false(already attempted)"]
    CacheAndReturn["currentPopstateTransitionEvent = eventReturn true"]

    ShouldAttempt --> CheckEventType
    CheckEventType --> ReturnFalse
    CheckEventType --> CheckCached
    CheckCached --> ReturnFalse2
    CheckCached --> CacheAndReturn
```
This optimization attempts to render popstate transitions synchronously to avoid flicker during browser history navigation.

**Sources:** [packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js709-732](https://github.com/facebook/react/blob/65eec428/packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js#L709-L732)

## Resource Management

ReactFiberConfigDOM implements special handling for "hoistable" resources - elements like stylesheets and scripts that should be singleton instances in the document head.

### Hoistable Elements

Resources are marked as hoistable through the `markNodeAsHoistable` function, which sets an internal flag on the DOM node:

```mermaid
flowchart TD
    CreateHoistable["createHoistableInstance()"]
    CreateElement["createElement(type)"]
    SetProps["setInitialProperties()"]
    MarkHoistable["markNodeAsHoistable(element)"]
    CheckHoistable["isMarkedHoistable(element)"]
    ReadFlag["Check internal flag"]
    GetResources["getResourcesFromRoot(root)"]
    ReturnSet["Return Set of hoistable instances"]

    CreateHoistable --> CreateElement
    CreateElement --> SetProps
    SetProps --> MarkHoistable
    CheckHoistable --> ReadFlag
    GetResources --> ReturnSet
```
The hoisting mechanism ensures that:

-   Multiple identical `<link>` or `<script>` elements are deduplicated
-   Resources are moved to the document `<head>`
-   Resources persist across re-renders if they remain in the tree

**Sources:** [packages/react-dom-bindings/src/client/ReactDOMComponentTree.js56-59](https://github.com/facebook/react/blob/65eec428/packages/react-dom-bindings/src/client/ReactDOMComponentTree.js#L56-L59) [packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js452-468](https://github.com/facebook/react/blob/65eec428/packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js#L452-L468)

### Resource Validation

For stylesheet links, React validates props to ensure correct resource semantics:

```mermaid
flowchart TD
    ValidateLink["validateLinkPropsForStyleResource(props)"]
    CheckRel["props.rel === 'stylesheet'?"]
    Error1["Warn: link must have rel='stylesheet'"]
    CheckHref["props.href present?"]
    Error2["Warn: stylesheet link must have href"]
    CheckOnLoad["props.onLoad or props.onError?"]
    Error3["Warn: stylesheet links in headcannot have onLoad/onError"]

    ValidateLink --> CheckRel
    CheckRel --> Error1
    CheckRel --> CheckHref
    CheckHref --> Error2
    CheckHref --> CheckOnLoad
    CheckOnLoad --> Error3
```
**Sources:** [packages/react-dom-bindings/src/shared/ReactDOMResourceValidation.js138](https://github.com/facebook/react/blob/65eec428/packages/react-dom-bindings/src/shared/ReactDOMResourceValidation.js#L138-L138)

## Special Element Handling

Several element types require special treatment beyond standard property application.

### Script Elements

Script tags must be created in a way that prevents execution:

```mermaid
flowchart TD
    CreateScript["Creating 'script' element"]
    CreateDiv["Create temporary div"]
    SetInnerHTML["div.innerHTML = ''"]
    ExtractScript["Extract script element"]
    RemoveFromDiv["div.removeChild(firstChild)"]
    Return["Return non-executing script element"]

    CreateScript --> CreateDiv
    CreateDiv --> SetInnerHTML
    SetInnerHTML --> ExtractScript
    ExtractScript --> RemoveFromDiv
    RemoveFromDiv --> Return
```
This ensures scripts don't execute during render, only during commit if explicitly mounted.

**Sources:** [packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js523-542](https://github.com/facebook/react/blob/65eec428/packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js#L523-L542)

### Select Elements

Select elements handle `multiple` and `size` props specially:

```mermaid
flowchart TD
    CreateSelect["Creating 'select' element"]
    CheckMultiple["props.multiple?"]
    SetMultiple["element.multiple = true"]
    CheckSize["props.size?"]
    SetSize["element.size = props.size(enables multi-select mode)"]

    CreateSelect --> CheckMultiple
    CheckMultiple --> SetMultiple
    CheckMultiple --> CheckSize
    CheckSize --> SetSize
```
**Sources:** [packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js544-562](https://github.com/facebook/react/blob/65eec428/packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js#L544-L562)

### Form Controls (Input, Textarea, Select)

Form controls have specialized prop handling:

-   `finalizeInitialChildren` returns `true` for inputs, selects, textareas to schedule `commitMount`
-   `commitMount` handles `autoFocus` by calling `element.focus()`
-   Dedicated modules handle controlled vs uncontrolled state: `ReactDOMInput`, `ReactDOMTextarea`, `ReactDOMSelect`

**Sources:** [packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js625-643](https://github.com/facebook/react/blob/65eec428/packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js#L625-L643) [packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js813-872](https://github.com/facebook/react/blob/65eec428/packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js#L813-L872)

### Image Elements

Images receive special handling in `commitMount` to ensure `onLoad` events fire correctly:

```mermaid
flowchart TD
    CommitMountImg["commitMount for 'img'"]
    CheckSrc["props.src present?"]
    CheckObjectSrc["src is object(Blob/MediaStream)?"]
    SetSrcObject["setSrcObject(element, type, src)"]
    ReassignSrc["element.src = src(triggers new load)"]
    CheckSrcSet["props.srcSet present?"]
    ReassignSrcSet["element.srcset = srcSet"]

    CommitMountImg --> CheckSrc
    CheckSrc --> CheckObjectSrc
    CheckObjectSrc --> SetSrcObject
    CheckObjectSrc --> ReassignSrc
    CheckSrc --> CheckSrcSet
    CheckSrcSet --> ReassignSrcSet
```
The reassignment ensures that even if the image has already loaded, the `onLoad` handler will be called again.

**Sources:** [packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js838-869](https://github.com/facebook/react/blob/65eec428/packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js#L838-L869)

## Hydration Support

ReactFiberConfigDOM provides hydration functions to match server-rendered HTML with React's virtual DOM during client-side hydration. This is a large topic covered in detail in [Hydration System](/facebook/react/6.3-hydration-system).

Key hydration functions exported:

-   `hydrateProperties(domElement, tag, props)` - Matches and validates props
-   `hydrateText(textInstance, text)` - Validates text content
-   `diffHydratedProperties(domElement, tag, props)` - Produces update payload for mismatches
-   `diffHydratedText(textInstance, text)` - Checks for text mismatches

Hydration also handles special cases:

-   Dehydrated Suspense boundaries (marked with comment nodes)
-   Form state markers for preserving form data across SSR
-   Input/textarea/select state synchronization via `hydrateInput`, `hydrateTextarea`, `hydrateSelect`

**Sources:** [packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js81-89](https://github.com/facebook/react/blob/65eec428/packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js#L81-L89) [packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js874-915](https://github.com/facebook/react/blob/65eec428/packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js#L874-L915)

## View Transitions and Scheduling

ReactFiberConfigDOM includes stubs and partial implementations for view transitions, which enable animated transitions between states. Full details are in [View Transitions and Gesture Scheduling](/facebook/react/6.4-view-transitions-and-gesture-scheduling).

### View Transition Lifecycle

The host config provides functions called by the reconciler during view transitions:

| Function | Purpose |
| --- | --- |
| `measureInstance(instance)` | Capture instance measurements before transition |
| `cloneRootViewTransitionContainer(root)` | Clone the root for "old" state capture |
| `startViewTransition(...)` | Begin coordinating the transition animation |
| `applyViewTransitionName(instance, name, className)` | Apply CSS view-transition-name |
| `stopViewTransition(transition)` | End the transition |

### Gesture Scheduling

Gesture timeline integration (for scrubbing through transitions) is also stubbed:

```mermaid
flowchart TD
    StartGesture["startGestureTransition(container, timeline, ...)"]
    MutationCB["mutationCallback()"]
    AnimateCB["animateCallback()"]
    Return["Return null(no actual animation)"]

    StartGesture --> MutationCB
    MutationCB --> AnimateCB
    AnimateCB --> Return
```
**Sources:** [packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js1094-1358](https://github.com/facebook/react/blob/65eec428/packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js#L1094-L1358)

## Component Tree Mapping

ReactFiberConfigDOM maintains a mapping between DOM nodes and React fibers to support:

-   Event dispatching (finding the React instance for a DOM node)
-   React DevTools (inspecting the component tree)
-   Public instance access (refs)

### Mapping Functions

```mermaid
flowchart TD
    UpdateFiberProps["updateFiberProps(domNode, props)"]
    StoreProps["domNode[internalPropsKey] = props"]
    GetFiberProps["getFiberCurrentPropsFromNode(domNode)"]
    ReadProps["return domNode[internalPropsKey]"]
    GetInstance["getInstanceFromNode(domNode)"]
    ReadKey["return domNode[internalInstanceKey]"]
    PrecacheFiber["precacheFiberNode(fiber, domNode)"]
    StoreOnNode["domNode[internalInstanceKey] = fiber"]

    UpdateFiberProps --> StoreProps
    GetFiberProps --> ReadProps
    GetInstance --> ReadKey
    PrecacheFiber --> StoreOnNode
```
These mappings are established during instance creation and used throughout the lifecycle for event handling and introspection.

**Sources:** [packages/react-dom-bindings/src/client/ReactDOMComponentTree.js47-60](https://github.com/facebook/react/blob/65eec428/packages/react-dom-bindings/src/client/ReactDOMComponentTree.js#L47-L60)

## Summary

ReactFiberConfigDOM serves as the critical bridge between React's platform-agnostic reconciler and the browser DOM. It:

-   **Creates DOM instances** with proper namespacing (HTML, SVG, MathML)
-   **Manages properties** by translating React props to DOM attributes/properties
-   **Performs mutations** efficiently using native DOM APIs (with `moveBefore` optimization)
-   **Integrates events** by coordinating with React's synthetic event system
-   **Handles resources** through hoisting mechanisms for stylesheets and scripts
-   **Supports hydration** by matching server-rendered HTML with the React tree
-   **Enables view transitions** for animated state changes (experimental)

The implementation is mutation-based (unlike React Native's persistence mode) and optimized for the browser environment, with special handling for form controls, scripts, images, and other HTML-specific elements.

**Sources:** [packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js1-1500](https://github.com/facebook/react/blob/65eec428/packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js#L1-L1500)
