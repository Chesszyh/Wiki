# 环境配置

相关源文件

-   [backend/open\_webui/env.py](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py)
-   [backend/open\_webui/routers/audio.py](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/routers/audio.py)
-   [backend/open\_webui/routers/auths.py](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/routers/auths.py)
-   [backend/open\_webui/routers/ollama.py](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/routers/ollama.py)
-   [backend/open\_webui/routers/openai.py](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/routers/openai.py)
-   [backend/open\_webui/utils/auth.py](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/utils/auth.py)
-   [backend/open\_webui/utils/embeddings.py](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/utils/embeddings.py)
-   [backend/open\_webui/utils/misc.py](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/utils/misc.py)
-   [backend/open\_webui/utils/oauth.py](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/utils/oauth.py)
-   [backend/open\_webui/utils/response.py](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/utils/response.py)

## 目的与范围

本页记录了 [backend/open\_webui/env.py](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py) 中的环境配置系统，它在应用启动时为 Open WebUI 建立基础配置。`env.py` 模块从 `.env` 文件中加载环境变量，设置全局常量，配置数据库和 Redis 连接，并建立整个应用中使用的目录结构。

**env.py 的关键职责：**

-   使用 `python-dotenv` 加载环境变量。
-   定义应用范围内的常量（路径、URL、特性标志）。
-   配置数据库连接参数。
-   设置 Redis 连接设置。
-   确定 ML 操作的设备类型 (CPU/CUDA/MPS)。
-   配置每个子系统的日志级别。
-   定义安全设置（密钥、身份验证模式）。

**配置层级区分：**

```mermaid
flowchart TD
    ENV_FILE[".env 文件"]
    ENV_PY["env.py (静态常量)"]
    CONFIG_PY["config.py (动态配置)"]
    APP_STATE["app.state.config (运行时)"]
    APP_LOGIC["应用逻辑"]

    ENV_FILE --> ENV_PY
    ENV_PY --> CONFIG_PY
    CONFIG_PY --> APP_STATE
    ENV_PY --> APP_LOGIC
    APP_STATE --> APP_LOGIC
```
-   **env.py**：启动时加载一次的静态配置。如果不重启应用，其值无法更改。
-   **config.py**：由数据库和 Redis 支持的动态配置。`PersistentConfig` 中的值可以在运行时通过管理员 UI 进行更新。

有关运行时配置更新的信息，请参阅 [动态配置系统 (9.4)](https://github.com/open-webui/open-webui/blob/a7271532/Dynamic%20Configuration%20System%20(9.4))。有关特定部署的配置，请参阅 [部署与运维 (17)](https://github.com/open-webui/open-webui/blob/a7271532/Deployment%20and%20Operations%20(17))。

**来源：** [backend/open\_webui/env.py1-40](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L1-L40) [backend/open\_webui/config.py1-50](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/config.py#L1-L50) [backend/open\_webui/config.py158-283](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/config.py#L158-L283)

---

## 环境变量加载

Open WebUI 使用 `python-dotenv` 库从位于仓库根目录的 `.env` 文件中加载环境变量。加载过程发生在 [backend/open\_webui/env.py](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py) 的顶部，在进行任何其他导入或配置之前建立目录结构并加载环境变量。

### 目录路径解析

配置系统建立了一个在整个应用中使用的规范目录层级结构：

```mermaid
flowchart TD
    ENV_FILE_PATH["ENV_FILE_PATH Path(__file__).resolve() (env.py 的绝对路径)"]
    OPEN_WEBUI_DIR["OPEN_WEBUI_DIR ENV_FILE_PATH.parent (open_webui/ 目录)"]
    BACKEND_DIR["BACKEND_DIR OPEN_WEBUI_DIR.parent (backend/ 目录)"]
    BASE_DIR["BASE_DIR BACKEND_DIR.parent (项目根目录)"]
    DOT_ENV_PATH["BASE_DIR / '.env'"]
    OS_ENVIRON["os.environ"]
    CONSTANTS["全局常量 WEBUI_NAME, DATA_DIR, DATABASE_URL 等"]

    ENV_FILE_PATH --> OPEN_WEBUI_DIR
    OPEN_WEBUI_DIR --> BACKEND_DIR
    BACKEND_DIR --> BASE_DIR
    BASE_DIR --> DOT_ENV_PATH
    DOT_ENV_PATH --> OS_ENVIRON
    OS_ENVIRON --> CONSTANTS
```
**定义的目录常量：**

| 常量 | 值 | 用途 |
| --- | --- | --- |
| `OPEN_WEBUI_DIR` | `Path(__file__).parent` | Python 包的位置 |
| `BACKEND_DIR` | `OPEN_WEBUI_DIR.parent` | 后端代码目录 |
| `BASE_DIR` | `BACKEND_DIR.parent` | 项目根目录 |
| `DATA_DIR` | `DATA_DIR` 环境变量或 `BACKEND_DIR/data` | 持久化数据存储 |
| `STATIC_DIR` | `STATIC_DIR` 环境变量或 `OPEN_WEBUI_DIR/static` | 静态资产目录 |
| `FRONTEND_BUILD_DIR` | `FRONTEND_BUILD_DIR` 环境变量或 `BASE_DIR/build` | 编译后的前端资源 |

路径解析使用 `.resolve()` 来获取规范路径，并移除任何 `..` 或 `.` 组件。这确保了整个代码库中路径引用的一致性。

**来源：** [backend/open\_webui/env.py20-35](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L20-L35) [backend/open\_webui/env.py230-263](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L230-L263)

---

## 变量处理模式

Open WebUI 中的环境变量在类型转换、验证和默认值分配方面遵循一致的模式。

### 布尔变量

布尔环境变量使用小写字符串与 "true" 进行比较：

```python
DOCKER = os.environ.get("DOCKER", "False").lower() == "true"
WEBUI_AUTH = os.environ.get("WEBUI_AUTH", "True").lower() == "true"
ENABLE_OAUTH_SIGNUP = os.environ.get("ENABLE_OAUTH_SIGNUP", "False").lower() == "true"
```
这种模式在 [backend/open\_webui/env.py](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py) 中广泛用于特性标志和布尔设置。

### 带有验证的整数变量

整数变量包含错误处理以确保数值有效：

```python
try:
    DATABASE_POOL_SIZE = int(DATABASE_POOL_SIZE)
except Exception:
    DATABASE_POOL_SIZE = None
```
对于可选的整数变量，通常会进行空字符串处理：

```python
if DATABASE_POOL_TIMEOUT == "":
    DATABASE_POOL_TIMEOUT = 30
else:
    try:
        DATABASE_POOL_TIMEOUT = int(DATABASE_POOL_TIMEOUT)
    except Exception:
        DATABASE_POOL_TIMEOUT = 30
```
**来源：** [backend/open\_webui/env.py309-335](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L309-L335)

### JSON 变量

以 JSON 字符串形式存储的复杂配置使用错误处理进行解析：

```python
SENTENCE_TRANSFORMERS_MODEL_KWARGS = os.environ.get("SENTENCE_TRANSFORMERS_MODEL_KWARGS", "")
if SENTENCE_TRANSFORMERS_MODEL_KWARGS == "":
    SENTENCE_TRANSFORMERS_MODEL_KWARGS = None
else:
    try:
        SENTENCE_TRANSFORMERS_MODEL_KWARGS = json.loads(SENTENCE_TRANSFORMERS_MODEL_KWARGS)
    except Exception:
        SENTENCE_TRANSFORMERS_MODEL_KWARGS = None
```
**来源：** [backend/open\_webui/env.py658-669](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L658-L669)

---

## 配置类别

环境变量被组织到不同的功能域中。下图将高层类别与其产生的关键配置常量进行了映射：

```mermaid
flowchart TD
    ENABLE_OTEL["ENABLE_OTEL"]
    AUDIT_LOG_LEVEL["AUDIT_LOG_LEVEL"]
    DEVICE_TYPE["DEVICE_TYPE"]
    SENTENCE_TRANSFORMERS_BACKEND["SENTENCE_TRANSFORMERS_BACKEND"]
    MODELS_CACHE_TTL["MODELS_CACHE_TTL"]
    ENABLE_WEBSOCKET_SUPPORT["ENABLE_WEBSOCKET_SUPPORT"]
    WEBSOCKET_MANAGER["WEBSOCKET_MANAGER"]
    AIOHTTP_CLIENT_TIMEOUT["AIOHTTP_CLIENT_TIMEOUT"]
    WEBUI_SECRET_KEY["WEBUI_SECRET_KEY"]
    WEBUI_AUTH["WEBUI_AUTH"]
    OAUTH_CLIENT_INFO_ENCRYPTION_KEY["OAUTH_CLIENT_INFO_ENCRYPTION_KEY"]
    DATA_DIR["DATA_DIR"]
    DATABASE_URL["DATABASE_URL"]
    REDIS_URL["REDIS_URL"]
    GLOBAL_LOG_LEVEL["GLOBAL_LOG_LEVEL"]
    SRC_LOG_LEVELS["SRC_LOG_LEVELS"]
```
**来源：** [backend/open\_webui/env.py73-110](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L73-L110) [backend/open\_webui/env.py277-369](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L277-L369) [backend/open\_webui/env.py441-490](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L441-L490) [backend/open\_webui/env.py576-646](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L576-L646) [backend/open\_webui/env.py42-67](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L42-L67) [backend/open\_webui/env.py739-802](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L739-L802) [backend/open\_webui/env.py707-732](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L707-L732)

---

## 日志配置

日志系统同时支持全局和按源划分的日志级别，从而实现了对日志输出的精细控制。

### 日志级别层级

```mermaid
flowchart TD
    GLOBAL_LOG_LEVEL["GLOBAL_LOG_LEVEL 默认: INFO"]
    log_sources["日志源: AUDIO, COMFYUI, CONFIG, DB, IMAGES, MAIN, MODELS, OLLAMA, OPENAI, RAG, WEBHOOK, SOCKET, OAUTH"]
    SRC_LOG_LEVELS["SRC_LOG_LEVELS 字典 按源覆盖"]
    ENV_VARS["环境变量: AUDIO_LOG_LEVEL, CONFIG_LOG_LEVEL 等"]
    Logger["各模块中的 logging.getLogger(name)"]

    GLOBAL_LOG_LEVEL --> SRC_LOG_LEVELS
    ENV_VARS --> SRC_LOG_LEVELS
    log_sources --> ENV_VARS
    SRC_LOG_LEVELS --> Logger
```
**来源：** [backend/open\_webui/env.py73-111](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L73-L111)

### 日志级别变量

| 变量 | 默认值 | 描述 |
| --- | --- | --- |
| `GLOBAL_LOG_LEVEL` | `INFO` | 为所有记录器设置基础日志级别 |
| `AUDIO_LOG_LEVEL` | 继承 `GLOBAL_LOG_LEVEL` | 音频服务日志 |
| `COMFYUI_LOG_LEVEL` | 继承 `GLOBAL_LOG_LEVEL` | ComfyUI 集成日志 |
| `CONFIG_LOG_LEVEL` | 继承 `GLOBAL_LOG_LEVEL` | 配置系统日志 |
| `DB_LOG_LEVEL` | 继承 `GLOBAL_LOG_LEVEL` | 数据库操作日志 |
| `IMAGES_LOG_LEVEL` | 继承 `GLOBAL_LOG_LEVEL` | 图像生成日志 |
| `MAIN_LOG_LEVEL` | 继承 `GLOBAL_LOG_LEVEL` | 主应用程序日志 |
| `MODELS_LOG_LEVEL` | 继承 `GLOBAL_LOG_LEVEL` | 模型管理日志 |
| `OLLAMA_LOG_LEVEL` | 继承 `GLOBAL_LOG_LEVEL` | Ollama 集成日志 |
| `OPENAI_LOG_LEVEL` | 继承 `GLOBAL_LOG_LEVEL` | OpenAI 集成日志 |
| `RAG_LOG_LEVEL` | 继承 `GLOBAL_LOG_LEVEL` | RAG 系统日志 |
| `WEBHOOK_LOG_LEVEL` | 继承 `GLOBAL_LOG_LEVEL` | Webhook 日志 |
| `SOCKET_LOG_LEVEL` | 继承 `GLOBAL_LOG_LEVEL` | WebSocket 日志 |
| `OAUTH_LOG_LEVEL` | 继承 `GLOBAL_LOG_LEVEL` | OAuth 身份验证日志 |

有效的日志级别：`DEBUG`, `INFO`, `WARNING`, `ERROR`, `CRITICAL`

**来源：** [backend/open\_webui/env.py86-111](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L86-L111)

---

## 路径与目录配置

Open WebUI 配置了多个目录路径，这些路径可以通过环境变量进行自定义。当从已安装的包运行 (`FROM_INIT_PY=true`) 时，系统会自动将数据从旧位置迁移到新位置。

### 目录变量

| 变量 | 默认值 | 描述 |
| --- | --- | --- |
| `DATA_DIR` | `backend/data` 或 `open_webui/data` | 持久化数据的根目录 |
| `STATIC_DIR` | `open_webui/static` | 静态资产目录 |
| `FONTS_DIR` | `open_webui/static/fonts` | 字体文件目录 |
| `FRONTEND_BUILD_DIR` | `build/` 或 `open_webui/frontend` | 编译后的前端资产 |

### 数据目录迁移

当 `FROM_INIT_PY` 为 true（通过 pip 安装）时，系统会检查现有的数据目录并进行迁移：

```mermaid
flowchart TD
    Check["DATA_DIR 是否存在 且不同于 NEW_DATA_DIR？"]
    Copy["将所有项复制到 NEW_DATA_DIR 使用 shutil.copytree() 复制目录 使用 shutil.copy2() 复制文件"]
    Zip["创建备份存档 open_webui_data.zip"]
    Remove["移除旧的 DATA_DIR 使用 shutil.rmtree()"]
    Update["将 DATA_DIR 更新为 NEW_DATA_DIR"]

    Check -- 是 --> Copy
    Copy --> Zip
    Zip --> Remove
    Remove --> Update
    Check -- 否 --> Update
```
**来源：** [backend/open\_webui/env.py230-263](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L230-L263)

---

## 数据库配置

数据库配置系统支持多种数据库类型，具有连接池功能，并能从旧的数据库名称进行迁移。

### 数据库 URL 构造

`DATABASE_URL` 可以从单个环境变量或多个组件变量构造，并具有自动的方言 (dialect) 规范化功能：

```mermaid
flowchart TD
    DATABASE_URL_ENV["os.environ.get('DATABASE_URL')"]
    CheckURL["是否提供了 DATABASE_URL？"]
    IndividualVars["DB_VARS 字典: DATABASE_TYPE, DATABASE_USER, DATABASE_PASSWORD, DATABASE_HOST, DATABASE_PORT, DATABASE_NAME"]
    CheckComplete["all(DB_VARS.values()) 是否为 true？"]
    ConstructURL["DATABASE_URL = f'{db_type}://{db_cred}@{db_host}:{db_port}/{db_name}'"]
    CheckSQLCipher["DATABASE_TYPE == 'sqlite+sqlcipher'？"]
    SQLCipherURL["DATABASE_URL = f'sqlite+sqlcipher:///{DATA_DIR}/webui.db'"]
    DefaultSQLite["DATABASE_URL = f'sqlite:///{DATA_DIR}/webui.db'"]
    PostgresCheck["DATABASE_URL 是否包含 'postgres://'？"]
    ReplacePostgres["DATABASE_URL = DATABASE_URL.replace('postgres://', 'postgresql://')"]
    FinalURL["DATABASE_URL (全局常量)"]

    DATABASE_URL_ENV --> CheckURL
    CheckURL -- 是 --> PostgresCheck
    CheckURL -- 否 --> IndividualVars
    IndividualVars --> CheckComplete
    CheckComplete -- 是 --> ConstructURL
    CheckComplete -- 否 --> CheckSQLCipher
    CheckSQLCipher -- 是 --> SQLCipherURL
    CheckSQLCipher -- 否 --> DefaultSQLite
    ConstructURL --> PostgresCheck
    SQLCipherURL --> PostgresCheck
    DefaultSQLite --> PostgresCheck
    PostgresCheck -- 是 --> ReplacePostgres
    PostgresCheck -- 否 --> FinalURL
    ReplacePostgres --> FinalURL
```
构造逻辑还处理了数据库文件名的迁移：如果在 `DATA_DIR` 中发现了旧的 `ollama.db`，则会将其重命名为 `webui.db`。

**来源：** [backend/open\_webui/env.py277-310](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L277-L310)

### 数据库配置变量

这些常量由 [backend/open\_webui/internal/db.py](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/internal/db.py) 消耗，用于配置 SQLAlchemy 引擎和连接池：

| 变量 | 默认值 | 描述 |
| --- | --- | --- |
| `DATABASE_URL` | `sqlite:///DATA_DIR/webui.db` | 完整的数据库连接 URL（由 SQLAlchemy 的 `create_engine()` 使用） |
| `DATABASE_TYPE` | \- | 数据库类型 (sqlite, postgresql, mysql 等) |
| `DATABASE_USER` | \- | 数据库用户名 |
| `DATABASE_PASSWORD` | \- | 数据库密码 |
| `DATABASE_HOST` | \- | 数据库主机 |
| `DATABASE_PORT` | \- | 数据库端口 |
| `DATABASE_NAME` | \- | 数据库名称 |
| `DATABASE_SCHEMA` | `None` | PostgreSQL 模式名称（传递给 SQLAlchemy 的 `connect_args`） |
| `DATABASE_POOL_SIZE` | `None` | SQLAlchemy 的 `pool_size` 参数 |
| `DATABASE_POOL_MAX_OVERFLOW` | `0` | SQLAlchemy 的 `max_overflow` 参数 |
| `DATABASE_POOL_TIMEOUT` | `30` | SQLAlchemy 的 `pool_timeout` 参数 (秒) |
| `DATABASE_POOL_RECYCLE` | `3600` | SQLAlchemy 的 `pool_recycle` 参数 (秒) |
| `DATABASE_ENABLE_SQLITE_WAL` | `False` | 启用 SQLite 的预写日志 (Write-Ahead Logging)（执行 `PRAGMA journal_mode=WAL`） |
| `DATABASE_USER_ACTIVE_STATUS_UPDATE_INTERVAL` | `None` | 更新用户活跃状态的时间间隔（浮点秒数，`None` 表示禁用） |

**来源：** [backend/open\_webui/env.py277-366](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L277-L366)

### 数据库迁移

系统会自动将旧的 `ollama.db` 文件重命名为 `webui.db`：

```python
if os.path.exists(f"{DATA_DIR}/ollama.db"):
    os.rename(f"{DATA_DIR}/ollama.db", f"{DATA_DIR}/webui.db")
```
**来源：** [backend/open\_webui/env.py270-275](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L270-L275)

---

## Redis 配置

Redis 为多实例部署提供了分布式缓存、会话管理和实时状态同步。Redis 客户端由 [backend/open\_webui/utils/redis.py](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/utils/redis.py) 中的 `get_redis_connection()` 使用这些环境常量进行初始化。

### Redis 连接配置

```mermaid
flowchart TD
    REDIS_URL["REDIS_URL (环境变量)"]
    REDIS_CLUSTER["REDIS_CLUSTER (环境变量)"]
    REDIS_SENTINEL["REDIS_SENTINEL_HOSTS, REDIS_SENTINEL_PORT (环境变量)"]
    GET_REDIS["get_redis_connection() (utils/redis.py)"]
    CLIENT_TYPE["连接类型？"]
    SENTINEL_CLIENT["Sentinel(sentinels, sentinel_kwargs).master_for()"]
    CLUSTER_CLIENT["RedisCluster(redis_url, decode_responses)"]
    REGULAR_CLIENT["Redis(redis_url, decode_responses)"]
    APP_STATE["app.state.redis (FastAPI)"]
    APP_CONFIG["app.state.config._redis (AppConfig)"]
    SESSION_POOL["SESSION_POOL (socket.io)"]

    REDIS_URL --> GET_REDIS
    REDIS_CLUSTER --> GET_REDIS
    REDIS_SENTINEL --> GET_REDIS
    GET_REDIS --> CLIENT_TYPE
    CLIENT_TYPE -- 哨兵模式 --> SENTINEL_CLIENT
    CLIENT_TYPE -- 集群模式 --> CLUSTER_CLIENT
    CLIENT_TYPE -- 普通模式 --> REGULAR_CLIENT
    SENTINEL_CLIENT --> APP_STATE
    CLUSTER_CLIENT --> APP_STATE
    REGULAR_CLIENT --> APP_STATE
    APP_STATE --> APP_CONFIG
    APP_STATE --> SESSION_POOL
```
**Redis 核心变量：**

| 变量 | 默认值 | 描述 |
| --- | --- | --- |
| `REDIS_URL` | `""` | Redis 连接 URL (例如 `redis://localhost:6379`) |
| `REDIS_CLUSTER` | `False` | 启用 Redis 集群模式（使用 `RedisCluster` 类） |
| `REDIS_KEY_PREFIX` | `open-webui` | 所有 Redis 键的前缀（用于 `AppConfig` 和 Socket.IO） |
| `REDIS_SENTINEL_HOSTS` | `""` | 逗号分隔的哨兵 (Sentinel) 主机列表 |
| `REDIS_SENTINEL_PORT` | `26379` | 哨兵端口（与 `REDIS_SENTINEL_HOSTS` 中的每个主机配合使用） |
| `REDIS_SENTINEL_MAX_RETRY_COUNT` | `2` | 哨兵故障转移操作的最大重试次数 |

**WebSocket 专用的 Redis 变量：**

| 变量 | 默认值 | 描述 |
| --- | --- | --- |
| `WEBSOCKET_MANAGER` | `""` | WebSocket 管理器类型（设为 `redis` 以启用 Redis 后端的 WebSocket） |
| `WEBSOCKET_REDIS_URL` | 继承 `REDIS_URL` | 用于 WebSocket 状态的独立 Redis URL |
| `WEBSOCKET_REDIS_CLUSTER` | 继承 `REDIS_CLUSTER` | 为 WebSocket Redis 启用集群模式 |
| `WEBSOCKET_REDIS_LOCK_TIMEOUT` | `60` | 分布式锁的锁定超时时间 (秒) |
| `WEBSOCKET_SENTINEL_HOSTS` | `""` | 用于 WebSocket Redis 的哨兵主机 |
| `WEBSOCKET_SENTINEL_PORT` | `26379` | 用于 WebSocket Redis 的哨兵端口 |

**来源：** [backend/open\_webui/env.py372-397](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L372-L397) [backend/open\_webui/env.py576-597](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L576-L597) [backend/open\_webui/utils/redis.py1-100](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/utils/redis.py#L1-L100)

---

## 身份验证与安全配置

身份验证系统支持多种身份验证方法，具有基于 JWT 的会话管理和可配置的安全设置。

### 带有环境变量的身份验证流程

```mermaid
flowchart TD
    WEBUI_AUTH["WEBUI_AUTH (env.py)"]
    CheckAuth["WEBUI_AUTH == True？"]
    TrustedHeader["WEBUI_AUTH_TRUSTED_EMAIL_HEADER (env.py)"]
    CheckHeader["是否配置了受信任请求头？"]
    LocalAuth["本地身份验证 Auths.authenticate_user() (routers/auths.py)"]
    HeaderAuth["受信任请求头验证 request.headers.get() (routers/auths.py)"]
    JWTCreation["create_token() (utils/auth.py) 使用 WEBUI_SECRET_KEY 和 JWT_EXPIRES_IN"]
    SetCookie["response.set_cookie('token') 属性: httponly=True, samesite=WEBUI_AUTH_COOKIE_SAME_SITE, secure=WEBUI_AUTH_COOKIE_SECURE"]
    DisabledAuth["自动以 admin@localhost 登录 Users.get_first_user()"]

    WEBUI_AUTH --> CheckAuth
    CheckAuth -- 是 --> TrustedHeader
    CheckAuth -- 否 --> DisabledAuth
    TrustedHeader --> CheckHeader
    CheckHeader -- 是 --> HeaderAuth
    CheckHeader -- 否 --> LocalAuth
    HeaderAuth --> JWTCreation
    LocalAuth --> JWTCreation
    JWTCreation --> SetCookie
```
**来源：** [backend/open\_webui/env.py408-471](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L408-L471) [backend/open\_webui/routers/auths.py106-161](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/routers/auths.py#L106-L161) [backend/open\_webui/routers/auths.py464-566](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/routers/auths.py#L464-L566) [backend/open\_webui/utils/auth.py159-199](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/utils/auth.py#L159-L199)

### 核心身份验证变量

| 变量 | 默认值 | 描述 |
| --- | --- | --- |
| `WEBUI_AUTH` | `True` | 启用/禁用身份验证系统 |
| `WEBUI_SECRET_KEY` | `t0p-s3cr3t` | JWT 签名密钥 (旧称: `WEBUI_JWT_SECRET_KEY`) |
| `WEBUI_SESSION_COOKIE_SAME_SITE` | `lax` | 会话 Cookie 的 SameSite 属性 |
| `WEBUI_SESSION_COOKIE_SECURE` | `False` | 是否要求会话 Cookie 使用 HTTPS |
| `WEBUI_AUTH_COOKIE_SAME_SITE` | 继承会话值 | 身份验证专用 Cookie 的 SameSite 属性 |
| `WEBUI_AUTH_COOKIE_SECURE` | 继承会话值 | 是否要求身份验证 Cookie 使用 HTTPS |
| `ENABLE_INITIAL_ADMIN_SIGNUP` | `False` | 禁用身份验证时允许首位用户注册 |
| `ENABLE_SIGNUP_PASSWORD_CONFIRMATION` | `False` | 注册时是否要求确认密码 |
| `BYPASS_MODEL_ACCESS_CONTROL` | `False` | 禁用针对每个模型的访问控制检查 |

**来源：** [backend/open\_webui/env.py408-471](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L408-L471)

### 受信任请求头身份验证

| 变量 | 默认值 | 描述 |
| --- | --- | --- |
| `WEBUI_AUTH_TRUSTED_EMAIL_HEADER` | `None` | 包含已验证电子邮件的 HTTP 请求头 |
| `WEBUI_AUTH_TRUSTED_NAME_HEADER` | `None` | 包含用户姓名的 HTTP 请求头 |
| `WEBUI_AUTH_TRUSTED_GROUPS_HEADER` | `None` | 包含用户组（逗号分隔）的 HTTP 请求头 |
| `WEBUI_AUTH_SIGNOUT_REDIRECT_URL` | `None` | 退出登录后的重定向 URL |

当设置了 `WEBUI_AUTH_TRUSTED_EMAIL_HEADER` 时，身份验证系统会信任由反向代理提供的身份信息。应用程序会自动根据请求头的值创建用户账户。

**来源：** [backend/open\_webui/env.py420-435](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L420-L435) [backend/open\_webui/routers/auths.py466-491](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/routers/auths.py#L466-L491)

### JWT 配置

| 变量 | 默认值 | 描述 |
| --- | --- | --- |
| `JWT_EXPIRES_IN` | 通过 `app.state.config` 配置 | JWT 令牌过期时间 (例如 `7d`, `24h`, `30m`) |

JWT 令牌使用 `WEBUI_SECRET_KEY` 并通过 HS256 算法创建。过期时间由 `parse_duration()` 解析，支持诸如 `7d`, `24h`, `30m`, `-1` (永不过期) 或 `0` (立即过期) 等格式。

**来源：** [backend/open\_webui/utils/auth.py46-48](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/utils/auth.py#L46-L48) [backend/open\_webui/utils/auth.py174-182](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/utils/auth.py#L174-L182)

---

## OAuth 配置

OAuth 配置控制第三方身份验证和动态客户端注册。

### OAuth 变量

| 变量 | 默认值 | 描述 |
| --- | --- | --- |
| `ENABLE_OAUTH_EMAIL_FALLBACK` | `False` | 如果缺少用户名声明，则将电子邮件用作备选 |
| `ENABLE_OAUTH_ID_TOKEN_COOKIE` | `True` | 在 Cookie 中存储 OAuth ID 令牌 |
| `OAUTH_CLIENT_INFO_ENCRYPTION_KEY` | 继承 `WEBUI_SECRET_KEY` | OAuth 客户端密钥的加密密钥 |
| `OAUTH_SESSION_TOKEN_ENCRYPTION_KEY` | 继承 `WEBUI_SECRET_KEY` | OAuth 会话令牌的加密密钥 |

### OAuth 加密密钥处理

```mermaid
flowchart TD
    KeySource["OAUTH_CLIENT_INFO_ENCRYPTION_KEY"]
    CheckLength["密钥长度是否为 44 字节？"]
    HashKey["使用 SHA-256 进行哈希处理 并通过 base64.urlsafe_b64encode() 编码"]
    UseDirectly["直接使用密钥 .encode()"]
    InitFernet["Fernet(key)"]
    EncryptDecrypt["encrypt_data() / decrypt_data()"]

    KeySource --> CheckLength
    CheckLength -- 否 --> HashKey
    CheckLength -- 是 --> UseDirectly
    HashKey --> InitFernet
    UseDirectly --> InitFernet
    InitFernet --> EncryptDecrypt
```
Fernet 加密系统要求一个 44 字节且经过 URL 安全的 base64 编码密钥。如果提供的密钥不符合此要求，它将被执行 SHA-256 哈希处理并重新编码。

**来源：** [backend/open\_webui/env.py476-490](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L476-L490) [backend/open\_webui/utils/oauth.py121-154](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/utils/oauth.py#L121-L154)

---

## SCIM 配置

SCIM (跨域身份管理系统) 提供了自动化的用户配置。

| 变量 | 默认值 | 描述 |
| --- | --- | --- |
| `SCIM_ENABLED` | `False` | 启用 SCIM 配置端点 |
| `SCIM_TOKEN` | `""` | 用于 SCIM 身份验证的 Bearer 令牌 |

**来源：** [backend/open\_webui/env.py493-498](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L493-L498)

---

## WebSocket 配置

WebSocket 支持实现了实时特性，如流式响应和协作编辑。

### WebSocket 变量

| 变量 | 默认值 | 描述 |
| --- | --- | --- |
| `ENABLE_WEBSOCKET_SUPPORT` | `True` | 启用 WebSocket 连接 |
| `WEBSOCKET_MANAGER` | `""` | WebSocket 管理器后端类型 |

### HTTP 客户端配置

WebSocket 和其他 HTTP 操作使用带有可配置超时的 aiohttp：

| 变量 | 默认值 | 描述 |
| --- | --- | --- |
| `AIOHTTP_CLIENT_TIMEOUT` | `None` | aiohttp 请求的默认超时时间 (秒) |
| `AIOHTTP_CLIENT_SESSION_SSL` | `True` | 为 aiohttp 会话启用 SSL 验证 |
| `AIOHTTP_CLIENT_TIMEOUT_MODEL_LIST` | `10` | 获取模型列表的超时时间 |
| `AIOHTTP_CLIENT_TIMEOUT_TOOL_SERVER_DATA` | `10` | 工具服务器数据请求的超时时间 |
| `AIOHTTP_CLIENT_SESSION_TOOL_SERVER_SSL` | `True` | 为工具服务器连接启用 SSL |

**来源：** [backend/open\_webui/env.py574-645](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L574-L645)

---

## AI/ML 配置

### 设备类型检测

`DEVICE_TYPE` 常量决定了 ML 操作（嵌入模型、重排序模型等）使用哪种硬件加速器：

```mermaid
flowchart TD
    USE_CUDA["USE_CUDA_DOCKER os.environ.get() (env.py)"]
    CheckCUDA["USE_CUDA.lower() == 'true'？"]
    TestTorch["import torch; torch.cuda.is_available()"]
    CUDASuccess["CUDA 是否可用？"]
    SetCUDA["DEVICE_TYPE = 'cuda' 由 SentenceTransformer(device=) 使用"]
    CheckMPS["torch.backends.mps.is_available().is_built()"]
    MPSAvailable["MPS 是否可用？"]
    SetMPS["DEVICE_TYPE = 'mps' Apple Silicon 加速"]
    SetCPU["DEVICE_TYPE = 'cpu' 默认回退方案"]
    USAGE["用于: SentenceTransformer(device=DEVICE_TYPE) CrossEncoder(device=DEVICE_TYPE)"]

    USE_CUDA --> CheckCUDA
    CheckCUDA -- 是 --> TestTorch
    CheckCUDA -- 否 --> CheckMPS
    TestTorch --> CUDASuccess
    CUDASuccess -- 是 --> SetCUDA
    CUDASuccess -- 否 --> CheckMPS
    CheckMPS --> MPSAvailable
    MPSAvailable -- 是 --> SetMPS
    MPSAvailable -- 否 --> SetCPU
    SetCUDA --> USAGE
    SetMPS --> USAGE
    SetCPU --> USAGE
```
**来源：** [backend/open\_webui/env.py42-69](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L42-L69) [backend/open\_webui/routers/retrieval.py123-142](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/routers/retrieval.py#L123-L142)

### Sentence Transformers 配置

| 变量 | 默认值 | 描述 |
| --- | --- | --- |
| `SENTENCE_TRANSFORMERS_BACKEND` | `torch` | Sentence Transformers 的后端 |
| `SENTENCE_TRANSFORMERS_MODEL_KWARGS` | `None` | 模型关键字参数的 JSON 字典 |
| `SENTENCE_TRANSFORMERS_CROSS_ENCODER_BACKEND` | `torch` | Cross-encoder 的后端 |
| `SENTENCE_TRANSFORMERS_CROSS_ENCODER_MODEL_KWARGS` | `None` | Cross-encoder 关键字参数的 JSON 字典 |

### 模型缓存

| 变量 | 默认值 | 描述 |
| --- | --- | --- |
| `MODELS_CACHE_TTL` | `1` | 模型缓存 TTL (秒) (`None` 表示禁用) |

**来源：** [backend/open\_webui/env.py649-691](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L649-L691) [backend/open\_webui/env.py527-537](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L527-L537)

---

## 聊天配置

| 变量 | 默认值 | 描述 |
| --- | --- | --- |
| `CHAT_RESPONSE_STREAM_DELTA_CHUNK_SIZE` | `1` | 流式输出前累积的块数量 |
| `CHAT_RESPONSE_MAX_TOOL_CALL_RETRIES` | `30` | 工具调用的最大重试次数 |
| `ENABLE_REALTIME_CHAT_SAVE` | `False` | 实时保存聊天更新 |
| `ENABLE_QUERIES_CACHE` | `False` | 启用查询结果缓存 |
| `RESET_CONFIG_ON_START` | `False` | 启动时重置配置为默认值 |

**来源：** [backend/open\_webui/env.py540-570](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L540-L570) [backend/open\_webui/env.py362-370](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L362-L370)

---

## 审计日志配置

审计日志捕获详细的请求/响应信息，用于合规性检查和调试。

### 审计日志变量

| 变量 | 默认值 | 描述 |
| --- | --- | --- |
| `AUDIT_LOGS_FILE_PATH` | `DATA_DIR/audit.log` | 审计日志文件路径 |
| `AUDIT_LOG_FILE_ROTATION_SIZE` | `10MB` | 轮转前的最大日志文件大小 |
| `AUDIT_UVICORN_LOGGER_NAMES` | `uvicorn.access` | 逗号分隔的待审计记录器名称 |
| `AUDIT_LOG_LEVEL` | `NONE` | 审计级别: NONE, METADATA, REQUEST, REQUEST\_RESPONSE |
| `MAX_BODY_LOG_SIZE` | `2048` | 记录请求/响应体时的最大字节数 |
| `AUDIT_EXCLUDED_PATHS` | `/chats,/chat,/folders` | 审计中排除的路径 (逗号分隔) |

### 审计日志级别

-   **NONE**：无审计日志。
-   **METADATA**：仅记录元数据（时间戳、用户、端点）。
-   **REQUEST**：记录请求元数据和请求体。
-   **REQUEST\_RESPONSE**：记录完整的请求和响应。

**来源：** [backend/open\_webui/env.py705-732](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L705-L732)

---

## OpenTelemetry 配置

OpenTelemetry 提供了用于可观测性的分布式追踪、指标和日志记录。

### OpenTelemetry 变量

| 变量 | 默认值 | 描述 |
| --- | --- | --- |
| `ENABLE_OTEL` | `False` | 启用 OpenTelemetry |
| `ENABLE_OTEL_TRACES` | `False` | 启用追踪收集 |
| `ENABLE_OTEL_METRICS` | `False` | 启用指标收集 |
| `ENABLE_OTEL_LOGS` | `False` | 启用日志收集 |
| `OTEL_EXPORTER_OTLP_ENDPOINT` | `http://localhost:4317` | 默认 OTLP 端点 |
| `OTEL_METRICS_EXPORTER_OTLP_ENDPOINT` | 继承默认值 | 专门的指标端点 |
| `OTEL_LOGS_EXPORTER_OTLP_ENDPOINT` | 继承默认值 | 专门的日志端点 |
| `OTEL_EXPORTER_OTLP_INSECURE` | `False` | 使用非安全连接 |
| `OTEL_METRICS_EXPORTER_OTLP_INSECURE` | 继承默认值 | 对指标使用非安全连接 |
| `OTEL_LOGS_EXPORTER_OTLP_INSECURE` | 继承默认值 | 对日志使用非安全连接 |
| `OTEL_SERVICE_NAME` | `open-webui` | 遥测中的服务名称 |
| `OTEL_RESOURCE_ATTRIBUTES` | `""` | 额外的资源属性 (key1=val1,key2=val2) |
| `OTEL_TRACES_SAMPLER` | `parentbased_always_on` | 追踪采样策略 |

### OpenTelemetry 身份验证

| 变量 | 默认值 | 描述 |
| --- | --- | --- |
| `OTEL_BASIC_AUTH_USERNAME` | `""` | 基础认证用户名 |
| `OTEL_BASIC_AUTH_PASSWORD` | `""` | 基础认证密码 |
| `OTEL_METRICS_BASIC_AUTH_USERNAME` | 继承默认值 | 专门的指标认证用户名 |
| `OTEL_METRICS_BASIC_AUTH_PASSWORD` | 继承默认值 | 专门的指标认证密码 |
| `OTEL_LOGS_BASIC_AUTH_USERNAME` | 继承默认值 | 专门的日志认证用户名 |
| `OTEL_LOGS_BASIC_AUTH_PASSWORD` | 继承默认值 | 专门的日志认证密码 |

### 导出器协议

| 变量 | 默认值 | 描述 |
| --- | --- | --- |
| `OTEL_OTLP_SPAN_EXPORTER` | `grpc` | 追踪协议 (grpc 或 http) |
| `OTEL_METRICS_OTLP_SPAN_EXPORTER` | 继承默认值 | 指标协议 |
| `OTEL_LOGS_OTLP_SPAN_EXPORTER` | 继承默认值 | 日志协议 |

**来源：** [backend/open\_webui/env.py735-802](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L735-L802)

---

## 中间件与处理配置

### 压缩中间件

| 变量 | 默认值 | 描述 |
| --- | --- | --- |
| `ENABLE_COMPRESSION_MIDDLEWARE` | `True` | 对响应启用 Gzip 压缩 |

### 转发用户请求头

| 变量 | 默认值 | 描述 |
| --- | --- | --- |
| `ENABLE_FORWARD_USER_INFO_HEADERS` | `False` | 在上游请求头中转发用户信息 |
| `ENABLE_STAR_SESSIONS_MIDDLEWARE` | `False` | 启用 Starlette 会话中间件 (实验性) |

### 工作进程配置

| 变量 | 默认值 | 描述 |
| --- | --- | --- |
| `UVICORN_WORKERS` | `1` | Uvicorn 工作进程数量 |

**来源：** [backend/open\_webui/env.py469-471](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L469-L471) [backend/open\_webui/env.py208-218](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L208-L218) [backend/open\_webui/env.py394-405](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L394-L405)

---

## 特性标志

### 离线模式

| 变量 | 默认值 | 描述 |
| --- | --- | --- |
| `OFFLINE_MODE` | `False` | 启用离线模式 (设置 HF\_HUB\_OFFLINE=1) |
| `ENABLE_VERSION_UPDATE_CHECK` | `True` | 检查版本更新 (离线模式下禁用) |

**来源：** [backend/open\_webui/env.py693-703](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L693-L703)

### 安全模式

| 变量 | 默认值 | 描述 |
| --- | --- | --- |
| `SAFE_MODE` | `False` | 启用安全模式 (限制某些特性) |

**来源：** [backend/open\_webui/env.py201-204](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L201-L204)

---

## 工具与函数配置

| 变量 | 默认值 | 描述 |
| --- | --- | --- |
| `PIP_OPTIONS` | `""` | 用于工具安装的空格分隔的 pip 选项 |
| `PIP_PACKAGE_INDEX_OPTIONS` | `""` | 空格分隔的 pip 索引选项 |

这些变量配置了在为自定义工具和函数安装依赖项时的 pip 行为。

**来源：** [backend/open\_webui/env.py804-808](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L804-L808)

---

## 渐进式 Web 应用 (PWA) 配置

| 变量 | 默认值 | 描述 |
| --- | --- | --- |
| `EXTERNAL_PWA_MANIFEST_URL` | `None` | 指向外部 PWA manifest.json 的 URL |

**来源：** [backend/open\_webui/env.py811-815](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L811-L815)

---

## 许可证配置

| 变量 | 默认值 | 描述 |
| --- | --- | --- |
| `LICENSE_KEY` | `""` | 高级特性的许可证密钥 |
| `LICENSE_BLOB_PATH` | `DATA_DIR/l.data` | 许可证 Blob 文件的路径 |
| `LICENSE_PUBLIC_KEY` | `""` | 许可证验证公钥 |

**来源：** [backend/open\_webui/env.py500-523](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L500-L523) [backend/open\_webui/utils/auth.py28-34](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/utils/auth.py#L28-L34)

---

## 应用元数据

| 变量 | 默认值 | 描述 |
| --- | --- | --- |
| `WEBUI_NAME` | `Open WebUI` | 应用程序名称 (更改后会追加 " (Open WebUI)") |
| `WEBUI_BUILD_HASH` | `dev-build` | 用于版本追踪的构建哈希 |
| `ENV` | `dev` | 环境 (dev, test, prod) |
| `INSTANCE_ID` | 随机 UUID | 唯一的实例标识符 |
| `DOCKER` | `False` | 是否在 Docker 容器中运行 |
| `TRUSTED_SIGNATURE_KEY` | `""` | 用于验证受信任载荷的 HMAC 密钥 |

**来源：** [backend/open\_webui/env.py113-138](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L113-L138) [backend/open\_webui/env.py39](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L39-L39) [backend/open\_webui/env.py119](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L119-L119) [backend/open\_webui/env.py222-224](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L222-L224)

---

## 环境变量参考表

### 关键安全变量

| 变量 | 默认值 | 安全影响 |
| --- | --- | --- |
| `WEBUI_SECRET_KEY` | `t0p-s3cr3t` | **关键**：用于 JWT 签名。在生产环境中必须更改。 |
| `OAUTH_CLIENT_INFO_ENCRYPTION_KEY` | 继承 `WEBUI_SECRET_KEY` | 加密 OAuth 客户端密钥 |
| `OAUTH_SESSION_TOKEN_ENCRYPTION_KEY` | 继承 `WEBUI_SECRET_KEY` | 加密 OAuth 会话令牌 |
| `SCIM_TOKEN` | `""` | 用于 SCIM API 访问的 Bearer 令牌 |
| `TRUSTED_SIGNATURE_KEY` | `""` | 用于验证受信任载荷的 HMAC 密钥 |

**警告**：默认的 `WEBUI_SECRET_KEY` 值 `t0p-s3cr3t` 是不安全的。在生产部署中，请务必设置一个强随机密钥。

**来源：** [backend/open\_webui/env.py441-490](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L441-L490)

---

## 用法示例

### 示例 1：生产环境数据库配置

```bash
# 带有连接池的 PostgreSQL
DATABASE_URL=postgresql://user:pass@localhost:5432/openwebui
DATABASE_POOL_SIZE=10
DATABASE_POOL_MAX_OVERFLOW=20
DATABASE_POOL_TIMEOUT=30
DATABASE_POOL_RECYCLE=3600
```
### 示例 2：Redis 哨兵配置

```bash
# 用于高可用的带哨兵的 Redis
REDIS_SENTINEL_HOSTS=sentinel1.example.com,sentinel2.example.com,sentinel3.example.com
REDIS_SENTINEL_PORT=26379
REDIS_SENTINEL_MAX_RETRY_COUNT=3
REDIS_KEY_PREFIX=openwebui-prod
```
### 示例 3：带有自定义加密的 OAuth

```bash
# 带有专用加密密钥的 OAuth 配置
ENABLE_OAUTH_SIGNUP=true
ENABLE_OAUTH_ID_TOKEN_COOKIE=true
OAUTH_CLIENT_INFO_ENCRYPTION_KEY=此处填入你的44字节base64编码密钥
```
### 示例 4：配合 Jaeger 的 OpenTelemetry

```bash
# 针对 Jaeger 的 OpenTelemetry 配置
ENABLE_OTEL=true
ENABLE_OTEL_TRACES=true
ENABLE_OTEL_METRICS=true
OTEL_EXPORTER_OTLP_ENDPOINT=http://jaeger:4317
OTEL_SERVICE_NAME=openwebui-production
OTEL_TRACES_SAMPLER=parentbased_traceidratio
OTEL_RESOURCE_ATTRIBUTES=environment=production,version=0.4.0
```
### 示例 5：受信任请求头身份验证

```bash
# 带有组同步的反向代理身份验证
WEBUI_AUTH_TRUSTED_EMAIL_HEADER=X-Forwarded-Email
WEBUI_AUTH_TRUSTED_NAME_HEADER=X-Forwarded-User
WEBUI_AUTH_TRUSTED_GROUPS_HEADER=X-Forwarded-Groups
```
**来源：** [backend/open\_webui/env.py277-305](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L277-L305) [backend/open\_webui/env.py372-391](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L372-L391) [backend/open\_webui/env.py476-490](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L476-L490) [backend/open\_webui/env.py739-802](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L739-L802) [backend/open\_webui/env.py420-426](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L420-L426)
