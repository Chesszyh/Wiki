# 环境配置

相关源文件

-   [LICENSE](https://github.com/open-webui/open-webui/blob/a7271532/LICENSE)
-   [README.md](https://github.com/open-webui/open-webui/blob/a7271532/README.md)
-   [TROUBLESHOOTING.md](https://github.com/open-webui/open-webui/blob/a7271532/TROUBLESHOOTING.md)
-   [backend/open\_webui/env.py](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py)
-   [backend/open\_webui/routers/audio.py](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/routers/audio.py)
-   [backend/open\_webui/routers/auths.py](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/routers/auths.py)
-   [backend/open\_webui/routers/ollama.py](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/routers/ollama.py)
-   [backend/open\_webui/routers/openai.py](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/routers/openai.py)
-   [backend/open\_webui/utils/auth.py](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/utils/auth.py)
-   [backend/open\_webui/utils/embeddings.py](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/utils/embeddings.py)
-   [backend/open\_webui/utils/misc.py](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/utils/misc.py)
-   [backend/open\_webui/utils/oauth.py](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/utils/oauth.py)
-   [backend/open\_webui/utils/response.py](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/utils/response.py)
-   [docs/apache.md](https://github.com/open-webui/open-webui/blob/a7271532/docs/apache.md)
-   [src/lib/components/chat/Settings/About.svelte](https://github.com/open-webui/open-webui/blob/a7271532/src/lib/components/chat/Settings/About.svelte)
-   [src/lib/constants.ts](https://github.com/open-webui/open-webui/blob/a7271532/src/lib/constants.ts)

## 目的与范围

本文档涵盖了 Open WebUI 中的环境变量配置系统。环境变量控制着应用程序的行为、外部服务连接、身份验证机制、存储后端以及功能标志。本页重点介绍环境变量如何在整个应用程序中加载、验证和使用的技术实现。

有关具体的部署配置，请参阅 [Docker 部署选项](/open-webui/open-webui/3.2-docker-deployment-options)。有关存储在数据库中的持久化配置，请参阅 [持久化配置系统](/open-webui/open-webui/11.2-persistent-configuration-system)。有关身份验证的具体设置，请参阅 [身份验证方法](/open-webui/open-webui/10.1-authentication-methods)。

## 配置加载架构

Open WebUI 的配置系统在 `backend/open_webui/env.py` 中初始化，它从 `.env` 文件和系统环境中加载环境变量，对其进行验证，并将其公开为 Python 模块常量。

### 配置加载流程

```mermaid
flowchart TD
    ENV_FILE[".env 文件 位于 BASE_DIR"]
    SYS_ENV["系统环境变量"]
    DOTENV["dotenv.load_dotenv() env.py:35-39"]
    PARSE["解析与验证 env.py:41-889"]
    PATH_VARS["路径变量 DATA_DIR, STATIC_DIR FRONTEND_BUILD_DIR"]
    DB_VARS["数据库变量 DATABASE_URL DATABASE_POOL_SIZE"]
    REDIS_VARS["Redis 变量 REDIS_URL REDIS_CLUSTER"]
    AUTH_VARS["身份验证变量 WEBUI_SECRET_KEY OAUTH_*"]
    API_VARS["API 配置 OLLAMA_BASE_URL OPENAI_API_KEY"]
    FEATURE_VARS["功能标志 ENABLE_*"]
    APP_STATE["应用程序状态 app.state.config"]
    ROUTES["API 路由 使用配置"]
    MIDDLEWARE["中间件 应用策略"]
    SERVICES["外部服务 连接设置"]

    ENV_FILE --> DOTENV
    SYS_ENV --> DOTENV
    DOTENV --> PARSE
    PARSE --> PATH_VARS
    PARSE --> DB_VARS
    PARSE --> REDIS_VARS
    PARSE --> AUTH_VARS
    PARSE --> API_VARS
    PARSE --> FEATURE_VARS
    PATH_VARS --> APP_STATE
    DB_VARS --> APP_STATE
    REDIS_VARS --> APP_STATE
    AUTH_VARS --> APP_STATE
    API_VARS --> APP_STATE
    FEATURE_VARS --> APP_STATE
    APP_STATE --> ROUTES
    APP_STATE --> MIDDLEWARE
    APP_STATE --> SERVICES
```
**来源：** [backend/open\_webui/env.py1-889](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L1-L889)

### 路径解析与目录结构

配置系统首先建立目录层级结构：

```mermaid
flowchart TD
    ENV_PY["env.py 文件"]
    RESOLVE["Path(file).resolve() env.py:23"]
    OPEN_WEBUI_DIR["OPEN_WEBUI_DIR backend/open_webui/env.py:26"]
    BACKEND_DIR["BACKEND_DIR backend/env.py:29"]
    BASE_DIR["BASE_DIR open-webui-dev/env.py:32"]
    DATA_DIR["DATA_DIR backend/data/env.py:210"]
    STATIC_DIR["STATIC_DIR open_webui/static/env.py:234"]
    FRONTEND_BUILD_DIR["FRONTEND_BUILD_DIR build/env.py:238"]
    DB_FILE["webui.db"]
    UPLOAD_DIR["uploads/"]
    CACHE_DIR["cache/"]

    ENV_PY --> RESOLVE
    RESOLVE --> OPEN_WEBUI_DIR
    OPEN_WEBUI_DIR --> BACKEND_DIR
    BACKEND_DIR --> BASE_DIR
    BASE_DIR --> DATA_DIR
    BASE_DIR --> STATIC_DIR
    BASE_DIR --> FRONTEND_BUILD_DIR
    DATA_DIR --> DB_FILE
    DATA_DIR --> UPLOAD_DIR
    DATA_DIR --> CACHE_DIR
```
**来源：** [backend/open\_webui/env.py23-244](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L23-L244)

## 核心配置类别

### LLM 提供者连接配置

用于连接 Ollama 和兼容 OpenAI API 的环境变量：

| 变量 | 类型 | 默认值 | 描述 |
| --- | --- | --- | --- |
| `OLLAMA_BASE_URL` | string | (运行时配置) | Ollama API 服务器的基准 URL |
| `OLLAMA_BASE_URLS` | list | (运行时配置) | 用于负载均衡的多个 Ollama 端点 |
| `OLLAMA_API_CONFIGS` | dict | (运行时配置) | 每个端点的具体配置（密钥、模型过滤等） |
| `OPENAI_API_BASE_URLS` | list | (运行时配置) | 兼容 OpenAI 的 API 端点列表 |
| `OPENAI_API_KEYS` | list | (运行时配置) | 与基准 URL 对应的 API 密钥列表 |
| `OPENAI_API_CONFIGS` | dict | (运行时配置) | 身份验证类型、请求头、模型配置等 |

这些配置主要存储在持久化配置系统中（参见 [持久化配置系统](/open-webui/open-webui/11.2-persistent-configuration-system)），但可以通过环境变量进行初始化。

```mermaid
flowchart TD
    CLIENT["聊天请求"]
    ROUTER["FastAPI 路由 /ollama 或 /openai"]
    CONFIG_CHECK["检查 app.state.config"]
    OLLAMA_URLS["OLLAMA_BASE_URLS routers/ollama.py:331"]
    OPENAI_URLS["OPENAI_API_BASE_URLS routers/openai.py:361"]
    LOAD_BALANCE["负载均衡 根据索引选择 URL"]
    API_CONFIG["获取 API 配置 根据索引或 URL"]
    AUTH_TYPE["auth_type routers/openai.py:145"]
    BEARER["添加 Authorization: Bearer 令牌"]
    NO_AUTH["无身份验证"]
    SESSION["使用会话 Cookie"]
    OAUTH["OAuth 令牌"]
    AZURE["Azure Entra ID"]
    FORWARD["转发至外部 API"]

    CLIENT --> ROUTER
    ROUTER --> CONFIG_CHECK
    CONFIG_CHECK --> OLLAMA_URLS
    CONFIG_CHECK --> OPENAI_URLS
    OLLAMA_URLS --> LOAD_BALANCE
    OPENAI_URLS --> LOAD_BALANCE
    LOAD_BALANCE --> API_CONFIG
    API_CONFIG --> AUTH_TYPE
    AUTH_TYPE --> BEARER
    AUTH_TYPE --> NO_AUTH
    AUTH_TYPE --> SESSION
    AUTH_TYPE --> OAUTH
    AUTH_TYPE --> AZURE
    BEARER --> FORWARD
    NO_AUTH --> FORWARD
    SESSION --> FORWARD
    OAUTH --> FORWARD
    AZURE --> FORWARD
```
**来源：** [backend/open\_webui/routers/ollama.py267-303](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/routers/ollama.py#L267-L303) [backend/open\_webui/routers/openai.py207-265](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/routers/openai.py#L207-L265) [backend/open\_webui/routers/openai.py118-180](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/routers/openai.py#L118-L180)

### 数据库配置

```mermaid
flowchart TD
    ENV_VARS["环境变量"]
    DATABASE_URL["DATABASE_URL env.py:257"]
    DATABASE_TYPE["DATABASE_TYPE env.py:259"]
    DB_CREDS["DATABASE_USER DATABASE_PASSWORD env.py:260-261"]
    DB_CONN["DATABASE_HOST DATABASE_PORT DATABASE_NAME env.py:269-274"]
    BUILD_URL["构建 DATABASE_URL? env.py:277-278"]
    CONSTRUCT["构造 URL: type://user:pass@host:port/db"]
    NORMALIZE["规范化: postgres:// → postgresql:// env.py:284-285"]
    POOL_CONFIG["连接池配置"]
    POOL_SIZE["DATABASE_POOL_SIZE env.py:289"]
    OVERFLOW["DATABASE_POOL_MAX_OVERFLOW env.py:297"]
    TIMEOUT["DATABASE_POOL_TIMEOUT env.py:307"]
    RECYCLE["DATABASE_POOL_RECYCLE env.py:317"]
    SCHEMA["DATABASE_SCHEMA env.py:287"]
    WAL["DATABASE_ENABLE_SQLITE_WAL env.py:327-329"]

    ENV_VARS --> DATABASE_URL
    ENV_VARS --> DATABASE_TYPE
    ENV_VARS --> DB_CREDS
    ENV_VARS --> DB_CONN
    DATABASE_TYPE --> BUILD_URL
    DB_CREDS --> BUILD_URL
    DB_CONN --> BUILD_URL
    BUILD_URL --> CONSTRUCT
    DATABASE_URL --> NORMALIZE
    CONSTRUCT --> NORMALIZE
    NORMALIZE --> POOL_CONFIG
    POOL_CONFIG --> POOL_SIZE
    POOL_CONFIG --> OVERFLOW
    POOL_CONFIG --> TIMEOUT
    POOL_CONFIG --> RECYCLE
    NORMALIZE --> SCHEMA
    NORMALIZE --> WAL
```
**数据库环境变量：**

| 变量 | 类型 | 默认值 | 描述 |
| --- | --- | --- | --- |
| `DATABASE_URL` | string | `sqlite:///DATA_DIR/webui.db` | 完整数据库连接字符串 |
| `DATABASE_TYPE` | string | \- | 数据库类型 (postgresql, mysql, sqlite, sqlite+sqlcipher) |
| `DATABASE_USER` | string | \- | 数据库用户名 |
| `DATABASE_PASSWORD` | string | \- | 数据库密码 |
| `DATABASE_HOST` | string | \- | 数据库主机 |
| `DATABASE_PORT` | string | \- | 数据库端口 |
| `DATABASE_NAME` | string | \- | 数据库名称 |
| `DATABASE_SCHEMA` | string | None | PostgreSQL 模式名称 |
| `DATABASE_POOL_SIZE` | int | None | SQLAlchemy 连接池大小 |
| `DATABASE_POOL_MAX_OVERFLOW` | int | 0 | 超出连接池大小的最大溢出连接数 |
| `DATABASE_POOL_TIMEOUT` | int | 30 | 从连接池获取连接的超时时间（秒） |
| `DATABASE_POOL_RECYCLE` | int | 3600 | 在 N 秒后回收连接 |
| `DATABASE_ENABLE_SQLITE_WAL` | bool | False | 为 SQLite 启用预写日志 (Write-Ahead Logging) |
| `DATABASE_USER_ACTIVE_STATUS_UPDATE_INTERVAL` | float | None | 更新用户活跃状态的时间间隔 |

**来源：** [backend/open\_webui/env.py257-340](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L257-L340)

### Redis 配置

Redis 用于分布式会话管理、WebSocket 消息分发、令牌撤销和速率限制：

```mermaid
flowchart TD
    REDIS_URL["REDIS_URL env.py:361"]
    REDIS_CLUSTER["REDIS_CLUSTER env.py:362"]
    REDIS_PREFIX["REDIS_KEY_PREFIX env.py:364"]
    SENTINEL_SETUP["哨兵 (Sentinel) 设置"]
    SENTINEL_HOSTS["REDIS_SENTINEL_HOSTS env.py:366"]
    SENTINEL_PORT["REDIS_SENTINEL_PORT env.py:367"]
    SENTINEL_RETRY["REDIS_SENTINEL_MAX_RETRY_COUNT env.py:370-376"]
    REDIS_CLIENT["Redis 客户端 utils/redis.py"]
    TOKEN_REVOKE["令牌撤销 utils/auth.py:232-247"]
    RATE_LIMIT["速率限制 utils/rate_limit.py"]
    WEBSOCKET_DIST["WebSocket 分发 socket/main.py"]
    SESSION_STORE["会话存储"]

    REDIS_URL --> REDIS_CLIENT
    REDIS_CLUSTER --> REDIS_CLIENT
    REDIS_PREFIX --> REDIS_CLIENT
    SENTINEL_HOSTS --> SENTINEL_SETUP
    SENTINEL_PORT --> SENTINEL_SETUP
    SENTINEL_RETRY --> SENTINEL_SETUP
    SENTINEL_SETUP --> REDIS_CLIENT
    REDIS_CLIENT --> TOKEN_REVOKE
    REDIS_CLIENT --> RATE_LIMIT
    REDIS_CLIENT --> WEBSOCKET_DIST
    REDIS_CLIENT --> SESSION_STORE
```
**Redis 环境变量：**

| 变量 | 类型 | 默认值 | 描述 |
| --- | --- | --- | --- |
| `REDIS_URL` | string | "" | Redis 连接 URL (例如 `redis://localhost:6379`) |
| `REDIS_CLUSTER` | bool | False | 启用 Redis 集群模式 |
| `REDIS_KEY_PREFIX` | string | "open-webui" | 所有 Redis 键的前缀 |
| `REDIS_SENTINEL_HOSTS` | string | "" | 逗号分隔的哨兵主机列表 |
| `REDIS_SENTINEL_PORT` | string | "26379" | 哨兵端口 |
| `REDIS_SENTINEL_MAX_RETRY_COUNT` | int | 2 | 哨兵故障转移的最大重试次数 |
| `REDIS_SOCKET_CONNECT_TIMEOUT` | float | None | 套接字连接超时时间（秒） |

**来源：** [backend/open\_webui/env.py357-384](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L357-L384) [backend/open\_webui/utils/auth.py213-247](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/utils/auth.py#L213-L247)

### 身份验证与安全配置

```mermaid
flowchart TD
    WEBUI_AUTH["WEBUI_AUTH env.py:403"]
    SECRET_KEY["WEBUI_SECRET_KEY env.py:450-455"]
    JWT_ALGO["JWT 算法: HS256 utils/auth.py:50"]
    TOKEN_CREATE["create_token() utils/auth.py:191-202"]
    TOKEN_DECODE["decode_token() utils/auth.py:205-210"]
    COOKIE_CONFIG["Cookie 配置"]
    SAME_SITE["WEBUI_SESSION_COOKIE_SAME_SITE env.py:457"]
    SECURE["WEBUI_SESSION_COOKIE_SECURE env.py:459-461"]
    AUTH_SAME_SITE["WEBUI_AUTH_COOKIE_SAME_SITE env.py:463-465"]
    AUTH_SECURE["WEBUI_AUTH_COOKIE_SECURE env.py:467-473"]
    OAUTH_CONFIG["OAuth 配置"]
    OAUTH_EMAIL_FALLBACK["ENABLE_OAUTH_EMAIL_FALLBACK env.py:485-487"]
    OAUTH_ID_TOKEN["ENABLE_OAUTH_ID_TOKEN_COOKIE env.py:489-491"]
    OAUTH_CLIENT_KEY["OAUTH_CLIENT_INFO_ENCRYPTION_KEY env.py:493-495"]
    OAUTH_SESSION_KEY["OAUTH_SESSION_TOKEN_ENCRYPTION_KEY env.py:497-499"]
    FERNET_ENCRYPT["Fernet 加密 utils/oauth.py:132-155"]
    TRUSTED_HEADERS["受信任请求头身份验证"]
    EMAIL_HEADER["WEBUI_AUTH_TRUSTED_EMAIL_HEADER env.py:412-414"]
    NAME_HEADER["WEBUI_AUTH_TRUSTED_NAME_HEADER env.py:415"]
    GROUPS_HEADER["WEBUI_AUTH_TRUSTED_GROUPS_HEADER env.py:416-418"]
    PASSWORD_VALIDATION["密码验证"]
    ENABLE_VALIDATION["ENABLE_PASSWORD_VALIDATION env.py:421-423"]
    REGEX_PATTERN["PASSWORD_VALIDATION_REGEX_PATTERN env.py:424-435"]

    WEBUI_AUTH --> SECRET_KEY
    SECRET_KEY --> JWT_ALGO
    SECRET_KEY --> TOKEN_CREATE
    SECRET_KEY --> TOKEN_DECODE
    WEBUI_AUTH --> COOKIE_CONFIG
    COOKIE_CONFIG --> SAME_SITE
    COOKIE_CONFIG --> SECURE
    COOKIE_CONFIG --> AUTH_SAME_SITE
    COOKIE_CONFIG --> AUTH_SECURE
    WEBUI_AUTH --> OAUTH_CONFIG
    OAUTH_CONFIG --> OAUTH_EMAIL_FALLBACK
    OAUTH_CONFIG --> OAUTH_ID_TOKEN
    OAUTH_CONFIG --> OAUTH_CLIENT_KEY
    OAUTH_CONFIG --> OAUTH_SESSION_KEY
    OAUTH_CLIENT_KEY --> FERNET_ENCRYPT
    WEBUI_AUTH --> TRUSTED_HEADERS
    TRUSTED_HEADERS --> EMAIL_HEADER
    TRUSTED_HEADERS --> NAME_HEADER
    TRUSTED_HEADERS --> GROUPS_HEADER
    WEBUI_AUTH --> PASSWORD_VALIDATION
    PASSWORD_VALIDATION --> ENABLE_VALIDATION
    PASSWORD_VALIDATION --> REGEX_PATTERN
```
**身份验证环境变量：**

| 变量 | 类型 | 默认值 | 描述 |
| --- | --- | --- | --- |
| `WEBUI_AUTH` | bool | True | 启用身份验证系统 |
| `WEBUI_SECRET_KEY` | string | "t0p-s3cr3t" | **关键**：用于 JWT 签名和加密的密钥 |
| `WEBUI_SESSION_COOKIE_SAME_SITE` | string | "lax" | 会话 Cookie 的 SameSite 属性 |
| `WEBUI_SESSION_COOKIE_SECURE` | bool | False | 会话 Cookie 是否要求 HTTPS |
| `WEBUI_AUTH_COOKIE_SAME_SITE` | string | (继承自会话) | 身份验证 Cookie 的 SameSite 属性 |
| `WEBUI_AUTH_COOKIE_SECURE` | bool | (继承自会话) | 身份验证 Cookie 是否要求 HTTPS |
| `WEBUI_AUTH_SIGNOUT_REDIRECT_URL` | string | None | 注销后的重定向 URL |
| `WEBUI_AUTH_TRUSTED_EMAIL_HEADER` | string | None | 包含受信任电子邮件的请求头 (例如 `X-User-Email`) |
| `WEBUI_AUTH_TRUSTED_NAME_HEADER` | string | None | 包含受信任姓名的请求头 |
| `WEBUI_AUTH_TRUSTED_GROUPS_HEADER` | string | None | 包含受信任组的请求头 |
| `ENABLE_INITIAL_ADMIN_SIGNUP` | bool | False | 允许第一个注册用户自动成为管理员（无需邀请） |
| `ENABLE_SIGNUP_PASSWORD_CONFIRMATION` | bool | False | 注册时是否要求确认密码 |
| `ENABLE_PASSWORD_VALIDATION` | bool | False | 启用密码复杂度验证 |
| `PASSWORD_VALIDATION_REGEX_PATTERN` | string | (复杂正则表达式) | 用于密码验证的正则表达式模式 |
| `BYPASS_MODEL_ACCESS_CONTROL` | bool | False | 禁用针对每个模型的访问控制检查 |
| `ENABLE_OAUTH_EMAIL_FALLBACK` | bool | False | 如果用户名不可用，则使用电子邮件 Claim |
| `ENABLE_OAUTH_ID_TOKEN_COOKIE` | bool | True | 在 Cookie 中存储 OAuth ID 令牌 |
| `OAUTH_CLIENT_INFO_ENCRYPTION_KEY` | string | (源自 WEBUI\_SECRET\_KEY) | 用于加密 OAuth 客户端凭据的密钥 |
| `OAUTH_SESSION_TOKEN_ENCRYPTION_KEY` | string | (源自 WEBUI\_SECRET\_KEY) | 用于加密 OAuth 会话令牌的密钥 |

**来源：** [backend/open\_webui/env.py400-509](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L400-L509) [backend/open\_webui/utils/auth.py49-257](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/utils/auth.py#L49-L257) [backend/open\_webui/utils/oauth.py132-165](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/utils/oauth.py#L132-L165)

### SCIM 与许可证配置

| 变量 | 类型 | 默认值 | 描述 |
| --- | --- | --- | --- |
| `ENABLE_SCIM` | bool | False | 启用 SCIM 2.0 用户配置 (Provisioning) |
| `SCIM_TOKEN` | string | "" | SCIM API 身份验证的 Bearer 令牌 |
| `LICENSE_KEY` | string | "" | 企业版许可证密钥 |
| `LICENSE_BLOB_PATH` | path | `DATA_DIR/l.data` | 加密许可证 Blob 文件的路径 |
| `LICENSE_PUBLIC_KEY` | string | "" | 用于许可证验证的公钥 |

**来源：** [backend/open\_webui/env.py502-536](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L502-L536)

### WebSocket 配置

WebSocket 支持可实现实时聊天更新、协作编辑和分布式消息传播：

| 变量 | 类型 | 默认值 | 描述 |
| --- | --- | --- | --- |
| `ENABLE_WEBSOCKET_SUPPORT` | bool | True | 启用 WebSocket 功能 |
| `WEBSOCKET_MANAGER` | string | "" | WebSocket 管理器类型 |
| `WEBSOCKET_REDIS_URL` | string | (源自 REDIS\_URL) | 用于 WebSocket 分发的 Redis URL |
| `WEBSOCKET_REDIS_CLUSTER` | bool | (源自 REDIS\_CLUSTER) | WebSocket 是否使用 Redis 集群 |
| `WEBSOCKET_REDIS_OPTIONS` | JSON | None | 额外的 Redis 客户端选项 |
| `WEBSOCKET_REDIS_LOCK_TIMEOUT` | int | 60 | Redis 操作的锁定超时时间 |
| `WEBSOCKET_SENTINEL_HOSTS` | string | "" | WebSocket Redis 的哨兵主机列表 |
| `WEBSOCKET_SENTINEL_PORT` | string | "26379" | WebSocket Redis 的哨兵端口 |
| `WEBSOCKET_SERVER_LOGGING` | bool | False | 启用 Socket.IO 服务器日志 |
| `WEBSOCKET_SERVER_ENGINEIO_LOGGING` | bool | False | 启用 Engine.IO 日志 |
| `WEBSOCKET_SERVER_PING_TIMEOUT` | int | 20 | Ping 超时时间（秒） |
| `WEBSOCKET_SERVER_PING_INTERVAL` | int | 25 | Ping 间隔时间（秒） |

**来源：** [backend/open\_webui/env.py608-668](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L608-L668)

### HTTP 客户端配置

整个应用程序中使用的 `aiohttp` 客户端设置：

| 变量 | 类型 | 默认值 | 描述 |
| --- | --- | --- | --- |
| `AIOHTTP_CLIENT_TIMEOUT` | int | None | HTTP 请求的默认超时时间（秒） |
| `AIOHTTP_CLIENT_SESSION_SSL` | bool | True | 验证 SSL 证书 |
| `AIOHTTP_CLIENT_TIMEOUT_MODEL_LIST` | int | 10 | 获取模型列表的超时时间 |
| `AIOHTTP_CLIENT_TIMEOUT_TOOL_SERVER_DATA` | int | 10 | 工具服务器数据请求的超时时间 |
| `AIOHTTP_CLIENT_SESSION_TOOL_SERVER_SSL` | bool | True | 验证工具服务器的 SSL |

**来源：** [backend/open\_webui/env.py670-717](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L670-L717)

### 存储配置

Open WebUI 通过多态提供者系统支持多种存储后端：

| 变量 | 类型 | 默认值 | 描述 |
| --- | --- | --- | --- |
| `STORAGE_PROVIDER` | string | "local" | 存储后端: `local`, `s3`, `gcs`, `azure` |
| `UPLOAD_DIR` | path | `DATA_DIR/uploads` | 本地上传目录 |
| `S3_BUCKET_NAME` | string | \- | S3 存储桶名称 |
| `S3_REGION_NAME` | string | \- | S3 区域 |
| `S3_ENDPOINT_URL` | string | \- | 自定义 S3 端点 (用于 MinIO 等) |
| `S3_ACCESS_KEY_ID` | string | \- | S3 访问密钥 ID |
| `S3_SECRET_ACCESS_KEY` | string | \- | S3 机密访问密钥 |
| `GCS_BUCKET_NAME` | string | \- | Google Cloud Storage 存储桶 |
| `GCS_CREDENTIALS_PATH` | path | \- | GCS 服务帐户 JSON 的路径 |
| `AZURE_STORAGE_ACCOUNT_NAME` | string | \- | Azure 存储帐户 |
| `AZURE_STORAGE_CONTAINER_NAME` | string | \- | Azure 容器名称 |
| `AZURE_STORAGE_ACCOUNT_KEY` | string | \- | Azure 帐户密钥 |
| `AZURE_STORAGE_CONNECTION_STRING` | string | \- | Azure 连接字符串 |

有关实现细节，请参阅 [存储提供者架构](/open-webui/open-webui/12.1-storage-provider-architecture)。

**来源：** [backend/open\_webui/config.py](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/config.py) (存储配置在 config 模块中加载)

### 性能与扩展配置

```mermaid
flowchart TD
    UVICORN["UVICORN_WORKERS env.py:390-397"]
    CACHE["缓存配置"]
    MODELS_TTL["MODELS_CACHE_TTL env.py:546-553"]
    QUERIES_CACHE["ENABLE_QUERIES_CACHE env.py:355"]
    CHAT["聊天配置"]
    STREAM_DELTA["CHAT_RESPONSE_STREAM_DELTA_CHUNK_SIZE env.py:565-577"]
    MAX_RETRIES["CHAT_RESPONSE_MAX_TOOL_CALL_RETRIES env.py:580-590"]
    BUFFER_SIZE["CHAT_STREAM_RESPONSE_CHUNK_MAX_BUFFER_SIZE env.py:593-605"]
    WORKERS["多个工作进程"]
    REDIS_SESSION["基于 Redis 的会话共享"]
    MEMORY["内存中 @cached 装饰器"]
    STREAM_HANDLER["流式响应处理"]

    UVICORN --> WORKERS
    MODELS_TTL --> CACHE
    QUERIES_CACHE --> CACHE
    STREAM_DELTA --> CHAT
    MAX_RETRIES --> CHAT
    BUFFER_SIZE --> CHAT
    WORKERS --> REDIS_SESSION
    CACHE --> MEMORY
    CHAT --> STREAM_HANDLER
```
**性能环境变量：**

| 变量 | 类型 | 默认值 | 描述 |
| --- | --- | --- | --- |
| `UVICORN_WORKERS` | int | 1 | Uvicorn 工作进程数 (若 >1 则需要 Redis) |
| `MODELS_CACHE_TTL` | int | 1 | 模型列表缓存 TTL（秒，None 表示不缓存） |
| `ENABLE_QUERIES_CACHE` | bool | False | 启用数据库查询结果缓存 |
| `CHAT_RESPONSE_STREAM_DELTA_CHUNK_SIZE` | int | 1 | 流式输出前累积的块数量 |
| `CHAT_RESPONSE_MAX_TOOL_CALL_RETRIES` | int | 30 | 工具调用执行的最大重试次数 |
| `CHAT_STREAM_RESPONSE_CHUNK_MAX_BUFFER_SIZE` | int | None | 流式响应的最大缓冲区大小 |

**来源：** [backend/open\_webui/env.py386-606](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L386-L606)

### Sentence Transformers 配置

用于本地嵌入生成和重排序 (Reranking)：

| 变量 | 类型 | 默认值 | 描述 |
| --- | --- | --- | --- |
| `SENTENCE_TRANSFORMERS_BACKEND` | string | "torch" | Sentence Transformers 的后端 |
| `SENTENCE_TRANSFORMERS_MODEL_KWARGS` | JSON | None | 模型初始化的关键字参数 |
| `SENTENCE_TRANSFORMERS_CROSS_ENCODER_BACKEND` | string | "torch" | Cross-Encoder 的后端 |
| `SENTENCE_TRANSFORMERS_CROSS_ENCODER_MODEL_KWARGS` | JSON | None | Cross-Encoder 的关键字参数 |

**来源：** [backend/open\_webui/env.py719-762](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L719-L762)

### 可观测性配置

用于追踪、指标和日志的 OpenTelemetry (OTEL) 集成：

```mermaid
flowchart TD
    ENABLE_OTEL["ENABLE_OTEL env.py:812"]
    TRACES["ENABLE_OTEL_TRACES env.py:813"]
    METRICS["ENABLE_OTEL_METRICS env.py:814"]
    LOGS["ENABLE_OTEL_LOGS env.py:815"]
    TRACE_ENDPOINT["OTEL_EXPORTER_OTLP_ENDPOINT env.py:817-819"]
    METRIC_ENDPOINT["OTEL_METRICS_EXPORTER_OTLP_ENDPOINT env.py:820-822"]
    LOG_ENDPOINT["OTEL_LOGS_EXPORTER_OTLP_ENDPOINT env.py:823-825"]
    TRACE_INSECURE["OTEL_EXPORTER_OTLP_INSECURE env.py:826-828"]
    METRIC_INSECURE["OTEL_METRICS_EXPORTER_OTLP_INSECURE env.py:829-834"]
    LOG_INSECURE["OTEL_LOGS_EXPORTER_OTLP_INSECURE env.py:835-840"]
    SAMPLER["OTEL_TRACES_SAMPLER env.py:845-847"]
    AUTH["身份验证"]
    BASIC_USER["OTEL_BASIC_AUTH_USERNAME env.py:848"]
    BASIC_PASS["OTEL_BASIC_AUTH_PASSWORD env.py:849"]
    EXPORTER_TYPE["OTEL_OTLP_SPAN_EXPORTER env.py:864-866"]

    ENABLE_OTEL --> TRACES
    ENABLE_OTEL --> METRICS
    ENABLE_OTEL --> LOGS
    TRACES --> TRACE_ENDPOINT
    METRICS --> METRIC_ENDPOINT
    LOGS --> LOG_ENDPOINT
    TRACE_ENDPOINT --> TRACE_INSECURE
    METRIC_ENDPOINT --> METRIC_INSECURE
    LOG_ENDPOINT --> LOG_INSECURE
    TRACES --> SAMPLER
    TRACES --> AUTH
    METRICS --> AUTH
    LOGS --> AUTH
    AUTH --> BASIC_USER
    AUTH --> BASIC_PASS
    TRACES --> EXPORTER_TYPE
```
**OpenTelemetry 环境变量：**

| 变量 | 类型 | 默认值 | 描述 |
| --- | --- | --- | --- |
| `ENABLE_OTEL` | bool | False | 启用 OpenTelemetry 检测 |
| `ENABLE_OTEL_TRACES` | bool | False | 启用追踪导出 |
| `ENABLE_OTEL_METRICS` | bool | False | 启用指标导出 |
| `ENABLE_OTEL_LOGS` | bool | False | 启用日志导出 |
| `OTEL_EXPORTER_OTLP_ENDPOINT` | string | "[http://localhost:4317](http://localhost:4317)" | 追踪的 OTLP 端点 |
| `OTEL_METRICS_EXPORTER_OTLP_ENDPOINT` | string | (源自 OTEL\_EXPORTER\_OTLP\_ENDPOINT) | 指标的 OTLP 端点 |
| `OTEL_LOGS_EXPORTER_OTLP_ENDPOINT` | string | (源自 OTEL\_EXPORTER\_OTLP\_ENDPOINT) | 日志的 OTLP 端点 |
| `OTEL_EXPORTER_OTLP_INSECURE` | bool | False | 为 OTLP 禁用 TLS |
| `OTEL_SERVICE_NAME` | string | "open-webui" | 遥测中的服务名称 |
| `OTEL_RESOURCE_ATTRIBUTES` | string | "" | 额外的资源属性 (key1=val1,key2=val2) |
| `OTEL_TRACES_SAMPLER` | string | "parentbased\_always\_on" | 追踪采样策略 |
| `OTEL_BASIC_AUTH_USERNAME` | string | "" | OTLP 的基础认证用户名 |
| `OTEL_BASIC_AUTH_PASSWORD` | string | "" | OTLP 的基础认证密码 |
| `OTEL_OTLP_SPAN_EXPORTER` | string | "grpc" | 导出协议: "grpc" 或 "http" |

**来源：** [backend/open\_webui/env.py808-875](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L808-L875)

### 审计日志配置

| 变量 | 类型 | 默认值 | 描述 |
| --- | --- | --- | --- |
| `AUDIT_LOGS_FILE_PATH` | path | `DATA_DIR/audit.log` | 审计日志文件路径 |
| `AUDIT_LOG_FILE_ROTATION_SIZE` | string | "10MB" | 日志轮转前的最大大小 |
| `AUDIT_UVICORN_LOGGER_NAMES` | list | \["uvicorn.access"\] | 要捕获的记录器名称 |
| `AUDIT_LOG_LEVEL` | string | "NONE" | 审计级别: NONE, METADATA, REQUEST, REQUEST\_RESPONSE |
| `MAX_BODY_LOG_SIZE` | int | 2048 | 记录请求/响应体时的最大字节数 |
| `AUDIT_EXCLUDED_PATHS` | list | \["/chats", "/chat", "/folders"\] | 审计中排除的路径 |

**来源：** [backend/open\_webui/env.py777-806](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L777-L806)

### 功能标志与杂项

| 变量 | 类型 | 默认值 | 描述 |
| --- | --- | --- | --- |
| `ENV` | string | "dev" | 环境: dev, test, prod |
| `DOCKER` | bool | False | 是否在 Docker 容器中运行 |
| `USE_CUDA_DOCKER` | string | "false" | Docker 中是否使用 CUDA |
| `DEVICE_TYPE` | string | "cpu" | ML 模型所用设备: cpu, cuda, mps |
| `GLOBAL_LOG_LEVEL` | string | "INFO" | 全局日志级别 |
| `SAFE_MODE` | bool | False | 启用安全模式（限制某些操作） |
| `ENABLE_FORWARD_USER_INFO_HEADERS` | bool | False | 向后端转发 X-OpenWebUI-User-\* 请求头 |
| `ENABLE_COMPRESSION_MIDDLEWARE` | bool | True | 启用 gzip 压缩 |
| `ENABLE_CUSTOM_MODEL_FALLBACK` | bool | False | 允许回退到备选模型 |
| `ENABLE_CHAT_RESPONSE_BASE64_IMAGE_URL_CONVERSION` | bool | False | 将 base64 图像转换为 URL |
| `ENABLE_REALTIME_CHAT_SAVE` | bool | False | 实时保存聊天消息 |
| `RESET_CONFIG_ON_START` | bool | False | 启动时重置配置为默认值 |
| `ENABLE_PUBLIC_ACTIVE_USERS_COUNT` | bool | True | 向非管理员显示活跃用户数 |
| `OFFLINE_MODE` | bool | False | 禁用外部网络请求 (设置 HF\_HUB\_OFFLINE=1) |
| `ENABLE_VERSION_UPDATE_CHECK` | bool | True | 检查新版本（OFFLINE\_MODE 时禁用） |
| `WEBUI_NAME` | string | "Open WebUI" | 应用程序名称 |
| `WEBUI_FAVICON_URL` | string | "[https://openwebui.com/favicon.png](https://openwebui.com/favicon.png)" | Favicon URL |
| `WEBUI_BUILD_HASH` | string | "dev-build" | 前端构建哈希 |
| `DEPLOYMENT_ID` | string | "" | 唯一部署标识符 |
| `INSTANCE_ID` | string | (生成的 UUID) | 唯一实例标识符 |
| `TRUSTED_SIGNATURE_KEY` | string | "" | 用于验证签名负载的密钥 |

**来源：** [backend/open\_webui/env.py41-204](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L41-L204) [backend/open\_webui/env.py542-889](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L542-L889)

## Docker 部署中的配置

环境变量通常通过 `-e` 标志或 docker-compose 的 `environment` 部分传递给 Docker 容器：

### 示例：基础 Ollama 连接

```
docker run -d -p 3000:8080 \
  -e OLLAMA_BASE_URL=http://host.docker.internal:11434 \
  -v open-webui:/app/backend/data \
  --name open-webui \
  ghcr.io/open-webui/open-webui:main
```
### 示例：OpenAI API 配置

```
docker run -d -p 3000:8080 \
  -e OPENAI_API_KEY=sk-xxxx \
  -v open-webui:/app/backend/data \
  --name open-webui \
  ghcr.io/open-webui/open-webui:main
```
### 示例：PostgreSQL 与 Redis

```
docker run -d -p 3000:8080 \
  -e DATABASE_URL=postgresql://user:pass@postgres:5432/openwebui \
  -e REDIS_URL=redis://redis:6379/0 \
  -e UVICORN_WORKERS=4 \
  -v open-webui:/app/backend/data \
  --name open-webui \
  ghcr.io/open-webui/open-webui:main
```
**来源：** [README.md119-193](https://github.com/open-webui/open-webui/blob/a7271532/README.md#L119-L193) [TROUBLESHOOTING.md16-19](https://github.com/open-webui/open-webui/blob/a7271532/TROUBLESHOOTING.md#L16-L19)

## 配置验证与错误处理

`env.py` 模块包含针对关键变量的验证逻辑：

```mermaid
flowchart TD
    LOAD["加载环境变量"]
    VALIDATE_SECRET["验证 WEBUI_SECRET_KEY env.py:475-476"]
    SECRET_CHECK["WEBUI_AUTH 且 SECRET_KEY 为空?"]
    RAISE_ERROR["抛出 ValueError ERROR_MESSAGES.ENV_VAR_NOT_FOUND"]
    CONTINUE["继续加载"]
    PARSE_INT["解析整数值"]
    INT_TRY["尝试 int() 转换"]
    DEFAULT_INT["使用默认值 例如 env.py:292-295"]
    SET_INT["设置整数值"]
    PARSE_BOOL["解析布尔值"]
    BOOL_CHECK[".lower() == 'true'"]
    SET_TRUE["设置为 True"]
    SET_FALSE["设置为 False"]
    PARSE_JSON["解析 JSON 值"]
    JSON_TRY["尝试 json.loads()"]
    DEFAULT_JSON["设置为 None 或默认值 例如 env.py:632-635"]
    SET_JSON["设置解析后的 JSON"]

    LOAD --> VALIDATE_SECRET
    VALIDATE_SECRET --> SECRET_CHECK
    SECRET_CHECK -- 是 --> RAISE_ERROR
    SECRET_CHECK -- 否 --> CONTINUE
    CONTINUE --> PARSE_INT
    PARSE_INT --> INT_TRY
    INT_TRY -- 失败 --> DEFAULT_INT
    INT_TRY -- 成功 --> SET_INT
    CONTINUE --> PARSE_BOOL
    PARSE_BOOL --> BOOL_CHECK
    BOOL_CHECK -- 是 --> SET_TRUE
    BOOL_CHECK -- 否 --> SET_FALSE
    CONTINUE --> PARSE_JSON
    PARSE_JSON --> JSON_TRY
    JSON_TRY -- 失败 --> DEFAULT_JSON
    JSON_TRY -- 成功 --> SET_JSON
```
**代码示例：**

```
# 带默认值的整数解析 (env.py:289-295)
DATABASE_POOL_SIZE = os.environ.get("DATABASE_POOL_SIZE", None)
if DATABASE_POOL_SIZE != None:
    try:
        DATABASE_POOL_SIZE = int(DATABASE_POOL_SIZE)
    except Exception:
        DATABASE_POOL_SIZE = None
```
```
# 布尔值解析 (env.py:362)
REDIS_CLUSTER = os.environ.get("REDIS_CLUSTER", "False").lower() == "true"
```
```
# 带默认值的 JSON 解析 (env.py:629-635)
WEBSOCKET_REDIS_OPTIONS = os.environ.get("WEBSOCKET_REDIS_OPTIONS", "")
if WEBSOCKET_REDIS_OPTIONS == "":
    WEBSOCKET_REDIS_OPTIONS = None
else:
    try:
        WEBSOCKET_REDIS_OPTIONS = json.loads(WEBSOCKET_REDIS_OPTIONS)
    except Exception:
        WEBSOCKET_REDIS_OPTIONS = None
```
**来源：** [backend/open\_webui/env.py289-635](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L289-L635)

## 环境变量 vs. 持久化配置

Open WebUI 使用二级配置系统：

1.  **环境变量**（本文档涵盖）：在容器启动时设置，控制基础设施和初始设置
2.  **持久化配置**（参见 [持久化配置系统](/open-webui/open-webui/11.2-persistent-configuration-system)）：存储在数据库中，可通过管理 UI 修改，跨重启持久化

```mermaid
flowchart TD
    ENV_VARS["环境变量 系统级"]
    INIT["应用程序启动 main.py"]
    APP_CONFIG["AppConfig 实例 config.py"]
    DB_LOAD["从数据库加载 config 表"]
    RUNTIME["运行时配置 app.state.config"]
    ADMIN_UI["管理 UI 设置模态框"]
    UPDATE_API["POST /api/config"]
    DB_SAVE["保存到数据库"]

    ENV_VARS --> INIT
    INIT --> APP_CONFIG
    APP_CONFIG --> DB_LOAD
    DB_LOAD --> RUNTIME
    RUNTIME --> ADMIN_UI
    ADMIN_UI --> UPDATE_API
    UPDATE_API --> DB_SAVE
    DB_SAVE --> RUNTIME
    ENV_VARS --> APP_CONFIG
```
**主要区别：**

-   环境变量：`OLLAMA_BASE_URL`, `DATABASE_URL`, `REDIS_URL`, `WEBUI_SECRET_KEY` (基础设施)
-   持久化配置：Ollama API 端点, OpenAI API 密钥, 功能开关, 用户偏好 (操作级)

某些变量可以通过这两种机制进行设置。环境变量通常提供初始值/默认值，而持久化配置则覆盖它们以提供操作灵活性。

**来源：** [backend/open\_webui/env.py1-889](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L1-L889) [backend/open\_webui/config.py](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/config.py)

## 常用配置模式

### 开发环境

```
# 本地开发的 .env 文件
ENV=dev
DATA_DIR=./data
WEBUI_SECRET_KEY=dev-secret-key-change-in-production
DATABASE_URL=sqlite:///./data/webui.db
OLLAMA_BASE_URL=http://localhost:11434
ENABLE_OLLAMA_API=True
ENABLE_OPENAI_API=False
GLOBAL_LOG_LEVEL=DEBUG
```
### 带外部数据库的生产环境

```
# 生产环境变量
ENV=prod
WEBUI_SECRET_KEY=<强随机密钥>
DATABASE_URL=postgresql://openwebui:password@db-host:5432/openwebui
DATABASE_POOL_SIZE=20
DATABASE_POOL_MAX_OVERFLOW=10
REDIS_URL=redis://redis-host:6379/0
UVICORN_WORKERS=4
ENABLE_OTEL=True
OTEL_EXPORTER_OTLP_ENDPOINT=http://jaeger:4317
AIOHTTP_CLIENT_SESSION_SSL=True
```
### 带 Redis 哨兵的多节点部署

```
# 用于高可用的 Redis 哨兵配置
REDIS_SENTINEL_HOSTS=sentinel1,sentinel2,sentinel3
REDIS_SENTINEL_PORT=26379
REDIS_SENTINEL_MAX_RETRY_COUNT=3
WEBSOCKET_REDIS_URL=redis://redis-master:6379/0
WEBSOCKET_SENTINEL_HOSTS=sentinel1,sentinel2,sentinel3
UVICORN_WORKERS=8
```
### 云存储配置

```
# S3 兼容存储
STORAGE_PROVIDER=s3
S3_BUCKET_NAME=openwebui-uploads
S3_REGION_NAME=us-east-1
S3_ENDPOINT_URL=https://s3.amazonaws.com
S3_ACCESS_KEY_ID=AKIAXXXXXXXXXXXX
S3_SECRET_ACCESS_KEY=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```
**来源：** [README.md86-212](https://github.com/open-webui/open-webui/blob/a7271532/README.md#L86-L212) [backend/open\_webui/env.py210-889](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L210-L889)
