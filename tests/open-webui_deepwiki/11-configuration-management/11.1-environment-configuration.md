# Environment Configuration

Relevant source files

-   [backend/open\_webui/env.py](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py)
-   [backend/open\_webui/routers/audio.py](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/routers/audio.py)
-   [backend/open\_webui/routers/auths.py](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/routers/auths.py)
-   [backend/open\_webui/routers/ollama.py](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/routers/ollama.py)
-   [backend/open\_webui/routers/openai.py](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/routers/openai.py)
-   [backend/open\_webui/utils/auth.py](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/utils/auth.py)
-   [backend/open\_webui/utils/embeddings.py](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/utils/embeddings.py)
-   [backend/open\_webui/utils/misc.py](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/utils/misc.py)
-   [backend/open\_webui/utils/oauth.py](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/utils/oauth.py)
-   [backend/open\_webui/utils/response.py](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/utils/response.py)

## Purpose and Scope

This page documents the environment configuration system in [backend/open\_webui/env.py](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py) which establishes the foundational configuration for Open WebUI at application startup. The `env.py` module loads environment variables from `.env` files, sets global constants, configures database and Redis connections, and establishes the directory structure used throughout the application.

**Key Responsibilities of env.py:**

-   Load environment variables using `python-dotenv`
-   Define application-wide constants (paths, URLs, feature flags)
-   Configure database connection parameters
-   Set up Redis connection settings
-   Establish device type for ML operations (CPU/CUDA/MPS)
-   Configure logging levels per subsystem
-   Define security settings (secret keys, authentication modes)

**Configuration Layer Distinction:**

```mermaid
flowchart TD
    ENV_FILE[".env file"]
    ENV_PY["env.py(Static Constants)"]
    CONFIG_PY["config.py(Dynamic Config)"]
    APP_STATE["app.state.config(Runtime)"]
    APP_LOGIC["Application Logic"]

    ENV --> FILE_ENV_PY
    ENV --> PY_CONFIG_PY
    CONFIG --> PY_APP_STATE
    ENV --> PY_APP_LOGIC
    APP --> STATE_APP_LOGIC
```
-   **env.py**: Static configuration loaded once at startup. Values cannot be changed without restart.
-   **config.py**: Dynamic configuration backed by database and Redis. Values in `PersistentConfig` can be updated at runtime via admin UI.

For runtime configuration updates, see [Dynamic Configuration System (9.4)](https://github.com/open-webui/open-webui/blob/a7271532/Dynamic Configuration System (9.4)) For deployment-specific configuration, see [Deployment and Operations (17)](https://github.com/open-webui/open-webui/blob/a7271532/Deployment and Operations (17))

**Sources:** [backend/open\_webui/env.py1-40](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L1-L40) [backend/open\_webui/config.py1-50](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/config.py#L1-L50) [backend/open\_webui/config.py158-283](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/config.py#L158-L283)

---

## Environment Variable Loading

Open WebUI uses the `python-dotenv` library to load environment variables from a `.env` file located in the repository root. The loading process occurs at the top of [backend/open\_webui/env.py](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py) which establishes the directory structure and loads environment variables before any other imports or configuration.

### Directory Path Resolution

The configuration system establishes a canonical directory hierarchy used throughout the application:

```mermaid
flowchart TD
    ENV_FILE_PATH["ENV_FILE_PATHPath(file).resolve()(env.py absolute path)"]
    OPEN_WEBUI_DIR["OPEN_WEBUI_DIRENV_FILE_PATH.parent(open_webui/)"]
    BACKEND_DIR["BACKEND_DIROPEN_WEBUI_DIR.parent(backend/)"]
    BASE_DIR["BASE_DIRBACKEND_DIR.parent(project root)"]
    DOT_ENV_PATH["BASE_DIR / '.env'"]
    OS_ENVIRON["os.environ"]
    CONSTANTS["Global ConstantsWEBUI_NAME, DATA_DIR,DATABASE_URL, etc."]

    ENV --> FILE_PATH_OPEN_WEBUI_DIR
    OPEN --> WEBUI_DIR_BACKEND_DIR
    BACKEND --> DIR_BASE_DIR
    BASE --> DIR_DOT_ENV_PATH
    DOT --> ENV_PATH_OS_ENVIRON
    OS --> ENVIRON_CONSTANTS
```
**Directory Constants Defined:**

| Constant | Value | Usage |
| --- | --- | --- |
| `OPEN_WEBUI_DIR` | `Path(__file__).parent` | Location of Python package |
| `BACKEND_DIR` | `OPEN_WEBUI_DIR.parent` | Backend code directory |
| `BASE_DIR` | `BACKEND_DIR.parent` | Project root directory |
| `DATA_DIR` | `DATA_DIR` env var or `BACKEND_DIR/data` | Persistent data storage |
| `STATIC_DIR` | `STATIC_DIR` env var or `OPEN_WEBUI_DIR/static` | Static assets |
| `FRONTEND_BUILD_DIR` | `FRONTEND_BUILD_DIR` env var or `BASE_DIR/build` | Compiled frontend |

The path resolution uses `.resolve()` to obtain canonical paths, removing any `..` or `.` components. This ensures consistent path references across the codebase.

**Sources:** [backend/open\_webui/env.py20-35](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L20-L35) [backend/open\_webui/env.py230-263](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L230-L263)

---

## Variable Processing Patterns

Environment variables in Open WebUI follow consistent patterns for type conversion, validation, and default value assignment.

### Boolean Variables

Boolean environment variables use lowercase string comparison with "true":

```
DOCKER = os.environ.get("DOCKER", "False").lower() == "true"
WEBUI_AUTH = os.environ.get("WEBUI_AUTH", "True").lower() == "true"
ENABLE_OAUTH_SIGNUP = os.environ.get("ENABLE_OAUTH_SIGNUP", "False").lower() == "true"
```
This pattern appears throughout [backend/open\_webui/env.py](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py) for feature flags and boolean settings.

### Integer Variables with Validation

Integer variables include error handling to ensure valid values:

```
try:
    DATABASE_POOL_SIZE = int(DATABASE_POOL_SIZE)
except Exception:
    DATABASE_POOL_SIZE = None
```
Empty string handling is common for optional integer variables:

```
if DATABASE_POOL_TIMEOUT == "":
    DATABASE_POOL_TIMEOUT = 30
else:
    try:
        DATABASE_POOL_TIMEOUT = int(DATABASE_POOL_TIMEOUT)
    except Exception:
        DATABASE_POOL_TIMEOUT = 30
```
**Sources:** [backend/open\_webui/env.py309-335](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L309-L335)

### JSON Variables

Complex configuration stored as JSON strings uses error handling:

```
SENTENCE_TRANSFORMERS_MODEL_KWARGS = os.environ.get("SENTENCE_TRANSFORMERS_MODEL_KWARGS", "")
if SENTENCE_TRANSFORMERS_MODEL_KWARGS == "":
    SENTENCE_TRANSFORMERS_MODEL_KWARGS = None
else:
    try:
        SENTENCE_TRANSFORMERS_MODEL_KWARGS = json.loads(SENTENCE_TRANSFORMERS_MODEL_KWARGS)
    except Exception:
        SENTENCE_TRANSFORMERS_MODEL_KWARGS = None
```
**Sources:** [backend/open\_webui/env.py658-669](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L658-L669)

---

## Configuration Categories

Environment variables are organized into functional domains. The following diagram maps high-level categories to the key configuration constants they produce:

```mermaid
flowchart TD
    ENABLE_OTEL["ENABLE_OTEL"]
    AUDIT_LOG_LEVEL["AUDIT_LOG_LEVEL"]
    DEVICE_TYPE["DEVICE_TYPE"]
    SENTENCE_TRANSFORMERS_BACKEND["SENTENCE_TRANSFORMERS_BACKEND"]
    MODELS_CACHE_TTL["MODELS_CACHE_TTL"]
    ENABLE_WEBSOCKET_SUPPORT["ENABLE_WEBSOCKET_SUPPORT"]
    WEBSOCKET_MANAGER["WEBSOCKET_MANAGER"]
    AIOHTTP_CLIENT_TIMEOUT["AIOHTTP_CLIENT_TIMEOUT"]
    WEBUI_SECRET_KEY["WEBUI_SECRET_KEY"]
    WEBUI_AUTH["WEBUI_AUTH"]
    OAUTH_CLIENT_INFO_ENCRYPTION_KEY["OAUTH_CLIENT_INFO_ENCRYPTION_KEY"]
    DATA_DIR["DATA_DIR"]
    DATABASE_URL["DATABASE_URL"]
    REDIS_URL["REDIS_URL"]
    GLOBAL_LOG_LEVEL["GLOBAL_LOG_LEVEL"]
    SRC_LOG_LEVELS["SRC_LOG_LEVELS"]
```
**Sources:** [backend/open\_webui/env.py73-110](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L73-L110) [backend/open\_webui/env.py277-369](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L277-L369) [backend/open\_webui/env.py441-490](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L441-L490) [backend/open\_webui/env.py576-646](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L576-L646) [backend/open\_webui/env.py42-67](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L42-L67) [backend/open\_webui/env.py739-802](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L739-L802) [backend/open\_webui/env.py707-732](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L707-L732)

---

## Logging Configuration

The logging system supports both global and per-source log levels, allowing fine-grained control over logging output.

### Log Level Hierarchy

```mermaid
flowchart TD
    GLOBAL_LOG_LEVEL["GLOBAL_LOG_LEVELDefault: INFO"]
    log_sources["Log Sources:AUDIO, COMFYUI, CONFIG,DB, IMAGES, MAIN,MODELS, OLLAMA, OPENAI,RAG, WEBHOOK, SOCKET, OAUTH"]
    SRC_LOG_LEVELS["SRC_LOG_LEVELS dictPer-source overrides"]
    ENV_VARS["Environment Variables:AUDIO_LOG_LEVELCONFIG_LOG_LEVELetc."]
    Logger["logging.getLogger(name)in each module"]

    GLOBAL --> LOG_LEVEL_SRC_LOG_LEVELS
    ENV --> VARS_SRC_LOG_LEVELS
    log --> sources_ENV_VARS
    SRC --> LOG_LEVELS_Logger
```
**Sources:** [backend/open\_webui/env.py73-111](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L73-L111)

### Log Level Variables

| Variable | Default | Description |
| --- | --- | --- |
| `GLOBAL_LOG_LEVEL` | `INFO` | Sets baseline log level for all loggers |
| `AUDIO_LOG_LEVEL` | Inherits `GLOBAL_LOG_LEVEL` | Audio service logging |
| `COMFYUI_LOG_LEVEL` | Inherits `GLOBAL_LOG_LEVEL` | ComfyUI integration logging |
| `CONFIG_LOG_LEVEL` | Inherits `GLOBAL_LOG_LEVEL` | Configuration system logging |
| `DB_LOG_LEVEL` | Inherits `GLOBAL_LOG_LEVEL` | Database operations logging |
| `IMAGES_LOG_LEVEL` | Inherits `GLOBAL_LOG_LEVEL` | Image generation logging |
| `MAIN_LOG_LEVEL` | Inherits `GLOBAL_LOG_LEVEL` | Main application logging |
| `MODELS_LOG_LEVEL` | Inherits `GLOBAL_LOG_LEVEL` | Model management logging |
| `OLLAMA_LOG_LEVEL` | Inherits `GLOBAL_LOG_LEVEL` | Ollama integration logging |
| `OPENAI_LOG_LEVEL` | Inherits `GLOBAL_LOG_LEVEL` | OpenAI integration logging |
| `RAG_LOG_LEVEL` | Inherits `GLOBAL_LOG_LEVEL` | RAG system logging |
| `WEBHOOK_LOG_LEVEL` | Inherits `GLOBAL_LOG_LEVEL` | Webhook logging |
| `SOCKET_LOG_LEVEL` | Inherits `GLOBAL_LOG_LEVEL` | WebSocket logging |
| `OAUTH_LOG_LEVEL` | Inherits `GLOBAL_LOG_LEVEL` | OAuth authentication logging |

Valid log levels: `DEBUG`, `INFO`, `WARNING`, `ERROR`, `CRITICAL`

**Sources:** [backend/open\_webui/env.py86-111](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L86-L111)

---

## Path and Directory Configuration

Open WebUI configures several directory paths that can be customized via environment variables. When running from the installed package (`FROM_INIT_PY=true`), the system automatically migrates data from the old location to the new location.

### Directory Variables

| Variable | Default | Description |
| --- | --- | --- |
| `DATA_DIR` | `backend/data` or `open_webui/data` | Root directory for persistent data |
| `STATIC_DIR` | `open_webui/static` | Static assets directory |
| `FONTS_DIR` | `open_webui/static/fonts` | Font files directory |
| `FRONTEND_BUILD_DIR` | `build/` or `open_webui/frontend` | Compiled frontend assets |

### Data Directory Migration

When `FROM_INIT_PY` is true (installed via pip), the system checks for an existing data directory and migrates it:

```mermaid
flowchart TD
    Check["DATA_DIR existsand differs fromNEW_DATA_DIR?"]
    Copy["Copy all items to NEW_DATA_DIRshutil.copytree() for dirsshutil.copy2() for files"]
    Zip["Create backup archiveopen_webui_data.zip"]
    Remove["Remove old DATA_DIRshutil.rmtree()"]
    Update["Update DATA_DIRto NEW_DATA_DIR"]

    Check --> Copy
    Copy --> Zip
    Zip --> Remove
    Remove --> Update
    Check --> Update
```
**Sources:** [backend/open\_webui/env.py230-263](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L230-L263)

---

## Database Configuration

The database configuration system supports multiple database types with connection pooling and migration from legacy database names.

### Database URL Construction

The `DATABASE_URL` is constructed from either a single environment variable or multiple component variables, with automatic dialect normalization:

```mermaid
flowchart TD
    DATABASE_URL_ENV["os.environ.get('DATABASE_URL')"]
    CheckURL["DATABASE_URLprovided?"]
    IndividualVars["DB_VARS dict:DATABASE_TYPEDATABASE_USERDATABASE_PASSWORDDATABASE_HOSTDATABASE_PORTDATABASE_NAME"]
    CheckComplete["all(DB_VARS.values())?"]
    ConstructURL["DATABASE_URL =f'{db_type}://{db_cred}@{db_host}:{db_port}/{db_name}'"]
    CheckSQLCipher["DATABASE_TYPE =='sqlite+sqlcipher'?"]
    SQLCipherURL["DATABASE_URL =f'sqlite+sqlcipher:///{DATA_DIR}/webui.db'"]
    DefaultSQLite["DATABASE_URL =f'sqlite:///{DATA_DIR}/webui.db'"]
    PostgresCheck["'postgres://' inDATABASE_URL?"]
    ReplacePostgres["DATABASE_URL =DATABASE_URL.replace('postgres://', 'postgresql://')"]
    FinalURL["DATABASE_URL(global constant)"]

    DATABASE --> URL_ENV_CheckURL
    CheckURL --> PostgresCheck
    CheckURL --> IndividualVars
    IndividualVars --> CheckComplete
    CheckComplete --> ConstructURL
    CheckComplete --> CheckSQLCipher
    CheckSQLCipher --> SQLCipherURL
    CheckSQLCipher --> DefaultSQLite
    ConstructURL --> PostgresCheck
    SQLCipherURL --> PostgresCheck
    DefaultSQLite --> PostgresCheck
    PostgresCheck --> ReplacePostgres
    PostgresCheck --> FinalURL
    ReplacePostgres --> FinalURL
```
The construction logic also handles database migration from legacy `ollama.db` to `webui.db` filenames if found in the `DATA_DIR`.

**Sources:** [backend/open\_webui/env.py277-310](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L277-L310)

### Database Configuration Variables

These constants are consumed by [backend/open\_webui/internal/db.py](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/internal/db.py) to configure SQLAlchemy engine and connection pooling:

| Variable | Default | Description |
| --- | --- | --- |
| `DATABASE_URL` | `sqlite:///DATA_DIR/webui.db` | Complete database connection URL (used by SQLAlchemy `create_engine()`) |
| `DATABASE_TYPE` | \- | Database type (sqlite, postgresql, mysql, etc.) |
| `DATABASE_USER` | \- | Database username |
| `DATABASE_PASSWORD` | \- | Database password |
| `DATABASE_HOST` | \- | Database host |
| `DATABASE_PORT` | \- | Database port |
| `DATABASE_NAME` | \- | Database name |
| `DATABASE_SCHEMA` | `None` | PostgreSQL schema name (passed to SQLAlchemy's `connect_args`) |
| `DATABASE_POOL_SIZE` | `None` | SQLAlchemy `pool_size` parameter |
| `DATABASE_POOL_MAX_OVERFLOW` | `0` | SQLAlchemy `max_overflow` parameter |
| `DATABASE_POOL_TIMEOUT` | `30` | SQLAlchemy `pool_timeout` parameter (seconds) |
| `DATABASE_POOL_RECYCLE` | `3600` | SQLAlchemy `pool_recycle` parameter (seconds) |
| `DATABASE_ENABLE_SQLITE_WAL` | `False` | Enable SQLite Write-Ahead Logging (executes `PRAGMA journal_mode=WAL`) |
| `DATABASE_USER_ACTIVE_STATUS_UPDATE_INTERVAL` | `None` | Interval for updating user active status (float seconds, `None` disables) |

**Sources:** [backend/open\_webui/env.py277-366](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L277-L366)

### Database Migration

The system automatically renames legacy `ollama.db` files to `webui.db`:

```
if os.path.exists(f"{DATA_DIR}/ollama.db"):
    os.rename(f"{DATA_DIR}/ollama.db", f"{DATA_DIR}/webui.db")
```
**Sources:** [backend/open\_webui/env.py270-275](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L270-L275)

---

## Redis Configuration

Redis provides distributed caching, session management, and real-time state synchronization for multi-instance deployments. The Redis client is initialized by `get_redis_connection()` in [backend/open\_webui/utils/redis.py](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/utils/redis.py) using these environment constants.

### Redis Connection Configuration

```mermaid
flowchart TD
    REDIS_URL["REDIS_URL(env var)"]
    REDIS_CLUSTER["REDIS_CLUSTER(env var)"]
    REDIS_SENTINEL["REDIS_SENTINEL_HOSTSREDIS_SENTINEL_PORT(env vars)"]
    GET_REDIS["get_redis_connection()(utils/redis.py)"]
    CLIENT_TYPE["ConnectionType?"]
    SENTINEL_CLIENT["Sentinel(sentinels,sentinel_kwargs).master_for()"]
    CLUSTER_CLIENT["RedisCluster(redis_url,decode_responses)"]
    REGULAR_CLIENT["Redis(redis_url,decode_responses)"]
    APP_STATE["app.state.redis(FastAPI)"]
    APP_CONFIG["app.state.config._redis(AppConfig)"]
    SESSION_POOL["SESSION_POOL(socket.io)"]

    REDIS --> URL_GET_REDIS
    REDIS --> CLUSTER_GET_REDIS
    REDIS --> SENTINEL_GET_REDIS
    GET --> REDIS_CLIENT_TYPE
    CLIENT --> TYPE_SENTINEL_CLIENT
    CLIENT --> TYPE_CLUSTER_CLIENT
    CLIENT --> TYPE_REGULAR_CLIENT
    SENTINEL --> CLIENT_APP_STATE
    CLUSTER --> CLIENT_APP_STATE
    REGULAR --> CLIENT_APP_STATE
    APP --> STATE_APP_CONFIG
    APP --> STATE_SESSION_POOL
```
**Redis Core Variables:**

| Variable | Default | Description |
| --- | --- | --- |
| `REDIS_URL` | `""` | Redis connection URL (e.g., `redis://localhost:6379`) |
| `REDIS_CLUSTER` | `False` | Enable Redis Cluster mode (uses `RedisCluster` class) |
| `REDIS_KEY_PREFIX` | `open-webui` | Prefix for all Redis keys (used in `AppConfig` and Socket.IO) |
| `REDIS_SENTINEL_HOSTS` | `""` | Comma-separated list of Sentinel hosts |
| `REDIS_SENTINEL_PORT` | `26379` | Sentinel port (used with each host in `REDIS_SENTINEL_HOSTS`) |
| `REDIS_SENTINEL_MAX_RETRY_COUNT` | `2` | Maximum retries for Sentinel failover operations |

**WebSocket-Specific Redis Variables:**

| Variable | Default | Description |
| --- | --- | --- |
| `WEBSOCKET_MANAGER` | `""` | WebSocket manager type (set to `redis` to enable Redis-backed WebSocket) |
| `WEBSOCKET_REDIS_URL` | Inherits `REDIS_URL` | Separate Redis URL for WebSocket state |
| `WEBSOCKET_REDIS_CLUSTER` | Inherits `REDIS_CLUSTER` | Enable cluster mode for WebSocket Redis |
| `WEBSOCKET_REDIS_LOCK_TIMEOUT` | `60` | Lock timeout in seconds for distributed locks |
| `WEBSOCKET_SENTINEL_HOSTS` | `""` | Sentinel hosts for WebSocket Redis |
| `WEBSOCKET_SENTINEL_PORT` | `26379` | Sentinel port for WebSocket Redis |

**Sources:** [backend/open\_webui/env.py372-397](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L372-L397) [backend/open\_webui/env.py576-597](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L576-L597) [backend/open\_webui/utils/redis.py1-100](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/utils/redis.py#L1-L100)

---

## Authentication and Security Configuration

The authentication system supports multiple authentication methods with JWT-based session management and configurable security settings.

### Authentication Flow with Environment Variables

```mermaid
flowchart TD
    WEBUI_AUTH["WEBUI_AUTH(env.py)"]
    CheckAuth["WEBUI_AUTH== True?"]
    TrustedHeader["WEBUI_AUTH_TRUSTED_EMAIL_HEADER(env.py)"]
    CheckHeader["Trusted headerconfigured?"]
    LocalAuth["Local AuthenticationAuths.authenticate_user()(routers/auths.py)"]
    HeaderAuth["Trusted Header Authrequest.headers.get()(routers/auths.py)"]
    JWTCreation["create_token()(utils/auth.py)Uses WEBUI_SECRET_KEYand JWT_EXPIRES_IN"]
    SetCookie["response.set_cookie('token')httponly=Truesamesite=WEBUI_AUTH_COOKIE_SAME_SITEsecure=WEBUI_AUTH_COOKIE_SECURE"]
    DisabledAuth["Auto-login as admin@localhostUsers.get_first_user()"]

    WEBUI --> AUTH_CheckAuth
    CheckAuth --> TrustedHeader
    CheckAuth --> DisabledAuth
    TrustedHeader --> CheckHeader
    CheckHeader --> HeaderAuth
    CheckHeader --> LocalAuth
    HeaderAuth --> JWTCreation
    LocalAuth --> JWTCreation
    JWTCreation --> SetCookie
```
**Sources:** [backend/open\_webui/env.py408-471](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L408-L471) [backend/open\_webui/routers/auths.py106-161](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/routers/auths.py#L106-L161) [backend/open\_webui/routers/auths.py464-566](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/routers/auths.py#L464-L566) [backend/open\_webui/utils/auth.py159-199](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/utils/auth.py#L159-L199)

### Core Authentication Variables

| Variable | Default | Description |
| --- | --- | --- |
| `WEBUI_AUTH` | `True` | Enable/disable authentication system |
| `WEBUI_SECRET_KEY` | `t0p-s3cr3t` | JWT signing key (legacy: `WEBUI_JWT_SECRET_KEY`) |
| `WEBUI_SESSION_COOKIE_SAME_SITE` | `lax` | Cookie SameSite attribute |
| `WEBUI_SESSION_COOKIE_SECURE` | `False` | Require HTTPS for session cookies |
| `WEBUI_AUTH_COOKIE_SAME_SITE` | Inherits session value | Cookie SameSite for auth cookies |
| `WEBUI_AUTH_COOKIE_SECURE` | Inherits session value | Require HTTPS for auth cookies |
| `ENABLE_INITIAL_ADMIN_SIGNUP` | `False` | Allow first user signup when auth is disabled |
| `ENABLE_SIGNUP_PASSWORD_CONFIRMATION` | `False` | Require password confirmation on signup |
| `BYPASS_MODEL_ACCESS_CONTROL` | `False` | Disable model access control checks |

**Sources:** [backend/open\_webui/env.py408-471](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L408-L471)

### Trusted Header Authentication

| Variable | Default | Description |
| --- | --- | --- |
| `WEBUI_AUTH_TRUSTED_EMAIL_HEADER` | `None` | HTTP header containing authenticated email |
| `WEBUI_AUTH_TRUSTED_NAME_HEADER` | `None` | HTTP header containing user name |
| `WEBUI_AUTH_TRUSTED_GROUPS_HEADER` | `None` | HTTP header containing user groups (comma-separated) |
| `WEBUI_AUTH_SIGNOUT_REDIRECT_URL` | `None` | Redirect URL after signout |

When `WEBUI_AUTH_TRUSTED_EMAIL_HEADER` is set, the authentication system trusts the reverse proxy to provide authentication. The application automatically creates user accounts based on header values.

**Sources:** [backend/open\_webui/env.py420-435](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L420-L435) [backend/open\_webui/routers/auths.py466-491](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/routers/auths.py#L466-L491)

### JWT Configuration

| Variable | Default | Description |
| --- | --- | --- |
| `JWT_EXPIRES_IN` | Configured via `app.state.config` | JWT token expiration (e.g., `7d`, `24h`, `30m`) |

JWT tokens are created with `WEBUI_SECRET_KEY` using the HS256 algorithm. The expiration is parsed using `parse_duration()` which supports formats like `7d`, `24h`, `30m`, `-1` (never expires), or `0` (immediate expiration).

**Sources:** [backend/open\_webui/utils/auth.py46-48](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/utils/auth.py#L46-L48) [backend/open\_webui/utils/auth.py174-182](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/utils/auth.py#L174-L182)

---

## OAuth Configuration

OAuth configuration controls third-party authentication and dynamic client registration.

### OAuth Variables

| Variable | Default | Description |
| --- | --- | --- |
| `ENABLE_OAUTH_EMAIL_FALLBACK` | `False` | Use email as username fallback |
| `ENABLE_OAUTH_ID_TOKEN_COOKIE` | `True` | Store OAuth ID token in cookie |
| `OAUTH_CLIENT_INFO_ENCRYPTION_KEY` | Inherits `WEBUI_SECRET_KEY` | Encryption key for OAuth client secrets |
| `OAUTH_SESSION_TOKEN_ENCRYPTION_KEY` | Inherits `WEBUI_SECRET_KEY` | Encryption key for OAuth session tokens |

### OAuth Encryption Key Processing

```mermaid
flowchart TD
    KeySource["OAUTH_CLIENT_INFO_ENCRYPTION_KEY"]
    CheckLength["Key length== 44 bytes?"]
    HashKey["Hash with SHA-256base64.urlsafe_b64encode()"]
    UseDirectly["Use key directly.encode()"]
    InitFernet["Fernet(key)"]
    EncryptDecrypt["encrypt_data()decrypt_data()"]

    KeySource --> CheckLength
    CheckLength --> HashKey
    CheckLength --> UseDirectly
    HashKey --> InitFernet
    UseDirectly --> InitFernet
    InitFernet --> EncryptDecrypt
```
The Fernet encryption system requires a 44-byte URL-safe base64-encoded key. If the provided key doesn't meet this requirement, it's hashed with SHA-256 and encoded.

**Sources:** [backend/open\_webui/env.py476-490](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L476-L490) [backend/open\_webui/utils/oauth.py121-154](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/utils/oauth.py#L121-L154)

---

## SCIM Configuration

SCIM (System for Cross-domain Identity Management) provides automated user provisioning.

| Variable | Default | Description |
| --- | --- | --- |
| `SCIM_ENABLED` | `False` | Enable SCIM provisioning endpoint |
| `SCIM_TOKEN` | `""` | Bearer token for SCIM authentication |

**Sources:** [backend/open\_webui/env.py493-498](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L493-L498)

---

## WebSocket Configuration

WebSocket support enables real-time features like streaming responses and collaborative editing.

### WebSocket Variables

| Variable | Default | Description |
| --- | --- | --- |
| `ENABLE_WEBSOCKET_SUPPORT` | `True` | Enable WebSocket connections |
| `WEBSOCKET_MANAGER` | `""` | WebSocket manager backend type |

### HTTP Client Configuration

WebSocket and other HTTP operations use aiohttp with configurable timeouts:

| Variable | Default | Description |
| --- | --- | --- |
| `AIOHTTP_CLIENT_TIMEOUT` | `None` | Default timeout for aiohttp requests (seconds) |
| `AIOHTTP_CLIENT_SESSION_SSL` | `True` | Enable SSL verification for aiohttp sessions |
| `AIOHTTP_CLIENT_TIMEOUT_MODEL_LIST` | `10` | Timeout for model list requests |
| `AIOHTTP_CLIENT_TIMEOUT_TOOL_SERVER_DATA` | `10` | Timeout for tool server data requests |
| `AIOHTTP_CLIENT_SESSION_TOOL_SERVER_SSL` | `True` | Enable SSL for tool server connections |

**Sources:** [backend/open\_webui/env.py574-645](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L574-L645)

---

## AI/ML Configuration

### Device Type Detection

The `DEVICE_TYPE` constant determines which hardware accelerator is used for ML operations (embedding models, reranking models, etc.):

```mermaid
flowchart TD
    USE_CUDA["USE_CUDA_DOCKERos.environ.get()(env.py)"]
    CheckCUDA["USE_CUDA.lower()== 'true'?"]
    TestTorch["import torchtorch.cuda.is_available()"]
    CUDASuccess["CUDAavailable?"]
    SetCUDA["DEVICE_TYPE = 'cuda'Used by SentenceTransformer(device=)"]
    CheckMPS["torch.backends.mps.is_available().is_built()"]
    MPSAvailable["MPSavailable?"]
    SetMPS["DEVICE_TYPE = 'mps'Apple Silicon acceleration"]
    SetCPU["DEVICE_TYPE = 'cpu'Default fallback"]
    USAGE["Used in:SentenceTransformer(device=DEVICE_TYPE)CrossEncoder(device=DEVICE_TYPE)"]

    USE --> CUDA_CheckCUDA
    CheckCUDA --> TestTorch
    TestTorch --> CUDASuccess
    CUDASuccess --> SetCUDA
    CUDASuccess --> CheckMPS
    CheckCUDA --> CheckMPS
    CheckMPS --> MPSAvailable
    MPSAvailable --> SetMPS
    MPSAvailable --> SetCPU
    SetCUDA --> USAGE
    SetMPS --> USAGE
    SetCPU --> USAGE
```
**Sources:** [backend/open\_webui/env.py42-69](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L42-L69) [backend/open\_webui/routers/retrieval.py123-142](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/routers/retrieval.py#L123-L142)

### Sentence Transformers Configuration

| Variable | Default | Description |
| --- | --- | --- |
| `SENTENCE_TRANSFORMERS_BACKEND` | `torch` | Backend for sentence transformers |
| `SENTENCE_TRANSFORMERS_MODEL_KWARGS` | `None` | JSON dict of model kwargs |
| `SENTENCE_TRANSFORMERS_CROSS_ENCODER_BACKEND` | `torch` | Backend for cross-encoder |
| `SENTENCE_TRANSFORMERS_CROSS_ENCODER_MODEL_KWARGS` | `None` | JSON dict of cross-encoder kwargs |

### Model Caching

| Variable | Default | Description |
| --- | --- | --- |
| `MODELS_CACHE_TTL` | `1` | Model cache TTL in seconds (None to disable) |

**Sources:** [backend/open\_webui/env.py649-691](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L649-L691) [backend/open\_webui/env.py527-537](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L527-L537)

---

## Chat Configuration

| Variable | Default | Description |
| --- | --- | --- |
| `CHAT_RESPONSE_STREAM_DELTA_CHUNK_SIZE` | `1` | Number of chunks to buffer before streaming |
| `CHAT_RESPONSE_MAX_TOOL_CALL_RETRIES` | `30` | Maximum retries for tool calls |
| `ENABLE_REALTIME_CHAT_SAVE` | `False` | Save chat updates in real-time |
| `ENABLE_QUERIES_CACHE` | `False` | Enable query result caching |
| `RESET_CONFIG_ON_START` | `False` | Reset configuration to defaults on startup |

**Sources:** [backend/open\_webui/env.py540-570](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L540-L570) [backend/open\_webui/env.py362-370](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L362-L370)

---

## Audit Logging Configuration

Audit logging captures detailed request/response information for compliance and debugging.

### Audit Log Variables

| Variable | Default | Description |
| --- | --- | --- |
| `AUDIT_LOGS_FILE_PATH` | `DATA_DIR/audit.log` | Path to audit log file |
| `AUDIT_LOG_FILE_ROTATION_SIZE` | `10MB` | Maximum log file size before rotation |
| `AUDIT_UVICORN_LOGGER_NAMES` | `uvicorn.access` | Comma-separated logger names to audit |
| `AUDIT_LOG_LEVEL` | `NONE` | Audit level: NONE, METADATA, REQUEST, REQUEST\_RESPONSE |
| `MAX_BODY_LOG_SIZE` | `2048` | Maximum bytes of request/response body to log |
| `AUDIT_EXCLUDED_PATHS` | `/chats,/chat,/folders` | Comma-separated paths to exclude from audit |

### Audit Log Levels

-   **NONE**: No audit logging
-   **METADATA**: Log metadata only (timestamp, user, endpoint)
-   **REQUEST**: Log request metadata and body
-   **REQUEST\_RESPONSE**: Log full request and response

**Sources:** [backend/open\_webui/env.py705-732](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L705-L732)

---

## OpenTelemetry Configuration

OpenTelemetry provides distributed tracing, metrics, and logging for observability.

### OpenTelemetry Variables

| Variable | Default | Description |
| --- | --- | --- |
| `ENABLE_OTEL` | `False` | Enable OpenTelemetry |
| `ENABLE_OTEL_TRACES` | `False` | Enable trace collection |
| `ENABLE_OTEL_METRICS` | `False` | Enable metrics collection |
| `ENABLE_OTEL_LOGS` | `False` | Enable log collection |
| `OTEL_EXPORTER_OTLP_ENDPOINT` | `http://localhost:4317` | Default OTLP endpoint |
| `OTEL_METRICS_EXPORTER_OTLP_ENDPOINT` | Inherits default | Metrics-specific endpoint |
| `OTEL_LOGS_EXPORTER_OTLP_ENDPOINT` | Inherits default | Logs-specific endpoint |
| `OTEL_EXPORTER_OTLP_INSECURE` | `False` | Use insecure connection |
| `OTEL_METRICS_EXPORTER_OTLP_INSECURE` | Inherits default | Insecure for metrics |
| `OTEL_LOGS_EXPORTER_OTLP_INSECURE` | Inherits default | Insecure for logs |
| `OTEL_SERVICE_NAME` | `open-webui` | Service name in telemetry |
| `OTEL_RESOURCE_ATTRIBUTES` | `""` | Additional resource attributes (key1=val1,key2=val2) |
| `OTEL_TRACES_SAMPLER` | `parentbased_always_on` | Trace sampling strategy |

### Authentication for OpenTelemetry

| Variable | Default | Description |
| --- | --- | --- |
| `OTEL_BASIC_AUTH_USERNAME` | `""` | Basic auth username |
| `OTEL_BASIC_AUTH_PASSWORD` | `""` | Basic auth password |
| `OTEL_METRICS_BASIC_AUTH_USERNAME` | Inherits default | Metrics-specific username |
| `OTEL_METRICS_BASIC_AUTH_PASSWORD` | Inherits default | Metrics-specific password |
| `OTEL_LOGS_BASIC_AUTH_USERNAME` | Inherits default | Logs-specific username |
| `OTEL_LOGS_BASIC_AUTH_PASSWORD` | Inherits default | Logs-specific password |

### Exporter Protocol

| Variable | Default | Description |
| --- | --- | --- |
| `OTEL_OTLP_SPAN_EXPORTER` | `grpc` | Protocol for traces (grpc or http) |
| `OTEL_METRICS_OTLP_SPAN_EXPORTER` | Inherits default | Protocol for metrics |
| `OTEL_LOGS_OTLP_SPAN_EXPORTER` | Inherits default | Protocol for logs |

**Sources:** [backend/open\_webui/env.py735-802](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L735-L802)

---

## Middleware and Processing Configuration

### Compression Middleware

| Variable | Default | Description |
| --- | --- | --- |
| `ENABLE_COMPRESSION_MIDDLEWARE` | `True` | Enable gzip compression for responses |

### Forward User Headers

| Variable | Default | Description |
| --- | --- | --- |
| `ENABLE_FORWARD_USER_INFO_HEADERS` | `False` | Forward user info in upstream headers |
| `ENABLE_STAR_SESSIONS_MIDDLEWARE` | `False` | Enable Starlette sessions middleware (experimental) |

### Worker Configuration

| Variable | Default | Description |
| --- | --- | --- |
| `UVICORN_WORKERS` | `1` | Number of Uvicorn worker processes |

**Sources:** [backend/open\_webui/env.py469-471](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L469-L471) [backend/open\_webui/env.py208-218](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L208-L218) [backend/open\_webui/env.py394-405](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L394-L405)

---

## Feature Flags

### Offline Mode

| Variable | Default | Description |
| --- | --- | --- |
| `OFFLINE_MODE` | `False` | Enable offline mode (sets HF\_HUB\_OFFLINE=1) |
| `ENABLE_VERSION_UPDATE_CHECK` | `True` | Check for version updates (disabled in offline mode) |

**Sources:** [backend/open\_webui/env.py693-703](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L693-L703)

### Safe Mode

| Variable | Default | Description |
| --- | --- | --- |
| `SAFE_MODE` | `False` | Enable safe mode (restricts certain features) |

**Sources:** [backend/open\_webui/env.py201-204](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L201-L204)

---

## Tools and Functions Configuration

| Variable | Default | Description |
| --- | --- | --- |
| `PIP_OPTIONS` | `""` | Space-separated pip options for tool installation |
| `PIP_PACKAGE_INDEX_OPTIONS` | `""` | Space-separated pip index options |

These variables configure pip behavior when installing dependencies for custom tools and functions.

**Sources:** [backend/open\_webui/env.py804-808](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L804-L808)

---

## Progressive Web App Configuration

| Variable | Default | Description |
| --- | --- | --- |
| `EXTERNAL_PWA_MANIFEST_URL` | `None` | URL to external PWA manifest.json |

**Sources:** [backend/open\_webui/env.py811-815](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L811-L815)

---

## Licensing Configuration

| Variable | Default | Description |
| --- | --- | --- |
| `LICENSE_KEY` | `""` | License key for premium features |
| `LICENSE_BLOB_PATH` | `DATA_DIR/l.data` | Path to license blob file |
| `LICENSE_PUBLIC_KEY` | `""` | Public key for license verification |

**Sources:** [backend/open\_webui/env.py500-523](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L500-L523) [backend/open\_webui/utils/auth.py28-34](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/utils/auth.py#L28-L34)

---

## Application Metadata

| Variable | Default | Description |
| --- | --- | --- |
| `WEBUI_NAME` | `Open WebUI` | Application name (appends " (Open WebUI)" if changed) |
| `WEBUI_BUILD_HASH` | `dev-build` | Build hash for version tracking |
| `ENV` | `dev` | Environment (dev, test, prod) |
| `INSTANCE_ID` | Random UUID | Unique instance identifier |
| `DOCKER` | `False` | Running in Docker container |
| `TRUSTED_SIGNATURE_KEY` | `""` | HMAC key for verifying trusted signatures |

**Sources:** [backend/open\_webui/env.py113-138](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L113-L138) [backend/open\_webui/env.py39](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L39-L39) [backend/open\_webui/env.py119](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L119-L119) [backend/open\_webui/env.py222-224](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L222-L224)

---

## Environment Variable Reference Table

### Critical Security Variables

| Variable | Default | Security Impact |
| --- | --- | --- |
| `WEBUI_SECRET_KEY` | `t0p-s3cr3t` | **CRITICAL**: Used for JWT signing. Must be changed in production. |
| `OAUTH_CLIENT_INFO_ENCRYPTION_KEY` | Inherits `WEBUI_SECRET_KEY` | Encrypts OAuth client secrets |
| `OAUTH_SESSION_TOKEN_ENCRYPTION_KEY` | Inherits `WEBUI_SECRET_KEY` | Encrypts OAuth session tokens |
| `SCIM_TOKEN` | `""` | Bearer token for SCIM API access |
| `TRUSTED_SIGNATURE_KEY` | `""` | HMAC key for verifying trusted payloads |

**Warning**: The default `WEBUI_SECRET_KEY` value `t0p-s3cr3t` is insecure. Always set a strong, random key in production deployments.

**Sources:** [backend/open\_webui/env.py441-490](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L441-L490)

---

## Usage Examples

### Example 1: Production Database Configuration

```
# PostgreSQL with connection pooling
DATABASE_URL=postgresql://user:pass@localhost:5432/openwebui
DATABASE_POOL_SIZE=10
DATABASE_POOL_MAX_OVERFLOW=20
DATABASE_POOL_TIMEOUT=30
DATABASE_POOL_RECYCLE=3600
```
### Example 2: Redis Sentinel Configuration

```
# Redis with Sentinel for high availability
REDIS_SENTINEL_HOSTS=sentinel1.example.com,sentinel2.example.com,sentinel3.example.com
REDIS_SENTINEL_PORT=26379
REDIS_SENTINEL_MAX_RETRY_COUNT=3
REDIS_KEY_PREFIX=openwebui-prod
```
### Example 3: OAuth with Custom Encryption

```
# OAuth configuration with dedicated encryption key
ENABLE_OAUTH_SIGNUP=true
ENABLE_OAUTH_ID_TOKEN_COOKIE=true
OAUTH_CLIENT_INFO_ENCRYPTION_KEY=your-44-byte-base64-encoded-key-here
```
### Example 4: OpenTelemetry with Jaeger

```
# OpenTelemetry configuration for Jaeger
ENABLE_OTEL=true
ENABLE_OTEL_TRACES=true
ENABLE_OTEL_METRICS=true
OTEL_EXPORTER_OTLP_ENDPOINT=http://jaeger:4317
OTEL_SERVICE_NAME=openwebui-production
OTEL_TRACES_SAMPLER=parentbased_traceidratio
OTEL_RESOURCE_ATTRIBUTES=environment=production,version=0.4.0
```
### Example 5: Trusted Header Authentication

```
# Reverse proxy authentication with group sync
WEBUI_AUTH_TRUSTED_EMAIL_HEADER=X-Forwarded-Email
WEBUI_AUTH_TRUSTED_NAME_HEADER=X-Forwarded-User
WEBUI_AUTH_TRUSTED_GROUPS_HEADER=X-Forwarded-Groups
```
**Sources:** [backend/open\_webui/env.py277-305](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L277-L305) [backend/open\_webui/env.py372-391](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L372-L391) [backend/open\_webui/env.py476-490](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L476-L490) [backend/open\_webui/env.py739-802](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L739-L802) [backend/open\_webui/env.py420-426](https://github.com/open-webui/open-webui/blob/a7271532/backend/open_webui/env.py#L420-L426)
