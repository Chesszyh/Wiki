# Editor Input and Pane System

Relevant source files

-   [src/vs/platform/action/common/action.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/platform/action/common/action.ts)
-   [src/vs/platform/actions/browser/actionViewItemService.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/platform/actions/browser/actionViewItemService.ts)
-   [src/vs/platform/actions/browser/menuEntryActionViewItem.css](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/platform/actions/browser/menuEntryActionViewItem.css)
-   [src/vs/platform/actions/browser/menuEntryActionViewItem.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/platform/actions/browser/menuEntryActionViewItem.ts)
-   [src/vs/platform/actions/browser/toolbar.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/platform/actions/browser/toolbar.ts)
-   [src/vs/platform/actions/common/actions.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/platform/actions/common/actions.ts)
-   [src/vs/platform/actions/common/menuService.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/platform/actions/common/menuService.ts)
-   [src/vs/platform/editor/common/editor.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/platform/editor/common/editor.ts)
-   [src/vs/platform/observable/common/platformObservableUtils.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/platform/observable/common/platformObservableUtils.ts)
-   [src/vs/workbench/browser/actions/layoutActions.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/browser/actions/layoutActions.ts)
-   [src/vs/workbench/browser/actions/quickAccessActions.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/browser/actions/quickAccessActions.ts)
-   [src/vs/workbench/browser/contextkeys.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/browser/contextkeys.ts)
-   [src/vs/workbench/browser/dnd.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/browser/dnd.ts)
-   [src/vs/workbench/browser/layout.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/browser/layout.ts)
-   [src/vs/workbench/browser/parts/auxiliarybar/auxiliaryBarActions.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/browser/parts/auxiliarybar/auxiliaryBarActions.ts)
-   [src/vs/workbench/browser/parts/editor/auxiliaryEditorPart.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/browser/parts/editor/auxiliaryEditorPart.ts)
-   [src/vs/workbench/browser/parts/editor/editor.contribution.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/browser/parts/editor/editor.contribution.ts)
-   [src/vs/workbench/browser/parts/editor/editor.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/browser/parts/editor/editor.ts)
-   [src/vs/workbench/browser/parts/editor/editorActions.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/browser/parts/editor/editorActions.ts)
-   [src/vs/workbench/browser/parts/editor/editorCommands.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/browser/parts/editor/editorCommands.ts)
-   [src/vs/workbench/browser/parts/editor/editorDropTarget.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/browser/parts/editor/editorDropTarget.ts)
-   [src/vs/workbench/browser/parts/editor/editorGroupView.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/browser/parts/editor/editorGroupView.ts)
-   [src/vs/workbench/browser/parts/editor/editorPart.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/browser/parts/editor/editorPart.ts)
-   [src/vs/workbench/browser/parts/editor/editorParts.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/browser/parts/editor/editorParts.ts)
-   [src/vs/workbench/browser/parts/panel/panelActions.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/browser/parts/panel/panelActions.ts)
-   [src/vs/workbench/browser/parts/titlebar/commandCenterControl.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/browser/parts/titlebar/commandCenterControl.ts)
-   [src/vs/workbench/browser/parts/titlebar/media/titlebarpart.css](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/browser/parts/titlebar/media/titlebarpart.css)
-   [src/vs/workbench/browser/parts/titlebar/titlebarActions.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/browser/parts/titlebar/titlebarActions.ts)
-   [src/vs/workbench/browser/parts/titlebar/titlebarPart.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/browser/parts/titlebar/titlebarPart.ts)
-   [src/vs/workbench/browser/parts/titlebar/windowTitle.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/browser/parts/titlebar/windowTitle.ts)
-   [src/vs/workbench/browser/workbench.contribution.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/browser/workbench.contribution.ts)
-   [src/vs/workbench/browser/workbench.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/browser/workbench.ts)
-   [src/vs/workbench/common/contextkeys.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/common/contextkeys.ts)
-   [src/vs/workbench/common/editor.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/common/editor.ts)
-   [src/vs/workbench/contrib/chat/browser/widget/chatContentParts/chatInlineAnchorWidget.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/contrib/chat/browser/widget/chatContentParts/chatInlineAnchorWidget.ts)
-   [src/vs/workbench/contrib/chat/browser/widget/chatContentParts/chatMarkdownDecorationsRenderer.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/contrib/chat/browser/widget/chatContentParts/chatMarkdownDecorationsRenderer.ts)
-   [src/vs/workbench/contrib/chat/browser/widget/chatContentParts/media/chatInlineAnchorWidget.css](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/contrib/chat/browser/widget/chatContentParts/media/chatInlineAnchorWidget.css)
-   [src/vs/workbench/contrib/debug/browser/statusbarColorProvider.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/contrib/debug/browser/statusbarColorProvider.ts)
-   [src/vs/workbench/services/actions/common/menusExtensionPoint.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/services/actions/common/menusExtensionPoint.ts)
-   [src/vs/workbench/services/editor/browser/editorService.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/services/editor/browser/editorService.ts)
-   [src/vs/workbench/services/editor/common/editorGroupsService.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/services/editor/common/editorGroupsService.ts)
-   [src/vs/workbench/services/editor/common/editorService.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/services/editor/common/editorService.ts)
-   [src/vs/workbench/services/editor/test/browser/editorGroupsService.test.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/services/editor/test/browser/editorGroupsService.test.ts)
-   [src/vs/workbench/services/editor/test/browser/editorService.test.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/services/editor/test/browser/editorService.test.ts)
-   [src/vs/workbench/services/layout/browser/layoutService.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/services/layout/browser/layoutService.ts)
-   [src/vs/workbench/test/browser/workbenchTestServices.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/test/browser/workbenchTestServices.ts)

## Purpose and Scope

This document describes the editor input and pane system in VS Code. The system separates the **model layer** (`EditorInput`) from the **view layer** (`EditorPane`), enabling VS Code to support multiple editor types while maintaining a consistent lifecycle and serialization framework.

**Key components documented:**

-   `EditorInput` abstraction and built-in implementations
-   `EditorPane` abstraction and rendering lifecycle
-   Registration and resolution mechanisms
-   Integration with `EditorGroupView` and `EditorGroupModel`

For information about how editors are organized into groups, see [Editor Service and Groups](/microsoft/vscode/5.2-editor-service-and-groups). For the overall layout system, see [Layout System and Parts](/microsoft/vscode/5.1-layout-system-and-parts).

## Core Abstractions

The editor system is built around two primary abstractions: **EditorInput** and **EditorPane**.

### EditorInput: Representing Editable Content

`EditorInput` is an abstract class defined in [src/vs/workbench/common/editor/editorInput.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/common/editor/editorInput.ts) that represents a unit of editable content. It is the model layer in the editor architecture and is independent of any visual representation.

**Diagram: EditorInput Class Hierarchy**

```mermaid
flowchart TD
    EditorInput["EditorInput(abstract base class)"]
    FileEditorInput["FileEditorInputworkbench/contrib/files"]
    UntitledTextEditorInput["UntitledTextEditorInputservices/untitled"]
    DiffEditorInput["DiffEditorInputcommon/editor/diffEditorInput.ts"]
    SideBySideEditorInput["SideBySideEditorInputcommon/editor/sideBySideEditorInput.ts"]
    TextResourceEditorInput["TextResourceEditorInputcommon/editor/textResourceEditorInput.ts"]
    CustomEditorInput["CustomEditorInput(extension-provided)"]

    EditorInput --> FileEditorInput
    EditorInput --> UntitledTextEditorInput
    EditorInput --> DiffEditorInput
    EditorInput --> SideBySideEditorInput
    EditorInput --> TextResourceEditorInput
    EditorInput --> CustomEditorInput
```
**Key responsibilities of EditorInput:**

| Responsibility | Description |
| --- | --- |
| Identity | Provides unique identification via `typeId` and `resource` |
| Capabilities | Declares capabilities via `EditorInputCapabilities` enum |
| Lifecycle | Manages resolve/save/revert operations |
| Metadata | Provides name, description, title, icon |
| Dirty state | Tracks unsaved changes |
| Serialization | Supports persistence across sessions |

Sources: [src/vs/workbench/common/editor.ts710-1057](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/common/editor.ts#L710-L1057) [src/vs/workbench/common/editor/editorInput.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/common/editor/editorInput.ts)

### EditorPane: Visual Container for Editors

`EditorPane` is an abstract class defined in [src/vs/workbench/browser/parts/editor/editorPane.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/browser/parts/editor/editorPane.ts) that represents the visual container and UI for editing content. An `EditorPane` renders and manages the UI for one or more `EditorInput` instances.

**Diagram: EditorPane Class Hierarchy and Responsibilities**

```mermaid
flowchart TD
    IEditorPane["IEditorPaneworkbench/common/editor.ts:85-210"]
    EditorPane["EditorPanebrowser/parts/editor/editorPane.ts"]
    TextResourceEditor["TextResourceEditorbrowser/parts/editor/textResourceEditor.ts"]
    TextDiffEditor["TextDiffEditorbrowser/parts/editor/textDiffEditor.ts"]
    SideBySideEditor["SideBySideEditorbrowser/parts/editor/sideBySideEditor.ts"]
    TextFileEditor["TextFileEditorcontrib/files/browser/editors/textFileEditor.ts"]
    EditorInput["EditorInputvia setInput()"]
    IEditorControl["getControl()ICodeEditor | IDiffEditor"]

    IEditorPane --> EditorPane
    EditorPane --> TextResourceEditor
    EditorPane --> TextDiffEditor
    EditorPane --> SideBySideEditor
    TextResourceEditor --> TextFileEditor
    EditorPane --> EditorInput
    EditorPane --> IEditorControl
```
**Key responsibilities of EditorPane:**

| Responsibility | Description |
| --- | --- |
| Rendering | Creates and manages DOM elements for editing |
| Input lifecycle | Handles `setInput()` to bind EditorInput to the pane |
| Control access | Provides access to underlying editor widget via `getControl()` |
| View state | Manages editor-specific view state (scroll, selection) |
| Size constraints | Defines minimum/maximum width/height |
| Context | Provides scoped `IContextKeyService` |

Sources: [src/vs/workbench/common/editor.ts85-210](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/common/editor.ts#L85-L210) [src/vs/workbench/browser/parts/editor/editorPane.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/browser/parts/editor/editorPane.ts) [src/vs/workbench/browser/parts/editor/textResourceEditor.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/browser/parts/editor/textResourceEditor.ts) [src/vs/workbench/browser/parts/editor/textDiffEditor.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/browser/parts/editor/textDiffEditor.ts)

### Relationship: Input to Pane Mapping

The mapping between `EditorInput` types and `EditorPane` implementations is managed through the `IEditorPaneRegistry` and resolved by `EditorResolverService`.

**Diagram: Editor Opening and Resolution Flow**

```mermaid
flowchart TD
    OpenEditor["IEditorService.openEditor()editorService.ts"]
    ResolveEditor["EditorResolverServiceresolveEditorModel()"]
    Registry["IEditorPaneRegistryRegistry.as(EditorExtensions.EditorPane)"]
    Descriptor["EditorPaneDescriptor"]
    Instantiate["instantiationServicecreateInstance()"]
    SetInput["editorPane.setInput()"]

    OpenEditor --> ResolveEditor
    ResolveEditor --> Registry
    Registry --> Descriptor
    Descriptor --> Instantiate
    Instantiate --> SetInput
```
Sources: [src/vs/workbench/services/editor/browser/editorResolverService.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/services/editor/browser/editorResolverService.ts) [src/vs/workbench/browser/editor.ts115-146](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/browser/editor.ts#L115-L146) [src/vs/workbench/services/editor/browser/editorService.ts588-724](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/services/editor/browser/editorService.ts#L588-L724)

## Editor Input Lifecycle

### Creation and Identity

Every `EditorInput` must provide:

-   **typeId**: A unique string identifying the input type
-   **resource**: Optional URI representing the underlying resource
-   **capabilities**: Bitmask of `EditorInputCapabilities` flags

> **[Mermaid stateDiagram]**
> *(图表结构无法解析)*

**EditorInputCapabilities** (defined in [src/vs/workbench/common/editor.ts795-827](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/common/editor.ts#L795-L827)) define behavioral characteristics:

| Capability | Bit Flag | Description |
| --- | --- | --- |
| `None` | `0` | No special capabilities |
| `Readonly` | `1 << 0` | Input cannot be edited |
| `Untitled` | `1 << 1` | Input has no backing file |
| `RequiresTrust` | `1 << 2` | Requires workspace trust to open |
| `Singleton` | `1 << 3` | Only one instance can exist globally |
| `CanDropIntoEditor` | `1 << 4` | Supports dropping into editor area |
| `AuxWindowUnsupported` | `1 << 5` | Cannot be moved to auxiliary window |
| `Scratchpad` | `1 << 6` | Ephemeral editor (e.g., playground) |
| `CanSplitInGroup` | `1 << 7` | Can be split within a single group |
| `MultipleEditors` | `1 << 8` | Represents multiple sub-editors |
| `ForceDescription` | `1 << 9` | Always show description in UI |

Sources: [src/vs/workbench/common/editor.ts795-827](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/common/editor.ts#L795-L827)

### Resolution and Model Loading

When an editor input is opened, it may need to load its underlying model via `resolve()`:

> **[Mermaid sequence]**
> *(图表结构无法解析)*

Sources: [src/vs/workbench/browser/parts/editor/editorGroupView.ts1031-1172](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/browser/parts/editor/editorGroupView.ts#L1031-L1172)

### Dirty State and Save Lifecycle

Editors track unsaved changes through the `isDirty()` method:

Key methods:

-   `isDirty(): boolean` - Check if input has unsaved changes
-   `isSaving(): boolean` - Check if save is in progress
-   `save(group, options): Promise<IEditorInput | undefined>` - Save changes
-   `revert(group, options): Promise<void>` - Discard changes
-   `onDidChangeDirty: Event<void>` - Fired when dirty state changes

Sources: [src/vs/workbench/common/editor.ts877-932](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/common/editor.ts#L877-L932)

### Disposal and Cleanup

When an editor input is no longer needed:

> **[Mermaid sequence]**
> *(图表结构无法解析)*

Important: Editor inputs may be reference-counted when shared across groups. Actual disposal only occurs when the last reference is removed.

Sources: [src/vs/workbench/common/editor/editorInput.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/common/editor/editorInput.ts)

## Editor Pane Lifecycle

### Instantiation and Registration

Editor panes are registered using `EditorPaneDescriptor` in the `EditorPaneRegistry`:

```mermaid
flowchart TD
    Register["Registry.asEditorExtensions.EditorPane"]
    Descriptor["EditorPaneDescriptor.create(ctor, typeId, name)"]
    InputTypes["SyncDescriptor array(compatible input types)"]

    Register --> Descriptor
    Descriptor --> InputTypes
```
Example registration structure:

```
EditorPaneDescriptor.create(
  TextResourceEditor,           // Pane class
  TextResourceEditor.ID,        // Unique pane ID
  "Text Editor"                 // Display name
)
Supported inputs: [
  UntitledTextEditorInput,
  TextResourceEditorInput
]
```
Sources: [src/vs/workbench/browser/parts/editor/editor.contribution.ts79-89](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/browser/parts/editor/editor.contribution.ts#L79-L89)

### Input Assignment via setInput()

The `setInput()` method binds an `EditorInput` to the pane. This is defined in [src/vs/workbench/browser/parts/editor/editorPane.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/browser/parts/editor/editorPane.ts) and typically overridden by subclasses.

**Diagram: setInput() Sequence**

> **[Mermaid sequence]**
> *(图表结构无法解析)*

The `setInput()` implementation pattern:

1.  Check if input is already set (optimization)
2.  Call `super.setInput()` to update base state
3.  Resolve the input to get its model
4.  Update the underlying editor control
5.  Apply any editor options (selection, reveal, etc.)
6.  Handle any errors

Sources: [src/vs/workbench/browser/parts/editor/editorPane.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/browser/parts/editor/editorPane.ts) [src/vs/workbench/browser/parts/editor/textResourceEditor.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/browser/parts/editor/textResourceEditor.ts) [src/vs/workbench/browser/parts/editor/textEditor.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/browser/parts/editor/textEditor.ts) [src/vs/workbench/browser/parts/editor/editorGroupView.ts1031-1172](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/browser/parts/editor/editorGroupView.ts#L1031-L1172)

### Editor Control Access

The `getControl()` method provides access to the underlying editor widget:

```mermaid
flowchart TD
    EditorPane["EditorPanegetControl(): IEditorControl"]
    TextEditorPane["TextEditorPanegetControl(): ICodeEditor"]
    DiffEditorPane["TextDiffEditorgetControl(): IDiffEditor"]
    CustomPane["CustomEditorPanegetControl(): custom widget"]
    ICodeEditor["ICodeEditor(Monaco editor)"]
    IDiffEditor["IDiffEditor(Monaco diff)"]
    CustomControl["Custom Control"]

    EditorPane --> TextEditorPane
    EditorPane --> DiffEditorPane
    EditorPane --> CustomPane
    TextEditorPane --> ICodeEditor
    DiffEditorPane --> IDiffEditor
    CustomPane --> CustomControl
```
Callers must cast to the specific control type using helpers like:

-   `isCodeEditor(control)`
-   `isDiffEditor(control)`
-   `isCompositeEditor(control)`

Sources: [src/vs/workbench/common/editor.ts168](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/common/editor.ts#L168-L168) [src/vs/editor/browser/editorBrowser.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/editor/browser/editorBrowser.ts)

### View State Persistence

Editor panes can save and restore view state (scroll position, selection, etc.):

> **[Mermaid sequence]**
> *(图表结构无法解析)*

View state includes:

-   Text editor: Scroll position, selection, folding state
-   Diff editor: Scroll sync, ignore trim whitespace setting
-   Custom editors: Editor-specific state

Sources: [src/vs/workbench/common/editor.ts176-177](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/common/editor.ts#L176-L177) [src/vs/workbench/browser/parts/editor/textEditor.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/browser/parts/editor/textEditor.ts)

## Editor Registration System

### EditorPaneRegistry

The `IEditorPaneRegistry` (accessed via `Registry.as<IEditorPaneRegistry>(EditorExtensions.EditorPane)`) maintains the mapping from editor pane IDs to their descriptors.

**Diagram: EditorPaneRegistry Structure**

```mermaid
flowchart TD
    Registry["Registry.as(EditorExtensions.EditorPane)IEditorPaneRegistry"]
    TEP["EditorPaneDescriptorTextResourceEditor.ID"]
    TDE["EditorPaneDescriptorTextDiffEditor.ID"]
    BRDE["EditorPaneDescriptorBinaryResourceDiffEditor.ID"]
    SBSE["EditorPaneDescriptorSideBySideEditor.ID"]
    TEPClass["TextResourceEditor class"]
    UTI["UntitledTextEditorInputTextResourceEditorInput"]
    TDEClass["TextDiffEditor class"]
    DEI["DiffEditorInput"]
    SBSEClass["SideBySideEditor class"]
    SBSEI["SideBySideEditorInput"]

    Registry --> TEP
    Registry --> TDE
    Registry --> BRDE
    Registry --> SBSE
    TEP --> TEPClass
    TEP --> UTI
    TDE --> TDEClass
    TDE --> DEI
    SBSE --> SBSEClass
    SBSE --> SBSEI
```
Sources: [src/vs/workbench/browser/parts/editor/editor.contribution.ts79-122](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/browser/parts/editor/editor.contribution.ts#L79-L122) [src/vs/workbench/browser/editor.ts115-146](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/browser/editor.ts#L115-L146)

### EditorFactoryRegistry

The `IEditorFactoryRegistry` (accessed via `Registry.as<IEditorFactoryRegistry>(EditorExtensions.EditorFactory)`) manages serialization/deserialization of editor inputs for session restore.

**Diagram: EditorFactoryRegistry and Serializers**

```mermaid
flowchart TD
    Registry["Registry.as(EditorExtensions.EditorFactory)IEditorFactoryRegistry"]
    UTI_S["UntitledTextEditorInputSerializerUntitledTextEditorInput.ID"]
    SBSEI_S["SideBySideEditorInputSerializerSideBySideEditorInput.ID"]
    DEI_S["DiffEditorInputSerializerDiffEditorInput.ID"]
    FEI_F["FileEditorFactoryFILE_EDITOR_INPUT_ID"]
    UTI["UntitledTextEditorInput"]
    SBSEI["SideBySideEditorInput"]
    DEI["DiffEditorInput"]
    FEI["FileEditorInput"]

    Registry --> UTI_S
    Registry --> SBSEI_S
    Registry --> DEI_S
    Registry --> FEI_F
    UTI --> S_UTI
    SBSEI --> S_SBSEI
    DEI --> S_DEI
    FEI --> F_FEI
```
**IEditorSerializer interface** (defined in [src/vs/workbench/common/editor.ts457-475](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/common/editor.ts#L457-L475)):

```
interface IEditorSerializer {
  canSerialize(editor: EditorInput): boolean
  serialize(editor: EditorInput): string | undefined
  deserialize(instantiationService: IInstantiationService,
              serializedEditor: string): EditorInput | undefined
}
```
**Serialization flow:**

1.  On window close: `EditorGroupsService` calls `serialize()` on each open `EditorInput`
2.  Serialized JSON stored in `IStorageService` (workspace or profile scope)
3.  On window open: `EditorGroupsService` calls `deserialize()` to recreate inputs
4.  Inputs are reopened in their original groups via `EditorGroupModel.openEditor()`

Sources: [src/vs/workbench/common/editor.ts423-475](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/common/editor.ts#L423-L475) [src/vs/workbench/browser/parts/editor/editor.contribution.ts124-126](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/browser/parts/editor/editor.contribution.ts#L124-L126) [src/vs/workbench/browser/parts/editor/editorPart.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/browser/parts/editor/editorPart.ts)

## Editor Resolution Process

### Resolution Pipeline

When opening an editor, the system resolves the input to determine which pane should display it:

```mermaid
flowchart TD
    Open["editorService.openEditor(input)"]
    Resolver["EditorResolverService"]
    Override["Check for override(user preference/extension)"]
    Default["Find default editor"]
    Registry["Query EditorPaneRegistry"]
    Instantiate["Instantiate EditorPane"]

    Open --> Resolver
    Resolver --> Override
    Override --> Instantiate
    Override --> Default
    Default --> Registry
    Registry --> Instantiate
```
Sources: [src/vs/workbench/services/editor/browser/editorResolverService.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/services/editor/browser/editorResolverService.ts)

### Priority System

The editor resolver uses a priority system to determine which editor to use:

| Priority Level | Description | Example |
| --- | --- | --- |
| `exclusive` | Only editor that can open this input | Binary file editor |
| `default` | Preferred editor for this input type | Text editor for .txt files |
| `option` | Available as alternative | Hex editor for any file |

```mermaid
flowchart TD
    Input["EditorInputResource: file.json"]
    Check1["Has exclusiveeditor?"]
    Check2["Has defaulteditor?"]
    Check3["Show picker"]
    Exclusive["Use exclusive editor"]
    Default["Use default editor"]
    User["User selects from options"]

    Input --> Check1
    Check1 --> Exclusive
    Check1 --> Check2
    Check2 --> Default
    Check2 --> Check3
    Check3 --> User
```
Sources: [src/vs/workbench/services/editor/common/editorResolverService.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/services/editor/common/editorResolverService.ts)

### Custom Editor Association

Users can override default editor associations:

> **[Mermaid sequence]**
> *(图表结构无法解析)*

Configuration format:

```
"workbench.editorAssociations": {
  "*.md": "vscode.markdown.preview.editor",
  "*.ipynb": "jupyter.notebook.ipynb"
}
```
Sources: [src/vs/workbench/browser/parts/editor/editorCommands.ts63-64](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/browser/parts/editor/editorCommands.ts#L63-L64)

## Built-in Editor Input Types

### FileEditorInput

Represents a file from the file system:

```mermaid
flowchart TD
    FileEditorInput["FileEditorInput"]
    Props["Properties"]
    Caps["Capabilities"]
    Resource["resource: URI(file path)"]
    PreferredResource["preferredResource: URI(for symbolic links)"]
    Encoding["preferredEncoding: string"]
    Language["preferredLanguage: string"]
    Contents["preferredContents: string(initial content)"]
    Saveable["✓ Can be saved"]
    Dirty["✓ Tracks dirty state"]
    Encoding2["✓ Encoding support"]
    Rename["✓ Supports rename"]

    FileEditorInput --> Props
    FileEditorInput --> Caps
    Props --> Resource
    Props --> PreferredResource
    Props --> Encoding
    Props --> Language
    Props --> Contents
    Caps --> Saveable
    Caps --> Dirty
    Caps --> Encoding2
    Caps --> Rename
```
Key features:

-   Backed by `ITextFileService` for save/revert operations
-   Supports encoding detection and conversion
-   Integrates with file watcher for external changes
-   Provides `IEncodingSupport` and `ILanguageSupport`

Sources: [src/vs/workbench/contrib/files/browser/editors/fileEditorInput.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/contrib/files/browser/editors/fileEditorInput.ts)

### UntitledTextEditorInput

Represents a new, unsaved text file:

```mermaid
flowchart TD
    UntitledInput["UntitledTextEditorInput"]
    Model["UntitledTextEditorModel"]
    Service["IUntitledTextEditorService"]
    Props["Properties"]
    Resource["resource: URI(untitled:// scheme)"]
    InitialValue["initialValue: string"]
    Language["language: string"]
    AssociatedPath["associatedResource: URI(for save as target)"]
    Behavior["Behavior"]
    AlwaysDirty["Always dirty until saved"]
    SaveAs["Prompts for path on save"]
    Associated["Associated path = suggested name"]

    UntitledInput --> Service
    Service --> Model
    UntitledInput --> Props
    Props --> Resource
    Props --> InitialValue
    Props --> Language
    Props --> AssociatedPath
    UntitledInput --> Behavior
    Behavior --> AlwaysDirty
    Behavior --> SaveAs
    Behavior --> Associated
```
Characteristics:

-   `resource.scheme === 'untitled'`
-   Always considered dirty (`isDirty() === true`)
-   Can have associated file path (for "Save As" hint)
-   Saved via "Save As" workflow

Sources: [src/vs/workbench/services/untitled/common/untitledTextEditorInput.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/services/untitled/common/untitledTextEditorInput.ts)

### DiffEditorInput

Represents a comparison between two editor inputs:

```mermaid
flowchart TD
    DiffEditorInput["DiffEditorInput"]
    Original["original: EditorInput(left/modified)"]
    Modified["modified: EditorInput(right/original)"]
    Pane["TextDiffEditor(pane)"]
    DiffControl["IDiffEditor(Monaco diff widget)"]
    OriginalEditor["Original Editor(left side)"]
    ModifiedEditor["Modified Editor(right side)"]
    Metadata["Metadata"]
    Label["Combines names'left ↔ right'"]
    Dirty["Dirty if modified is dirty"]
    Save["Save delegates to modified"]

    DiffEditorInput --> Original
    DiffEditorInput --> Modified
    DiffEditorInput --> Pane
    Pane --> DiffControl
    DiffControl --> OriginalEditor
    DiffControl --> ModifiedEditor
    DiffEditorInput --> Metadata
    Metadata --> Label
    Metadata --> Dirty
    Metadata --> Save
```
Key behaviors:

-   Name combines both inputs: `{original.name} ↔ {modified.name}`
-   Dirty state follows the `modified` input
-   Save operations delegate to the `modified` input
-   Supports swap operation (`DIFF_SWAP_SIDES` command)

Sources: [src/vs/workbench/common/editor/diffEditorInput.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/common/editor/diffEditorInput.ts)

### SideBySideEditorInput

Shows two editors side-by-side without comparison highlighting:

```mermaid
flowchart TD
    SideBySide["SideBySideEditorInput"]
    Primary["primary: EditorInput(right/main)"]
    Secondary["secondary: EditorInput(left/auxiliary)"]
    Pane["SideBySideEditor(pane)"]
    PrimaryPane["Primary Pane(right side)"]
    SecondaryPane["Secondary Pane(left side)"]
    Focus["Focus Management"]
    Commands["FOCUS_FIRST_SIDE_EDITORFOCUS_SECOND_SIDE_EDITORFOCUS_OTHER_SIDE_EDITOR"]

    SideBySide --> Primary
    SideBySide --> Secondary
    SideBySide --> Pane
    Pane --> PrimaryPane
    Pane --> SecondaryPane
    SideBySide --> Focus
    Focus --> Commands
```
Difference from DiffEditorInput:

-   No diff highlighting or decoration
-   Each side is an independent editor pane
-   Used for reference/comparison without merge semantics
-   Focus can be independently controlled per side

Sources: [src/vs/workbench/common/editor/sideBySideEditorInput.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/common/editor/sideBySideEditorInput.ts) [src/vs/workbench/browser/parts/editor/sideBySideEditor.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/browser/parts/editor/sideBySideEditor.ts)

### TextResourceEditorInput

Represents read-only text content (often from non-file sources):

```mermaid
flowchart TD
    TextResource["TextResourceEditorInput"]
    Props["Properties"]
    Use["Use Cases"]
    Resource["resource: URI(any scheme)"]
    Name["name: string(display name)"]
    Description["description: string"]
    Contents["contents: string(initial value)"]
    Output["Extension output"]
    Virtual["Virtual documents"]
    Readonly["Read-only views"]
    Search["Search results"]

    TextResource --> Props
    Props --> Resource
    Props --> Name
    Props --> Description
    Props --> Contents
    TextResource --> Use
    Use --> Output
    Use --> Virtual
    Use --> Readonly
    Use --> Search
```
Characteristics:

-   Typically read-only (no save capability)
-   Can represent any URI scheme (not just `file://`)
-   Used by extensions for virtual documents
-   Lightweight compared to `FileEditorInput`

Sources: [src/vs/workbench/common/editor/textResourceEditorInput.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/common/editor/textResourceEditorInput.ts)

## Integration with Editor Groups

### Active Editor Concept

Within an `EditorGroupView`, one `EditorInput` can be active at a time. The active editor is managed by `EditorGroupModel`.

**Diagram: Active Editor in EditorGroupView**

```mermaid
flowchart TD
    Group["EditorGroupVieweditorGroupView.ts"]
    Model["EditorGroupModeleditorGroupModel.ts"]
    Editors["editors: EditorInput[]"]
    ActiveIndex["activeEditor: EditorInput | undefined"]
    Pane["EditorPaneseditorPanes.ts"]
    E1["EditorInput 1"]
    E2["EditorInput 2"]
    E3["EditorInput 3(active)"]
    E4["EditorInput 4"]
    ContextKeys["IContextKeyService(scoped)"]
    ActiveEditorContext["ActiveEditorContext.set()"]
    ActiveEditorDirtyContext["ActiveEditorDirtyContext.set()"]
    ActiveEditorPinnedContext["ActiveEditorPinnedContext.set()"]

    Group --> Model
    Model --> Editors
    Model --> ActiveIndex
    Editors --> E1
    Editors --> E2
    Editors --> E3
    Editors --> E4
    ActiveIndex --> E3
    E3 --> Pane
    Group --> ContextKeys
    ContextKeys --> ActiveEditorContext
    ContextKeys --> ActiveEditorDirtyContext
    ContextKeys --> ActiveEditorPinnedContext
```
The active editor determines:

-   Which `EditorPane` is visible in the group
-   Which context keys are active (via `handleGroupContextKeys()` in [src/vs/workbench/browser/parts/editor/editorGroupView.ts249-327](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/browser/parts/editor/editorGroupView.ts#L249-L327))
-   Which commands are available
-   What appears in the `EditorTitleControl`

Sources: [src/vs/workbench/browser/parts/editor/editorGroupView.ts249-327](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/browser/parts/editor/editorGroupView.ts#L249-L327) [src/vs/workbench/common/editor/editorGroupModel.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/common/editor/editorGroupModel.ts)

### Opening Editors in Groups

The flow from opening an editor to displaying it:

> **[Mermaid sequence]**
> *(图表结构无法解析)*

Sources: [src/vs/workbench/browser/parts/editor/editorGroupView.ts988-1172](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/browser/parts/editor/editorGroupView.ts#L988-L1172) [src/vs/workbench/services/editor/browser/editorService.ts588-724](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/services/editor/browser/editorService.ts#L588-L724)

### Editor Stack Management

Each group maintains a stack of opened editors:

```mermaid
flowchart TD
    Stack["Editor Stack"]
    Active["Active Index"]
    Preview["Preview Mode"]
    Pinned["Pinned Set"]
    Sticky["Sticky Set"]
    E1["Editor 1 (sticky)"]
    E2["Editor 2 (pinned)"]
    E3["Editor 3 (active)"]
    E4["Editor 4 (preview)"]
    Operations["Operations"]
    OpenOp["openEditor()"]
    CloseOp["closeEditor()"]
    MoveOp["moveEditor()"]
    PinOp["pinEditor()"]
    StickOp["stickEditor()"]

    Stack --> E1
    Stack --> E2
    Stack --> E3
    Stack --> E4
    Active --> E3
    Pinned --> E1
    Pinned --> E2
    Sticky --> E1
    Preview --> E4
    Operations --> OpenOp
    Operations --> CloseOp
    Operations --> MoveOp
    Operations --> PinOp
    Operations --> StickOp
```
Key concepts:

-   **Sticky editors**: Always appear first, typically pinned
-   **Pinned editors**: Persist in the group (not preview)
-   **Preview editor**: Temporary editor, replaced by next preview
-   **Active editor**: Currently visible editor

Sources: [src/vs/workbench/common/editor/editorGroupModel.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/common/editor/editorGroupModel.ts)

### Pane Reuse and Pooling

The `EditorPanes` container (defined in [src/vs/workbench/browser/parts/editor/editorPanes.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/browser/parts/editor/editorPanes.ts)) manages a pool of `EditorPane` instances for performance.

**Diagram: EditorPanes Pooling Mechanism**

```mermaid
flowchart TD
    EditorPanes["EditorPaneseditorPanes.ts"]
    Registry["IEditorPaneRegistryRegistry.as(EditorExtensions.EditorPane)"]
    ActivePanes["activeEditorPanes: Map<string, EditorPane>"]
    Pane1["TextResourceEditorkey: TextResourceEditor.ID"]
    Pane2["TextDiffEditorkey: TextDiffEditor.ID"]
    Pane3["SideBySideEditorkey: SideBySideEditor.ID"]
    Request["openEditor(input, options)"]
    GetDescriptor["getEditorPaneDescriptor(input)"]
    Check["activeEditorPaneshas descriptor.typeId?"]
    Show["Show existing panesetInput(input)"]
    Create["Instantiate new panecreateEditorPane(descriptor)"]
    SetInput["editorPane.setInput()"]

    EditorPanes --> Registry
    EditorPanes --> ActivePanes
    ActivePanes --> Pane1
    ActivePanes --> Pane2
    ActivePanes --> Pane3
    Request --> GetDescriptor
    GetDescriptor --> Check
    Check --> Show
    Check --> Create
    Show --> SetInput
    Create --> SetInput
```
**Key benefits:**

-   Minimizes DOM creation/destruction
-   Preserves Monaco editor widgets between editor switches
-   Faster editor transitions (especially for text editors)
-   Memory efficiency through reuse

Sources: [src/vs/workbench/browser/parts/editor/editorPanes.ts](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/browser/parts/editor/editorPanes.ts) [src/vs/workbench/browser/parts/editor/editorGroupView.ts1031-1172](https://github.com/microsoft/vscode/blob/1be3088d/src/vs/workbench/browser/parts/editor/editorGroupView.ts#L1031-L1172)

---

## Summary

The Editor Input and Pane System provides the foundation for VS Code's flexible editor architecture:

-   **EditorInput** represents the model/content layer
-   **EditorPane** represents the view/UI layer
-   **Registration system** connects inputs to panes
-   **Resolution system** determines which pane to use
-   **Lifecycle management** handles opening, saving, and closing
-   **Integration with groups** enables multi-editor workflows

This separation of concerns enables:

-   Multiple views of the same content (split editors)
-   Custom editor implementations
-   Flexible serialization and session restore
-   Extension-provided editor types
-   Efficient resource management through pane pooling
