
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://wiki.neurosama.uk/linux_deepwiki/3-virtualization-%28kvm%29/3.2-kvm-arm64-virtualization/">
      
      
        <link rel="prev" href="../3.1-kvm-x86-virtualization/">
      
      
        <link rel="next" href="../">
      
      
        
          <link rel="alternate" href="./" hreflang="en">
        
          <link rel="alternate" href="../../../zh/linux_deepwiki/3-virtualization-%28kvm%29/3.2-kvm-arm64-virtualization/" hreflang="zh">
        
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>KVM ARM64 Virtualization - DeepWiki</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#kvm-arm64-virtualization" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="DeepWiki" class="md-header__button md-logo" aria-label="DeepWiki" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            DeepWiki
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              KVM ARM64 Virtualization
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="Select language">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7 1.62-4.33L19.12 17z"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="./" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="../../../zh/linux_deepwiki/3-virtualization-%28kvm%29/3.2-kvm-arm64-virtualization/" hreflang="zh" class="md-select__link">
              中文
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/Chesszyh/Wiki" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  Welcome to DeepWiki

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../celery_deepwiki/1-celery-overview/1.1-installation-and-setup/" class="md-tabs__link">
          
  
  
  Celery deepwiki

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../lc0_deepwiki/1-lc0-overview/" class="md-tabs__link">
          
  
  
  Lc0 deepwiki

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../1-linux-kernel-overview/" class="md-tabs__link">
          
  
  
  Linux deepwiki

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../ragflow_deepwiki/1-overview/" class="md-tabs__link">
          
  
  
  Ragflow deepwiki

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../redis_deepwiki/1-redis-overview/" class="md-tabs__link">
          
  
  
  Redis deepwiki

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../stockfish_deepwiki/2-core-data-structures-and-types/" class="md-tabs__link">
          
  
  
  Stockfish deepwiki

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="DeepWiki" class="md-nav__button md-logo" aria-label="DeepWiki" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    DeepWiki
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Chesszyh/Wiki" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Welcome to DeepWiki
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Celery deepwiki
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Celery deepwiki
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    1 celery overview
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    1 celery overview
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/1-celery-overview/1.1-installation-and-setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Installation and Setup
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/1-celery-overview/1.2-core-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Core Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/1-celery-overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Celery Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    2 the celery application
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    2 the celery application
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/2-the-celery-application/2.1-application-initialization-and-configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Application Initialization and Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/2-the-celery-application/2.2-task-registration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Task Registration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/2-the-celery-application/2.3-message-brokers-and-routing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Message Brokers and Routing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/2-the-celery-application/2.4-amqp-layer-and-message-protocol/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AMQP Layer and Message Protocol
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/2-the-celery-application/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The Celery Application
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5" >
        
          
          <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    3 tasks
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    3 tasks
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/3-tasks/3.1-task-definition-and-invocation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Task Definition and Invocation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/3-tasks/3.2-task-lifecycle-and-states/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Task Lifecycle and States
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/3-tasks/3.3-error-handling-and-retry/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Error Handling and Retry
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/3-tasks/3.4-time-limits-and-rate-limits/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Time Limits and Rate Limits
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/3-tasks/3.5-task-options-and-customization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Task Options and Customization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/3-tasks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tasks
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_7" >
        
          
          <label class="md-nav__link" for="__nav_2_7" id="__nav_2_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    4 canvas workflows
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    4 canvas workflows
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/4-canvas-workflows/4.1-signatures/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Signature and Composition
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/4-canvas-workflows/4.2-workflow-primitives/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Workflow Primitives
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/4-canvas-workflows/4.3-advanced-canvas-features/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Advanced Canvas Features
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/4-canvas-workflows/4.4-chord-execution/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chord Execution
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/4-canvas-workflows/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Canvas Workflows
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_9" >
        
          
          <label class="md-nav__link" for="__nav_2_9" id="__nav_2_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    5 workers
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    5 workers
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/5-workers/5.1-worker-architecture-and-bootsteps/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Worker Architecture and Bootsteps
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/5-workers/5.2-worker-lifecycle-and-shutdown/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Worker Lifecycle and Shutdown
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/5-workers/5.3-concurrency-models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Concurrency Models
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/5-workers/5.4-worker-configuration-and-control/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Worker Configuration and Control
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/5-workers/5.5-consumer-and-event-loops/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Consumer and Event Loops
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/5-workers/5.6-autoscaling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Autoscaling
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/5-workers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Workers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_11" >
        
          
          <label class="md-nav__link" for="__nav_2_11" id="__nav_2_11_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    6 result backends
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_11">
            <span class="md-nav__icon md-icon"></span>
            
  
    6 result backends
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/6-result-backends/6.1-backend-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Backend Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/6-result-backends/6.2-backend-implementations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Backend Implementations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/6-result-backends/6.3-result-storage-and-retrieval/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Result Serialization and Retrieval
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/6-result-backends/6.4-chord-coordination/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chord Coordination
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/6-result-backends/6.5-backend-resilience/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Error Handling and Resilience
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/6-result-backends/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Result Backends
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_13" >
        
          
          <label class="md-nav__link" for="__nav_2_13" id="__nav_2_13_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    7 periodic tasks (beat)
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_13">
            <span class="md-nav__icon md-icon"></span>
            
  
    7 periodic tasks (beat)
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/7-periodic-tasks-%28beat%29/7.1-beat-scheduler-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Beat Scheduler Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/7-periodic-tasks-%28beat%29/7.2-schedule-types/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Schedule Types
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/7-periodic-tasks-%28beat%29/7.3-time-and-timezone-handling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Time and Timezone Handling
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/7-periodic-tasks-%28beat%29/7.4-persistent-storage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Persistent Storage
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/7-periodic-tasks-%28beat%29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Periodic Tasks (Beat)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_15" >
        
          
          <label class="md-nav__link" for="__nav_2_15" id="__nav_2_15_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    8 monitoring and control
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_15_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_15">
            <span class="md-nav__icon md-icon"></span>
            
  
    8 monitoring and control
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/8-monitoring-and-control/8.1-remote-control-commands/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Remote Control Commands
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/8-monitoring-and-control/8.2-worker-inspection/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Worker Inspection
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/8-monitoring-and-control/8.3-event-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Event System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/8-monitoring-and-control/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Monitoring and Control
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_17" >
        
          
          <label class="md-nav__link" for="__nav_2_17" id="__nav_2_17_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    9 command line interface
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_17_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_17">
            <span class="md-nav__icon md-icon"></span>
            
  
    9 command line interface
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/9-command-line-interface/9.1-cli-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CLI Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/9-command-line-interface/9.2-worker-and-beat-commands/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Worker and Beat Commands
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/9-command-line-interface/9.3-management-commands/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Management Commands
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/9-command-line-interface/9.4-multi-worker-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Multi-worker Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/9-command-line-interface/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Command Line Interface
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_19" >
        
          
          <label class="md-nav__link" for="__nav_2_19" id="__nav_2_19_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    10 development and testing
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_19_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_19">
            <span class="md-nav__icon md-icon"></span>
            
  
    10 development and testing
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/10-development-and-testing/10.1-testing-infrastructure/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Testing Infrastructure
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/10-development-and-testing/10.2-test-matrix-and-environments/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Test Matrix and Environments
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/10-development-and-testing/10.3-integration-and-smoke-tests/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Integration and Smoke Tests
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/10-development-and-testing/10.4-code-quality-and-documentation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Code Quality and Documentation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/10-development-and-testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Development and Testing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_21" >
        
          
          <label class="md-nav__link" for="__nav_2_21" id="__nav_2_21_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    11 packaging and distribution
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_21_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_21">
            <span class="md-nav__icon md-icon"></span>
            
  
    11 packaging and distribution
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/11-packaging-and-distribution/11.1-package-structure/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Package Structure
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/11-packaging-and-distribution/11.2-dependencies-and-extras/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dependencies and Extras
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/11-packaging-and-distribution/11.3-version-management-and-release/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Version Management and Release
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/11-packaging-and-distribution/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Packaging and Distribution
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Lc0 deepwiki
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Lc0 deepwiki
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/1-lc0-overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lc0 Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    2 building and installation
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    2 building and installation
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/2-building-and-installation/2.1-build-system-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Build System Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/2-building-and-installation/2.2-linux-and-macos-build-process/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Linux and macOS Build Process
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/2-building-and-installation/2.3-windows-build-process/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Windows Build Process
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/2-building-and-installation/2.4-version-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Version Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/2-building-and-installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Building and Installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    3 core engine architecture
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    3 core engine architecture
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/3-core-engine-architecture/3.1-uci-protocol-implementation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    UCI Protocol Implementation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/3-core-engine-architecture/3.2-configuration-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuration System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/3-core-engine-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Core Engine Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_6" >
        
          
          <label class="md-nav__link" for="__nav_3_6" id="__nav_3_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    4 chess representation
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    4 chess representation
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/4-chess-representation/4.1-bitboards-and-move-generation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Bitboards
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/4-chess-representation/4.2-position-encoding-and-history/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Position Encoding and History
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/4-chess-representation/4.3-syzygy-tablebase-integration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Syzygy Tablebase Integration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/4-chess-representation/4.4-pgn-and-game-import/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    PGN and Game Import
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/4-chess-representation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chess Representation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_8" >
        
          
          <label class="md-nav__link" for="__nav_3_8" id="__nav_3_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    5 search algorithm
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    5 search algorithm
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/5-search-algorithm/5.1-mcts-implementation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MCTS Implementation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/5-search-algorithm/5.2-search-parameters-and-stopping-conditions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Search Parameters and Stopping Conditions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/5-search-algorithm/5.3-search-tree-caching/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Caching System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/5-search-algorithm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Search Algorithm
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_10" >
        
          
          <label class="md-nav__link" for="__nav_3_10" id="__nav_3_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    6 neural network system
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    6 neural network system
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/6-neural-network-system/6.1-network-interface-and-backend-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Network Interface and Backend Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/6-neural-network-system/6.2-weights-loading-and-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Weights Loading and Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/6-neural-network-system/6.3-cuda-and-cudnn-backend/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CUDA and cuDNN Backend
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/6-neural-network-system/6.4-onnx-integration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ONNX Integration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/6-neural-network-system/6.5-xla-and-hlo-support/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    XLA and HLO Support
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/6-neural-network-system/6.6-memory-caching-and-performance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Memory Caching and Performance
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/6-neural-network-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Neural Network System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_12" >
        
          
          <label class="md-nav__link" for="__nav_3_12" id="__nav_3_12_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    7 self play system
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_12">
            <span class="md-nav__icon md-icon"></span>
            
  
    7 self play system
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/7-self-play-system/7.1-tournament-organization-and-game-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tournament Organization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/7-self-play-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Self-Play System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_14" >
        
          
          <label class="md-nav__link" for="__nav_3_14" id="__nav_3_14_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    8 utilities and infrastructure
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_14">
            <span class="md-nav__icon md-icon"></span>
            
  
    8 utilities and infrastructure
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/8-utilities-and-infrastructure/8.1-fast-mathematical-functions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Fast Mathematical Functions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/8-utilities-and-infrastructure/8.2-threading-and-synchronization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Threading and Synchronization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/8-utilities-and-infrastructure/8.3-benchmarking-and-performance-testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Benchmarking and Performance Testing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/8-utilities-and-infrastructure/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Utilities and Infrastructure
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_16" >
        
          
          <label class="md-nav__link" for="__nav_3_16" id="__nav_3_16_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    9 continuous integration and deployment
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_16_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_16">
            <span class="md-nav__icon md-icon"></span>
            
  
    9 continuous integration and deployment
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/9-continuous-integration-and-deployment/9.1-circleci-workflows/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CircleCI Workflows
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/9-continuous-integration-and-deployment/9.2-windows-build-and-packaging/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Windows Build and Packaging
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/9-continuous-integration-and-deployment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Continuous Integration and Deployment
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Linux deepwiki
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Linux deepwiki
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../1-linux-kernel-overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Linux Kernel Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    2 rust for linux
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    2 rust for linux
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2-rust-for-linux/2.1-rust-kernel-apis-and-abstractions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Rust Kernel APIs and Abstractions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2-rust-for-linux/2.2-nova-drm-graphics-driver/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Nova DRM Graphics Driver
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2-rust-for-linux/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Rust for Linux
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    3 virtualization (kvm)
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    3 virtualization (kvm)
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../3.1-kvm-x86-virtualization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    KVM x86 Virtualization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    KVM ARM64 Virtualization
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    KVM ARM64 Virtualization
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#purpose-and-scope" class="md-nav__link">
    <span class="md-ellipsis">
      
        Purpose and Scope
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hardware-architecture-overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        Hardware Architecture Overview
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Hardware Architecture Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#execution-modes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Execution Modes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-arm64-virtualization-capabilities" class="md-nav__link">
    <span class="md-ellipsis">
      
        Key ARM64 Virtualization Capabilities
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core-data-structures" class="md-nav__link">
    <span class="md-ellipsis">
      
        Core Data Structures
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Core Data Structures">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vm-and-vcpu-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        VM and vCPU Architecture
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#system-register-state-management" class="md-nav__link">
    <span class="md-ellipsis">
      
        System Register State Management
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#system-register-emulation" class="md-nav__link">
    <span class="md-ellipsis">
      
        System Register Emulation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="System Register Emulation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#register-trap-and-emulation-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Register Trap and Emulation Flow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#important-register-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Important Register Classes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#register-access-optimization-vhe" class="md-nav__link">
    <span class="md-ellipsis">
      
        Register Access Optimization (VHE)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nested-virtualization" class="md-nav__link">
    <span class="md-ellipsis">
      
        Nested Virtualization
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Nested Virtualization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nested-virtualization-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        Nested Virtualization Architecture
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shadow-stage-2-mmu-management" class="md-nav__link">
    <span class="md-ellipsis">
      
        Shadow Stage 2 MMU Management
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nested-s2-page-table-walk" class="md-nav__link">
    <span class="md-ellipsis">
      
        Nested S2 Page Table Walk
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vncr-virtual-nested-control-registers" class="md-nav__link">
    <span class="md-ellipsis">
      
        VNCR (Virtual Nested Control Registers)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#address-translation-at-instruction-emulation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Address Translation (AT) Instruction Emulation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#protected-kvm-pkvm" class="md-nav__link">
    <span class="md-ellipsis">
      
        Protected KVM (pKVM)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Protected KVM (pKVM)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pkvm-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        pKVM Architecture
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pkvm-memory-ownership" class="md-nav__link">
    <span class="md-ellipsis">
      
        pKVM Memory Ownership
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pkvm-vm-lifecycle" class="md-nav__link">
    <span class="md-ellipsis">
      
        pKVM VM Lifecycle
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stage-2-memory-management" class="md-nav__link">
    <span class="md-ellipsis">
      
        Stage 2 Memory Management
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Stage 2 Memory Management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#stage-2-translation-structure" class="md-nav__link">
    <span class="md-ellipsis">
      
        Stage 2 Translation Structure
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stage-2-fault-handling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Stage 2 Fault Handling
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stage-2-page-table-operations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Stage 2 Page Table Operations
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memory-slot-management" class="md-nav__link">
    <span class="md-ellipsis">
      
        Memory Slot Management
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#additional-subsystems" class="md-nav__link">
    <span class="md-ellipsis">
      
        Additional Subsystems
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Additional Subsystems">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#performance-monitoring-unit-pmu" class="md-nav__link">
    <span class="md-ellipsis">
      
        Performance Monitoring Unit (PMU)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#virtual-gic-vgic" class="md-nav__link">
    <span class="md-ellipsis">
      
        Virtual GIC (VGIC)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#timers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Timers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#debug-support" class="md-nav__link">
    <span class="md-ellipsis">
      
        Debug Support
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#key-configuration-and-trap-registers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Key Configuration and Trap Registers
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Key Configuration and Trap Registers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#critical-control-registers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Critical Control Registers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fine-grained-traps-fgt" class="md-nav__link">
    <span class="md-ellipsis">
      
        Fine-Grained Traps (FGT)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        Summary
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Virtualization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_6" >
        
          
          <label class="md-nav__link" for="__nav_4_6" id="__nav_4_6_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    4 core kernel infrastructure
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    4 core kernel infrastructure
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../4-core-kernel-infrastructure/4.1-process-scheduling-and-sched_ext/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Process Scheduling and sched_ext
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../4-core-kernel-infrastructure/4.2-tracing-and-observability/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tracing and Observability
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../4-core-kernel-infrastructure/4.3-build-system-and-kbuild/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Build System and Kbuild
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../4-core-kernel-infrastructure/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Core Kernel Infrastructure
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_8" >
        
          
          <label class="md-nav__link" for="__nav_4_8" id="__nav_4_8_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    5 storage and io
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    5 storage and io
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../5-storage-and-io/5.1-io_uring-asynchronous-io/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    io_uring Asynchronous I/O
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../5-storage-and-io/5.2-btrfs-copy-on-write-filesystem/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Btrfs Copy-on-Write Filesystem
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../5-storage-and-io/5.3-ufs-storage-controller/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    UFS Storage Controller
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../5-storage-and-io/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Storage and I/O
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_10" >
        
          
          <label class="md-nav__link" for="__nav_4_10" id="__nav_4_10_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    6 graphics and display
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    6 graphics and display
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../6-graphics-and-display/6.1-amdgpu-driver/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AMDGPU Driver
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../6-graphics-and-display/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Graphics and Display
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Ragflow deepwiki
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Ragflow deepwiki
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ragflow_deepwiki/1-overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    2 getting started and deployment
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    2 getting started and deployment
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ragflow_deepwiki/2-getting-started-and-deployment/2.1-docker-compose-deployment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Docker Compose Deployment
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ragflow_deepwiki/2-getting-started-and-deployment/2.4-build-system-and-cicd/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Build System and CI/CD
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ragflow_deepwiki/2-getting-started-and-deployment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Getting Started and Deployment
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_4" >
        
          
          <label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    3 system architecture
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    3 system architecture
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ragflow_deepwiki/3-system-architecture/3.1-core-application-services/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Core Application Services
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ragflow_deepwiki/3-system-architecture/3.2-data-storage-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Data Storage Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ragflow_deepwiki/3-system-architecture/3.3-task-execution-and-queue-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Task Execution and Queue System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ragflow_deepwiki/3-system-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    System Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_6" >
        
          
          <label class="md-nav__link" for="__nav_5_6" id="__nav_5_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    4 frontend application
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    4 frontend application
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ragflow_deepwiki/4-frontend-application/4.1-internationalization-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Internationalization System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ragflow_deepwiki/4-frontend-application/4.2-application-structure-and-ui-features/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Application Structure and Routing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ragflow_deepwiki/4-frontend-application/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Frontend Application
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_8" >
        
          
          <label class="md-nav__link" for="__nav_5_8" id="__nav_5_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    5 llm integration system
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    5 llm integration system
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ragflow_deepwiki/5-llm-integration-system/5.1-model-factory-pattern-and-registration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Model Factory Pattern and Registration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ragflow_deepwiki/5-llm-integration-system/5.2-provider-implementations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Provider Implementations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ragflow_deepwiki/5-llm-integration-system/5.3-error-handling-and-retry-logic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Error Handling and Retry Logic
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ragflow_deepwiki/5-llm-integration-system/5.4-tenant-configuration-and-usage-tracking/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tenant Configuration and Usage Tracking
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ragflow_deepwiki/5-llm-integration-system/5.5-tool-calling-and-function-use/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tool Calling and Function Use
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ragflow_deepwiki/5-llm-integration-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LLM Integration System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_10" >
        
          
          <label class="md-nav__link" for="__nav_5_10" id="__nav_5_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    6 document processing pipeline
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    6 document processing pipeline
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ragflow_deepwiki/6-document-processing-pipeline/6.1-document-parsing-strategies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Document Parsing Strategies
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ragflow_deepwiki/6-document-processing-pipeline/6.2-chunking-methods/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chunking Methods
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ragflow_deepwiki/6-document-processing-pipeline/6.3-content-enhancement-and-embedding/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Content Enhancement and Embedding
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ragflow_deepwiki/6-document-processing-pipeline/6.4-layout-recognition-and-ocr/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Layout Recognition and OCR
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ragflow_deepwiki/6-document-processing-pipeline/6.5-knowledge-graph-construction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Knowledge Graph Construction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ragflow_deepwiki/6-document-processing-pipeline/6.6-raptor-hierarchical-summarization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    RAPTOR Hierarchical Summarization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ragflow_deepwiki/6-document-processing-pipeline/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Document Processing Pipeline
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_12" >
        
          
          <label class="md-nav__link" for="__nav_5_12" id="__nav_5_12_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    7 data source integration
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_12">
            <span class="md-nav__icon md-icon"></span>
            
  
    7 data source integration
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ragflow_deepwiki/7-data-source-integration/7.1-connector-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Connector Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ragflow_deepwiki/7-data-source-integration/7.2-synchronization-and-scheduling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Synchronization and Scheduling
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ragflow_deepwiki/7-data-source-integration/7.3-supported-data-sources/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Supported Data Sources
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ragflow_deepwiki/7-data-source-integration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Data Source Integration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_14" >
        
          
          <label class="md-nav__link" for="__nav_5_14" id="__nav_5_14_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    8 backend api system
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_14">
            <span class="md-nav__icon md-icon"></span>
            
  
    8 backend api system
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ragflow_deepwiki/8-backend-api-system/8.1-api-architecture-and-sdk/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    API Architecture and SDK
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ragflow_deepwiki/8-backend-api-system/8.2-authentication-and-authorization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Authentication and Multi-tenancy
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ragflow_deepwiki/8-backend-api-system/8.3-dataset-and-knowledge-base-apis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dataset and Knowledge Base APIs
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ragflow_deepwiki/8-backend-api-system/8.4-document-and-file-management-apis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Document and File Management APIs
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ragflow_deepwiki/8-backend-api-system/8.5-chat-and-conversation-apis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chat and Conversation APIs
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ragflow_deepwiki/8-backend-api-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Backend API System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_16" >
        
          
          <label class="md-nav__link" for="__nav_5_16" id="__nav_5_16_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    9 agent and workflow system
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_16_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_16">
            <span class="md-nav__icon md-icon"></span>
            
  
    9 agent and workflow system
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ragflow_deepwiki/9-agent-and-workflow-system/9.1-canvas-engine-and-dsl/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Canvas Engine and DSL
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ragflow_deepwiki/9-agent-and-workflow-system/9.2-component-system-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Component System Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ragflow_deepwiki/9-agent-and-workflow-system/9.3-built-in-components/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Built-in Components
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ragflow_deepwiki/9-agent-and-workflow-system/9.4-workflow-execution-and-streaming/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Workflow Execution and Streaming
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ragflow_deepwiki/9-agent-and-workflow-system/9.5-state-and-variable-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    State and Variable Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ragflow_deepwiki/9-agent-and-workflow-system/9.6-agent-tools-and-react-loop/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Agent Tools and ReAct Loop
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ragflow_deepwiki/9-agent-and-workflow-system/9.7-canvas-api-and-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Canvas API and Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ragflow_deepwiki/9-agent-and-workflow-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Agent and Workflow System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_18" >
        
          
          <label class="md-nav__link" for="__nav_5_18" id="__nav_5_18_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    10 retrieval and rag system
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_18_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_18">
            <span class="md-nav__icon md-icon"></span>
            
  
    10 retrieval and rag system
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ragflow_deepwiki/10-retrieval-and-rag-system/10.1-query-processing-and-refinement/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Query Processing and Refinement
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ragflow_deepwiki/10-retrieval-and-rag-system/10.2-hybrid-search-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Hybrid Search Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ragflow_deepwiki/10-retrieval-and-rag-system/10.3-reranking-and-metadata-filtering/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Reranking and Metadata Filtering
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ragflow_deepwiki/10-retrieval-and-rag-system/10.4-response-generation-and-citations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Response Generation and Citations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ragflow_deepwiki/10-retrieval-and-rag-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Retrieval and RAG System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Redis deepwiki
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Redis deepwiki
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/1-redis-overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Redis Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2" >
        
          
          <label class="md-nav__link" for="__nav_6_2" id="__nav_6_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    2 redis core
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    2 redis core
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/2-redis-core/2.1-server-architecture-and-lifecycle/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Server Architecture and Lifecycle
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/2-redis-core/2.2-client-connection-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Client Connection Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/2-redis-core/2.3-command-processing-pipeline/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Command Processing Pipeline
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/2-redis-core/2.4-configuration-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuration Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/2-redis-core/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Redis Core
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_4" >
        
          
          <label class="md-nav__link" for="__nav_6_4" id="__nav_6_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    3 data storage and management
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    3 data storage and management
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/3-data-storage-and-management/3.1-core-data-types-implementation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Core Data Types Implementation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/3-data-storage-and-management/3.2-streams-and-blocking-operations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Streams and Blocking Operations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/3-data-storage-and-management/3.3-hyperloglog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    HyperLogLog
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/3-data-storage-and-management/3.4-memory-efficient-data-structures/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Memory-Efficient Data Structures
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/3-data-storage-and-management/3.5-dictionary-and-key-value-store/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dictionary and Key-Value Store
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/3-data-storage-and-management/3.6-dynamic-string-library/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dynamic String Library
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/3-data-storage-and-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Data Storage and Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_6" >
        
          
          <label class="md-nav__link" for="__nav_6_6" id="__nav_6_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    4 memory management
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    4 memory management
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/4-memory-management/4.1-eviction-and-expiration-policies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Eviction and Expiration Policies
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/4-memory-management/4.2-memory-allocators-and-build-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Memory Allocators and Build System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/4-memory-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Memory Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_8" >
        
          
          <label class="md-nav__link" for="__nav_6_8" id="__nav_6_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    5 scripting and extensions
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    5 scripting and extensions
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/5-scripting-and-extensions/5.1-lua-scripting-and-redis-functions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lua Scripting and Redis Functions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/5-scripting-and-extensions/5.2-redis-module-api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Redis Module API
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/5-scripting-and-extensions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Scripting and Extensions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_10" >
        
          
          <label class="md-nav__link" for="__nav_6_10" id="__nav_6_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    6 high availability and distribution
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    6 high availability and distribution
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/6-high-availability-and-distribution/6.1-redis-cluster/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Redis Cluster
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/6-high-availability-and-distribution/6.2-redis-sentinel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Redis Sentinel
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/6-high-availability-and-distribution/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    High Availability and Scaling
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/7-persistence-and-replication/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Persistence and Replication
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_13" >
        
          
          <label class="md-nav__link" for="__nav_6_13" id="__nav_6_13_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    8 security
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_13">
            <span class="md-nav__icon md-icon"></span>
            
  
    8 security
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/8-security/8.1-access-control-lists/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Access Control Lists
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/8-security/8.2-network-security-and-tls/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Network Security and TLS
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/8-security/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Security
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_15" >
        
          
          <label class="md-nav__link" for="__nav_6_15" id="__nav_6_15_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    9 client tools
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_15_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_15">
            <span class="md-nav__icon md-icon"></span>
            
  
    9 client tools
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/9-client-tools/9.1-redis-cli-and-benchmark-tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Redis CLI and Benchmark Tools
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/9-client-tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Client Tools
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_17" >
        
          
          <label class="md-nav__link" for="__nav_6_17" id="__nav_6_17_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    10 development and testing
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_17_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_17">
            <span class="md-nav__icon md-icon"></span>
            
  
    10 development and testing
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/10-development-and-testing/10.1-build-system-and-dependencies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Build System and Dependencies
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/10-development-and-testing/10.2-testing-framework/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Testing Framework
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/10-development-and-testing/10.3-continuous-integration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Continuous Integration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/10-development-and-testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Development and Testing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Stockfish deepwiki
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Stockfish deepwiki
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stockfish_deepwiki/2-core-data-structures-and-types/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Core Data Structures and Types
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_2" >
        
          
          <label class="md-nav__link" for="__nav_7_2" id="__nav_7_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    3 board representation
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    3 board representation
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stockfish_deepwiki/3-board-representation/3.1-position-and-state-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Position and State Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stockfish_deepwiki/3-board-representation/3.2-bitboards-and-low-level-operations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Bitboards and Low-level Operations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stockfish_deepwiki/3-board-representation/3.3-move-generation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Move Generation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stockfish_deepwiki/3-board-representation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Board Representation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_4" >
        
          
          <label class="md-nav__link" for="__nav_7_4" id="__nav_7_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    4 search system
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    4 search system
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stockfish_deepwiki/4-search-system/4.1-search-algorithm-and-iterative-deepening/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Search Algorithm and Iterative Deepening
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stockfish_deepwiki/4-search-system/4.2-thread-management-and-parallel-search/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Thread Management and Parallel Search
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stockfish_deepwiki/4-search-system/4.3-move-ordering-and-move-picker/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Move Ordering and Move Picker
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stockfish_deepwiki/4-search-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Search System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_6" >
        
          
          <label class="md-nav__link" for="__nav_7_6" id="__nav_7_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    5 evaluation system
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    5 evaluation system
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stockfish_deepwiki/5-evaluation-system/5.1-nnue-neural-network-evaluation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    NNUE Neural Network Evaluation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stockfish_deepwiki/5-evaluation-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Evaluation System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_8" >
        
          
          <label class="md-nav__link" for="__nav_7_8" id="__nav_7_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    6 external interface
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    6 external interface
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stockfish_deepwiki/6-external-interface/6.1-uci-protocol-handler/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    UCI Protocol Handler
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stockfish_deepwiki/6-external-interface/6.2-uci-options-and-configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    UCI Options and Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stockfish_deepwiki/6-external-interface/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    External Interface
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_10" >
        
          
          <label class="md-nav__link" for="__nav_7_10" id="__nav_7_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    7 infrastructure and support
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    7 infrastructure and support
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stockfish_deepwiki/7-infrastructure-and-support/7.1-build-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Build System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stockfish_deepwiki/7-infrastructure-and-support/7.2-utilities-and-support-functions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Utilities and Support Functions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stockfish_deepwiki/7-infrastructure-and-support/7.3-testing-and-benchmarking/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Testing and Benchmarking
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stockfish_deepwiki/7-infrastructure-and-support/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Infrastructure and Support
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#purpose-and-scope" class="md-nav__link">
    <span class="md-ellipsis">
      
        Purpose and Scope
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hardware-architecture-overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        Hardware Architecture Overview
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Hardware Architecture Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#execution-modes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Execution Modes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-arm64-virtualization-capabilities" class="md-nav__link">
    <span class="md-ellipsis">
      
        Key ARM64 Virtualization Capabilities
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core-data-structures" class="md-nav__link">
    <span class="md-ellipsis">
      
        Core Data Structures
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Core Data Structures">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vm-and-vcpu-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        VM and vCPU Architecture
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#system-register-state-management" class="md-nav__link">
    <span class="md-ellipsis">
      
        System Register State Management
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#system-register-emulation" class="md-nav__link">
    <span class="md-ellipsis">
      
        System Register Emulation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="System Register Emulation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#register-trap-and-emulation-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Register Trap and Emulation Flow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#important-register-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Important Register Classes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#register-access-optimization-vhe" class="md-nav__link">
    <span class="md-ellipsis">
      
        Register Access Optimization (VHE)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nested-virtualization" class="md-nav__link">
    <span class="md-ellipsis">
      
        Nested Virtualization
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Nested Virtualization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nested-virtualization-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        Nested Virtualization Architecture
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shadow-stage-2-mmu-management" class="md-nav__link">
    <span class="md-ellipsis">
      
        Shadow Stage 2 MMU Management
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nested-s2-page-table-walk" class="md-nav__link">
    <span class="md-ellipsis">
      
        Nested S2 Page Table Walk
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vncr-virtual-nested-control-registers" class="md-nav__link">
    <span class="md-ellipsis">
      
        VNCR (Virtual Nested Control Registers)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#address-translation-at-instruction-emulation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Address Translation (AT) Instruction Emulation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#protected-kvm-pkvm" class="md-nav__link">
    <span class="md-ellipsis">
      
        Protected KVM (pKVM)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Protected KVM (pKVM)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pkvm-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        pKVM Architecture
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pkvm-memory-ownership" class="md-nav__link">
    <span class="md-ellipsis">
      
        pKVM Memory Ownership
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pkvm-vm-lifecycle" class="md-nav__link">
    <span class="md-ellipsis">
      
        pKVM VM Lifecycle
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stage-2-memory-management" class="md-nav__link">
    <span class="md-ellipsis">
      
        Stage 2 Memory Management
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Stage 2 Memory Management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#stage-2-translation-structure" class="md-nav__link">
    <span class="md-ellipsis">
      
        Stage 2 Translation Structure
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stage-2-fault-handling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Stage 2 Fault Handling
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stage-2-page-table-operations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Stage 2 Page Table Operations
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memory-slot-management" class="md-nav__link">
    <span class="md-ellipsis">
      
        Memory Slot Management
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#additional-subsystems" class="md-nav__link">
    <span class="md-ellipsis">
      
        Additional Subsystems
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Additional Subsystems">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#performance-monitoring-unit-pmu" class="md-nav__link">
    <span class="md-ellipsis">
      
        Performance Monitoring Unit (PMU)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#virtual-gic-vgic" class="md-nav__link">
    <span class="md-ellipsis">
      
        Virtual GIC (VGIC)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#timers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Timers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#debug-support" class="md-nav__link">
    <span class="md-ellipsis">
      
        Debug Support
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#key-configuration-and-trap-registers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Key Configuration and Trap Registers
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Key Configuration and Trap Registers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#critical-control-registers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Critical Control Registers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fine-grained-traps-fgt" class="md-nav__link">
    <span class="md-ellipsis">
      
        Fine-Grained Traps (FGT)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        Summary
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="kvm-arm64-virtualization">KVM ARM64 Virtualization<a class="headerlink" href="#kvm-arm64-virtualization" title="Permanent link">&para;</a></h1>
<p>Relevant source files</p>
<ul>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/include/asm/esr.h">arch/arm64/include/asm/esr.h</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/include/asm/kvm_arm.h">arch/arm64/include/asm/kvm_arm.h</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/include/asm/kvm_asm.h">arch/arm64/include/asm/kvm_asm.h</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/include/asm/kvm_emulate.h">arch/arm64/include/asm/kvm_emulate.h</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/include/asm/kvm_host.h">arch/arm64/include/asm/kvm_host.h</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/include/asm/kvm_mmu.h">arch/arm64/include/asm/kvm_mmu.h</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/include/asm/kvm_nested.h">arch/arm64/include/asm/kvm_nested.h</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/include/asm/kvm_pgtable.h">arch/arm64/include/asm/kvm_pgtable.h</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/include/asm/kvm_pkvm.h">arch/arm64/include/asm/kvm_pkvm.h</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/include/asm/memory.h">arch/arm64/include/asm/memory.h</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/include/asm/por.h">arch/arm64/include/asm/por.h</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/include/asm/stacktrace/nvhe.h">arch/arm64/include/asm/stacktrace/nvhe.h</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/include/asm/sysreg.h">arch/arm64/include/asm/sysreg.h</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/Makefile">arch/arm64/kvm/Makefile</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/arch_timer.c">arch/arm64/kvm/arch_timer.c</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/arm.c">arch/arm64/kvm/arm.c</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/at.c">arch/arm64/kvm/at.c</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/config.c">arch/arm64/kvm/config.c</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/debug.c">arch/arm64/kvm/debug.c</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/emulate-nested.c">arch/arm64/kvm/emulate-nested.c</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/fpsimd.c">arch/arm64/kvm/fpsimd.c</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/guest.c">arch/arm64/kvm/guest.c</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/handle_exit.c">arch/arm64/kvm/handle_exit.c</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/hyp/entry.S">arch/arm64/kvm/hyp/entry.S</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/hyp/exception.c">arch/arm64/kvm/hyp/exception.c</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/hyp/include/hyp/debug-sr.h">arch/arm64/kvm/hyp/include/hyp/debug-sr.h</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/hyp/include/hyp/fault.h">arch/arm64/kvm/hyp/include/hyp/fault.h</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/hyp/include/hyp/switch.h">arch/arm64/kvm/hyp/include/hyp/switch.h</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/hyp/include/hyp/sysreg-sr.h">arch/arm64/kvm/hyp/include/hyp/sysreg-sr.h</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/hyp/include/nvhe/gfp.h">arch/arm64/kvm/hyp/include/nvhe/gfp.h</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/hyp/include/nvhe/mem_protect.h">arch/arm64/kvm/hyp/include/nvhe/mem_protect.h</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/hyp/include/nvhe/memory.h">arch/arm64/kvm/hyp/include/nvhe/memory.h</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/hyp/include/nvhe/mm.h">arch/arm64/kvm/hyp/include/nvhe/mm.h</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/hyp/include/nvhe/pkvm.h">arch/arm64/kvm/hyp/include/nvhe/pkvm.h</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/hyp/nvhe/debug-sr.c">arch/arm64/kvm/hyp/nvhe/debug-sr.c</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/hyp/nvhe/hyp-main.c">arch/arm64/kvm/hyp/nvhe/hyp-main.c</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/hyp/nvhe/mem_protect.c">arch/arm64/kvm/hyp/nvhe/mem_protect.c</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/hyp/nvhe/mm.c">arch/arm64/kvm/hyp/nvhe/mm.c</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/hyp/nvhe/page_alloc.c">arch/arm64/kvm/hyp/nvhe/page_alloc.c</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/hyp/nvhe/pkvm.c">arch/arm64/kvm/hyp/nvhe/pkvm.c</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/hyp/nvhe/setup.c">arch/arm64/kvm/hyp/nvhe/setup.c</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/hyp/nvhe/stacktrace.c">arch/arm64/kvm/hyp/nvhe/stacktrace.c</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/hyp/nvhe/switch.c">arch/arm64/kvm/hyp/nvhe/switch.c</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/hyp/nvhe/sys_regs.c">arch/arm64/kvm/hyp/nvhe/sys_regs.c</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/hyp/nvhe/sysreg-sr.c">arch/arm64/kvm/hyp/nvhe/sysreg-sr.c</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/hyp/nvhe/timer-sr.c">arch/arm64/kvm/hyp/nvhe/timer-sr.c</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/hyp/pgtable.c">arch/arm64/kvm/hyp/pgtable.c</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/hyp/vhe/debug-sr.c">arch/arm64/kvm/hyp/vhe/debug-sr.c</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/hyp/vhe/switch.c">arch/arm64/kvm/hyp/vhe/switch.c</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/hyp/vhe/sysreg-sr.c">arch/arm64/kvm/hyp/vhe/sysreg-sr.c</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/inject_fault.c">arch/arm64/kvm/inject_fault.c</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/mmu.c">arch/arm64/kvm/mmu.c</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/nested.c">arch/arm64/kvm/nested.c</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/pkvm.c">arch/arm64/kvm/pkvm.c</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/pmu-emul.c">arch/arm64/kvm/pmu-emul.c</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/reset.c">arch/arm64/kvm/reset.c</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/stacktrace.c">arch/arm64/kvm/stacktrace.c</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/sys_regs.c">arch/arm64/kvm/sys_regs.c</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/sys_regs.h">arch/arm64/kvm/sys_regs.h</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/va_layout.c">arch/arm64/kvm/va_layout.c</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/vgic/vgic-v5.c">arch/arm64/kvm/vgic/vgic-v5.c</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/tools/sysreg">arch/arm64/tools/sysreg</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/include/kvm/arm_arch_timer.h">include/kvm/arm_arch_timer.h</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/include/kvm/arm_pmu.h">include/kvm/arm_pmu.h</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/tools/arch/arm64/include/asm/sysreg.h">tools/arch/arm64/include/asm/sysreg.h</a></li>
<li><a href="https://github.com/torvalds/linux/blob/fcb70a56/tools/include/linux/kasan-tags.h">tools/include/linux/kasan-tags.h</a></li>
</ul>
<h2 id="purpose-and-scope">Purpose and Scope<a class="headerlink" href="#purpose-and-scope" title="Permanent link">&para;</a></h2>
<p>This document describes the ARM64-specific implementation of KVM (Kernel-based Virtual Machine) virtualization. It covers system register emulation, nested virtualization support, protected KVM (pKVM), Stage 2 memory management, and ARM64-specific virtualization features. For x86 virtualization, see <a href="/torvalds/linux/3.1-kvm-x86-virtualization">KVM x86 Virtualization</a>. For the generic KVM core, see <a href="/torvalds/linux/3-virtualization-(kvm)">Virtualization and Hardware Isolation</a>.</p>
<h2 id="hardware-architecture-overview">Hardware Architecture Overview<a class="headerlink" href="#hardware-architecture-overview" title="Permanent link">&para;</a></h2>
<p>ARM64 virtualization relies on hardware extensions that provide privilege separation and memory isolation. The architecture defines Exception Levels (ELs) where EL0 is unprivileged user space, EL1 is kernel space, and EL2 is the hypervisor level.</p>
<h3 id="execution-modes">Execution Modes<a class="headerlink" href="#execution-modes" title="Permanent link">&para;</a></h3>
<p><pre class="mermaid"><code>flowchart TD
    L1_HYP["L1 Hypervisor(vEL2)"]
    L0["KVM L0(EL2)"]
    L2_GUEST["L2 Guest(vEL1)"]
    HOST_VHE["Host Linux + KVM(EL2)"]
    GUEST_VHE_EL1["Guest Kernel(EL1)"]
    GUEST_VHE_EL0["Guest User(EL0)"]
    HOST_EL1["Host Linux(EL1)"]
    HOST_EL2["KVM Hypervisor(EL2)"]
    GUEST_EL1["Guest Kernel(EL1)"]
    GUEST_EL0["Guest User(EL0)"]

    L0 --&gt; L1_HYP
    L1 --&gt; HYP_L2_GUEST
    HOST --&gt; VHE_GUEST_VHE_EL1
    GUEST --&gt; VHE_EL1_GUEST_VHE_EL0
    HOST --&gt; EL2_HOST_EL1
    HOST --&gt; EL2_GUEST_EL1
    GUEST --&gt; EL1_GUEST_EL0</code></pre>
<strong>VHE (Virtualization Host Extensions)</strong>: When enabled, the host kernel runs at EL2, eliminating the need for separate EL1/EL2 context switches. This is indicated by <code>HCR_EL2.E2H=1</code>.</p>
<p><strong>NVHE (Non-VHE)</strong>: Traditional mode where the host runs at EL1 and KVM hypervisor code runs at EL2.</p>
<p>Sources: <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/include/asm/kvm_host.h#L1-L100">arch/arm64/include/asm/kvm_host.h1-100</a> <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/arm.c#L1-L100">arch/arm64/kvm/arm.c1-100</a></p>
<h3 id="key-arm64-virtualization-capabilities">Key ARM64 Virtualization Capabilities<a class="headerlink" href="#key-arm64-virtualization-capabilities" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Feature</th>
<th>Description</th>
<th>Code Support</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>HCR_EL2</strong></td>
<td>Hypervisor Configuration Register - controls VM behavior</td>
<td><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/arm.c#L1100-L1200">arch/arm64/kvm/arm.c1100-1200</a></td>
</tr>
<tr>
<td><strong>VHE</strong></td>
<td>Virtualization Host Extensions - host runs at EL2</td>
<td>Detected via <code>has_vhe()</code></td>
</tr>
<tr>
<td><strong>Stage 2 Translation</strong></td>
<td>Second-level address translation (IPA→PA)</td>
<td><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/mmu.c#L1-L100">arch/arm64/kvm/mmu.c1-100</a></td>
</tr>
<tr>
<td><strong>Nested Virtualization</strong></td>
<td>NV/NV2 for running hypervisors in VMs</td>
<td><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/nested.c#L1-L100">arch/arm64/kvm/nested.c1-100</a></td>
</tr>
<tr>
<td><strong>pKVM</strong></td>
<td>Protected KVM with memory isolation</td>
<td><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/pkvm.c#L1-L100">arch/arm64/kvm/pkvm.c1-100</a></td>
</tr>
</tbody>
</table>
<p>Sources: <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/include/asm/kvm_host.h#L1-L100">arch/arm64/include/asm/kvm_host.h1-100</a> <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/arm.c#L1-L100">arch/arm64/kvm/arm.c1-100</a></p>
<h2 id="core-data-structures">Core Data Structures<a class="headerlink" href="#core-data-structures" title="Permanent link">&para;</a></h2>
<h3 id="vm-and-vcpu-architecture">VM and vCPU Architecture<a class="headerlink" href="#vm-and-vcpu-architecture" title="Permanent link">&para;</a></h3>
<p><pre class="mermaid"><code>flowchart TD
    kvm["struct kvm"]
    kvm_arch["struct kvm_arch"]
    kvm_s2_mmu["struct kvm_s2_mmuStage 2 MMU"]
    nested_mmus["nested_mmus[]Shadow S2 MMUs"]
    kvm_vcpu["struct kvm_vcpu"]
    kvm_vcpu_arch["struct kvm_vcpu_arch"]
    kvm_cpu_context["struct kvm_cpu_contextsys_regs[NR_SYS_REGS]"]
    hw_mmu["hw_mmuActive S2 MMU"]
    vncr_array["vncr_arrayNested register state"]

    kvm --&gt; kvm_arch
    kvm --&gt; arch_kvm_s2_mmu
    kvm --&gt; arch_nested_mmus
    kvm --&gt; vcpu_kvm_vcpu_arch
    kvm --&gt; vcpu_arch_kvm_cpu_context
    kvm --&gt; vcpu_arch_hw_mmu
    kvm --&gt; vcpu_arch_vncr_array
    hw --&gt; mmu_kvm_s2_mmu
    hw --&gt; mmu_nested_mmus</code></pre>
<strong><code>struct kvm_arch</code></strong>: VM-wide ARM64-specific state including the primary Stage 2 MMU (<code>mmu</code>), nested MMUs array for nested virtualization, and emulated ID registers.</p>
<p><strong><code>struct kvm_vcpu_arch</code></strong>: Per-vCPU state including system registers (<code>ctxt.sys_regs</code>), trap configuration (<code>hcr_el2</code>, <code>mdcr_el2</code>), and pointer to active Stage 2 MMU (<code>hw_mmu</code>).</p>
<p><strong><code>struct kvm_cpu_context</code></strong>: Holds architectural state including general-purpose registers, system registers array, and FP/SIMD state.</p>
<p><strong><code>struct kvm_s2_mmu</code></strong>: Represents a Stage 2 MMU context with page table base (<code>pgd_phys</code>), VMID, and configuration (<code>vtcr</code>).</p>
<p>Sources: <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/include/asm/kvm_host.h#L294-L408">arch/arm64/include/asm/kvm_host.h294-408</a> <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/include/asm/kvm_host.h#L152-L230">arch/arm64/include/asm/kvm_host.h152-230</a> <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/include/asm/kvm_host.h#L664-L680">arch/arm64/include/asm/kvm_host.h664-680</a> <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/include/asm/kvm_host.h#L794-L896">arch/arm64/include/asm/kvm_host.h794-896</a></p>
<h3 id="system-register-state-management">System Register State Management<a class="headerlink" href="#system-register-state-management" title="Permanent link">&para;</a></h3>
<p><pre class="mermaid"><code>flowchart TD
    MEMORY["SR_LOC_MEMORYIn sys_regs[] array"]
    LOADED["SR_LOC_LOADEDOn physical CPU"]
    MAPPED["SR_LOC_MAPPEDEL2→EL1 mapping"]
    XLATED["SR_LOC_XLATEDNeeds translation"]
    vcpu_read["vcpu_read_sys_reg()"]
    vcpu_write["vcpu_write_sys_reg()"]
    locate_register["locate_register()"]
    read_sr_from_cpu["read_sr_from_cpu()"]
    write_sr_to_cpu["write_sr_to_cpu()"]

    vcpu --&gt; read_locate_register
    vcpu --&gt; write_locate_register
    locate --&gt; register_MEMORY
    locate --&gt; register_LOADED
    locate --&gt; register_MAPPED
    locate --&gt; register_XLATED
    LOADED --&gt; read_sr_from_cpu
    LOADED --&gt; write_sr_to_cpu</code></pre>
The system register state can reside in different locations depending on context:</p>
<ul>
<li><strong><code>SR_LOC_MEMORY</code></strong>: Register stored in <code>sys_regs[]</code> array in memory</li>
<li><strong><code>SR_LOC_LOADED</code></strong>: Register currently loaded on physical CPU</li>
<li><strong><code>SR_LOC_MAPPED</code></strong>: EL2 register mapped to EL1 equivalent (VHE mode)</li>
<li><strong><code>SR_LOC_XLATED</code></strong>: Register needs format translation between EL1/EL2</li>
</ul>
<p>The <code>locate_register()</code> function determines where a register currently resides based on whether the vCPU is loaded and if VHE is active.</p>
<p>Sources: <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/sys_regs.c#L85-L216">arch/arm64/kvm/sys_regs.c85-216</a> <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/sys_regs.c#L218-L292">arch/arm64/kvm/sys_regs.c218-292</a> <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/sys_regs.c#L294-L392">arch/arm64/kvm/sys_regs.c294-392</a></p>
<h2 id="system-register-emulation">System Register Emulation<a class="headerlink" href="#system-register-emulation" title="Permanent link">&para;</a></h2>
<p>System register emulation handles guest accesses to privileged ARM64 system registers via the trap-and-emulate mechanism. The implementation is in <code>arch/arm64/kvm/sys_regs.c</code>.</p>
<h3 id="register-trap-and-emulation-flow">Register Trap and Emulation Flow<a class="headerlink" href="#register-trap-and-emulation-flow" title="Permanent link">&para;</a></h3>
<p><pre class="mermaid"><code>flowchart TD
    GUEST["Guest: MSR/MRS instruction"]
    TRAP["VM exit ESR_EL2.EC=0x18"]
    KEXEC["kvm_handle_sys_reg()"]
    DECODE["kvm_sys_reg_reg_to_index()"]
    SEARCH["__get_sys_reg_desc()Binary search sys_reg_descs[]"]
    CHECK_VIS["r-&gt;visibility()Check ID reg features"]
    ACCESS_FN["r-&gt;access_fn()struct sys_reg_params *p"]
    EMULATE["vcpu_read_sys_reg()vcpu_write_sys_reg()"]
    FORWARD["Forward to nested L1Check coarse_trap_bits[]"]
    UNDEFINED["kvm_inject_undefined()"]

    GUEST --&gt; TRAP
    TRAP --&gt; KEXEC
    KEXEC --&gt; DECODE
    DECODE --&gt; SEARCH
    SEARCH --&gt; CHECK_VIS
    CHECK --&gt; VIS_UNDEFINED
    CHECK --&gt; VIS_ACCESS_FN
    ACCESS --&gt; FN_EMULATE
    ACCESS --&gt; FN_FORWARD
    ACCESS --&gt; FN_UNDEFINED</code></pre>
<strong>Trap Entry</strong>: Exception Syndrome Register (<code>ESR_EL2</code>) contains:</p>
<ul>
<li><code>EC=0x18</code>: System register trap</li>
<li><code>Op0, Op1, CRn, CRm, Op2</code>: Register encoding</li>
<li><code>Rt</code>: Destination register</li>
<li>Direction bit indicates read vs write</li>
</ul>
<p><strong><code>struct sys_reg_desc</code></strong>: Descriptor for each system register at <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/sys_regs.c#L50-L84">arch/arm64/kvm/sys_regs.c50-84</a>:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>struct sys_reg_desc {
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    enum vcpu_sysreg reg;                    // Index into sys_regs[]
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    bool (*access_fn)(...);                  // Trap handler
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    unsigned int (*visibility)(...);         // Feature-based visibility
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    u64 (*reset)(struct kvm_vcpu *, ...);   // Reset function
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    u64 val;                                 // Reset value
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>};
</code></pre></div>
<strong>Access Function Behaviors</strong>:</p>
<ul>
<li><code>access_rw()</code> <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/sys_regs.c#L487-L497">arch/arm64/kvm/sys_regs.c487-497</a>: Read/write via <code>vcpu_read_sys_reg()</code>/<code>vcpu_write_sys_reg()</code></li>
<li><code>trap_raz_wi()</code> <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/sys_regs.c#L684-L692">arch/arm64/kvm/sys_regs.c684-692</a>: Read-as-zero, writes ignored</li>
<li><code>access_vm_reg()</code> <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/sys_regs.c#L556-L579">arch/arm64/kvm/sys_regs.c556-579</a>: VM registers with <code>kvm_toggle_cache()</code> on write</li>
<li><code>access_gic_sgi()</code> <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/sys_regs.c#L602-L648">arch/arm64/kvm/sys_regs.c602-648</a>: Forward to <code>vgic_v3_dispatch_sgi()</code></li>
</ul>
<p>Sources: <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/sys_regs.c#L1-L100">arch/arm64/kvm/sys_regs.c1-100</a> <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/sys_regs.c#L487-L692">arch/arm64/kvm/sys_regs.c487-692</a></p>
<h3 id="important-register-classes">Important Register Classes<a class="headerlink" href="#important-register-classes" title="Permanent link">&para;</a></h3>
<p><pre class="mermaid"><code>flowchart TD
    DBGBVR["DBGBVRn_EL1Breakpoint Value"]
    DBGBCR["DBGBCRn_EL1Breakpoint Control"]
    MDSCR["MDSCR_EL1Monitor Debug"]
    ICC_SGI1R["ICC_SGI1R_EL1Software Generated Interrupt"]
    ICC_SRE["ICC_SRE_EL1System Register Enable"]
    PMCR["PMCR_EL0PMU Control"]
    PMEVCNTR["PMEVCNTRn_EL0Event Counters"]
    PMCCNTR["PMCCNTR_EL0Cycle Counter"]
    ID_AA64PFR0["ID_AA64PFR0_EL1Processor Features"]
    ID_AA64MMFR0["ID_AA64MMFR0_EL1Memory Model Features"]
    MIDR["MIDR_EL1CPU Identification"]
    SCTLR["SCTLR_EL1System Control"]
    TCR["TCR_EL1Translation Control"]
    TTBR["TTBR0/1_EL1Page Table Base"]</code></pre>
<strong>Configuration Registers</strong>: Control MMU, caching, and system behavior. Many are trapped when <code>HCR_EL2.TVM</code> is set to allow KVM to track guest page table configuration.</p>
<p><strong>ID Registers</strong>: Provide feature discovery. KVM virtualizes these to expose a consistent feature set across the VM, potentially hiding host features or advertising emulated features.</p>
<p><strong>PMU Registers</strong>: Performance monitoring counters. KVM creates host perf events to back guest PMU counters, allowing accurate performance measurement in guests.</p>
<p><strong>GIC Registers</strong>: Interrupt controller access. SGI generation is trapped and forwarded to the VGIC for emulation.</p>
<p>Sources: <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/sys_regs.c#L100-L145">arch/arm64/kvm/sys_regs.c100-145</a> <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/sys_regs.c#L602-L667">arch/arm64/kvm/sys_regs.c602-667</a> <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/pmu-emul.c#L1-L100">arch/arm64/kvm/pmu-emul.c1-100</a></p>
<h3 id="register-access-optimization-vhe">Register Access Optimization (VHE)<a class="headerlink" href="#register-access-optimization-vhe" title="Permanent link">&para;</a></h3>
<p>With VHE (<code>HCR_EL2.E2H=1</code>), EL1 registers are accessed via EL12 aliases to avoid save/restore. The <code>locate_register()</code> function <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/sys_regs.c#L175-L216">arch/arm64/kvm/sys_regs.c175-216</a> determines register location using <code>enum sr_loc_attr</code>:</p>
<p><strong>Register Location States</strong> (<code>enum sr_loc_attr</code> at <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/sys_regs.c#L85-L91">arch/arm64/kvm/sys_regs.c85-91</a>):</p>
<ul>
<li><code>SR_LOC_MEMORY (0x0)</code>: In <code>ctxt.sys_regs[]</code> array</li>
<li><code>SR_LOC_LOADED (0x1)</code>: On physical CPU</li>
<li><code>SR_LOC_MAPPED (0x2)</code>: EL2 reg mapped to EL1 (e.g., <code>SCTLR_EL2</code> → <code>SCTLR_EL1</code>)</li>
<li><code>SR_LOC_XLATED (0x4)</code>: Needs format translation (e.g., <code>translate_sctlr_el2_to_sctlr_el1()</code>)</li>
<li><code>SR_LOC_SPECIAL (0x8)</code>: Special handling (e.g., <code>CNTHCTL_EL2</code>)</li>
</ul>
<p><strong>EL12 Alias Mapping</strong> (VHE mode, non-nested):</p>
<table>
<thead>
<tr>
<th>EL1 Register</th>
<th>Physical Register</th>
<th>Translation Function</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>SCTLR_EL1</code></td>
<td><code>SYS_SCTLR_EL12</code></td>
<td>None</td>
</tr>
<tr>
<td><code>TCR_EL1</code></td>
<td><code>SYS_TCR_EL12</code></td>
<td>None</td>
</tr>
<tr>
<td><code>TTBR0_EL1</code></td>
<td><code>SYS_TTBR0_EL12</code></td>
<td>None</td>
</tr>
<tr>
<td><code>SCTLR_EL2</code></td>
<td><code>SYS_SCTLR_EL12</code> (when mapped)</td>
<td><code>translate_sctlr_el2_to_sctlr_el1()</code></td>
</tr>
</tbody>
</table>
<p><strong>Read/Write Functions</strong>:</p>
<ul>
<li><code>vcpu_read_sys_reg()</code> <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/sys_regs.c#L294-L339">arch/arm64/kvm/sys_regs.c294-339</a>: Checks <code>SR_LOC_LOADED</code>, calls <code>read_sr_from_cpu()</code> if on CPU</li>
<li><code>vcpu_write_sys_reg()</code> <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/sys_regs.c#L341-L392">arch/arm64/kvm/sys_regs.c341-392</a>: Checks <code>SR_LOC_LOADED</code>, calls <code>write_sr_to_cpu()</code> if on CPU</li>
<li><code>read_sr_from_cpu()</code> <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/sys_regs.c#L218-L256">arch/arm64/kvm/sys_regs.c218-256</a>: Reads from <code>SYS_*_EL12</code> aliases</li>
<li><code>write_sr_to_cpu()</code> <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/sys_regs.c#L258-L292">arch/arm64/kvm/sys_regs.c258-292</a>: Writes to <code>SYS_*_EL12</code> aliases</li>
</ul>
<p>Sources: <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/sys_regs.c#L85-L392">arch/arm64/kvm/sys_regs.c85-392</a></p>
<h2 id="nested-virtualization">Nested Virtualization<a class="headerlink" href="#nested-virtualization" title="Permanent link">&para;</a></h2>
<p>ARM64 KVM supports nested virtualization, allowing a guest to run its own hypervisor (L1) and nested guests (L2). This is implemented using ARMv8.4-NV (Nested Virtualization) and ARMv8.3-NV extensions.</p>
<h3 id="nested-virtualization-architecture">Nested Virtualization Architecture<a class="headerlink" href="#nested-virtualization-architecture" title="Permanent link">&para;</a></h3>
<p><pre class="mermaid"><code>flowchart TD
    L0_KVM["KVM Hypervisor(EL2)"]
    HOST_MMU["Host S2 MMU"]
    NESTED_MMUS["nested_mmus[]Shadow S2 contexts"]
    L1_VIRT["L1 Guest Hypervisor(vEL2)"]
    L1_S2["L1's S2 Page Tables(VTTBR_EL2)"]
    VNCR["VNCR_EL2Virtual nested control regs"]
    L2_GUEST["L2 Guest(vEL1)"]
    L2_S1["L2 S1 Page Tables"]
    SHADOW_S2["Shadow S2 MMUkvm_s2_mmu"]
    SHADOW_PT["Shadow Page TablesComposite of L1 S2"]

    L0 --&gt; KVM_HOST_MMU
    L0 --&gt; KVM_NESTED_MMUS
    L0 --&gt; KVM_L1_VIRT
    L1 --&gt; VIRT_L1_S2
    L1 --&gt; VIRT_VNCR
    L1 --&gt; VIRT_L2_GUEST
    L2 --&gt; GUEST_L2_S1
    NESTED --&gt; MMUS_SHADOW_S2
    SHADOW --&gt; S2_SHADOW_PT
    L1 --&gt; S2_SHADOW_PT</code></pre>
<strong>L0 (Host KVM)</strong>: Runs at EL2 and manages all virtualization. Maintains shadow S2 contexts for nested guests.</p>
<p><strong>L1 (Guest Hypervisor)</strong>: Runs at vEL2 (virtual EL2) in the context of a VM. Configures its own S2 page tables via <code>VTTBR_EL2</code>.</p>
<p><strong>L2 (Nested Guest)</strong>: Runs at vEL1 under L1's control. Its memory accesses go through both L2's S1 (controlled by L2) and the shadow S2 (controlled by L0).</p>
<p><strong>Shadow S2 MMU</strong>: KVM L0 maintains shadow S2 page tables by walking L1's S2 page tables and translating intermediate physical addresses (IPAs) used by L1.</p>
<p>Sources: <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/nested.c#L1-L52">arch/arm64/kvm/nested.c1-52</a> <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/nested.c#L612-L659">arch/arm64/kvm/nested.c612-659</a></p>
<h3 id="shadow-stage-2-mmu-management">Shadow Stage 2 MMU Management<a class="headerlink" href="#shadow-stage-2-mmu-management" title="Permanent link">&para;</a></h3>
<p><pre class="mermaid"><code>flowchart TD
    LOOKUP["lookup_s2_mmu(vcpu)Check VTTBR_EL2 + VTCR_EL2"]
    FOUND["Shadow S2exists?"]
    GET_FREE["get_s2_mmu_nested()Allocate/reuse context"]
    WALK_L1["kvm_walk_nested_s2()Walk L1's S2 tables"]
    POPULATE["Populate shadow S2kvm_pgtable_stage2_map()"]
    USE["Use shadow S2vcpu-&gt;arch.hw_mmu"]

    LOOKUP --&gt; FOUND
    FOUND --&gt; USE
    FOUND --&gt; GET_FREE
    GET --&gt; FREE_WALK_L1
    WALK --&gt; L1_POPULATE
    POPULATE --&gt; USE</code></pre>
<strong>Context Allocation</strong>: Each VM has an array of <code>nested_mmus</code> (sized as <code>num_vcpus * S2_MMU_PER_VCPU</code>). When a vCPU runs with L1 S2 enabled, KVM searches for a matching shadow context or allocates a new one.</p>
<p><strong>Context Matching</strong>: A shadow S2 MMU is matched by:</p>
<ul>
<li><code>VTTBR_EL2</code> value (VMID + base address)</li>
<li><code>VTCR_EL2</code> configuration</li>
<li><code>HCR_EL2.VM</code> state (S2 enabled/disabled)</li>
</ul>
<p><strong>Page Table Walking</strong>: <code>kvm_walk_nested_s2()</code> performs a software walk of L1's S2 page tables to translate an L2 GPA to L1 IPA, then to host PA.</p>
<p><strong>Shadow Population</strong>: On L2 page faults, KVM walks L1's S2, translates the resulting L1 IPA through the host S2, and populates the shadow S2 with the final PA.</p>
<p>Sources: <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/nested.c#L612-L728">arch/arm64/kvm/nested.c612-728</a> <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/nested.c#L209-L380">arch/arm64/kvm/nested.c209-380</a> <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/nested.c#L661-L720">arch/arm64/kvm/nested.c661-720</a></p>
<h3 id="nested-s2-page-table-walk">Nested S2 Page Table Walk<a class="headerlink" href="#nested-s2-page-table-walk" title="Permanent link">&para;</a></h3>
<p>Function <code>walk_nested_s2_pgd()</code> <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/nested.c#L244-L374">arch/arm64/kvm/nested.c244-374</a> implements ARMv8 Stage 2 translation:</p>
<p><pre class="mermaid"><code>flowchart TD
    START["walk_nested_s2_pgd()phys_addr_t ipa"]
    PARSE["vtcr_to_walk_info()struct s2_walk_info wi"]
    CALC_BASE["wi.baddr = VTTBR_EL2 &amp; masklevel = 3 - wi.sl"]
    LOOP_START["level loop"]
    CALC_INDEX["index = ipa bits[va_top:va_bottom] &gt;&gt; 3"]
    READ_DESC["read_guest_s2_desc()kvm_read_guest()"]
    CHECK_VALID["desc &amp; KVM_PTE_VALID"]
    CHECK_TYPE["desc &amp; KVM_PTE_TYPEBLOCK or TABLE?"]
    CHECK_AF["desc &amp; KVM_PTE_LEAF_ATTR_LO_S2_AF"]
    TRANSLATE["out-&gt;pa = desc_to_oa()out-&gt;readable/writable from S2AP"]
    FAULT["out-&gt;esr = compute_fsc(level, FSC)"]
    NEXT_LEVEL["baddr = desc_to_oa()level++"]
    RETURN_OK["return 0"]
    RETURN_FAULT["return 1"]

    START --&gt; PARSE
    PARSE --&gt; CALC_BASE
    CALC --&gt; BASE_LOOP_START
    LOOP --&gt; START_CALC_INDEX
    CALC --&gt; INDEX_READ_DESC
    READ --&gt; DESC_CHECK_VALID
    CHECK --&gt; VALID_FAULT
    CHECK --&gt; VALID_CHECK_TYPE
    CHECK --&gt; TYPE_NEXT_LEVEL
    CHECK --&gt; TYPE_CHECK_AF
    CHECK --&gt; AF_FAULT
    CHECK --&gt; AF_TRANSLATE
    NEXT --&gt; LEVEL_LOOP_START
    TRANSLATE --&gt; RETURN_OK
    FAULT --&gt; RETURN_FAULT</code></pre>
<strong><code>struct s2_walk_info</code></strong> <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/nested.c#L126-L134">arch/arm64/kvm/nested.c126-134</a>:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>struct s2_walk_info {
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>    u64 baddr;              // Base address from VTTBR_EL2
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>    unsigned int max_oa_bits; // Output address size
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>    unsigned int pgshift;   // Page shift (12/14/16)
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>    unsigned int sl;        // Starting level
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>    unsigned int t0sz;      // VTCR_EL2.T0SZ
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>    bool be;                // Big-endian
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>    bool ha;                // Hardware Access flag update
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>};
</code></pre></div>
<strong><code>struct kvm_s2_trans</code></strong> (output) <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/include/asm/kvm_nested.h#L70-L80">arch/arm64/include/asm/kvm_nested.h70-80</a>:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>struct kvm_s2_trans {
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>    phys_addr_t output;     // Translated PA
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>    unsigned long block_size;
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>    bool readable, writable;
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>    int level;              // Page table level
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>    u64 desc;               // Final descriptor
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>    u64 esr;                // Fault syndrome if failed
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>};
</code></pre></div>
<strong>Descriptor Processing</strong>:</p>
<ul>
<li><code>desc_to_oa()</code> <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/at.c#L59-L80">arch/arm64/kvm/at.c59-80</a>: Extracts output address handling 52-bit PA</li>
<li><code>check_output_size()</code> <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/nested.c#L191-L199">arch/arm64/kvm/nested.c191-199</a>: Validates against <code>wi-&gt;max_oa_bits</code></li>
<li><code>swap_guest_s2_desc()</code> <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/nested.c#L223-L235">arch/arm64/kvm/nested.c223-235</a>: Updates descriptor for hardware AF</li>
</ul>
<p>Sources: <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/nested.c#L126-L374">arch/arm64/kvm/nested.c126-374</a> <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/at.c#L59-L80">arch/arm64/kvm/at.c59-80</a> <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/include/asm/kvm_nested.h#L70-L80">arch/arm64/include/asm/kvm_nested.h70-80</a></p>
<h3 id="vncr-virtual-nested-control-registers">VNCR (Virtual Nested Control Registers)<a class="headerlink" href="#vncr-virtual-nested-control-registers" title="Permanent link">&para;</a></h3>
<p>NV2 extension allows L1's EL2 system registers to be stored in a memory page, eliminating most trap overhead:</p>
<p><pre class="mermaid"><code>flowchart TD
    L2_ACCESS_NEW["L2 accesses EL2 reg"]
    HW_REDIRECT["HW redirects toVNCR_EL2 + offset"]
    NO_TRAP["No trap needed"]
    L2_ACCESS_OLD["L2 accesses EL2 reg"]
    TRAP_L0_OLD["Trap to L0"]
    EMULATE_OLD["Emulate access"]

    L2 --&gt; ACCESS_NEW_HW_REDIRECT
    HW --&gt; REDIRECT_NO_TRAP
    L2 --&gt; ACCESS_OLD_TRAP_L0_OLD
    TRAP --&gt; L0_OLD_EMULATE_OLD</code></pre>
<strong>VNCR Array</strong>: Each vCPU has a <code>vncr_array</code> (4KB page) where NV2-capable registers are stored. The hardware automatically redirects EL2 register accesses to this memory.</p>
<p><strong>Register Mapping</strong>: The <code>VNCR()</code> macro in the <code>vcpu_sysreg</code> enum defines which registers are VNCR-capable and their offsets.</p>
<p><strong>TLB Management</strong>: KVM maintains a <code>vncr_tlb</code> structure tracking the virtual-to-physical translation of the VNCR page, invalidating it on memory changes.</p>
<p>Sources: <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/include/asm/kvm_host.h#L417-L433">arch/arm64/include/asm/kvm_host.h417-433</a> <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/include/asm/kvm_host.h#L532-L622">arch/arm64/include/asm/kvm_host.h532-622</a> <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/nested.c#L813-L858">arch/arm64/kvm/nested.c813-858</a></p>
<h3 id="address-translation-at-instruction-emulation">Address Translation (AT) Instruction Emulation<a class="headerlink" href="#address-translation-at-instruction-emulation" title="Permanent link">&para;</a></h3>
<p>AT instructions perform address translation and are trapped when issued by L1 hypervisors:</p>
<p><pre class="mermaid"><code>flowchart TD
    GUEST_AT["L1 executes AT S1E1R"]
    TRAP["Trap to L0 KVM"]
    SETUP["setup_s1_walk()Parse SCTLR, TCR, TTBR"]
    CHECK_MMU["MMUenabled?"]
    WALK_S1["kvm_walk_s1()Walk S1 page tables"]
    WALK_S2["Walk S2 if nestedkvm_walk_nested_s2()"]
    WRITE_PAR["Write result to PAR_EL1PA or fault syndrome"]

    GUEST --&gt; AT_TRAP
    TRAP --&gt; SETUP
    SETUP --&gt; CHECK_MMU
    CHECK --&gt; MMU_WRITE_PAR
    CHECK --&gt; MMU_WALK_S1
    WALK --&gt; S1_WALK_S2
    WALK --&gt; S2_WRITE_PAR</code></pre>
<strong>Translation Regimes</strong>: The system supports multiple translation regimes:</p>
<ul>
<li><code>TR_EL10</code>: EL1&amp;0 translation regime</li>
<li><code>TR_EL2</code>: EL2 translation regime</li>
<li><code>TR_EL20</code>: EL2&amp;0 translation regime (VHE)</li>
</ul>
<p><strong>AT Instruction Support</strong>: KVM emulates various AT instructions:</p>
<ul>
<li><code>AT S1E0R/W</code>: EL0 translation (read/write)</li>
<li><code>AT S1E1R/W</code>: EL1 translation</li>
<li><code>AT S1E2R/W</code>: EL2 translation (nested context)</li>
</ul>
<p><strong>Complex Features</strong>: The implementation handles advanced features like:</p>
<ul>
<li>52-bit physical addressing (LPA/LPA2)</li>
<li>Permission indirection (PIE, POE)</li>
<li>Hierarchical permission disables (HPD)</li>
</ul>
<p>Sources: <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/at.c#L1-L80">arch/arm64/kvm/at.c1-80</a> <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/at.c#L82-L137">arch/arm64/kvm/at.c82-137</a> <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/at.c#L138-L400">arch/arm64/kvm/at.c138-400</a></p>
<h2 id="protected-kvm-pkvm">Protected KVM (pKVM)<a class="headerlink" href="#protected-kvm-pkvm" title="Permanent link">&para;</a></h2>
<p>pKVM provides strong isolation for confidential VMs by leveraging EL2 to protect guest memory from the host kernel.</p>
<h3 id="pkvm-architecture">pKVM Architecture<a class="headerlink" href="#pkvm-architecture" title="Permanent link">&para;</a></h3>
<p><pre class="mermaid"><code>flowchart TD
    PKVM_HYP["pKVM Hypervisor(Always resident at EL2)"]
    HOST_S2["Host Stage 2 MMU(Restricts host access)"]
    GUEST_S2["Guest Stage 2 MMU(Protects guest memory)"]
    HOST_KERNEL["Host Linux Kernel(Untrusted)"]
    KVM_MODULE["KVM Module(Untrusted)"]
    PROTECTED_VM["Protected VM(Isolated from host)"]
    GUEST_MEMORY["Guest Memory(Host cannot access)"]
    OWNED_BY_HOST["Pages owned by host"]
    OWNED_BY_GUEST["Pages donated to guest(Irrevocable)"]
    OWNED_BY_HYP["Pages owned by hypervisor"]

    HOST --&gt; KERNEL_KVM_MODULE
    KVM --&gt; MODULE_PKVM_HYP
    PKVM --&gt; HYP_HOST_S2
    PKVM --&gt; HYP_GUEST_S2
    HOST --&gt; S2_HOST_KERNEL
    GUEST --&gt; S2_PROTECTED_VM
    PROTECTED --&gt; VM_GUEST_MEMORY
    GUEST --&gt; MEMORY_OWNED_BY_GUEST</code></pre>
<strong>Host Stage 2</strong>: In pKVM, the host Linux kernel runs behind a Stage 2 MMU controlled by the EL2 hypervisor. This restricts the host's view of physical memory, preventing it from accessing guest pages.</p>
<p><strong>Guest Protection</strong>: Guest memory pages are donated to the guest and marked as inaccessible to the host. The EL2 hypervisor enforces these restrictions.</p>
<p><strong>Hypercall Interface</strong>: The host KVM module communicates with the pKVM hypervisor via hypercalls for VM lifecycle operations.</p>
<p>Sources: <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/hyp/nvhe/mem_protect.c#L1-L52">arch/arm64/kvm/hyp/nvhe/mem_protect.c1-52</a> <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/pkvm.c#L1-L50">arch/arm64/kvm/pkvm.c1-50</a></p>
<h3 id="pkvm-memory-ownership">pKVM Memory Ownership<a class="headerlink" href="#pkvm-memory-ownership" title="Permanent link">&para;</a></h3>
<p>Page ownership state machine implemented in <code>arch/arm64/kvm/hyp/nvhe/mem_protect.c</code>:</p>
<p><pre class="mermaid"><code>flowchart TD
    NOPAGE["PKVM_NOPAGEFree page"]
    OWNED["PKVM_PAGE_OWNEDExclusively owned"]
    SHARED["PKVM_PAGE_SHARED_OWNEDShared with hypervisor"]
    SHARE["__pkvm_host_share_hyp()host_stage2_set_owner_locked()"]
    UNSHARE["__pkvm_host_unshare_hyp()"]
    DONATE["__pkvm_host_donate_hyp()host_stage2_set_owner_locked()"]
    RECLAIM["__pkvm_hyp_donate_host()"]

    OWNED --&gt; SHARE
    SHARE --&gt; SHARED
    SHARED --&gt; UNSHARE
    UNSHARE --&gt; OWNED
    OWNED --&gt; DONATE
    DONATE --&gt; NOPAGE
    NOPAGE --&gt; RECLAIM
    RECLAIM --&gt; OWNED</code></pre>
<strong><code>struct hyp_page</code></strong> per-page metadata <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/hyp/include/nvhe/memory.h#L1-L50">arch/arm64/kvm/hyp/include/nvhe/memory.h1-50</a>:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>struct hyp_page {
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>    unsigned short refcount;  // Reference count
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>    unsigned short order;     // Allocation order
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>};
</code></pre></div>
<strong>Page State Values</strong> (<code>enum pkvm_page_state</code>):</p>
<ul>
<li><code>PKVM_NOPAGE (0)</code>: Unowned, available</li>
<li><code>PKVM_PAGE_OWNED</code>: Owned by single component</li>
<li><code>PKVM_PAGE_SHARED_OWNED</code>: Host shared with hyp</li>
<li><code>PKVM_PAGE_RESTRICTED_PROT</code>: Guest protected page</li>
</ul>
<p><strong>Key Functions</strong>:</p>
<ul>
<li><code>host_stage2_set_owner_locked()</code> <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/hyp/nvhe/mem_protect.c#L700-L800">arch/arm64/kvm/hyp/nvhe/mem_protect.c700-800</a>: Updates host S2 PTE with owner metadata</li>
<li><code>__pkvm_host_donate_hyp()</code> <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/hyp/nvhe/mem_protect.c#L800-L900">arch/arm64/kvm/hyp/nvhe/mem_protect.c800-900</a>: Transfers ownership from host to hypervisor</li>
<li><code>check_host_page_state_range()</code> <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/hyp/nvhe/mem_protect.c#L600-L700">arch/arm64/kvm/hyp/nvhe/mem_protect.c600-700</a>: Validates state before transitions</li>
<li><code>hyp_page_ref_inc/dec()</code>: Atomic refcount operations</li>
</ul>
<p><strong>Memory Protection</strong>: Host S2 MMU (<code>host_mmu.pgt</code>) enforces ownership - attempting to access guest-owned pages from host triggers S2 fault.</p>
<p>Sources: <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/hyp/nvhe/mem_protect.c#L600-L900">arch/arm64/kvm/hyp/nvhe/mem_protect.c600-900</a> <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/hyp/include/nvhe/memory.h#L1-L50">arch/arm64/kvm/hyp/include/nvhe/memory.h1-50</a></p>
<h3 id="pkvm-vm-lifecycle">pKVM VM Lifecycle<a class="headerlink" href="#pkvm-vm-lifecycle" title="Permanent link">&para;</a></h3>
<p><pre class="mermaid"><code>flowchart TD
    CREATE_VM["Host: kvm_arch_init_vm()"]
    INIT_PKVM["pkvm_init_host_vm()Reserve hyp VM handle"]
    ALLOC_SHADOW["Allocate shadow VMat EL2"]
    CREATE_VCPU["Host: kvm_arch_vcpu_create()"]
    DONATE_VCPU["Donate vCPU memoryto hypervisor"]
    INIT_TRAPS["pkvm_vcpu_init_traps()Configure trap handlers"]
    RUN["Host: KVM_RUN"]
    ENTER_GUEST["__pkvm_vcpu_run()World switch to guest"]
    GUEST_EXIT["VM exit"]
    HANDLE_EXIT["Handle exit in EL2or forward to host"]
    DESTROY["Host: kvm_arch_destroy_vm()"]
    TEARDOWN["pkvm_destroy_hyp_vm()Reclaim memory"]

    CREATE --&gt; VM_INIT_PKVM
    INIT --&gt; PKVM_ALLOC_SHADOW
    ALLOC --&gt; SHADOW_CREATE_VCPU
    CREATE --&gt; VCPU_DONATE_VCPU
    DONATE --&gt; VCPU_INIT_TRAPS
    INIT --&gt; TRAPS_RUN
    RUN --&gt; ENTER_GUEST
    ENTER --&gt; GUEST_GUEST_EXIT
    GUEST --&gt; EXIT_HANDLE_EXIT
    HANDLE --&gt; EXIT_ENTER_GUEST
    HANDLE --&gt; EXIT_DESTROY
    DESTROY --&gt; TEARDOWN</code></pre>
<strong>Shadow VM Structure</strong>: The hypervisor maintains a shadow <code>pkvm_hyp_vm</code> structure for each protected VM, separate from the untrusted host's <code>struct kvm</code>.</p>
<p><strong>Memory Caches</strong>: Protected VMs use dedicated memory caches (<code>pkvm_memcache</code>) pre-populated by the host but managed by the hypervisor.</p>
<p><strong>Exit Handling</strong>: Many VM exits are handled entirely in EL2 (e.g., GIC accesses, some system register traps), avoiding return to the untrusted host.</p>
<p>Sources: <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/hyp/nvhe/pkvm.c#L200-L400">arch/arm64/kvm/hyp/nvhe/pkvm.c200-400</a> <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/pkvm.c#L1-L200">arch/arm64/kvm/pkvm.c1-200</a> <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/hyp/nvhe/mem_protect.c#L250-L400">arch/arm64/kvm/hyp/nvhe/mem_protect.c250-400</a></p>
<h2 id="stage-2-memory-management">Stage 2 Memory Management<a class="headerlink" href="#stage-2-memory-management" title="Permanent link">&para;</a></h2>
<p>Stage 2 (S2) translation provides the second level of address translation, mapping Intermediate Physical Addresses (IPAs) used by the guest to Physical Addresses (PAs) on the host.</p>
<h3 id="stage-2-translation-structure">Stage 2 Translation Structure<a class="headerlink" href="#stage-2-translation-structure" title="Permanent link">&para;</a></h3>
<p><pre class="mermaid"><code>flowchart TD
    GVA["Guest Virtual Address(GVA)"]
    IPA["Intermediate Physical Address(IPA/GPA)"]
    PA["Physical Address(PA/HPA)"]
    S1["Stage 1 (Guest-controlled)GVA → IPA"]
    S2["Stage 2 (KVM-controlled)IPA → PA"]
    GUEST_PT["Guest Page Tables(TTBR0/1_EL1)"]
    S2_PT["Stage 2 Page Tables(VTTBR_EL2)"]
    KVM_PGTABLE["struct kvm_pgtablepgd, mm_ops"]

    GVA --&gt; S1
    S1 --&gt; IPA
    S1 --&gt; GUEST_PT
    IPA --&gt; S2
    S2 --&gt; PA
    S2 --&gt; S2_PT
    S2 --&gt; PT_KVM_PGTABLE</code></pre>
<strong>Stage 1</strong>: Controlled by the guest OS. Translates guest virtual addresses to what the guest believes are physical addresses (IPAs).</p>
<p><strong>Stage 2</strong>: Controlled by KVM. Provides an additional translation layer and memory isolation. Traps guest memory accesses for emulation or protection.</p>
<p><strong>kvm_pgtable</strong>: Generic page table abstraction with operations for map, unmap, and walk operations.</p>
<p>Sources: <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/mmu.c#L1-L100">arch/arm64/kvm/mmu.c1-100</a> <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/include/asm/kvm_host.h#L152-L230">arch/arm64/include/asm/kvm_host.h152-230</a></p>
<h3 id="stage-2-fault-handling">Stage 2 Fault Handling<a class="headerlink" href="#stage-2-fault-handling" title="Permanent link">&para;</a></h3>
<p>Stage 2 abort entry point is <code>kvm_handle_guest_abort()</code> <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/mmu.c#L1350-L1450">arch/arm64/kvm/mmu.c1350-1450</a>:</p>
<p><pre class="mermaid"><code>flowchart TD
    ABORT["kvm_handle_guest_abort()ESR_EL2.EC=0x24/0x25"]
    GET_IPA["fault_ipa = kvm_vcpu_get_fault_ipa()HPFAR_EL2[47:12] | FAR_EL2[11:0]"]
    NESTED["vcpu_has_nv() &amp;&amp;is_hyp_ctxt()"]
    WALK_L1["kvm_walk_nested_s2()struct kvm_s2_trans *trans"]
    CHECK_L1["trans-&gt;esr != 0"]
    INJECT["kvm_inject_s2_fault()Write FAR_EL2, HPFAR_EL2"]
    USER_FAULT["user_mem_abort()"]
    LOOKUP_SLOT["gfn_to_memslot()struct kvm_memory_slot"]
    MMIO_CHECK["slot == NULL"]
    EMULATE_MMIO["io_mem_abort()kvm_io_bus_write()"]
    GET_PFN["__gfn_to_pfn_memslot()gup_longterm()"]
    MAP_S2["kvm_pgtable_stage2_map()pgt-&gt;mm_ops-&gt;zalloc_page()"]
    TLB_FLUSH["__kvm_tlb_flush_vmid_ipa()"]

    ABORT --&gt; GET_IPA
    GET --&gt; IPA_NESTED
    NESTED --&gt; WALK_L1
    NESTED --&gt; USER_FAULT
    WALK --&gt; L1_CHECK_L1
    CHECK --&gt; L1_INJECT
    CHECK --&gt; L1_USER_FAULT
    USER --&gt; FAULT_LOOKUP_SLOT
    LOOKUP --&gt; SLOT_MMIO_CHECK
    MMIO --&gt; CHECK_EMULATE_MMIO
    MMIO --&gt; CHECK_GET_PFN
    GET --&gt; PFN_MAP_S2
    MAP --&gt; S2_TLB_FLUSH</code></pre>
<strong>Fault Information Extraction</strong>:</p>
<ul>
<li><code>kvm_vcpu_get_fault_ipa()</code> <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/include/asm/kvm_emulate.h#L350-L360">arch/arm64/include/asm/kvm_emulate.h350-360</a>: Combines <code>HPFAR_EL2</code> (bits [47:12]) with <code>FAR_EL2</code> (bits [11:0])</li>
<li><code>kvm_vcpu_get_esr()</code>: Reads <code>ESR_EL2</code> for fault type</li>
<li><code>kvm_vcpu_dabt_iswrite()</code>: Checks write vs read from <code>ESR_EL2.WnR</code></li>
</ul>
<p><strong>Nested S2 Translation</strong> <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/nested.c#L398-L421">arch/arm64/kvm/nested.c398-421</a>:</p>
<ul>
<li><code>kvm_walk_nested_s2()</code>: Walks L1's S2 page tables</li>
<li>If <code>trans-&gt;esr != 0</code>: Fault at L1 level, inject to L1 hypervisor</li>
<li>If success: Continue with host mapping using <code>trans-&gt;output</code> as L1 IPA</li>
</ul>
<p><strong>Memory Slot Lookup</strong> <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/mmu.c#L1250-L1300">arch/arm64/kvm/mmu.c1250-1300</a>:</p>
<ul>
<li><code>gfn_to_memslot()</code>: Finds <code>struct kvm_memory_slot</code> for GFN</li>
<li>If no slot: Treat as MMIO, call <code>io_mem_abort()</code></li>
<li>If slot found: Normal RAM, proceed to map</li>
</ul>
<p><strong>S2 Mapping Installation</strong> <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/mmu.c#L1300-L1400">arch/arm64/kvm/mmu.c1300-1400</a>:</p>
<ul>
<li><code>__gfn_to_pfn_memslot()</code>: Translates GFN to host PFN via <code>get_user_pages()</code></li>
<li><code>kvm_pgtable_stage2_map()</code>: Installs PTE in S2 page table</li>
<li><code>__kvm_tlb_flush_vmid_ipa()</code>: Flushes TLB for new mapping</li>
</ul>
<p>Sources: <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/mmu.c#L1250-L1450">arch/arm64/kvm/mmu.c1250-1450</a> <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/nested.c#L398-L421">arch/arm64/kvm/nested.c398-421</a> <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/include/asm/kvm_emulate.h#L350-L360">arch/arm64/include/asm/kvm_emulate.h350-360</a></p>
<h3 id="stage-2-page-table-operations">Stage 2 Page Table Operations<a class="headerlink" href="#stage-2-page-table-operations" title="Permanent link">&para;</a></h3>
<p><strong><code>struct kvm_pgtable</code></strong> <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/include/asm/kvm_pgtable.h#L200-L250">arch/arm64/include/asm/kvm_pgtable.h200-250</a>:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>struct kvm_pgtable {
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>    kvm_pte_t *pgd;                    // Page table root
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>    struct kvm_pgtable_mm_ops *mm_ops; // Memory operations
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>    struct kvm_s2_mmu *mmu;           // Back pointer
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>    int ia_bits;                      // Input address size
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>    u8 start_level;                   // Starting level
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>    u32 flags;                        // KVM_PGTABLE_S2_*
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>};
</code></pre></div>
<strong>Core Page Table Operations</strong>:</p>
<table>
<thead>
<tr>
<th>Function</th>
<th>Location</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>kvm_pgtable_stage2_map()</code></td>
<td><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/hyp/pgtable.c#L800-L900">arch/arm64/kvm/hyp/pgtable.c800-900</a></td>
<td>Map IPA→PA with <code>enum kvm_pgtable_prot</code></td>
</tr>
<tr>
<td><code>kvm_pgtable_stage2_unmap()</code></td>
<td><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/hyp/pgtable.c#L950-L1000">arch/arm64/kvm/hyp/pgtable.c950-1000</a></td>
<td>Unmap range, call <code>mm_ops-&gt;put_page()</code></td>
</tr>
<tr>
<td><code>kvm_pgtable_stage2_wrprotect()</code></td>
<td><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/hyp/pgtable.c#L1100-L1150">arch/arm64/kvm/hyp/pgtable.c1100-1150</a></td>
<td>Clear <code>KVM_PTE_LEAF_ATTR_LO_S2_S2AP_W</code></td>
</tr>
<tr>
<td><code>kvm_pgtable_stage2_test_clear_young()</code></td>
<td><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/hyp/pgtable.c#L1200-L1250">arch/arm64/kvm/hyp/pgtable.c1200-1250</a></td>
<td>Clear <code>KVM_PTE_LEAF_ATTR_LO_S2_AF</code></td>
</tr>
<tr>
<td><code>kvm_pgtable_stage2_flush()</code></td>
<td><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/hyp/pgtable.c#L1300-L1350">arch/arm64/kvm/hyp/pgtable.c1300-1350</a></td>
<td>Cache clean for device memory</td>
</tr>
<tr>
<td><code>kvm_pgtable_stage2_split()</code></td>
<td><a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/hyp/pgtable.c#L1400-L1500">arch/arm64/kvm/hyp/pgtable.c1400-1500</a></td>
<td>Break block into page mappings</td>
</tr>
</tbody>
</table>
<p><strong>Memory Operations</strong> (<code>struct kvm_pgtable_mm_ops</code> at <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/mmu.c#L229-L246">arch/arm64/kvm/mmu.c229-246</a>):</p>
<ul>
<li><code>zalloc_page()</code>: Allocate zeroed page (calls <code>stage2_memcache_zalloc_page()</code>)</li>
<li><code>get_page()</code>, <code>put_page()</code>: Reference counting</li>
<li><code>phys_to_virt()</code>, <code>virt_to_phys()</code>: Address translation</li>
<li><code>free_unlinked_table()</code>: RCU-delayed free via <code>stage2_free_unlinked_table()</code></li>
</ul>
<p><strong>Dirty Logging</strong> <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/mmu.c#L1100-L1200">arch/arm64/kvm/mmu.c1100-1200</a>:</p>
<ul>
<li>Enable: Call <code>kvm_pgtable_stage2_wrprotect()</code> on all guest memory</li>
<li>On write fault: Set <code>KVM_MEM_LOG_DIRTY_PAGES</code> bit in memslot bitmap</li>
<li>Query: Read dirty bitmap via <code>KVM_GET_DIRTY_LOG</code> ioctl</li>
</ul>
<p><strong>Block Mapping Strategy</strong>:</p>
<ul>
<li>Attempt 1GB blocks (level 1) if aligned and contiguous</li>
<li>Fall back to 2MB blocks (level 2) otherwise</li>
<li>Force 4KB pages (level 3) for partial mappings or <code>KVM_PGTABLE_S2_NOFWB</code></li>
</ul>
<p>Sources: <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/include/asm/kvm_pgtable.h#L200-L250">arch/arm64/include/asm/kvm_pgtable.h200-250</a> <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/hyp/pgtable.c#L800-L1500">arch/arm64/kvm/hyp/pgtable.c800-1500</a> <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/mmu.c#L229-L246">arch/arm64/kvm/mmu.c229-246</a></p>
<h3 id="memory-slot-management">Memory Slot Management<a class="headerlink" href="#memory-slot-management" title="Permanent link">&para;</a></h3>
<p><pre class="mermaid"><code>flowchart TD
    USERSPACE["Userspace VMM(QEMU)"]
    SET_MEM_REGION["KVM_SET_USER_MEMORY_REGIONDefine guest memory regions"]
    MEMSLOT["struct kvm_memory_slotbase_gfn, npages, userspace_addr"]
    MEMSLOTS["Per-VM memslots array"]
    MAP_RANGE["kvm_arch_prepare_memory_region()"]
    POPULATE["Eagerly map or fault on access"]
    STAGE2_MAP["kvm_pgtable_stage2_map()"]

    USERSPACE --&gt; SET_MEM_REGION
    SET --&gt; MEM_REGION_MEMSLOT
    MEMSLOT --&gt; MEMSLOTS
    MEMSLOTS --&gt; MAP_RANGE
    MAP --&gt; RANGE_POPULATE
    POPULATE --&gt; STAGE2_MAP</code></pre>
<strong>Memory Regions</strong>: Each guest memory region is described by a <code>struct kvm_memory_slot</code>:</p>
<ul>
<li><code>base_gfn</code>: Guest frame number (IPA &gt;&gt; PAGE_SHIFT)</li>
<li><code>npages</code>: Size in pages</li>
<li><code>userspace_addr</code>: Host virtual address backing this region</li>
</ul>
<p><strong>Demand Paging</strong>: By default, S2 mappings are created on-demand via page faults. This allows memory overcommit and swap.</p>
<p><strong>Eager Mapping</strong>: For some use cases (e.g., huge page pre-allocation), KVM can eagerly populate S2 mappings at region creation time.</p>
<p>Sources: <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/mmu.c#L1400-L1600">arch/arm64/kvm/mmu.c1400-1600</a></p>
<h2 id="additional-subsystems">Additional Subsystems<a class="headerlink" href="#additional-subsystems" title="Permanent link">&para;</a></h2>
<h3 id="performance-monitoring-unit-pmu">Performance Monitoring Unit (PMU)<a class="headerlink" href="#performance-monitoring-unit-pmu" title="Permanent link">&para;</a></h3>
<p><pre class="mermaid"><code>flowchart TD
    GUEST_READ["Guest reads PMEVCNTRn"]
    GUEST_WRITE["Guest writes PMCR_EL0"]
    PMC["struct kvm_pmcPer-counter state"]
    PERF_EVENT["Host perf_eventBacking counter"]
    PMU_IRQ["PMU overflow interruptto VGIC"]
    ACCESS_EVCNTR["access_pmu_evcntr()"]
    ACCESS_PMCR["access_pmcr()"]
    CREATE_EVENT["kvm_pmu_create_perf_event()"]
    OVERFLOW["kvm_pmu_overflow_status()"]

    GUEST --&gt; READ_ACCESS_EVCNTR
    GUEST --&gt; WRITE_ACCESS_PMCR
    ACCESS --&gt; EVCNTR_PMC
    ACCESS --&gt; PMCR_PMC
    PMC --&gt; PERF_EVENT
    ACCESS --&gt; PMCR_CREATE_EVENT
    CREATE --&gt; EVENT_PERF_EVENT
    PERF --&gt; EVENT_OVERFLOW
    OVERFLOW --&gt; PMU_IRQ</code></pre>
<strong>Counter Virtualization</strong>: Each guest PMU counter is backed by a host <code>perf_event</code>, allowing accurate performance measurement without direct hardware access.</p>
<p><strong>Event Filtering</strong>: KVM provides <code>PMCEID0/1_EL0</code> to advertise supported PMU events. A VM-wide filter can restrict events further.</p>
<p><strong>Overflow Interrupts</strong>: When a counter overflows, KVM injects a PMU interrupt to the guest via the VGIC.</p>
<p>Sources: <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/pmu-emul.c#L1-L100">arch/arm64/kvm/pmu-emul.c1-100</a> <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/pmu-emul.c#L100-L300">arch/arm64/kvm/pmu-emul.c100-300</a> <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/sys_regs.c#L1004-L1047">arch/arm64/kvm/sys_regs.c1004-1047</a></p>
<h3 id="virtual-gic-vgic">Virtual GIC (VGIC)<a class="headerlink" href="#virtual-gic-vgic" title="Permanent link">&para;</a></h3>
<p>The VGIC emulates the ARM Generic Interrupt Controller, providing interrupt delivery to vCPUs:</p>
<p><strong>Distributor (GICD)</strong>: Manages global interrupt state and routing.</p>
<p><strong>Redistributor (GICR)</strong>: Per-CPU interrupt interface.</p>
<p><strong>CPU Interface</strong>: Accessed via system registers (<code>ICC_*_EL1</code>). With GICv3, these are trapped and emulated by KVM.</p>
<p><strong>vGIC Integration</strong>:</p>
<ul>
<li><code>vgic_v3_dispatch_sgi()</code>: Handles guest SGI generation</li>
<li><code>kvm_vgic_inject_irq()</code>: Injects interrupts into guest</li>
<li><code>vgic_v3_sync_hardware_irq()</code>: Synchronizes virtual IRQ state</li>
</ul>
<p>Sources: <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/sys_regs.c#L602-L648">arch/arm64/kvm/sys_regs.c602-648</a> <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/sys_regs.c#L650-L667">arch/arm64/kvm/sys_regs.c650-667</a></p>
<h3 id="timers">Timers<a class="headerlink" href="#timers" title="Permanent link">&para;</a></h3>
<p><pre class="mermaid"><code>flowchart TD
    EL1_PHYS["EL1 Physical Timer(CNTP)"]
    EL1_VIRT["EL1 Virtual Timer(CNTV)"]
    EL2_PHYS["EL2 Physical Timer(CNTHP, nested)"]
    EL2_VIRT["EL2 Virtual Timer(CNTHV, nested)"]
    TIMER_STATE["struct arch_timer_cpuPer-vCPU timer state"]
    HRTIMER["Host hrtimerBacking timers"]
    TIMER_IRQ["Timer interruptto VGIC"]

    EL1 --&gt; PHYS_TIMER_STATE
    EL1 --&gt; VIRT_TIMER_STATE
    EL2 --&gt; PHYS_TIMER_STATE
    EL2 --&gt; VIRT_TIMER_STATE
    TIMER --&gt; STATE_HRTIMER
    HRTIMER --&gt; TIMER_IRQ</code></pre>
<strong>Timer Virtualization</strong>: KVM provides virtual views of ARM architectural timers. Each timer can generate interrupts at programmed times.</p>
<p><strong>Counter Offset</strong>: KVM maintains a VM-wide virtual counter offset (<code>CNTVOFF_EL2</code>), allowing the guest to see a monotonic time base independent of host suspend/resume.</p>
<p><strong>Nested Timer Support</strong>: For nested virtualization, KVM emulates the EL2 timers (<code>CNTHP</code>, <code>CNTHV</code>) used by L1 hypervisors.</p>
<p>Sources: <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/arch_timer.c#L1-L100">arch/arm64/kvm/arch_timer.c1-100</a></p>
<h3 id="debug-support">Debug Support<a class="headerlink" href="#debug-support" title="Permanent link">&para;</a></h3>
<p><pre class="mermaid"><code>flowchart TD
    VCPU_DEBUG["vcpu_debug_stateGuest's HW breakpoints"]
    EXTERNAL_DEBUG["external_debug_stateHost debugger BPs"]
    MDSCR["MDSCR_EL1Monitor debug control"]
    DBGBVR["DBGBVRn_EL1Breakpoint addresses"]
    DBGBCR["DBGBCRn_EL1Breakpoint controls"]
    SAVE_HOST["Save host debug state"]
    LOAD_GUEST["Load guest/debugger state"]
    RESTORE["Restore host state"]

    VCPU --&gt; DEBUG_LOAD_GUEST
    EXTERNAL --&gt; DEBUG_LOAD_GUEST
    LOAD --&gt; GUEST_DBGBVR
    LOAD --&gt; GUEST_DBGBCR
    SAVE --&gt; HOST_LOAD_GUEST
    LOAD --&gt; GUEST_RESTORE</code></pre>
<strong>Guest Debug Registers</strong>: Each vCPU has its own view of debug registers (breakpoints, watchpoints).</p>
<p><strong>External Debugging</strong>: The host debugger (via <code>KVM_SET_GUEST_DEBUG</code> ioctl) can set breakpoints that apply to guest execution.</p>
<p><strong>Debug Ownership</strong>: The <code>debug_owner</code> field tracks whether debug registers currently belong to the guest or the host debugger.</p>
<p>Sources: <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/debug.c#L1-L100">arch/arm64/kvm/debug.c1-100</a> <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/include/asm/kvm_host.h#L845-L862">arch/arm64/include/asm/kvm_host.h845-862</a></p>
<h2 id="key-configuration-and-trap-registers">Key Configuration and Trap Registers<a class="headerlink" href="#key-configuration-and-trap-registers" title="Permanent link">&para;</a></h2>
<h3 id="critical-control-registers">Critical Control Registers<a class="headerlink" href="#critical-control-registers" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Register</th>
<th>Purpose</th>
<th>Key Fields</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>HCR_EL2</strong></td>
<td>Hypervisor Configuration</td>
<td><code>VM</code> (enable S2), <code>TVM</code> (trap VM regs), <code>NV</code>/<code>NV1</code>/<code>NV2</code> (nested virt)</td>
</tr>
<tr>
<td><strong>VTCR_EL2</strong></td>
<td>Virtual Translation Control</td>
<td><code>T0SZ</code> (IPA size), <code>SL0</code> (start level), <code>TG0</code> (granule size), <code>PS</code> (PA size)</td>
</tr>
<tr>
<td><strong>VTTBR_EL2</strong></td>
<td>Virtual Translation Table Base</td>
<td><code>VMID</code>, <code>BADDR</code> (S2 page table base)</td>
</tr>
<tr>
<td><strong>MDCR_EL2</strong></td>
<td>Monitor Debug Configuration</td>
<td><code>TPM</code> (trap PMU), <code>TDA</code> (trap debug), <code>HPMN</code> (PMU counter count)</td>
</tr>
<tr>
<td><strong>CPTR_EL2</strong></td>
<td>Architectural Feature Trap</td>
<td><code>TTA</code> (trap trace), <code>FPEN</code> (FP/SIMD trap), <code>ZEN</code> (SVE trap)</td>
</tr>
</tbody>
</table>
<p>Sources: <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/include/asm/kvm_arm.h#L1-L100">arch/arm64/include/asm/kvm_arm.h1-100</a> <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/sys_regs.c#L1-L100">arch/arm64/kvm/sys_regs.c1-100</a></p>
<h3 id="fine-grained-traps-fgt">Fine-Grained Traps (FGT)<a class="headerlink" href="#fine-grained-traps-fgt" title="Permanent link">&para;</a></h3>
<p>ARM v8.6 introduced Fine-Grained Traps, allowing more granular control over which system registers trap:</p>
<p><pre class="mermaid"><code>flowchart TD
    HFGRTR["HFGRTR_EL2Read traps"]
    HFGWTR["HFGWTR_EL2Write traps"]
    HFGITR["HFGITR_EL2Instruction traps"]
    HDFGRTR["HDFGRTR_EL2Debug read traps"]
    FGT_ARRAY["vcpu-&gt;arch.fgt[]Cached trap values"]
    MATCH_FGT["Check register bitin FGT register"]
    DECIDE["Trap?"]
    LOCAL["Handle locally"]
    FORWARD["Forward to L1"]

    HFGRTR --&gt; FGT_ARRAY
    HFGWTR --&gt; FGT_ARRAY
    HFGITR --&gt; FGT_ARRAY
    HDFGRTR --&gt; FGT_ARRAY
    FGT --&gt; ARRAY_MATCH_FGT
    MATCH --&gt; FGT_DECIDE
    DECIDE --&gt; LOCAL
    DECIDE --&gt; FORWARD</code></pre>
<strong>FGT Usage</strong>: KVM configures FGT registers to trap only the system registers it needs to emulate or control, reducing unnecessary traps for well-behaved guests.</p>
<p><strong>Nested FGT</strong>: For nested virtualization, L1's FGT settings are honored by evaluating them alongside L0's settings.</p>
<p>Sources: <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/include/asm/kvm_host.h#L276-L292">arch/arm64/include/asm/kvm_host.h276-292</a> <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/include/asm/kvm_host.h#L819-L822">arch/arm64/include/asm/kvm_host.h819-822</a> <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/emulate-nested.c#L1-L100">arch/arm64/kvm/emulate-nested.c1-100</a></p>
<h2 id="summary">Summary<a class="headerlink" href="#summary" title="Permanent link">&para;</a></h2>
<p>KVM ARM64 provides comprehensive virtualization support leveraging ARM's hardware virtualization extensions. Key capabilities include:</p>
<ul>
<li><strong>System Register Emulation</strong>: Efficient trap-and-emulate with VHE optimizations</li>
<li><strong>Nested Virtualization</strong>: Full support for running hypervisors in VMs via shadow S2 MMUs and VNCR</li>
<li><strong>pKVM</strong>: Hardware-enforced confidential computing with memory isolation</li>
<li><strong>Stage 2 MMU</strong>: Flexible IPA→PA translation with huge page support</li>
<li><strong>Device Emulation</strong>: VGIC for interrupts, timer virtualization, PMU emulation</li>
</ul>
<p>The implementation carefully balances performance (minimizing traps, using hardware features) with flexibility (supporting nested VMs, protected VMs, and various ARM64 CPU features).</p>
<p>Sources: <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/arm.c#L1-L500">arch/arm64/kvm/arm.c1-500</a> <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/sys_regs.c#L1-L500">arch/arm64/kvm/sys_regs.c1-500</a> <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/nested.c#L1-L500">arch/arm64/kvm/nested.c1-500</a> <a href="https://github.com/torvalds/linux/blob/fcb70a56/arch/arm64/kvm/mmu.c#L1-L500">arch/arm64/kvm/mmu.c1-500</a></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["navigation.tabs", "navigation.sections", "navigation.top", "search.suggest", "search.highlight", "content.code.copy"], "search": "../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>