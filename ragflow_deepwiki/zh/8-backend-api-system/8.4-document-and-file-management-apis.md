# 8.4 文档与文件管理 API (Document and File Management APIs)

相关源文件：

- [api/apps/document_app.py](https://github.com/infiniflow/ragflow/blob/80a16e71/api/apps/document_app.py)
- [api/apps/file_app.py](https://github.com/infiniflow/ragflow/blob/80a16e71/api/apps/file_app.py)
- [api/apps/file2document_app.py](https://github.com/infiniflow/ragflow/blob/80a16e71/api/apps/file2document_app.py)
- [api/db/db_models.py](https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/db_models.py)
- [api/db/services/document_service.py](https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/document_service.py)
- [api/db/services/file_service.py](https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/file_service.py)
- [api/db/services/file2document_service.py](https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/file2document_service.py)

本章节介绍了用于管理 RAGFlow 数据集内文档和文件的 API 端点与服务。这些 API 处理文件上传、文档生命周期管理、元数据操作，以及文件存储层与文档处理流水线之间的协作。

有关数据集级别的操作（创建、配置等），请参阅[数据集与知识库 API](/zh/8-backend-api-system/8.3-dataset-and-knowledge-base-apis)。

---

## 概述 (Overview)

RAGFlow 采用双层内容管理架构：

1.  **文件层 (File Layer)**：由 `FileService` 管理的物理文件存储，组织为分层文件夹结构，通过对象存储（如 MinIO）进行持久化。
2.  **文档层 (Document Layer)**：由 `DocumentService` 管理的逻辑文档记录，链接到数据集（Knowledgebase），包含解析状态、切片和元数据。

`File2Document` 模型在两层之间建立了多对多关系，允许不同数据集引用同一个物理文件。

---

## API 架构 (API Architecture)

### 文档管理路由 (Document Management Routes)

`document_app.py` 模块在 `/v1/document` 前缀下暴露了以文档为中心的端点，包括上传、列表、删除、运行解析、修改解析器配置以及元数据管理。

### 文件管理路由 (File Management Routes)

`file_app.py` 模块在 `/v1/file` 下提供了基于文件夹的文件操作，包括文件夹创建、移动、重命名和物理文件上传。

---

## 核心数据模型 (Core Data Models)

### 文档模型 (Document Model)
逻辑文档的核心属性包括：
- `id`, `kb_id`, `name`, `type` (文档/图片/音频等)
- `parser_id` (naive, book, pdf 等)
- `parser_config` (解析配置 JSON)
- `run` (解析状态：UNSTART, RUNNING, CANCEL, DONE, FAIL)
- `progress` (解析进度 0-1)
- `meta_fields` (用户定义的元数据 JSON)

### 文件模型 (File Model)
物理文件的核心属性包括：
- `id`, `parent_id` (父文件夹 ID), `tenant_id`
- `location` (对象存储中的路径)
- `size`, `source_type`

---

## 文档生命周期管理 (Document Lifecycle)

### 文档解析控制 (Document Parsing Control)
`/run` 端点用于控制文档处理流程：
- **RUNNING**: 开始或重启解析。如果设置 `delete=true`，将清除现有切片。
- **CANCEL**: 取消正在进行的解析任务。

### 状态切换 (Status Management)
`/change_status` 端点允许启用或禁用文档（`status="0"` 或 `"1"`）。被禁用的文档在检索过程中会被过滤掉，支持 A/B 测试或内容审核流。

---

## 元数据管理 (Metadata Management)

### 元数据模式 (Metadata Schema)
文档支持灵活的 JSON 元数据（`meta_fields`）。

### 过滤系统 (Filtering System)
`/list` 端点支持高级元数据过滤，提供多种操作符：
- `eq` (等于), `ne` (不等于)
- `gt`/`gte` (大于/大于等于), `lt`/`lte` (小于/小于等于)
- `in`, `not_in` (成员检查)
- `contains`, `regex` (文本包含/正则匹配)

### 批量更新 (Batch Update)
`/metadata/update` 端点允许对满足特定条件的文档集进行批量的元数据增加、修改或删除。

---

## 高级操作 (Advanced Operations)

- **网络爬虫 (Web Crawling)**：`/web_crawl` 端点可将网页 URL 转换为 PDF 文档并存入数据集。
- **实时解析 (Ad-hoc Parsing)**：`/parse` 端点支持对上传的文件或 URL 进行即时解析并返回纯文本，而不创建持久化的文档记录。
- **缩略图管理 (Thumbnail Management)**：`/thumbnails` 接口返回文档预览图，用于前端列表展示。

---

## 总结 (Summary)

文档与文件管理 API 提供了稳健的集成能力：
- **物理与逻辑分离**：通过文件/文档双层架构实现存储的高效利用。
- **精细化解析控制**：支持按需启动、取消解析以及配置热更新。
- **强大的元数据引擎**：支持复杂的检索过滤和批量管理操作。
- **多模态支持**：统一处理文档、图片、音频及网页内容。
