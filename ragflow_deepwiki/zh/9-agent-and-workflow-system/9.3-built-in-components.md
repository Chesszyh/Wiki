# 9.3 内置组件 (Built-in Components)

相关源文件：

- [agent/canvas.py](https://github.com/infiniflow/ragflow/blob/80a16e71/agent/canvas.py)
- [agent/component/agent_with_tools.py](https://github.com/infiniflow/ragflow/blob/80a16e71/agent/component/agent_with_tools.py)
- [agent/component/base.py](https://github.com/infiniflow/ragflow/blob/80a16e71/agent/component/base.py)
- [agent/component/categorize.py](https://github.com/infiniflow/ragflow/blob/80a16e71/agent/component/categorize.py)
- [agent/component/llm.py](https://github.com/infiniflow/ragflow/blob/80a16e71/agent/component/llm.py)
- [agent/tools/base.py](https://github.com/infiniflow/ragflow/blob/80a16e71/agent/tools/base.py)

本页面记录了 RAGFlow 画布智能体工作流系统中的内置组件。内置组件是预先实现的、可重用的构建块，用于处理智能体工作流中的特定任务，如检索信息、生成文本、基于分类进行路由以及对接外部服务。

---

## 概述 (Overview)

RAGFlow 提供了一系列内置组件库。每个组件都继承自 `ComponentBase`，并通过 `_invoke()` 或 `_invoke_async()` 方法实现特定功能。组件通过 `agent/component/__init__.py` 中的动态导入系统自动发现并注册。

---

## 组件类别 (Component Categories)

内置组件按主要用途划分为以下功能类别：

| 类别 | 组件 | 用途 |
| --- | --- | --- |
| **AI/LLM** | Generate, Categorize, Message | 基于大模型的文本生成、分类、对话操作 |
| **检索 (Retrieval)** | Retrieval | 跨数据集的向量和知识图谱搜索 |
| **流控 (Flow Control)** | Begin, Switch, Categorize, UserFillUp | 工作流入口、分支跳转及用户输入收集 |
| **迭代 (Iteration)** | Iteration, Loop, ExitLoop | 列表处理及条件循环 |
| **转换 (Transformation)** | Template | 字符串处理与变量插值 |
| **外部服务 (External)** | BaiduFanyi, DeepL, QWeather, GitHub | 第三方 API 集成 |

---

## 核心 AI 组件 (Core AI Components)

### 生成组件 (Generate Component)
`Generate` 组件执行 LLM 文本生成，支持可选的流式输出。
- **关键参数**：`llm_id`（模型 ID）、`system_prompt`（系统提示词）、`cite`（是否启用引用）。
- **流式行为**：启用流式传输时，组件返回 `partial()` 对象，由画布引擎实时通过 SSE 事件发送。

### 分类组件 (Categorize Component)
使用 LLM 进行意图识别，将用户输入分类。
- **工作机制**：根据类别描述和示例构建提示词，LLM 返回类别名称，组件设置 `_next` 输出以决定后续执行路径。

### 消息组件 (Message Component)
处理面向用户的输出，支持可选的文本转语音 (TTS) 音频生成。
- **特性**：支持 `[ID:n]` 形式的引用解析，并能识别流式输出中的思考过程（Think Tag），触发 `start_to_think`/`end_to_think` 事件。

---

## 检索组件 (Retrieval Components)

### 检索组件 (Retrieval Component)
在多个数据集上执行混合向量与知识图谱搜索。
- **特性**：自动将检索到的切片添加到画布级别的引用状态 (`canvas.add_reference`)，使其可供下游组件引用。

---

## 流控组件 (Flow Control Components)

### 开始组件 (Begin Component)
工作流的起点。
- **模式**：支持 `Chat`（对话模式）和 `Webhook`（由外部触发）。

### 用户补充组件 (UserFillUp Component)
在工作流中途暂停执行，以收集用户的补充输入。
- **流程**：发出 `user_inputs` 事件，工作流挂起，待用户通过 API 提供输入后恢复。

---

## 迭代组件 (Iteration Components)

### 迭代与循环 (Iteration and Loop)
- **Iteration**：按元素顺序处理列表，为每个元素执行子工作流。
- **Loop**：条件循环，直到满足退出条件或执行了 `ExitLoop` 组件。

---

## 总结 (Summary)

内置组件库构成了 RAGFlow 灵活编排能力的核心。通过组合这些标准化组件，开发者可以快速构建出具备复杂逻辑、检索能力和外部集成能力的 AI 智能体。
