# 6.3 内容增强与嵌入 (Content Enhancement and Embedding)

在文档解析和切片之后，RAGFlow 会进行内容增强和向量嵌入，以提高检索的准确性和召回率。

## 6.3.1 内容增强 (Content Enhancement)

内容增强通过提取额外的元数据和生成合成内容来丰富原始文本块。

### 1. 关键词提取 (Keyword Extraction)
系统会为每个切片（Chunk）提取关键词，用于混合搜索（Hybrid Search）中的全文检索部分。
- 使用 LLM 或统计方法提取关键短语。
- 关键词被存储在 Elasticsearch 的独立字段中。

### 2. 问题生成 (Question Generation / Q&A Generation)
为了增强检索效果，系统会根据切片内容生成可能的问题（Questions）。
- **目的**：通过“问题-切片”匹配来提高相关性，因为用户的查询通常也是问题形式。
- **实现**：调用 LLM 根据当前切片生成 3-5 个潜在问题。

### 3. 摘要生成 (Summarization)
对于长篇幅或复杂的切片，生成简短摘要有助于捕捉核心语义。

## 6.3.2 向量嵌入 (Vector Embedding)

嵌入（Embedding）是将文本转换为高维向量的过程，是语义搜索的核心。

### 1. 模型选择
RAGFlow 支持多种嵌入模型：
- **OpenAI**: `text-embedding-3-small`, `text-embedding-3-large`
- **HuggingFace/Local**: `BAAI/bge-large-zh-v1.5`, `maidalun1020/bce-embedding-base_v1`
- **各云厂商**：智谱、通义千问等提供的嵌入接口。

### 2. 批量处理 (Batch Processing)
为了提高效率，嵌入过程采用批量调用：
- `EmbeddingModel.encode_queries()`: 用于用户查询。
- `EmbeddingModel.encode_documents()`: 用于文档切片。

### 3. 多模态嵌入 (Multi-modal Embedding)
对于包含图片的切片，系统会结合视觉特征：
- 使用视觉模型（如 CLIP 或类似架构）生成图像嵌入。
- 文本描述（OCR 结果）也会与图像特征融合。

## 6.3.3 存储与索引 (Storage and Indexing)

处理后的数据被存入向量数据库（如 Elasticsearch/OpenSearch 或 Milvus）：
- **向量字段**：存储 Embedding 向量。
- **文本字段**：存储原始文本及增强后的关键词、问题。
- **元数据**：存储文档 ID、页码、图片路径等。

---
注：内容增强会增加处理时间和 LLM 令牌（Token）消耗，可在系统设置中根据需求开启或关闭。
