
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://wiki.neurosama.uk/ragflow_deepwiki/9-agent-and-workflow-system/">
      
      
        <link rel="prev" href="9.7-canvas-api-and-management/">
      
      
        <link rel="next" href="../10-retrieval-and-rag-system/10.1-query-processing-and-refinement/">
      
      
        
          <link rel="alternate" href="./" hreflang="en">
        
          <link rel="alternate" href="../../zh/ragflow_deepwiki/9-agent-and-workflow-system/" hreflang="zh">
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Agent and Workflow System - DeepWiki</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#agent-and-workflow-system" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="DeepWiki" class="md-header__button md-logo" aria-label="DeepWiki" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            DeepWiki
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Agent and Workflow System
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="Select language">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7 1.62-4.33L19.12 17z"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="./" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="../../zh/ragflow_deepwiki/9-agent-and-workflow-system/" hreflang="zh" class="md-select__link">
              中文
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/Chesszyh/Wiki" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Welcome to DeepWiki

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../celery_deepwiki/1-celery-overview/1.1-installation-and-setup/" class="md-tabs__link">
          
  
  
  Celery deepwiki

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../lc0_deepwiki/1-lc0-overview/" class="md-tabs__link">
          
  
  
  Lc0 deepwiki

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../linux_deepwiki/1-linux-kernel-overview/" class="md-tabs__link">
          
  
  
  Linux deepwiki

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../1-overview/" class="md-tabs__link">
          
  
  
  Ragflow deepwiki

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../redis_deepwiki/1-redis-overview/" class="md-tabs__link">
          
  
  
  Redis deepwiki

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../stockfish_deepwiki/2-core-data-structures-and-types/" class="md-tabs__link">
          
  
  
  Stockfish deepwiki

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="DeepWiki" class="md-nav__button md-logo" aria-label="DeepWiki" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    DeepWiki
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Chesszyh/Wiki" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Welcome to DeepWiki
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Celery deepwiki
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Celery deepwiki
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    1 celery overview
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    1 celery overview
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../celery_deepwiki/1-celery-overview/1.1-installation-and-setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Installation and Setup
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../celery_deepwiki/1-celery-overview/1.2-core-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Core Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../celery_deepwiki/1-celery-overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Celery Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    2 the celery application
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    2 the celery application
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../celery_deepwiki/2-the-celery-application/2.1-application-initialization-and-configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Application Initialization and Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../celery_deepwiki/2-the-celery-application/2.2-task-registration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Task Registration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../celery_deepwiki/2-the-celery-application/2.3-message-brokers-and-routing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Message Brokers and Routing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../celery_deepwiki/2-the-celery-application/2.4-amqp-layer-and-message-protocol/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AMQP Layer and Message Protocol
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../celery_deepwiki/2-the-celery-application/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The Celery Application
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5" >
        
          
          <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    3 tasks
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    3 tasks
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../celery_deepwiki/3-tasks/3.1-task-definition-and-invocation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Task Definition and Invocation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../celery_deepwiki/3-tasks/3.2-task-lifecycle-and-states/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Task Lifecycle and States
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../celery_deepwiki/3-tasks/3.3-error-handling-and-retry/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Error Handling and Retry
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../celery_deepwiki/3-tasks/3.4-time-limits-and-rate-limits/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Time Limits and Rate Limits
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../celery_deepwiki/3-tasks/3.5-task-options-and-customization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Task Options and Customization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../celery_deepwiki/3-tasks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tasks
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_7" >
        
          
          <label class="md-nav__link" for="__nav_2_7" id="__nav_2_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    4 canvas workflows
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    4 canvas workflows
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../celery_deepwiki/4-canvas-workflows/4.1-signatures/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Signature and Composition
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../celery_deepwiki/4-canvas-workflows/4.2-workflow-primitives/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Workflow Primitives
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../celery_deepwiki/4-canvas-workflows/4.3-advanced-canvas-features/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Advanced Canvas Features
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../celery_deepwiki/4-canvas-workflows/4.4-chord-execution/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chord Execution
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../celery_deepwiki/4-canvas-workflows/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Canvas Workflows
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_9" >
        
          
          <label class="md-nav__link" for="__nav_2_9" id="__nav_2_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    5 workers
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    5 workers
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../celery_deepwiki/5-workers/5.1-worker-architecture-and-bootsteps/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Worker Architecture and Bootsteps
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../celery_deepwiki/5-workers/5.2-worker-lifecycle-and-shutdown/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Worker Lifecycle and Shutdown
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../celery_deepwiki/5-workers/5.3-concurrency-models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Concurrency Models
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../celery_deepwiki/5-workers/5.4-worker-configuration-and-control/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Worker Configuration and Control
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../celery_deepwiki/5-workers/5.5-consumer-and-event-loops/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Consumer and Event Loops
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../celery_deepwiki/5-workers/5.6-autoscaling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Autoscaling
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../celery_deepwiki/5-workers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Workers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_11" >
        
          
          <label class="md-nav__link" for="__nav_2_11" id="__nav_2_11_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    6 result backends
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_11">
            <span class="md-nav__icon md-icon"></span>
            
  
    6 result backends
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../celery_deepwiki/6-result-backends/6.1-backend-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Backend Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../celery_deepwiki/6-result-backends/6.2-backend-implementations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Backend Implementations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../celery_deepwiki/6-result-backends/6.3-result-storage-and-retrieval/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Result Serialization and Retrieval
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../celery_deepwiki/6-result-backends/6.4-chord-coordination/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chord Coordination
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../celery_deepwiki/6-result-backends/6.5-backend-resilience/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Error Handling and Resilience
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../celery_deepwiki/6-result-backends/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Result Backends
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_13" >
        
          
          <label class="md-nav__link" for="__nav_2_13" id="__nav_2_13_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    7 periodic tasks (beat)
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_13">
            <span class="md-nav__icon md-icon"></span>
            
  
    7 periodic tasks (beat)
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../celery_deepwiki/7-periodic-tasks-%28beat%29/7.1-beat-scheduler-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Beat Scheduler Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../celery_deepwiki/7-periodic-tasks-%28beat%29/7.2-schedule-types/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Schedule Types
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../celery_deepwiki/7-periodic-tasks-%28beat%29/7.3-time-and-timezone-handling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Time and Timezone Handling
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../celery_deepwiki/7-periodic-tasks-%28beat%29/7.4-persistent-storage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Persistent Storage
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../celery_deepwiki/7-periodic-tasks-%28beat%29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Periodic Tasks (Beat)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_15" >
        
          
          <label class="md-nav__link" for="__nav_2_15" id="__nav_2_15_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    8 monitoring and control
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_15_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_15">
            <span class="md-nav__icon md-icon"></span>
            
  
    8 monitoring and control
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../celery_deepwiki/8-monitoring-and-control/8.1-remote-control-commands/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Remote Control Commands
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../celery_deepwiki/8-monitoring-and-control/8.2-worker-inspection/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Worker Inspection
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../celery_deepwiki/8-monitoring-and-control/8.3-event-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Event System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../celery_deepwiki/8-monitoring-and-control/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Monitoring and Control
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_17" >
        
          
          <label class="md-nav__link" for="__nav_2_17" id="__nav_2_17_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    9 command line interface
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_17_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_17">
            <span class="md-nav__icon md-icon"></span>
            
  
    9 command line interface
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../celery_deepwiki/9-command-line-interface/9.1-cli-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CLI Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../celery_deepwiki/9-command-line-interface/9.2-worker-and-beat-commands/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Worker and Beat Commands
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../celery_deepwiki/9-command-line-interface/9.3-management-commands/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Management Commands
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../celery_deepwiki/9-command-line-interface/9.4-multi-worker-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Multi-worker Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../celery_deepwiki/9-command-line-interface/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Command Line Interface
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_19" >
        
          
          <label class="md-nav__link" for="__nav_2_19" id="__nav_2_19_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    10 development and testing
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_19_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_19">
            <span class="md-nav__icon md-icon"></span>
            
  
    10 development and testing
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../celery_deepwiki/10-development-and-testing/10.1-testing-infrastructure/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Testing Infrastructure
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../celery_deepwiki/10-development-and-testing/10.2-test-matrix-and-environments/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Test Matrix and Environments
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../celery_deepwiki/10-development-and-testing/10.3-integration-and-smoke-tests/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Integration and Smoke Tests
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../celery_deepwiki/10-development-and-testing/10.4-code-quality-and-documentation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Code Quality and Documentation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../celery_deepwiki/10-development-and-testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Development and Testing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_21" >
        
          
          <label class="md-nav__link" for="__nav_2_21" id="__nav_2_21_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    11 packaging and distribution
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_21_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_21">
            <span class="md-nav__icon md-icon"></span>
            
  
    11 packaging and distribution
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../celery_deepwiki/11-packaging-and-distribution/11.1-package-structure/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Package Structure
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../celery_deepwiki/11-packaging-and-distribution/11.2-dependencies-and-extras/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dependencies and Extras
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../celery_deepwiki/11-packaging-and-distribution/11.3-version-management-and-release/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Version Management and Release
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../celery_deepwiki/11-packaging-and-distribution/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Packaging and Distribution
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Lc0 deepwiki
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Lc0 deepwiki
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lc0_deepwiki/1-lc0-overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lc0 Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    2 building and installation
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    2 building and installation
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lc0_deepwiki/2-building-and-installation/2.1-build-system-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Build System Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lc0_deepwiki/2-building-and-installation/2.2-linux-and-macos-build-process/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Linux and macOS Build Process
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lc0_deepwiki/2-building-and-installation/2.3-windows-build-process/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Windows Build Process
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lc0_deepwiki/2-building-and-installation/2.4-version-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Version Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lc0_deepwiki/2-building-and-installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Building and Installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    3 core engine architecture
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    3 core engine architecture
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lc0_deepwiki/3-core-engine-architecture/3.1-uci-protocol-implementation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    UCI Protocol Implementation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lc0_deepwiki/3-core-engine-architecture/3.2-configuration-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuration System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lc0_deepwiki/3-core-engine-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Core Engine Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_6" >
        
          
          <label class="md-nav__link" for="__nav_3_6" id="__nav_3_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    4 chess representation
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    4 chess representation
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lc0_deepwiki/4-chess-representation/4.1-bitboards-and-move-generation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Bitboards
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lc0_deepwiki/4-chess-representation/4.2-position-encoding-and-history/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Position Encoding and History
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lc0_deepwiki/4-chess-representation/4.3-syzygy-tablebase-integration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Syzygy Tablebase Integration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lc0_deepwiki/4-chess-representation/4.4-pgn-and-game-import/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    PGN and Game Import
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lc0_deepwiki/4-chess-representation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chess Representation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_8" >
        
          
          <label class="md-nav__link" for="__nav_3_8" id="__nav_3_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    5 search algorithm
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    5 search algorithm
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lc0_deepwiki/5-search-algorithm/5.1-mcts-implementation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MCTS Implementation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lc0_deepwiki/5-search-algorithm/5.2-search-parameters-and-stopping-conditions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Search Parameters and Stopping Conditions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lc0_deepwiki/5-search-algorithm/5.3-search-tree-caching/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Caching System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lc0_deepwiki/5-search-algorithm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Search Algorithm
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_10" >
        
          
          <label class="md-nav__link" for="__nav_3_10" id="__nav_3_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    6 neural network system
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    6 neural network system
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lc0_deepwiki/6-neural-network-system/6.1-network-interface-and-backend-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Network Interface and Backend Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lc0_deepwiki/6-neural-network-system/6.2-weights-loading-and-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Weights Loading and Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lc0_deepwiki/6-neural-network-system/6.3-cuda-and-cudnn-backend/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CUDA and cuDNN Backend
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lc0_deepwiki/6-neural-network-system/6.4-onnx-integration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ONNX Integration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lc0_deepwiki/6-neural-network-system/6.5-xla-and-hlo-support/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    XLA and HLO Support
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lc0_deepwiki/6-neural-network-system/6.6-memory-caching-and-performance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Memory Caching and Performance
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lc0_deepwiki/6-neural-network-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Neural Network System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_12" >
        
          
          <label class="md-nav__link" for="__nav_3_12" id="__nav_3_12_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    7 self play system
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_12">
            <span class="md-nav__icon md-icon"></span>
            
  
    7 self play system
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lc0_deepwiki/7-self-play-system/7.1-tournament-organization-and-game-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tournament Organization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lc0_deepwiki/7-self-play-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Self-Play System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_14" >
        
          
          <label class="md-nav__link" for="__nav_3_14" id="__nav_3_14_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    8 utilities and infrastructure
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_14">
            <span class="md-nav__icon md-icon"></span>
            
  
    8 utilities and infrastructure
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lc0_deepwiki/8-utilities-and-infrastructure/8.1-fast-mathematical-functions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Fast Mathematical Functions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lc0_deepwiki/8-utilities-and-infrastructure/8.2-threading-and-synchronization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Threading and Synchronization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lc0_deepwiki/8-utilities-and-infrastructure/8.3-benchmarking-and-performance-testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Benchmarking and Performance Testing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lc0_deepwiki/8-utilities-and-infrastructure/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Utilities and Infrastructure
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_16" >
        
          
          <label class="md-nav__link" for="__nav_3_16" id="__nav_3_16_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    9 continuous integration and deployment
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_16_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_16">
            <span class="md-nav__icon md-icon"></span>
            
  
    9 continuous integration and deployment
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lc0_deepwiki/9-continuous-integration-and-deployment/9.1-circleci-workflows/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CircleCI Workflows
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lc0_deepwiki/9-continuous-integration-and-deployment/9.2-windows-build-and-packaging/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Windows Build and Packaging
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lc0_deepwiki/9-continuous-integration-and-deployment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Continuous Integration and Deployment
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Linux deepwiki
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Linux deepwiki
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux_deepwiki/1-linux-kernel-overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Linux Kernel Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    2 rust for linux
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    2 rust for linux
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux_deepwiki/2-rust-for-linux/2.1-rust-kernel-apis-and-abstractions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Rust Kernel APIs and Abstractions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux_deepwiki/2-rust-for-linux/2.2-nova-drm-graphics-driver/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Nova DRM Graphics Driver
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux_deepwiki/2-rust-for-linux/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Rust for Linux
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" >
        
          
          <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    3 virtualization (kvm)
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    3 virtualization (kvm)
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux_deepwiki/3-virtualization-%28kvm%29/3.1-kvm-x86-virtualization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    KVM x86 Virtualization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux_deepwiki/3-virtualization-%28kvm%29/3.2-kvm-arm64-virtualization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    KVM ARM64 Virtualization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux_deepwiki/3-virtualization-%28kvm%29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Virtualization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_6" >
        
          
          <label class="md-nav__link" for="__nav_4_6" id="__nav_4_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    4 core kernel infrastructure
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    4 core kernel infrastructure
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux_deepwiki/4-core-kernel-infrastructure/4.1-process-scheduling-and-sched_ext/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Process Scheduling and sched_ext
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux_deepwiki/4-core-kernel-infrastructure/4.2-tracing-and-observability/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tracing and Observability
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux_deepwiki/4-core-kernel-infrastructure/4.3-build-system-and-kbuild/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Build System and Kbuild
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux_deepwiki/4-core-kernel-infrastructure/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Core Kernel Infrastructure
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_8" >
        
          
          <label class="md-nav__link" for="__nav_4_8" id="__nav_4_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    5 storage and io
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    5 storage and io
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux_deepwiki/5-storage-and-io/5.1-io_uring-asynchronous-io/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    io_uring Asynchronous I/O
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux_deepwiki/5-storage-and-io/5.2-btrfs-copy-on-write-filesystem/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Btrfs Copy-on-Write Filesystem
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux_deepwiki/5-storage-and-io/5.3-ufs-storage-controller/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    UFS Storage Controller
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux_deepwiki/5-storage-and-io/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Storage and I/O
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_10" >
        
          
          <label class="md-nav__link" for="__nav_4_10" id="__nav_4_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    6 graphics and display
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    6 graphics and display
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux_deepwiki/6-graphics-and-display/6.1-amdgpu-driver/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AMDGPU Driver
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux_deepwiki/6-graphics-and-display/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Graphics and Display
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Ragflow deepwiki
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Ragflow deepwiki
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../1-overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    2 getting started and deployment
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    2 getting started and deployment
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2-getting-started-and-deployment/2.1-docker-compose-deployment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Docker Compose Deployment
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2-getting-started-and-deployment/2.4-build-system-and-cicd/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Build System and CI/CD
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2-getting-started-and-deployment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Getting Started and Deployment
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_4" >
        
          
          <label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    3 system architecture
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    3 system architecture
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../3-system-architecture/3.1-core-application-services/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Core Application Services
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../3-system-architecture/3.2-data-storage-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Data Storage Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../3-system-architecture/3.3-task-execution-and-queue-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Task Execution and Queue System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../3-system-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    System Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_6" >
        
          
          <label class="md-nav__link" for="__nav_5_6" id="__nav_5_6_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    4 frontend application
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    4 frontend application
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../4-frontend-application/4.1-internationalization-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Internationalization System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../4-frontend-application/4.2-application-structure-and-ui-features/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Application Structure and Routing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../4-frontend-application/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Frontend Application
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_8" >
        
          
          <label class="md-nav__link" for="__nav_5_8" id="__nav_5_8_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    5 llm integration system
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    5 llm integration system
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../5-llm-integration-system/5.1-model-factory-pattern-and-registration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Model Factory Pattern and Registration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../5-llm-integration-system/5.2-provider-implementations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Provider Implementations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../5-llm-integration-system/5.3-error-handling-and-retry-logic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Error Handling and Retry Logic
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../5-llm-integration-system/5.4-tenant-configuration-and-usage-tracking/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tenant Configuration and Usage Tracking
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../5-llm-integration-system/5.5-tool-calling-and-function-use/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tool Calling and Function Use
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../5-llm-integration-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LLM Integration System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_10" >
        
          
          <label class="md-nav__link" for="__nav_5_10" id="__nav_5_10_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    6 document processing pipeline
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    6 document processing pipeline
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../6-document-processing-pipeline/6.1-document-parsing-strategies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Document Parsing Strategies
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../6-document-processing-pipeline/6.2-chunking-methods/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chunking Methods
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../6-document-processing-pipeline/6.3-content-enhancement-and-embedding/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Content Enhancement and Embedding
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../6-document-processing-pipeline/6.4-layout-recognition-and-ocr/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Layout Recognition and OCR
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../6-document-processing-pipeline/6.5-knowledge-graph-construction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Knowledge Graph Construction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../6-document-processing-pipeline/6.6-raptor-hierarchical-summarization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    RAPTOR Hierarchical Summarization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../6-document-processing-pipeline/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Document Processing Pipeline
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_12" >
        
          
          <label class="md-nav__link" for="__nav_5_12" id="__nav_5_12_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    7 data source integration
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_12">
            <span class="md-nav__icon md-icon"></span>
            
  
    7 data source integration
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../7-data-source-integration/7.1-connector-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Connector Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../7-data-source-integration/7.2-synchronization-and-scheduling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Synchronization and Scheduling
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../7-data-source-integration/7.3-supported-data-sources/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Supported Data Sources
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../7-data-source-integration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Data Source Integration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_14" >
        
          
          <label class="md-nav__link" for="__nav_5_14" id="__nav_5_14_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    8 backend api system
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_14">
            <span class="md-nav__icon md-icon"></span>
            
  
    8 backend api system
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../8-backend-api-system/8.1-api-architecture-and-sdk/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    API Architecture and SDK
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../8-backend-api-system/8.2-authentication-and-authorization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Authentication and Multi-tenancy
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../8-backend-api-system/8.3-dataset-and-knowledge-base-apis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dataset and Knowledge Base APIs
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../8-backend-api-system/8.4-document-and-file-management-apis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Document and File Management APIs
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../8-backend-api-system/8.5-chat-and-conversation-apis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chat and Conversation APIs
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../8-backend-api-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Backend API System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_16" >
        
          
          <label class="md-nav__link" for="__nav_5_16" id="__nav_5_16_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    9 agent and workflow system
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_16_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_16">
            <span class="md-nav__icon md-icon"></span>
            
  
    9 agent and workflow system
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="9.1-canvas-engine-and-dsl/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Canvas Engine and DSL
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="9.2-component-system-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Component System Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="9.3-built-in-components/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Built-in Components
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="9.4-workflow-execution-and-streaming/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Workflow Execution and Streaming
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="9.5-state-and-variable-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    State and Variable Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="9.6-agent-tools-and-react-loop/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Agent Tools and ReAct Loop
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="9.7-canvas-api-and-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Canvas API and Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Agent and Workflow System
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Agent and Workflow System
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#canvas-and-graph-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        Canvas and Graph Architecture
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Canvas and Graph Architecture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dsl-structure" class="md-nav__link">
    <span class="md-ellipsis">
      
        DSL Structure
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#graph-class" class="md-nav__link">
    <span class="md-ellipsis">
      
        Graph Class
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#canvas-class" class="md-nav__link">
    <span class="md-ellipsis">
      
        Canvas Class
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#component-system" class="md-nav__link">
    <span class="md-ellipsis">
      
        Component System
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Component System">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#componentbase-abstract-class" class="md-nav__link">
    <span class="md-ellipsis">
      
        ComponentBase Abstract Class
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#componentparambase" class="md-nav__link">
    <span class="md-ellipsis">
      
        ComponentParamBase
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#component-lifecycle-diagram" class="md-nav__link">
    <span class="md-ellipsis">
      
        Component Lifecycle Diagram
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#variable-resolution-system" class="md-nav__link">
    <span class="md-ellipsis">
      
        Variable Resolution System
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Variable Resolution System">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#variable-types" class="md-nav__link">
    <span class="md-ellipsis">
      
        Variable Types
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#variable-resolution-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      
        Variable Resolution Pattern
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nested-path-resolution" class="md-nav__link">
    <span class="md-ellipsis">
      
        Nested Path Resolution
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#execution-engine" class="md-nav__link">
    <span class="md-ellipsis">
      
        Execution Engine
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Execution Engine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#async-batch-execution" class="md-nav__link">
    <span class="md-ellipsis">
      
        Async Batch Execution
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#concurrent-component-execution" class="md-nav__link">
    <span class="md-ellipsis">
      
        Concurrent Component Execution
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#path-management" class="md-nav__link">
    <span class="md-ellipsis">
      
        Path Management
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#built-in-components-overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        Built-in Components Overview
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Built-in Components Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#component-registry-and-discovery" class="md-nav__link">
    <span class="md-ellipsis">
      
        Component Registry and Discovery
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#component-type-registry" class="md-nav__link">
    <span class="md-ellipsis">
      
        Component Type Registry
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#frontend-canvas-ui" class="md-nav__link">
    <span class="md-ellipsis">
      
        Frontend Canvas UI
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Frontend Canvas UI">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reactflow-based-visual-editor" class="md-nav__link">
    <span class="md-ellipsis">
      
        ReactFlow-Based Visual Editor
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#node-addition-and-connection-system" class="md-nav__link">
    <span class="md-ellipsis">
      
        Node Addition and Connection System
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#form-configuration-system" class="md-nav__link">
    <span class="md-ellipsis">
      
        Form Configuration System
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#operator-palette-organization" class="md-nav__link">
    <span class="md-ellipsis">
      
        Operator Palette Organization
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agent-component-and-react-loop" class="md-nav__link">
    <span class="md-ellipsis">
      
        Agent Component and ReAct Loop
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Agent Component and ReAct Loop">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#agent-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        Agent Architecture
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tool-loading-and-mcp-integration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tool Loading and MCP Integration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#react-loop-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      
        ReAct Loop Implementation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tool-system-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tool System Architecture
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#llm-component" class="md-nav__link">
    <span class="md-ellipsis">
      
        LLM Component
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LLM Component">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-llm-invocation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Basic LLM Invocation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prompt-preparation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prompt Preparation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#streaming-vs-blocking-execution" class="md-nav__link">
    <span class="md-ellipsis">
      
        Streaming vs Blocking Execution
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structured-output" class="md-nav__link">
    <span class="md-ellipsis">
      
        Structured Output
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#categorize-component" class="md-nav__link">
    <span class="md-ellipsis">
      
        Categorize Component
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#canvas-api-endpoints" class="md-nav__link">
    <span class="md-ellipsis">
      
        Canvas API Endpoints
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Canvas API Endpoints">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#completion-endpoint" class="md-nav__link">
    <span class="md-ellipsis">
      
        Completion Endpoint
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sse-event-types" class="md-nav__link">
    <span class="md-ellipsis">
      
        SSE Event Types
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#debug-endpoint" class="md-nav__link">
    <span class="md-ellipsis">
      
        Debug Endpoint
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#other-endpoints" class="md-nav__link">
    <span class="md-ellipsis">
      
        Other Endpoints
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#state-management" class="md-nav__link">
    <span class="md-ellipsis">
      
        State Management
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="State Management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#conversation-history" class="md-nav__link">
    <span class="md-ellipsis">
      
        Conversation History
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retrieval-state" class="md-nav__link">
    <span class="md-ellipsis">
      
        Retrieval State
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memory-system" class="md-nav__link">
    <span class="md-ellipsis">
      
        Memory System
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#global-variables" class="md-nav__link">
    <span class="md-ellipsis">
      
        Global Variables
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#task-cancellation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Task Cancellation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tool-execution-tracing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tool Execution Tracing
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tool Execution Tracing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#callback-mechanism" class="md-nav__link">
    <span class="md-ellipsis">
      
        Callback Mechanism
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#trace-retrieval" class="md-nav__link">
    <span class="md-ellipsis">
      
        Trace Retrieval
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#component-registration-and-discovery" class="md-nav__link">
    <span class="md-ellipsis">
      
        Component Registration and Discovery
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        Summary
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_18" >
        
          
          <label class="md-nav__link" for="__nav_5_18" id="__nav_5_18_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    10 retrieval and rag system
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_18_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_18">
            <span class="md-nav__icon md-icon"></span>
            
  
    10 retrieval and rag system
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../10-retrieval-and-rag-system/10.1-query-processing-and-refinement/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Query Processing and Refinement
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../10-retrieval-and-rag-system/10.2-hybrid-search-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Hybrid Search Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../10-retrieval-and-rag-system/10.3-reranking-and-metadata-filtering/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Reranking and Metadata Filtering
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../10-retrieval-and-rag-system/10.4-response-generation-and-citations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Response Generation and Citations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../10-retrieval-and-rag-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Retrieval and RAG System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Redis deepwiki
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Redis deepwiki
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../redis_deepwiki/1-redis-overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Redis Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2" >
        
          
          <label class="md-nav__link" for="__nav_6_2" id="__nav_6_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    2 redis core
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    2 redis core
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../redis_deepwiki/2-redis-core/2.1-server-architecture-and-lifecycle/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Server Architecture and Lifecycle
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../redis_deepwiki/2-redis-core/2.2-client-connection-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Client Connection Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../redis_deepwiki/2-redis-core/2.3-command-processing-pipeline/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Command Processing Pipeline
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../redis_deepwiki/2-redis-core/2.4-configuration-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuration Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../redis_deepwiki/2-redis-core/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Redis Core
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_4" >
        
          
          <label class="md-nav__link" for="__nav_6_4" id="__nav_6_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    3 data storage and management
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    3 data storage and management
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../redis_deepwiki/3-data-storage-and-management/3.1-core-data-types-implementation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Core Data Types Implementation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../redis_deepwiki/3-data-storage-and-management/3.2-streams-and-blocking-operations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Streams and Blocking Operations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../redis_deepwiki/3-data-storage-and-management/3.3-hyperloglog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    HyperLogLog
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../redis_deepwiki/3-data-storage-and-management/3.4-memory-efficient-data-structures/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Memory-Efficient Data Structures
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../redis_deepwiki/3-data-storage-and-management/3.5-dictionary-and-key-value-store/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dictionary and Key-Value Store
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../redis_deepwiki/3-data-storage-and-management/3.6-dynamic-string-library/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dynamic String Library
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../redis_deepwiki/3-data-storage-and-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Data Storage and Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_6" >
        
          
          <label class="md-nav__link" for="__nav_6_6" id="__nav_6_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    4 memory management
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    4 memory management
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../redis_deepwiki/4-memory-management/4.1-eviction-and-expiration-policies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Eviction and Expiration Policies
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../redis_deepwiki/4-memory-management/4.2-memory-allocators-and-build-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Memory Allocators and Build System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../redis_deepwiki/4-memory-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Memory Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_8" >
        
          
          <label class="md-nav__link" for="__nav_6_8" id="__nav_6_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    5 scripting and extensions
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    5 scripting and extensions
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../redis_deepwiki/5-scripting-and-extensions/5.1-lua-scripting-and-redis-functions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lua Scripting and Redis Functions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../redis_deepwiki/5-scripting-and-extensions/5.2-redis-module-api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Redis Module API
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../redis_deepwiki/5-scripting-and-extensions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Scripting and Extensions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_10" >
        
          
          <label class="md-nav__link" for="__nav_6_10" id="__nav_6_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    6 high availability and distribution
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    6 high availability and distribution
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../redis_deepwiki/6-high-availability-and-distribution/6.1-redis-cluster/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Redis Cluster
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../redis_deepwiki/6-high-availability-and-distribution/6.2-redis-sentinel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Redis Sentinel
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../redis_deepwiki/6-high-availability-and-distribution/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    High Availability and Scaling
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../redis_deepwiki/7-persistence-and-replication/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Persistence and Replication
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_13" >
        
          
          <label class="md-nav__link" for="__nav_6_13" id="__nav_6_13_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    8 security
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_13">
            <span class="md-nav__icon md-icon"></span>
            
  
    8 security
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../redis_deepwiki/8-security/8.1-access-control-lists/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Access Control Lists
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../redis_deepwiki/8-security/8.2-network-security-and-tls/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Network Security and TLS
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../redis_deepwiki/8-security/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Security
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_15" >
        
          
          <label class="md-nav__link" for="__nav_6_15" id="__nav_6_15_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    9 client tools
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_15_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_15">
            <span class="md-nav__icon md-icon"></span>
            
  
    9 client tools
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../redis_deepwiki/9-client-tools/9.1-redis-cli-and-benchmark-tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Redis CLI and Benchmark Tools
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../redis_deepwiki/9-client-tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Client Tools
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_17" >
        
          
          <label class="md-nav__link" for="__nav_6_17" id="__nav_6_17_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    10 development and testing
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_17_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_17">
            <span class="md-nav__icon md-icon"></span>
            
  
    10 development and testing
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../redis_deepwiki/10-development-and-testing/10.1-build-system-and-dependencies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Build System and Dependencies
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../redis_deepwiki/10-development-and-testing/10.2-testing-framework/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Testing Framework
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../redis_deepwiki/10-development-and-testing/10.3-continuous-integration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Continuous Integration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../redis_deepwiki/10-development-and-testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Development and Testing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Stockfish deepwiki
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Stockfish deepwiki
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../stockfish_deepwiki/2-core-data-structures-and-types/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Core Data Structures and Types
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_2" >
        
          
          <label class="md-nav__link" for="__nav_7_2" id="__nav_7_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    3 board representation
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    3 board representation
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../stockfish_deepwiki/3-board-representation/3.1-position-and-state-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Position and State Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../stockfish_deepwiki/3-board-representation/3.2-bitboards-and-low-level-operations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Bitboards and Low-level Operations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../stockfish_deepwiki/3-board-representation/3.3-move-generation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Move Generation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../stockfish_deepwiki/3-board-representation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Board Representation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_4" >
        
          
          <label class="md-nav__link" for="__nav_7_4" id="__nav_7_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    4 search system
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    4 search system
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../stockfish_deepwiki/4-search-system/4.1-search-algorithm-and-iterative-deepening/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Search Algorithm and Iterative Deepening
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../stockfish_deepwiki/4-search-system/4.2-thread-management-and-parallel-search/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Thread Management and Parallel Search
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../stockfish_deepwiki/4-search-system/4.3-move-ordering-and-move-picker/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Move Ordering and Move Picker
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../stockfish_deepwiki/4-search-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Search System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_6" >
        
          
          <label class="md-nav__link" for="__nav_7_6" id="__nav_7_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    5 evaluation system
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    5 evaluation system
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../stockfish_deepwiki/5-evaluation-system/5.1-nnue-neural-network-evaluation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    NNUE Neural Network Evaluation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../stockfish_deepwiki/5-evaluation-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Evaluation System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_8" >
        
          
          <label class="md-nav__link" for="__nav_7_8" id="__nav_7_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    6 external interface
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    6 external interface
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../stockfish_deepwiki/6-external-interface/6.1-uci-protocol-handler/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    UCI Protocol Handler
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../stockfish_deepwiki/6-external-interface/6.2-uci-options-and-configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    UCI Options and Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../stockfish_deepwiki/6-external-interface/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    External Interface
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_10" >
        
          
          <label class="md-nav__link" for="__nav_7_10" id="__nav_7_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    7 infrastructure and support
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    7 infrastructure and support
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../stockfish_deepwiki/7-infrastructure-and-support/7.1-build-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Build System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../stockfish_deepwiki/7-infrastructure-and-support/7.2-utilities-and-support-functions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Utilities and Support Functions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../stockfish_deepwiki/7-infrastructure-and-support/7.3-testing-and-benchmarking/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Testing and Benchmarking
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../stockfish_deepwiki/7-infrastructure-and-support/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Infrastructure and Support
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#canvas-and-graph-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        Canvas and Graph Architecture
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Canvas and Graph Architecture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dsl-structure" class="md-nav__link">
    <span class="md-ellipsis">
      
        DSL Structure
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#graph-class" class="md-nav__link">
    <span class="md-ellipsis">
      
        Graph Class
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#canvas-class" class="md-nav__link">
    <span class="md-ellipsis">
      
        Canvas Class
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#component-system" class="md-nav__link">
    <span class="md-ellipsis">
      
        Component System
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Component System">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#componentbase-abstract-class" class="md-nav__link">
    <span class="md-ellipsis">
      
        ComponentBase Abstract Class
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#componentparambase" class="md-nav__link">
    <span class="md-ellipsis">
      
        ComponentParamBase
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#component-lifecycle-diagram" class="md-nav__link">
    <span class="md-ellipsis">
      
        Component Lifecycle Diagram
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#variable-resolution-system" class="md-nav__link">
    <span class="md-ellipsis">
      
        Variable Resolution System
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Variable Resolution System">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#variable-types" class="md-nav__link">
    <span class="md-ellipsis">
      
        Variable Types
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#variable-resolution-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      
        Variable Resolution Pattern
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nested-path-resolution" class="md-nav__link">
    <span class="md-ellipsis">
      
        Nested Path Resolution
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#execution-engine" class="md-nav__link">
    <span class="md-ellipsis">
      
        Execution Engine
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Execution Engine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#async-batch-execution" class="md-nav__link">
    <span class="md-ellipsis">
      
        Async Batch Execution
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#concurrent-component-execution" class="md-nav__link">
    <span class="md-ellipsis">
      
        Concurrent Component Execution
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#path-management" class="md-nav__link">
    <span class="md-ellipsis">
      
        Path Management
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#built-in-components-overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        Built-in Components Overview
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Built-in Components Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#component-registry-and-discovery" class="md-nav__link">
    <span class="md-ellipsis">
      
        Component Registry and Discovery
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#component-type-registry" class="md-nav__link">
    <span class="md-ellipsis">
      
        Component Type Registry
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#frontend-canvas-ui" class="md-nav__link">
    <span class="md-ellipsis">
      
        Frontend Canvas UI
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Frontend Canvas UI">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reactflow-based-visual-editor" class="md-nav__link">
    <span class="md-ellipsis">
      
        ReactFlow-Based Visual Editor
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#node-addition-and-connection-system" class="md-nav__link">
    <span class="md-ellipsis">
      
        Node Addition and Connection System
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#form-configuration-system" class="md-nav__link">
    <span class="md-ellipsis">
      
        Form Configuration System
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#operator-palette-organization" class="md-nav__link">
    <span class="md-ellipsis">
      
        Operator Palette Organization
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agent-component-and-react-loop" class="md-nav__link">
    <span class="md-ellipsis">
      
        Agent Component and ReAct Loop
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Agent Component and ReAct Loop">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#agent-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        Agent Architecture
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tool-loading-and-mcp-integration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tool Loading and MCP Integration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#react-loop-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      
        ReAct Loop Implementation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tool-system-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tool System Architecture
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#llm-component" class="md-nav__link">
    <span class="md-ellipsis">
      
        LLM Component
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LLM Component">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-llm-invocation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Basic LLM Invocation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prompt-preparation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prompt Preparation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#streaming-vs-blocking-execution" class="md-nav__link">
    <span class="md-ellipsis">
      
        Streaming vs Blocking Execution
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structured-output" class="md-nav__link">
    <span class="md-ellipsis">
      
        Structured Output
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#categorize-component" class="md-nav__link">
    <span class="md-ellipsis">
      
        Categorize Component
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#canvas-api-endpoints" class="md-nav__link">
    <span class="md-ellipsis">
      
        Canvas API Endpoints
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Canvas API Endpoints">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#completion-endpoint" class="md-nav__link">
    <span class="md-ellipsis">
      
        Completion Endpoint
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sse-event-types" class="md-nav__link">
    <span class="md-ellipsis">
      
        SSE Event Types
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#debug-endpoint" class="md-nav__link">
    <span class="md-ellipsis">
      
        Debug Endpoint
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#other-endpoints" class="md-nav__link">
    <span class="md-ellipsis">
      
        Other Endpoints
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#state-management" class="md-nav__link">
    <span class="md-ellipsis">
      
        State Management
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="State Management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#conversation-history" class="md-nav__link">
    <span class="md-ellipsis">
      
        Conversation History
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retrieval-state" class="md-nav__link">
    <span class="md-ellipsis">
      
        Retrieval State
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memory-system" class="md-nav__link">
    <span class="md-ellipsis">
      
        Memory System
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#global-variables" class="md-nav__link">
    <span class="md-ellipsis">
      
        Global Variables
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#task-cancellation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Task Cancellation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tool-execution-tracing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tool Execution Tracing
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tool Execution Tracing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#callback-mechanism" class="md-nav__link">
    <span class="md-ellipsis">
      
        Callback Mechanism
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#trace-retrieval" class="md-nav__link">
    <span class="md-ellipsis">
      
        Trace Retrieval
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#component-registration-and-discovery" class="md-nav__link">
    <span class="md-ellipsis">
      
        Component Registration and Discovery
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        Summary
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="agent-and-workflow-system">Agent and Workflow System<a class="headerlink" href="#agent-and-workflow-system" title="Permanent link">&para;</a></h1>
<p>Relevant source files</p>
<ul>
<li><a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/canvas.py">agent/canvas.py</a></li>
<li><a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/component/agent_with_tools.py">agent/component/agent_with_tools.py</a></li>
<li><a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/component/base.py">agent/component/base.py</a></li>
<li><a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/component/categorize.py">agent/component/categorize.py</a></li>
<li><a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/component/llm.py">agent/component/llm.py</a></li>
<li><a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/tools/base.py">agent/tools/base.py</a></li>
<li><a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/tools/retrieval.py">agent/tools/retrieval.py</a></li>
<li><a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/apps/api_app.py">api/apps/api_app.py</a></li>
<li><a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/apps/canvas_app.py">api/apps/canvas_app.py</a></li>
<li><a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/apps/sdk/chat.py">api/apps/sdk/chat.py</a></li>
<li><a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/apps/sdk/dataset.py">api/apps/sdk/dataset.py</a></li>
<li><a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/apps/sdk/dify_retrieval.py">api/apps/sdk/dify_retrieval.py</a></li>
<li><a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/apps/sdk/doc.py">api/apps/sdk/doc.py</a></li>
<li><a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/apps/sdk/session.py">api/apps/sdk/session.py</a></li>
<li><a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/canvas_service.py">api/db/services/canvas_service.py</a></li>
<li><a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/conversation_service.py">api/db/services/conversation_service.py</a></li>
<li><a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/utils/api_utils.py">api/utils/api_utils.py</a></li>
<li><a href="https://github.com/infiniflow/ragflow/blob/80a16e71/docs/references/http_api_reference.md">docs/references/http_api_reference.md</a></li>
<li><a href="https://github.com/infiniflow/ragflow/blob/80a16e71/docs/references/python_api_reference.md">docs/references/python_api_reference.md</a></li>
<li><a href="https://github.com/infiniflow/ragflow/blob/80a16e71/docs/release_notes.md">docs/release_notes.md</a></li>
<li><a href="https://github.com/infiniflow/ragflow/blob/80a16e71/rag/advanced_rag/__init__.py">rag/advanced_rag/__init__.py</a></li>
<li><a href="https://github.com/infiniflow/ragflow/blob/80a16e71/rag/benchmark.py">rag/benchmark.py</a></li>
<li><a href="https://github.com/infiniflow/ragflow/blob/80a16e71/rag/prompts/generator.py">rag/prompts/generator.py</a></li>
<li><a href="https://github.com/infiniflow/ragflow/blob/80a16e71/sdk/python/ragflow_sdk/modules/chat.py">sdk/python/ragflow_sdk/modules/chat.py</a></li>
<li><a href="https://github.com/infiniflow/ragflow/blob/80a16e71/sdk/python/ragflow_sdk/ragflow.py">sdk/python/ragflow_sdk/ragflow.py</a></li>
<li><a href="https://github.com/infiniflow/ragflow/blob/80a16e71/web/src/components/knowledge-base-item.tsx">web/src/components/knowledge-base-item.tsx</a></li>
<li><a href="https://github.com/infiniflow/ragflow/blob/80a16e71/web/src/interfaces/request/flow.ts">web/src/interfaces/request/flow.ts</a></li>
</ul>
<p>The Agent and Workflow System provides a visual, DSL-based orchestration engine for building complex AI workflows. It enables users to compose multi-step processes by connecting components (LLM, Retrieval, Agent, Categorize, etc.) into directed graphs that execute asynchronously with state management, variable resolution, and streaming output. This system powers RAGFlow's agent capabilities and custom workflow automation.</p>
<p>For document retrieval functionality integrated with workflows, see <a href="/infiniflow/ragflow/9-agent-and-workflow-system">Retrieval and RAG System</a>. For LLM provider integration used by components, see <a href="/infiniflow/ragflow/5-llm-integration-system">LLM Integration System</a>.</p>
<hr />
<h2 id="canvas-and-graph-architecture">Canvas and Graph Architecture<a class="headerlink" href="#canvas-and-graph-architecture" title="Permanent link">&para;</a></h2>
<p>The workflow system is built around two core classes: <code>Graph</code> (base orchestrator) and <code>Canvas</code> (agent-specific extension).</p>
<h3 id="dsl-structure">DSL Structure<a class="headerlink" href="#dsl-structure" title="Permanent link">&para;</a></h3>
<p>Workflows are defined as JSON DSL containing components, connections, and state. The DSL is stored in the <code>dsl</code> field of <code>UserCanvas</code> database records and loaded by the <code>Graph</code> and <code>Canvas</code> classes.</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>{
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>  &quot;components&quot;: {
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    &quot;begin&quot;: {
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>      &quot;obj&quot;: {
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>        &quot;component_name&quot;: &quot;Begin&quot;,
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>        &quot;params&quot;: {}
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>      },
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>      &quot;downstream&quot;: [&quot;retrieval_0&quot;],
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>      &quot;upstream&quot;: []
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>    },
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>    &quot;retrieval_0&quot;: {
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>      &quot;obj&quot;: {
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>        &quot;component_name&quot;: &quot;Retrieval&quot;,
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>        &quot;params&quot;: {&quot;kb_ids&quot;: [&quot;kb-123&quot;]}
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>      },
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>      &quot;downstream&quot;: [&quot;generate_0&quot;],
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>      &quot;upstream&quot;: [&quot;begin&quot;]
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>    }
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>  },
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>  &quot;history&quot;: [],
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>  &quot;path&quot;: [&quot;begin&quot;],
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a>  &quot;retrieval&quot;: {&quot;chunks&quot;: {}, &quot;doc_aggs&quot;: {}},
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a>  &quot;globals&quot;: {
<a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a>    &quot;sys.query&quot;: &quot;&quot;,
<a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a>    &quot;sys.user_id&quot;: &quot;tenant_id&quot;,
<a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a>    &quot;sys.conversation_turns&quot;: 0,
<a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a>    &quot;sys.files&quot;: []
<a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a>  },
<a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a>  &quot;variables&quot;: {
<a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a>    &quot;api_key&quot;: {&quot;type&quot;: &quot;string&quot;, &quot;value&quot;: &quot;&quot;},
<a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a>    &quot;threshold&quot;: {&quot;type&quot;: &quot;number&quot;, &quot;value&quot;: 0.8}
<a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a>  },
<a id="__codelineno-0-33" name="__codelineno-0-33" href="#__codelineno-0-33"></a>  &quot;memory&quot;: []
<a id="__codelineno-0-34" name="__codelineno-0-34" href="#__codelineno-0-34"></a>}
</code></pre></div>
<strong>DSL Lifecycle:</strong></p>
<ul>
<li><strong>Storage</strong>: <code>UserCanvas.dsl</code> field in MySQL (JSON or serialized string)</li>
<li><strong>Loading</strong>: <code>Graph.__init__(dsl: str)</code> → <code>json.loads(dsl)</code> → <code>Graph.load()</code></li>
<li><strong>Component Instantiation</strong>: <code>component_class(name)</code> factory function</li>
<li><strong>Serialization</strong>: <code>Graph.__str__()</code> → <code>json.dumps(dsl)</code> → saved back to database</li>
</ul>
<p><strong>Sources:</strong> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/canvas.py#L42-L79">agent/canvas.py42-79</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/canvas.py#L81-L89">agent/canvas.py81-89</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/canvas.py#L107-L126">agent/canvas.py107-126</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/apps/canvas_app.py#L140-L145">api/apps/canvas_app.py140-145</a></p>
<h3 id="graph-class">Graph Class<a class="headerlink" href="#graph-class" title="Permanent link">&para;</a></h3>
<p>The <code>Graph</code> class (<code>agent/canvas.py</code>) provides core workflow orchestration:</p>
<p><pre class="mermaid"><code>flowchart TD
    DSL["JSON DSL stringfrom UserCanvas.dsl"]
    Init["Graph.init(dsl, tenant_id, task_id)"]
    ParseJSON["json.loads(dsl)"]
    StoreAttrs["Store: self.dsl, self.components,self.path, self._tenant_id,self.task_id, self._thread_pool"]
    Load["Graph.load()"]
    IterComponents["For each inself.dsl['components']"]
    GetParamClass["component_class(name + 'Param')"]
    ParamUpdate["param.update(params)"]
    ParamCheck["param.check()"]
    GetComponentClass["component_class(name)"]
    Instantiate["Instantiate componentwith (canvas, id, param)"]
    StoreComponent["self.components[id]['obj'] = instance"]
    GetMethods["get_component(cpn_id)get_component_obj(cpn_id)get_component_type(cpn_id)"]
    VarMethods["get_variable_value(exp)set_variable_value(exp, value)get_value_with_variable(value)"]
    TaskMethods["is_canceled() → has_canceled(task_id)cancel_task() → REDIS_CONN.set"]

    DSL --&gt; Init
    Init --&gt; ParseJSON
    ParseJSON --&gt; StoreAttrs
    Init --&gt; Load
    Load --&gt; IterComponents
    IterComponents --&gt; GetParamClass
    GetParamClass --&gt; ParamUpdate
    ParamUpdate --&gt; ParamCheck
    ParamCheck --&gt; GetComponentClass
    GetComponentClass --&gt; Instantiate
    Instantiate --&gt; StoreComponent
    StoreAttrs --&gt; GetMethods
    StoreAttrs --&gt; VarMethods
    StoreAttrs --&gt; TaskMethods</code></pre>
<strong>Key Methods (Graph class):</strong></p>
<ul>
<li><code>__init__(dsl: str, tenant_id, task_id)</code> - Parses <code>json.loads(dsl)</code>, stores in <code>self.dsl</code>, creates <code>ThreadPoolExecutor(max_workers=5)</code></li>
<li><code>load()</code> - Iterates <code>self.dsl["components"]</code>, instantiates via <code>component_class()</code>, validates with <code>param.check()</code></li>
<li><code>__str__()</code> - Serializes to JSON via <code>json.dumps()</code>, calls <code>str(cpn["obj"])</code> for each component</li>
<li><code>get_component(cpn_id)</code> - Returns <code>self.components[cpn_id]</code> dict with <code>obj</code>, <code>upstream</code>, <code>downstream</code></li>
<li><code>get_component_obj(cpn_id)</code> - Returns <code>self.components[cpn_id]["obj"]</code> (ComponentBase instance)</li>
<li><code>get_variable_value(exp)</code> - Resolves <code>{sys.*}</code>, <code>{env.*}</code>, or <code>{cpn_id@var}</code> expressions</li>
<li><code>is_canceled()</code> - Checks <code>has_canceled(self.task_id)</code> via Redis lookup</li>
<li><code>cancel_task()</code> - Sets <code>REDIS_CONN.set(f"{self.task_id}-cancel", "x")</code></li>
</ul>
<p><strong>Thread Pool:</strong> <code>self._thread_pool = ThreadPoolExecutor(max_workers=5)</code> created in <code>__init__</code>, used for concurrent component execution</p>
<p><strong>Sources:</strong> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/canvas.py#L40-L89">agent/canvas.py40-89</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/canvas.py#L91-L105">agent/canvas.py91-105</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/canvas.py#L107-L126">agent/canvas.py107-126</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/canvas.py#L147-L161">agent/canvas.py147-161</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/canvas.py#L189-L277">agent/canvas.py189-277</a></p>
<h3 id="canvas-class">Canvas Class<a class="headerlink" href="#canvas-class" title="Permanent link">&para;</a></h3>
<p><code>Canvas</code> extends <code>Graph</code> with agent-specific state management and execution logic:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>class Canvas(Graph):
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>    def __init__(self, dsl: str, tenant_id, task_id, canvas_id):
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>        self.globals = {
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>            &quot;sys.query&quot;: &quot;&quot;,
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>            &quot;sys.user_id&quot;: tenant_id,
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>            &quot;sys.conversation_turns&quot;: 0,
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>            &quot;sys.files&quot;: []
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>        }
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>        self.variables = {}  # User-defined env.* variables from DSL
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>        super().__init__(dsl, tenant_id, task_id)
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>        self._id = canvas_id
</code></pre></div>
<strong>Additional State (Canvas-specific):</strong></p>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Purpose</th>
<th>Loaded From</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>self.history</code></td>
<td><code>list[(role, content)]</code></td>
<td>Conversation history tuples</td>
<td><code>self.dsl["history"]</code></td>
</tr>
<tr>
<td><code>self.retrieval</code></td>
<td><code>list[dict]</code></td>
<td>Retrieved chunks/docs per turn</td>
<td><code>self.dsl["retrieval"]</code></td>
</tr>
<tr>
<td><code>self.memory</code></td>
<td><code>list[(user, assist, summ)]</code></td>
<td>Episodic memory tuples</td>
<td><code>self.dsl.get("memory", [])</code></td>
</tr>
<tr>
<td><code>self.globals</code></td>
<td><code>dict</code></td>
<td>System variables (<code>sys.*</code>) and env variables (<code>env.*</code>)</td>
<td><code>self.dsl.get("globals", {})</code></td>
</tr>
<tr>
<td><code>self.variables</code></td>
<td><code>dict</code></td>
<td>Variable definitions (type, value, description)</td>
<td><code>self.dsl.get("variables", {})</code></td>
</tr>
<tr>
<td><code>self.message_id</code></td>
<td><code>str</code></td>
<td>Current message UUID (set in <code>run()</code>)</td>
<td>Generated with <code>get_uuid()</code></td>
</tr>
<tr>
<td><code>self._loop</code></td>
<td><code>asyncio.EventLoop</code></td>
<td>Current event loop</td>
<td><code>asyncio.get_running_loop()</code></td>
</tr>
</tbody>
</table>
<p><strong>Key Canvas Methods:</strong></p>
<ul>
<li><code>load()</code> - Extends <code>Graph.load()</code> to load <code>history</code>, <code>retrieval</code>, <code>memory</code>, <code>globals</code>, <code>variables</code></li>
<li><code>reset(mem=False)</code> - Clears state; if <code>mem=True</code>, preserves <code>history</code>, <code>retrieval</code>, <code>memory</code></li>
<li><code>run(**kwargs)</code> - Main async execution engine (see Execution Engine section)</li>
<li><code>add_user_input(question)</code> - Appends to <code>self.history</code></li>
<li><code>get_history(window_size)</code> - Returns last N conversation turns</li>
<li><code>add_reference(chunks, doc_infos)</code> - Appends to <code>self.retrieval[-1]</code></li>
<li><code>get_reference()</code> - Returns <code>self.retrieval[-1]</code> for citation</li>
<li><code>tool_use_callback(agent_id, func_name, params, result)</code> - Logs to Redis at key <code>f"{task_id}-{message_id}-logs"</code></li>
<li><code>get_files_async(files)</code> - Converts file metadata to base64 images or parsed text</li>
<li><code>tts(tts_mdl, text)</code> - Generates audio binary with optional TTS model</li>
</ul>
<p><strong>Sources:</strong> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/canvas.py#L279-L310">agent/canvas.py279-310</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/canvas.py#L318-L360">agent/canvas.py318-360</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/canvas.py#L705-L810">agent/canvas.py705-810</a></p>
<hr />
<h2 id="component-system">Component System<a class="headerlink" href="#component-system" title="Permanent link">&para;</a></h2>
<h3 id="componentbase-abstract-class">ComponentBase Abstract Class<a class="headerlink" href="#componentbase-abstract-class" title="Permanent link">&para;</a></h3>
<p>All workflow components inherit from <code>ComponentBase</code>:</p>
<p><pre class="mermaid"><code>flowchart TD
    ComponentBase["ComponentBase (ABC)agent/component/base.py"]
    Init["init(canvas, id, param)Initialize with canvas reference"]
    Invoke["invoke(**kwargs)Sync entry point"]
    InvokeAsync["invoke_async(**kwargs)Async entry point"]
    InvokeImpl["_invoke(**kwargs)Override this"]
    Output["output(var_nm)Get output values"]
    SetOutput["set_output(key, value)Set output values"]
    GetInput["get_input(key)Get input with variable resolution"]
    Reset["reset(only_output)Clear state"]
    ErrorHandling["exception_handler()Get exception strategy"]
    CheckCanceled["check_if_canceled()Check task cancellation"]

    ComponentBase --&gt; Init
    ComponentBase --&gt; Invoke
    ComponentBase --&gt; InvokeAsync
    ComponentBase --&gt; Output
    ComponentBase --&gt; SetOutput
    ComponentBase --&gt; GetInput
    ComponentBase --&gt; Reset
    ComponentBase --&gt; ErrorHandling
    ComponentBase --&gt; CheckCanceled
    Invoke --&gt; InvokeImpl
    InvokeAsync --&gt; InvokeImpl</code></pre>
<strong>Core Lifecycle:</strong></p>
<ol>
<li><strong>Initialization</strong> - <code>__init__(canvas, id, param)</code> stores canvas reference, component ID, and parameters</li>
<li><strong>Invocation</strong> - <code>invoke()</code> or <code>invoke_async()</code> wrap <code>_invoke()</code> with timing and error handling</li>
<li><strong>Execution</strong> - <code>_invoke(**kwargs)</code> is overridden by subclasses to implement component logic</li>
<li><strong>Output</strong> - Results stored in <code>self._param.outputs</code>, accessed via <code>output(var_nm)</code></li>
</ol>
<p><strong>Sources:</strong> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/component/base.py#L361-L580">agent/component/base.py361-580</a></p>
<h3 id="componentparambase">ComponentParamBase<a class="headerlink" href="#componentparambase" title="Permanent link">&para;</a></h3>
<p>Parameter objects define component configuration and I/O schema:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>class ComponentParamBase(ABC):
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>    def __init__(self):
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>        self.message_history_window_size = 13
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>        self.inputs = {}   # Input schema with values
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>        self.outputs = {}  # Output values by key
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>        self.description = &quot;&quot;
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>        self.max_retries = 0
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>        self.delay_after_error = 2.0
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>        self.exception_method = None
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>        self.exception_default_value = None
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>        self.exception_goto = None
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>        self.debug_inputs = {}
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a>    def check(self):
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a>        raise NotImplementedError(&quot;Parameter Object should be checked.&quot;)
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a>
<a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a>    def update(self, conf, allow_redundant=False):
<a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a>        # Recursively updates parameters from config dict
<a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a>
<a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a>    def as_dict(self):
<a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a>        # Serializes to JSON-compatible dict
</code></pre></div>
<strong>Parameter Validation:</strong></p>
<ul>
<li><code>check()</code> - Must be implemented by subclasses to validate configuration</li>
<li><code>check_positive_integer()</code>, <code>check_decimal_float()</code>, etc. - Built-in validators</li>
<li>Raises <code>ValueError</code> with descriptive messages on validation failure</li>
</ul>
<p><strong>Sources:</strong> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/component/base.py#L36-L359">agent/component/base.py36-359</a></p>
<h3 id="component-lifecycle-diagram">Component Lifecycle Diagram<a class="headerlink" href="#component-lifecycle-diagram" title="Permanent link">&para;</a></h3>
<blockquote>
<p><strong>[Mermaid sequence]</strong>
<em>(图表结构无法解析)</em></p>
</blockquote>
<p><strong>Sources:</strong> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/component/base.py#L402-L443">agent/component/base.py402-443</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/component/llm.py#L263-L342">agent/component/llm.py263-342</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/component/agent_with_tools.py#L176-L251">agent/component/agent_with_tools.py176-251</a></p>
<hr />
<h2 id="variable-resolution-system">Variable Resolution System<a class="headerlink" href="#variable-resolution-system" title="Permanent link">&para;</a></h2>
<p>The workflow system supports three variable types:</p>
<h3 id="variable-types">Variable Types<a class="headerlink" href="#variable-types" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Prefix</th>
<th>Description</th>
<th>Example</th>
<th>Resolution</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>sys.*</code></td>
<td>System variables</td>
<td><code>sys.query</code>, <code>sys.user_id</code>, <code>sys.conversation_turns</code>, <code>sys.files</code></td>
<td>Stored in <code>Canvas.globals</code></td>
</tr>
<tr>
<td><code>env.*</code></td>
<td>Environment/user variables</td>
<td><code>env.api_key</code>, <code>env.threshold</code></td>
<td>Defined in <code>Canvas.variables</code>, resolved to <code>globals["env.*"]</code></td>
</tr>
<tr>
<td><code>{cpn_id}@{field}</code></td>
<td>Component outputs</td>
<td><code>retrieval_0@content</code>, <code>agent@use_tools</code></td>
<td>Retrieved from component output</td>
</tr>
</tbody>
</table>
<h3 id="variable-resolution-pattern">Variable Resolution Pattern<a class="headerlink" href="#variable-resolution-pattern" title="Permanent link">&para;</a></h3>
<p>Variables are resolved using regex pattern matching:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a># Pattern in ComponentBase
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>variable_ref_patt = r&quot;\{* *\{([a-zA-Z:0-9]+@[A-Za-z0-9_.-]+|sys\.[A-Za-z0-9_.]+|env\.[A-Za-z0-9_.]+)\} *\}*&quot;
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a># Resolution in Graph.get_value_with_variable()
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>def get_value_with_variable(self, value: str) -&gt; Any:
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>    pat = re.compile(r&quot;\{* *\{([a-zA-Z:0-9]+@[A-Za-z0-9_.-]+|sys\.[A-Za-z0-9_.]+|env\.[A-Za-z0-9_.]+)\} *\}*&quot;)
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>    out_parts = []
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>    for m in pat.finditer(value):
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>        key = m.group(1)
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>        v = self.get_variable_value(key)
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>        # Handle partial (streaming), str, or complex objects
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>        if isinstance(v, partial):
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>            buf = []
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a>            for chunk in v():
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a>                buf.append(chunk)
<a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a>            rep = &quot;&quot;.join(buf)
<a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a>        elif isinstance(v, str):
<a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a>            rep = v
<a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a>        else:
<a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a>            rep = json.dumps(v, ensure_ascii=False)
<a id="__codelineno-3-21" name="__codelineno-3-21" href="#__codelineno-3-21"></a>        out_parts.append(rep)
<a id="__codelineno-3-22" name="__codelineno-3-22" href="#__codelineno-3-22"></a>    return &quot;&quot;.join(out_parts)
</code></pre></div>
<strong>Sources:</strong> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/canvas.py#L162-L188">agent/canvas.py162-188</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/component/base.py#L364-L364">agent/component/base.py364</a></p>
<h3 id="nested-path-resolution">Nested Path Resolution<a class="headerlink" href="#nested-path-resolution" title="Permanent link">&para;</a></h3>
<p>Component outputs can be accessed with dot notation:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a># Example: {retrieval_0@chunks.0.content}
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>def get_variable_param_value(self, obj: Any, path: str) -&gt; Any:
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>    cur = obj
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>    for key in path.split(&#39;.&#39;):
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>        if isinstance(cur, dict):
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>            cur = cur.get(key)
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>        elif isinstance(cur, (list, tuple)):
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>            idx = int(key)
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>            cur = cur[idx]
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>        else:
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>            cur = getattr(cur, key, None)
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a>    return cur
</code></pre></div>
<strong>Sources:</strong> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/canvas.py#L206-L233">agent/canvas.py206-233</a></p>
<hr />
<h2 id="execution-engine">Execution Engine<a class="headerlink" href="#execution-engine" title="Permanent link">&para;</a></h2>
<h3 id="async-batch-execution">Async Batch Execution<a class="headerlink" href="#async-batch-execution" title="Permanent link">&para;</a></h3>
<p>The <code>Canvas.run(**kwargs)</code> method orchestrates asynchronous component execution with streaming SSE events:</p>
<p><pre class="mermaid"><code>flowchart TD
    Start["Canvas.run(**kwargs)"]
    Init["self._loop = asyncio.get_running_loop()self.message_id = get_uuid()created_at = int(time.time())"]
    AddInput["self.add_user_input(kwargs['query'])self.globals['sys.query'] = queryself.globals['sys.conversation_turns'] += 1"]
    YieldStart["yield decorate('workflow_started',{'inputs': kwargs.get('inputs')})"]
    BatchLoop["idx = len(self.path) - 1while idx &lt; len(self.path):"]
    YieldNodeStart["for i in range(idx, to):yield decorate('node_started', {...})"]
    RunBatch["await _run_batch(idx, to)"]
    PostProcess["for i in range(idx, to):cpn_obj = get_component_obj(path[i])"]
    CheckMessage["cpn_obj.component_name== 'message'?"]
    StreamMessage["if isinstance(output('content'), partial):async for m in stream():yield decorate('message', {'content': m})"]
    YieldNodeFinish["yield _node_finished(cpn_obj)"]
    ExtendPath["Extend self.path based on:- categorize/switch: output('_next')- iteration/loop: get_start()- downstream: cpn['downstream']"]
    CheckError["self.error?"]
    CheckMorePath["idx &lt; len(self.path)?"]
    YieldFinish["yield decorate('workflow_finished',{'outputs': get_component_obj(path[-1]).output()})"]

    Start --&gt; Init
    Init --&gt; AddInput
    AddInput --&gt; YieldStart
    YieldStart --&gt; BatchLoop
    BatchLoop --&gt; YieldNodeStart
    YieldNodeStart --&gt; RunBatch
    RunBatch --&gt; PostProcess
    PostProcess --&gt; CheckMessage
    CheckMessage --&gt; StreamMessage
    CheckMessage --&gt; YieldNodeFinish
    StreamMessage --&gt; YieldNodeFinish
    YieldNodeFinish --&gt; ExtendPath
    ExtendPath --&gt; CheckError
    CheckError --&gt; YieldFinish
    CheckError --&gt; CheckMorePath
    CheckMorePath --&gt; BatchLoop
    CheckMorePath --&gt; YieldFinish</code></pre>
<strong>Key Execution Steps:</strong></p>
<ol>
<li>
<p><strong>Initialization</strong> (lines 361-390):</p>
<ul>
<li><code>self._loop = asyncio.get_running_loop()</code> - Capture event loop</li>
<li><code>self.message_id = get_uuid()</code> - Generate message ID for tracing</li>
<li>Update <code>self.globals</code> with <code>kwargs</code> (query, user_id, files)</li>
<li>Increment <code>self.globals["sys.conversation_turns"]</code></li>
<li>Append <code>"begin"</code> to <code>self.path</code> if empty</li>
<li>
<p><strong>Batch Execution</strong> (lines 414-458):</p>
</li>
<li>
<p><code>_run_batch(from_idx, to_idx)</code> - Execute components concurrently</p>
</li>
<li>Uses <code>loop.run_in_executor(self._thread_pool, ...)</code> for parallel invocation</li>
<li>Checks <code>invoke_async()</code> availability, falls back to <code>invoke()</code></li>
<li>
<p><strong>Post-Processing</strong> (lines 488-610):</p>
</li>
<li>
<p>Handle <code>Message</code> component streaming with <code>partial</code> generators</p>
</li>
<li>Emit <code>node_finished</code> events with inputs, outputs, elapsed time</li>
<li>Apply exception handlers if errors occur</li>
<li>Extend path based on component type (categorize, iteration, loop, standard)</li>
<li>
<p><strong>Streaming Support</strong> (lines 494-550):</p>
</li>
<li>
<p><code>partial</code> function output streams via <code>async for m in stream()</code></p>
</li>
<li>Special handling for <code>&lt;think&gt;</code> tags (<code>start_to_think</code>, <code>end_to_think</code> flags)</li>
<li>Optional TTS conversion with <code>self.tts(tts_mdl, buff_m)</code></li>
<li>Citation detection with <code>re.search(r"\[ID:[ 0-9]+\]", content)</code></li>
</ul>
</li>
</ol>
<p><strong>Cancellation Checks:</strong> <code>self.is_canceled()</code> called at multiple points; raises <code>TaskCanceledException</code> if Redis flag set</p>
<p><strong>Sources:</strong> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/canvas.py#L361-L406">agent/canvas.py361-406</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/canvas.py#L414-L458">agent/canvas.py414-458</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/canvas.py#L471-L614">agent/canvas.py471-614</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/canvas.py#L632-L649">agent/canvas.py632-649</a></p>
<h3 id="concurrent-component-execution">Concurrent Component Execution<a class="headerlink" href="#concurrent-component-execution" title="Permanent link">&para;</a></h3>
<p>The <code>_run_batch(f, t)</code> nested function (inside <code>Canvas.run()</code>) executes components in parallel:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>async def _run_batch(f, t):
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>    &quot;&quot;&quot;Execute components from index f to t concurrently&quot;&quot;&quot;
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>    if self.is_canceled():
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>        msg = f&quot;Task {self.task_id} has been canceled during batch execution.&quot;
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>        logging.info(msg)
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>        raise TaskCanceledException(msg)
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>    loop = asyncio.get_running_loop()
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>    tasks = []
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>    def _run_async_in_thread(coro_func, **call_kwargs):
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a>        &quot;&quot;&quot;Helper to run coroutine in thread pool&quot;&quot;&quot;
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a>        return asyncio.run(coro_func(**call_kwargs))
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a>
<a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a>    i = f
<a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a>    while i &lt; t:
<a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a>        cpn = self.get_component_obj(self.path[i])
<a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a>        task_fn = None
<a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a>        call_kwargs = None
<a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a>
<a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a>        # Prepare inputs
<a id="__codelineno-5-22" name="__codelineno-5-22" href="#__codelineno-5-22"></a>        if cpn.component_name.lower() in [&quot;begin&quot;, &quot;userfillup&quot;]:
<a id="__codelineno-5-23" name="__codelineno-5-23" href="#__codelineno-5-23"></a>            call_kwargs = {&quot;inputs&quot;: kwargs.get(&quot;inputs&quot;, {})}
<a id="__codelineno-5-24" name="__codelineno-5-24" href="#__codelineno-5-24"></a>            task_fn = cpn.invoke
<a id="__codelineno-5-25" name="__codelineno-5-25" href="#__codelineno-5-25"></a>            i += 1
<a id="__codelineno-5-26" name="__codelineno-5-26" href="#__codelineno-5-26"></a>        else:
<a id="__codelineno-5-27" name="__codelineno-5-27" href="#__codelineno-5-27"></a>            # Check if upstream dependencies are satisfied
<a id="__codelineno-5-28" name="__codelineno-5-28" href="#__codelineno-5-28"></a>            for _, ele in cpn.get_input_elements().items():
<a id="__codelineno-5-29" name="__codelineno-5-29" href="#__codelineno-5-29"></a>                if isinstance(ele, dict) and ele.get(&quot;_cpn_id&quot;) and \
<a id="__codelineno-5-30" name="__codelineno-5-30" href="#__codelineno-5-30"></a>                   ele.get(&quot;_cpn_id&quot;) not in self.path[:i]:
<a id="__codelineno-5-31" name="__codelineno-5-31" href="#__codelineno-5-31"></a>                    self.path.pop(i)  # Skip component
<a id="__codelineno-5-32" name="__codelineno-5-32" href="#__codelineno-5-32"></a>                    t -= 1
<a id="__codelineno-5-33" name="__codelineno-5-33" href="#__codelineno-5-33"></a>                    break
<a id="__codelineno-5-34" name="__codelineno-5-34" href="#__codelineno-5-34"></a>            else:
<a id="__codelineno-5-35" name="__codelineno-5-35" href="#__codelineno-5-35"></a>                call_kwargs = cpn.get_input()
<a id="__codelineno-5-36" name="__codelineno-5-36" href="#__codelineno-5-36"></a>                task_fn = cpn.invoke
<a id="__codelineno-5-37" name="__codelineno-5-37" href="#__codelineno-5-37"></a>                i += 1
<a id="__codelineno-5-38" name="__codelineno-5-38" href="#__codelineno-5-38"></a>
<a id="__codelineno-5-39" name="__codelineno-5-39" href="#__codelineno-5-39"></a>        if task_fn is None:
<a id="__codelineno-5-40" name="__codelineno-5-40" href="#__codelineno-5-40"></a>            continue
<a id="__codelineno-5-41" name="__codelineno-5-41" href="#__codelineno-5-41"></a>
<a id="__codelineno-5-42" name="__codelineno-5-42" href="#__codelineno-5-42"></a>        # Execute async if available
<a id="__codelineno-5-43" name="__codelineno-5-43" href="#__codelineno-5-43"></a>        invoke_async = getattr(cpn, &quot;invoke_async&quot;, None)
<a id="__codelineno-5-44" name="__codelineno-5-44" href="#__codelineno-5-44"></a>        if invoke_async and asyncio.iscoroutinefunction(invoke_async):
<a id="__codelineno-5-45" name="__codelineno-5-45" href="#__codelineno-5-45"></a>            tasks.append(loop.run_in_executor(
<a id="__codelineno-5-46" name="__codelineno-5-46" href="#__codelineno-5-46"></a>                self._thread_pool,
<a id="__codelineno-5-47" name="__codelineno-5-47" href="#__codelineno-5-47"></a>                partial(_run_async_in_thread, invoke_async, **(call_kwargs or {}))
<a id="__codelineno-5-48" name="__codelineno-5-48" href="#__codelineno-5-48"></a>            ))
<a id="__codelineno-5-49" name="__codelineno-5-49" href="#__codelineno-5-49"></a>        else:
<a id="__codelineno-5-50" name="__codelineno-5-50" href="#__codelineno-5-50"></a>            tasks.append(loop.run_in_executor(
<a id="__codelineno-5-51" name="__codelineno-5-51" href="#__codelineno-5-51"></a>                self._thread_pool,
<a id="__codelineno-5-52" name="__codelineno-5-52" href="#__codelineno-5-52"></a>                partial(task_fn, **(call_kwargs or {}))
<a id="__codelineno-5-53" name="__codelineno-5-53" href="#__codelineno-5-53"></a>            ))
<a id="__codelineno-5-54" name="__codelineno-5-54" href="#__codelineno-5-54"></a>
<a id="__codelineno-5-55" name="__codelineno-5-55" href="#__codelineno-5-55"></a>    if tasks:
<a id="__codelineno-5-56" name="__codelineno-5-56" href="#__codelineno-5-56"></a>        await asyncio.gather(*tasks)
</code></pre></div>
<strong>Execution Strategy:</strong></p>
<ul>
<li><strong>Thread Pool</strong>: <code>self._thread_pool = ThreadPoolExecutor(max_workers=5)</code> created in <code>Graph.__init__()</code></li>
<li><strong>Concurrency</strong>: All components in batch range <code>&lt;FileRef file-url="https://github.com/infiniflow/ragflow/blob/80a16e71/f, t)</code> execute in parallel via <code>asyncio.gather(*tasks)</code>\n- <strong>Async Support</strong>#LNaN-LNaN" NaN file-path="f, t)<code>execute in parallel via</code>asyncio.gather(*tasks)`\n- <strong>Async Support</strong>"&gt;Hii</li>
</ul>
<h3 id="path-management">Path Management<a class="headerlink" href="#path-management" title="Permanent link">&para;</a></h3>
<p>The execution path dynamically extends based on component logic:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a># After component execution
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>if cpn_obj.component_name.lower() in [&quot;categorize&quot;, &quot;switch&quot;]:
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>    # Conditional branching
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>    _extend_path(cpn_obj.output(&quot;_next&quot;))
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>elif cpn_obj.component_name.lower() in (&quot;iteration&quot;, &quot;loop&quot;):
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>    # Loop entry
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>    _append_path(cpn_obj.get_start())
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>elif cpn_obj.component_name.lower() == &quot;exitloop&quot;:
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>    # Loop exit
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>    _extend_path(self.get_component(cpn[&quot;parent_id&quot;])[&quot;downstream&quot;])
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>else:
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>    # Standard flow
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a>    _extend_path(cpn[&quot;downstream&quot;])
</code></pre></div>
<strong>Sources:</strong> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/canvas.py#L596-L609">agent/canvas.py596-609</a></p>
<hr />
<h2 id="built-in-components-overview">Built-in Components Overview<a class="headerlink" href="#built-in-components-overview" title="Permanent link">&para;</a></h2>
<h3 id="component-registry-and-discovery">Component Registry and Discovery<a class="headerlink" href="#component-registry-and-discovery" title="Permanent link">&para;</a></h3>
<p>Components are auto-discovered and registered via the factory pattern in <code>agent/component/__init__.py</code>:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a># Auto-import all component modules
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>_package_path = os.path.dirname(__file__)
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>__all_classes: Dict[str, Type] = {}
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>def _import_submodules():
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>    &quot;&quot;&quot;Auto-import all .py files in agent/component/&quot;&quot;&quot;
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>    for filename in os.listdir(_package_path):
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>        if filename.startswith(&quot;__&quot;) or not filename.endswith(&quot;.py&quot;):
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>            continue
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>        module_name = filename[:-3]
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>        module = importlib.import_module(f&quot;.{module_name}&quot;, package=__name__)
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a>        _extract_classes_from_module(module)
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a>
<a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a>def component_class(class_name):
<a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a>    &quot;&quot;&quot;Factory function to resolve class by name&quot;&quot;&quot;
<a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a>    for module_name in [&quot;agent.component&quot;, &quot;agent.tools&quot;, &quot;rag.flow&quot;]:
<a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a>        try:
<a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a>            return getattr(importlib.import_module(module_name), class_name)
<a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a>        except Exception:
<a id="__codelineno-7-20" name="__codelineno-7-20" href="#__codelineno-7-20"></a>            pass
<a id="__codelineno-7-21" name="__codelineno-7-21" href="#__codelineno-7-21"></a>    assert False, f&quot;Can&#39;t import {class_name}&quot;
</code></pre></div>
<strong>Sources:</strong> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/component/__init__.py#L22-L58">agent/component/__init__.py22-58</a></p>
<h3 id="component-type-registry">Component Type Registry<a class="headerlink" href="#component-type-registry" title="Permanent link">&para;</a></h3>
<p>The frontend defines the complete operator enumeration in <code>Operator</code> enum:</p>
<table>
<thead>
<tr>
<th>Operator</th>
<th>Category</th>
<th>Description</th>
<th>Node Type</th>
<th>Form Component</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Begin</code></td>
<td>Workflow Control</td>
<td>Entry point with prologue</td>
<td><code>beginNode</code></td>
<td><code>BeginForm</code></td>
</tr>
<tr>
<td><code>Message</code></td>
<td>Dialog</td>
<td>Display message to user</td>
<td><code>messageNode</code></td>
<td><code>MessageForm</code></td>
</tr>
<tr>
<td><code>UserFillUp</code></td>
<td>Dialog</td>
<td>Request user input mid-workflow</td>
<td><code>ragNode</code></td>
<td><code>UserFillUpForm</code></td>
</tr>
<tr>
<td><code>Retrieval</code></td>
<td>Foundation</td>
<td>Knowledge base retrieval</td>
<td><code>retrievalNode</code></td>
<td><code>RetrievalForm</code></td>
</tr>
<tr>
<td><code>Agent</code></td>
<td>Foundation</td>
<td>ReAct agent with tools</td>
<td><code>agentNode</code></td>
<td><code>AgentForm</code></td>
</tr>
<tr>
<td><code>Categorize</code></td>
<td>Flow Control</td>
<td>Intent classification router</td>
<td><code>categorizeNode</code></td>
<td><code>CategorizeForm</code></td>
</tr>
<tr>
<td><code>Switch</code></td>
<td>Flow Control</td>
<td>Conditional branching</td>
<td><code>switchNode</code></td>
<td><code>SwitchForm</code></td>
</tr>
<tr>
<td><code>Iteration</code></td>
<td>Flow Control</td>
<td>Loop over array</td>
<td><code>group</code></td>
<td><code>IterationForm</code></td>
</tr>
<tr>
<td><code>Loop</code></td>
<td>Flow Control</td>
<td>Conditional loop</td>
<td><code>loopNode</code></td>
<td><code>LoopForm</code></td>
</tr>
<tr>
<td><code>ExitLoop</code></td>
<td>Flow Control</td>
<td>Break from loop</td>
<td><code>exitLoopNode</code></td>
<td>N/A</td>
</tr>
<tr>
<td><code>RewriteQuestion</code></td>
<td>LLM</td>
<td>Query reformulation</td>
<td><code>rewriteNode</code></td>
<td><code>RewriteQuestionForm</code></td>
</tr>
<tr>
<td><code>Code</code></td>
<td>Data Manipulation</td>
<td>Execute Python/JS</td>
<td><code>ragNode</code></td>
<td><code>CodeForm</code></td>
</tr>
<tr>
<td><code>StringTransform</code></td>
<td>Data Manipulation</td>
<td>String merge/split</td>
<td><code>ragNode</code></td>
<td><code>StringTransformForm</code></td>
</tr>
<tr>
<td><code>DataOperations</code></td>
<td>Data Manipulation</td>
<td>JSON object operations</td>
<td><code>dataOperationsNode</code></td>
<td><code>DataOperationsForm</code></td>
</tr>
<tr>
<td><code>ListOperations</code></td>
<td>Data Manipulation</td>
<td>Array filtering/sorting</td>
<td><code>listOperationsNode</code></td>
<td><code>ListOperationsForm</code></td>
</tr>
<tr>
<td><code>VariableAssigner</code></td>
<td>Data Manipulation</td>
<td>Variable assignment</td>
<td><code>variableAssignerNode</code></td>
<td><code>VariableAssignerForm</code></td>
</tr>
<tr>
<td><code>VariableAggregator</code></td>
<td>Data Manipulation</td>
<td>Aggregate variables</td>
<td><code>variableAggregatorNode</code></td>
<td><code>VariableAggregatorForm</code></td>
</tr>
<tr>
<td><code>ExeSQL</code></td>
<td>Tools</td>
<td>SQL query execution</td>
<td><code>ragNode</code></td>
<td><code>ExeSQLForm</code></td>
</tr>
<tr>
<td><code>DuckDuckGo</code></td>
<td>Tools</td>
<td>Web search</td>
<td><code>ragNode</code></td>
<td><code>DuckDuckGoForm</code></td>
</tr>
<tr>
<td><code>Wikipedia</code></td>
<td>Tools</td>
<td>Wikipedia search</td>
<td><code>ragNode</code></td>
<td><code>WikipediaForm</code></td>
</tr>
<tr>
<td><code>PubMed</code></td>
<td>Tools</td>
<td>PubMed literature search</td>
<td><code>ragNode</code></td>
<td><code>PubMedForm</code></td>
</tr>
<tr>
<td><code>ArXiv</code></td>
<td>Tools</td>
<td>ArXiv paper search</td>
<td><code>ragNode</code></td>
<td><code>ArXivForm</code></td>
</tr>
<tr>
<td><code>Google</code></td>
<td>Tools</td>
<td>Google search</td>
<td><code>ragNode</code></td>
<td><code>GoogleForm</code></td>
</tr>
<tr>
<td><code>Bing</code></td>
<td>Tools</td>
<td>Bing search</td>
<td><code>ragNode</code></td>
<td><code>BingForm</code></td>
</tr>
<tr>
<td><code>GoogleScholar</code></td>
<td>Tools</td>
<td>Google Scholar search</td>
<td><code>ragNode</code></td>
<td><code>GoogleScholarForm</code></td>
</tr>
<tr>
<td><code>GitHub</code></td>
<td>Tools</td>
<td>GitHub search</td>
<td><code>ragNode</code></td>
<td><code>GithubForm</code></td>
</tr>
<tr>
<td><code>TavilySearch</code></td>
<td>Tools</td>
<td>Tavily AI search</td>
<td><code>ragNode</code></td>
<td><code>TavilyForm</code></td>
</tr>
<tr>
<td><code>TavilyExtract</code></td>
<td>Tools</td>
<td>Tavily content extract</td>
<td><code>ragNode</code></td>
<td><code>TavilyExtractForm</code></td>
</tr>
<tr>
<td><code>SearXNG</code></td>
<td>Tools</td>
<td>SearXNG metasearch</td>
<td><code>ragNode</code></td>
<td><code>SearXNGForm</code></td>
</tr>
<tr>
<td><code>WenCai</code></td>
<td>Tools</td>
<td>WenCai financial data</td>
<td><code>ragNode</code></td>
<td><code>WenCaiForm</code></td>
</tr>
<tr>
<td><code>YahooFinance</code></td>
<td>Tools</td>
<td>Yahoo Finance data</td>
<td><code>ragNode</code></td>
<td><code>YahooFinanceForm</code></td>
</tr>
<tr>
<td><code>Invoke</code></td>
<td>Tools</td>
<td>HTTP request</td>
<td><code>ragNode</code></td>
<td><code>InvokeForm</code></td>
</tr>
<tr>
<td><code>Email</code></td>
<td>Tools</td>
<td>Send email</td>
<td><code>ragNode</code></td>
<td><code>EmailForm</code></td>
</tr>
<tr>
<td><code>Crawler</code></td>
<td>Tools</td>
<td>Web crawler</td>
<td><code>ragNode</code></td>
<td><code>CrawlerForm</code></td>
</tr>
<tr>
<td><code>PDFGenerator</code></td>
<td>Tools</td>
<td>Generate PDF documents</td>
<td><code>ragNode</code></td>
<td><code>PDFGeneratorForm</code></td>
</tr>
<tr>
<td><code>ExcelProcessor</code></td>
<td>Tools</td>
<td>Excel file operations</td>
<td><code>ragNode</code></td>
<td>N/A</td>
</tr>
<tr>
<td><code>Note</code></td>
<td>Utility</td>
<td>Visual notes on canvas</td>
<td><code>noteNode</code></td>
<td>N/A</td>
</tr>
<tr>
<td><code>Tool</code></td>
<td>Utility</td>
<td>Tool placeholder for Agent</td>
<td><code>toolNode</code></td>
<td><code>ToolForm</code></td>
</tr>
<tr>
<td><code>Parser</code></td>
<td>Pipeline</td>
<td>Document parser (DataFlow)</td>
<td><code>parserNode</code></td>
<td><code>ParserForm</code></td>
</tr>
<tr>
<td><code>Tokenizer</code></td>
<td>Pipeline</td>
<td>Text tokenization (DataFlow)</td>
<td><code>tokenizerNode</code></td>
<td><code>TokenizerForm</code></td>
</tr>
<tr>
<td><code>Splitter</code></td>
<td>Pipeline</td>
<td>Text chunking (DataFlow)</td>
<td><code>splitterNode</code></td>
<td><code>SplitterForm</code></td>
</tr>
<tr>
<td><code>HierarchicalMerger</code></td>
<td>Pipeline</td>
<td>Hierarchical merger (DataFlow)</td>
<td><code>splitterNode</code></td>
<td><code>HierarchicalMergerForm</code></td>
</tr>
<tr>
<td><code>Extractor</code></td>
<td>Pipeline</td>
<td>Content extraction (DataFlow)</td>
<td><code>contextNode</code></td>
<td><code>ExtractorForm</code></td>
</tr>
<tr>
<td><code>File</code></td>
<td>Pipeline</td>
<td>File input (DataFlow)</td>
<td><code>fileNode</code></td>
<td>N/A</td>
</tr>
</tbody>
</table>
<p><strong>Component Instantiation Flow:</strong></p>
<ol>
<li><code>Graph.load()</code> calls <code>component_class(cpn["obj"]["component_name"] + "Param")</code> to get param class</li>
<li>Create param instance: <code>param = ParamClass()</code></li>
<li>Update with DSL config: <code>param.update(cpn["obj"]["params"])</code></li>
<li>Validate: <code>param.check()</code> (raises <code>ValueError</code> on validation failure)</li>
<li>Get component class: <code>component_class(cpn["obj"]["component_name"])</code></li>
<li>Instantiate: <code>ComponentClass(canvas, component_id, param)</code></li>
<li>Store in registry: <code>self.components[component_id]["obj"] = instance</code></li>
</ol>
<p><strong>Sources:</strong> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/canvas.py#L91-L103">agent/canvas.py91-103</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/web/src/constants/agent.tsx#L71-L120">web/src/constants/agent.tsx71-120</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/web/src/pages/agent/constant/index.tsx#L52-L67">web/src/pages/agent/constant/index.tsx52-67</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/web/src/pages/agent/form-sheet/form-config-map.tsx#L44-L184">web/src/pages/agent/form-sheet/form-config-map.tsx44-184</a></p>
<hr />
<h2 id="frontend-canvas-ui">Frontend Canvas UI<a class="headerlink" href="#frontend-canvas-ui" title="Permanent link">&para;</a></h2>
<h3 id="reactflow-based-visual-editor">ReactFlow-Based Visual Editor<a class="headerlink" href="#reactflow-based-visual-editor" title="Permanent link">&para;</a></h3>
<p>The agent canvas UI is implemented using ReactFlow in <code>web/src/pages/agent/canvas/index.tsx</code>:</p>
<p><pre class="mermaid"><code>flowchart TD
    AgentCanvas["AgentCanvas Componentweb/src/pages/agent/canvas/index.tsx"]
    ReactFlowCore["ReactFlow Core@xyflow/react"]
    NodeTypes["nodeTypes ObjectMaps Operator → React Component"]
    EdgeTypes["edgeTypes ObjectbuttonEdge custom edge"]
    NodesEdges["nodes/edges StateuseSelectCanvasData()"]
    Handlers["Event Handlers"]
    OnConnect["onConnect → handleConnect"]
    OnNodeClick["onNodeClick → showFormDrawer"]
    OnPaneClick["onPaneClick → hideFormDrawer"]
    OnBeforeDelete["onBeforeDelete → handleBeforeDelete"]
    FormSheet["FormSheet ComponentConfiguration drawer"]
    ChatSheet["ChatSheet ComponentConversation interface"]
    RunSheet["RunSheet ComponentInput parameters"]
    LogSheet["LogSheet ComponentExecution traces"]
    NodeComponents["Node Components"]
    BeginNode["BeginNode"]
    AgentNode["AgentNode"]
    RetrievalNode["RetrievalNode"]
    MessageNode["MessageNode"]
    SwitchNode["SwitchNode"]
    IterationNode["IterationNode (group)"]
    LoopNode["LoopNode"]
    RagNode["RagNode (generic)"]
    Dropdown["NextStepDropdownAdd component menu"]
    AccordionOps["AccordionOperatorsCategorized operator list"]

    AgentCanvas --&gt; ReactFlowCore
    AgentCanvas --&gt; NodeTypes
    AgentCanvas --&gt; EdgeTypes
    AgentCanvas --&gt; NodesEdges
    AgentCanvas --&gt; Handlers
    Handlers --&gt; OnConnect
    Handlers --&gt; OnNodeClick
    Handlers --&gt; OnPaneClick
    Handlers --&gt; OnBeforeDelete
    AgentCanvas --&gt; FormSheet
    AgentCanvas --&gt; ChatSheet
    AgentCanvas --&gt; RunSheet
    AgentCanvas --&gt; LogSheet
    NodeTypes --&gt; NodeComponents
    NodeComponents --&gt; BeginNode
    NodeComponents --&gt; AgentNode
    NodeComponents --&gt; RetrievalNode
    NodeComponents --&gt; MessageNode
    NodeComponents --&gt; SwitchNode
    NodeComponents --&gt; IterationNode
    NodeComponents --&gt; LoopNode
    NodeComponents --&gt; RagNode
    OnConnect --&gt; Dropdown
    Dropdown --&gt; AccordionOps</code></pre>
<strong>Core UI Components:</strong></p>
<table>
<thead>
<tr>
<th>Component</th>
<th>Purpose</th>
<th>File Path</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>AgentCanvas</code></td>
<td>Main canvas container</td>
<td><code>web/src/pages/agent/canvas/index.tsx</code></td>
</tr>
<tr>
<td><code>BeginNode</code></td>
<td>Entry point node</td>
<td><code>web/src/pages/agent/canvas/node/begin-node.tsx</code></td>
</tr>
<tr>
<td><code>AgentNode</code></td>
<td>Agent with tools node</td>
<td><code>web/src/pages/agent/canvas/node/agent-node.tsx</code></td>
</tr>
<tr>
<td><code>RetrievalNode</code></td>
<td>Knowledge base retrieval</td>
<td><code>web/src/pages/agent/canvas/node/retrieval-node.tsx</code></td>
</tr>
<tr>
<td><code>MessageNode</code></td>
<td>Message display</td>
<td><code>web/src/pages/agent/canvas/node/message-node.tsx</code></td>
</tr>
<tr>
<td><code>SwitchNode</code></td>
<td>Conditional branching</td>
<td><code>web/src/pages/agent/canvas/node/switch-node.tsx</code></td>
</tr>
<tr>
<td><code>IterationNode</code></td>
<td>Loop container (group)</td>
<td><code>web/src/pages/agent/canvas/node/iteration-node.tsx</code></td>
</tr>
<tr>
<td><code>LoopNode</code></td>
<td>Conditional loop</td>
<td><code>web/src/pages/agent/canvas/node/loop-node.tsx</code></td>
</tr>
<tr>
<td><code>RagNode</code></td>
<td>Generic node for tools</td>
<td><code>web/src/pages/agent/canvas/node/index.tsx</code></td>
</tr>
<tr>
<td><code>NextStepDropdown</code></td>
<td>Component palette</td>
<td><code>web/src/pages/agent/canvas/node/dropdown/next-step-dropdown.tsx</code></td>
</tr>
<tr>
<td><code>FormSheet</code></td>
<td>Configuration drawer</td>
<td><code>web/src/pages/agent/form-sheet/next.tsx</code></td>
</tr>
</tbody>
</table>
<p><strong>Sources:</strong> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/web/src/pages/agent/canvas/index.tsx#L80-L108">web/src/pages/agent/canvas/index.tsx80-108</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/web/src/pages/agent/canvas/index.tsx#L119-L260">web/src/pages/agent/canvas/index.tsx119-260</a></p>
<h3 id="node-addition-and-connection-system">Node Addition and Connection System<a class="headerlink" href="#node-addition-and-connection-system" title="Permanent link">&para;</a></h3>
<p>The workflow for adding nodes uses placeholder-based connection dragging:</p>
<blockquote>
<p><strong>[Mermaid sequence]</strong>
<em>(图表结构无法解析)</em></p>
</blockquote>
<p><strong>Key Hooks:</strong></p>
<table>
<thead>
<tr>
<th>Hook</th>
<th>Purpose</th>
<th>File Path</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>useAddNode</code></td>
<td>Node creation logic</td>
<td><code>web/src/pages/agent/hooks/use-add-node.ts:353-506</code></td>
</tr>
<tr>
<td><code>useConnectionDrag</code></td>
<td>Connection drag handling</td>
<td><code>web/src/pages/agent/hooks/use-connection-drag.ts</code></td>
</tr>
<tr>
<td><code>usePlaceholderManager</code></td>
<td>Placeholder lifecycle</td>
<td><code>web/src/pages/agent/hooks/use-placeholder-manager.ts</code></td>
</tr>
<tr>
<td><code>useValidateConnection</code></td>
<td>Connection validation</td>
<td><code>web/src/pages/agent/hooks/use-validate-connection.ts</code></td>
</tr>
</tbody>
</table>
<p><strong>Sources:</strong> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/web/src/pages/agent/hooks/use-add-node.ts#L353-L506">web/src/pages/agent/hooks/use-add-node.ts353-506</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/web/src/pages/agent/canvas/node/dropdown/next-step-dropdown.tsx#L17-L117">web/src/pages/agent/canvas/node/dropdown/next-step-dropdown.tsx17-117</a></p>
<h3 id="form-configuration-system">Form Configuration System<a class="headerlink" href="#form-configuration-system" title="Permanent link">&para;</a></h3>
<p>Each operator has a dedicated form component mapped in <code>FormConfigMap</code>:</p>
<p><pre class="mermaid"><code>flowchart TD
    FormSheet["FormSheetMain drawer container"]
    FormConfigMap["FormConfigMapOperator → Form Component"]
    Forms["Form Components"]
    BeginForm["BeginFormMode, prologue, inputs"]
    AgentForm["AgentFormLLM, tools, prompts"]
    RetrievalForm["RetrievalFormKB selection, parameters"]
    ExeSQLForm["ExeSQLFormDB config, SQL query"]
    SwitchForm["SwitchFormConditions, branches"]
    FormHooks["Form Hooks"]
    UseFormValues["useFormValues()Load from node.data.form"]
    UseWatchFormChange["useWatchFormChange()Auto-save to store"]
    Store["useGraphStoreZustand store"]
    UpdateNode["updateNode(nodeId, data)"]

    FormSheet --&gt; FormConfigMap
    FormConfigMap --&gt; Forms
    Forms --&gt; BeginForm
    Forms --&gt; AgentForm
    Forms --&gt; RetrievalForm
    Forms --&gt; ExeSQLForm
    Forms --&gt; SwitchForm
    FormSheet --&gt; FormHooks
    FormHooks --&gt; UseFormValues
    FormHooks --&gt; UseWatchFormChange
    UseWatchFormChange --&gt; Store
    Store --&gt; UpdateNode</code></pre>
<strong>Form System Flow:</strong></p>
<ol>
<li>User clicks node → <code>onNodeClick()</code> → <code>setClickedNodeId()</code> → <code>showFormDrawer()</code></li>
<li><code>FormSheet</code> renders, looks up operator type in <code>FormConfigMap</code></li>
<li>Form component loads via <code>useFormValues(initialValues, node)</code> → reads <code>node.data.form</code></li>
<li>Form renders with <code>react-hook-form</code> + <code>zod</code> validation</li>
<li>User edits → <code>useWatchFormChange()</code> watches all fields</li>
<li>On change → debounced <code>updateNode(nodeId, { form: values })</code> → Zustand store</li>
<li>Store update → Canvas re-renders → Node displays updated data</li>
</ol>
<p><strong>Sources:</strong> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/web/src/pages/agent/form-sheet/form-config-map.tsx#L1-L184">web/src/pages/agent/form-sheet/form-config-map.tsx1-184</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/web/src/pages/agent/hooks/use-form-values.ts">web/src/pages/agent/hooks/use-form-values.ts</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/web/src/pages/agent/hooks/use-watch-form-change.ts">web/src/pages/agent/hooks/use-watch-form-change.ts</a></p>
<h3 id="operator-palette-organization">Operator Palette Organization<a class="headerlink" href="#operator-palette-organization" title="Permanent link">&para;</a></h3>
<p>The NextStepDropdown organizes operators into categories:</p>
<p><pre class="mermaid"><code>flowchart TD
    Dropdown["NextStepDropdown"]
    Accordion["Accordion ComponentCollapsible sections"]
    Foundation["FoundationAgent, Retrieval"]
    Dialog["DialogMessage, UserFillUp"]
    Flow["FlowSwitch, Iteration, Loop, Categorize"]
    DataManip["Data ManipulationCode, StringTransform, DataOperations"]
    Tools["ToolsExeSQL, Google, DuckDuckGo, Email, etc."]
    OperatorList["OperatorItemListRenders operator buttons"]
    HandleClick["handleClick(operator)Calls addCanvasNode()"]

    Dropdown --&gt; Accordion
    Accordion --&gt; Foundation
    Accordion --&gt; Dialog
    Accordion --&gt; Flow
    Accordion --&gt; DataManip
    Accordion --&gt; Tools
    Foundation --&gt; OperatorList
    Dialog --&gt; OperatorList
    Flow --&gt; OperatorList
    DataManip --&gt; OperatorList
    Tools --&gt; OperatorList
    OperatorList --&gt; HandleClick</code></pre>
<strong>Operator Categories:</strong></p>
<ol>
<li><strong>Foundation</strong>: <code>Agent</code>, <code>Retrieval</code></li>
<li><strong>Dialog</strong>: <code>Message</code>, <code>UserFillUp</code></li>
<li><strong>Flow</strong>: <code>Switch</code>, <code>Iteration</code>, <code>Loop</code>, <code>ExitLoop</code>, <code>Categorize</code></li>
<li><strong>Data Manipulation</strong>: <code>Code</code>, <code>StringTransform</code>, <code>DataOperations</code>, <code>VariableAssigner</code>, <code>ListOperations</code>, <code>VariableAggregator</code></li>
<li><strong>Tools</strong>: <code>TavilySearch</code>, <code>TavilyExtract</code>, <code>ExeSQL</code>, <code>Google</code>, <code>YahooFinance</code>, <code>Email</code>, <code>DuckDuckGo</code>, <code>Wikipedia</code>, <code>GoogleScholar</code>, <code>ArXiv</code>, <code>PubMed</code>, <code>GitHub</code>, <code>Invoke</code>, <code>WenCai</code>, <code>SearXNG</code>, <code>PDFGenerator</code></li>
</ol>
<p><strong>Pipeline-Specific Categories (DataFlow mode):</strong></p>
<ul>
<li><strong>Processors</strong>: <code>Parser</code>, <code>Tokenizer</code>, <code>Extractor</code></li>
<li><strong>Chunker</strong>: <code>Splitter</code>, <code>HierarchicalMerger</code></li>
</ul>
<p><strong>Sources:</strong> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/web/src/pages/agent/canvas/node/dropdown/accordion-operators.tsx#L29-L133">web/src/pages/agent/canvas/node/dropdown/accordion-operators.tsx29-133</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/web/src/pages/agent/canvas/node/dropdown/accordion-operators.tsx#L156-L222">web/src/pages/agent/canvas/node/dropdown/accordion-operators.tsx156-222</a></p>
<hr />
<h2 id="agent-component-and-react-loop">Agent Component and ReAct Loop<a class="headerlink" href="#agent-component-and-react-loop" title="Permanent link">&para;</a></h2>
<h3 id="agent-architecture">Agent Architecture<a class="headerlink" href="#agent-architecture" title="Permanent link">&para;</a></h3>
<p>The <code>Agent</code> component implements ReAct (Reasoning + Acting) for tool orchestration:</p>
<p><pre class="mermaid"><code>flowchart TD
    AgentInit["Agent.init()Load tools and MCP servers"]
    ToolRegistry["self.tools = {}Indexed tool objects"]
    ToolMeta["self.tool_meta = []OpenAI function schemas"]
    Invoke["Agent._invoke_async(**kwargs)"]
    PreparePrompt["_prepare_prompt_variables()Build system prompt + messages"]
    CheckDownstream["Downstream isMessage component?"]
    StreamPath["Set output as partial()Stream with tools"]
    BlockPath["Execute blocking_react_with_tools_streamly_async_simple()"]
    ReactLoop["ReAct Loop(max 5 rounds)"]
    AnalyzeTask["analyze_task_async()Understand goal + tools"]
    NextStep["next_step_async()LLM plans tool calls"]
    ParseJSON["json_repair.loads()Extract tool calls"]
    ToolCall["Execute tools concurrentlytoolcall_session.tool_call_async()"]
    Callback["Canvas.tool_use_callback()Log to Redis"]
    Reflect["Build observationAppend to history"]
    Complete["complete_tasktool called?"]
    FinalAnswer["Generate final responsewith optional citations"]

    AgentInit --&gt; ToolRegistry
    ToolRegistry --&gt; ToolMeta
    Invoke --&gt; PreparePrompt
    PreparePrompt --&gt; CheckDownstream
    CheckDownstream --&gt; StreamPath
    CheckDownstream --&gt; BlockPath
    StreamPath --&gt; ReactLoop
    BlockPath --&gt; ReactLoop
    ReactLoop --&gt; AnalyzeTask
    AnalyzeTask --&gt; NextStep
    NextStep --&gt; ParseJSON
    ParseJSON --&gt; ToolCall
    ToolCall --&gt; Callback
    Callback --&gt; Reflect
    Reflect --&gt; Complete
    Complete --&gt; NextStep
    Complete --&gt; FinalAnswer</code></pre>
<strong>Sources:</strong> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/component/agent_with_tools.py#L81-L251">agent/component/agent_with_tools.py81-251</a></p>
<h3 id="tool-loading-and-mcp-integration">Tool Loading and MCP Integration<a class="headerlink" href="#tool-loading-and-mcp-integration" title="Permanent link">&para;</a></h3>
<p>The <code>Agent</code> component loads tools from two sources: component-based tools and MCP (Model Context Protocol) servers:</p>
<p><pre class="mermaid"><code>flowchart TD
    AgentInit["Agent.init(canvas, id, param)"]
    LoadComponentTools["For idx, cpn in param.tools:Load component-based tools"]
    LoadToolObj["_load_tool_obj(cpn)→ component_class(name)(canvas, cpn_id, param)"]
    IndexName["indexed_name = f'{original_name}_{idx}'"]
    StoreComponent["self.tools[indexed_name] = cpn_obj"]
    BuildComponentMeta["indexed_meta = deepcopy(original_meta)indexed_meta['function']['name'] = indexed_nameself.tool_meta.append(indexed_meta)"]
    LoadMCPTools["For mcp in param.mcp:Load MCP server tools"]
    GetMCPServer["MCPServerService.get_by_id(mcp['mcp_id'])"]
    CreateSession["tool_call_session = MCPToolCallSession(mcp_server, variables)"]
    StoreMCP["For tnm, meta in mcp['tools'].items():self.tool_meta.append(mcp_tool_metadata_to_openai_tool(meta))self.tools[tnm] = tool_call_session"]
    CreateCallback["self.callback = partial(canvas.tool_use_callback, id)"]
    CreateLLMSession["self.toolcall_session = LLMToolPluginCallSession(self.tools, self.callback)"]

    AgentInit --&gt; LoadComponentTools
    LoadComponentTools --&gt; LoadToolObj
    LoadToolObj --&gt; IndexName
    IndexName --&gt; StoreComponent
    StoreComponent --&gt; BuildComponentMeta
    AgentInit --&gt; LoadMCPTools
    LoadMCPTools --&gt; GetMCPServer
    GetMCPServer --&gt; CreateSession
    CreateSession --&gt; StoreMCP
    AgentInit --&gt; CreateCallback
    CreateCallback --&gt; CreateLLMSession</code></pre>
<strong>Component-Based Tools:</strong></p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>def _load_tool_obj(self, cpn: dict) -&gt; object:
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>    &quot;&quot;&quot;Load tool from component definition&quot;&quot;&quot;
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>    tool_name = cpn[&quot;component_name&quot;]
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>    param = component_class(tool_name + &quot;Param&quot;)()
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>    param.update(cpn[&quot;params&quot;])
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>    param.check()
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>    # Create nested component ID: agent_id--&gt;tool_name
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>    cpn_id = f&quot;{self._id}--&gt;&quot; + cpn.get(&quot;name&quot;, &quot;&quot;).replace(&quot; &quot;, &quot;_&quot;)
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>    return component_class(cpn[&quot;component_name&quot;])(self._canvas, cpn_id, param)
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a>
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a># Example: Retrieval tool
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a>self.tools[&quot;retrieval_0&quot;] = Retrieval(canvas, &quot;agent_0--&gt;retrieval_0&quot;, param)
</code></pre></div>
<strong>MCP (Model Context Protocol) Tools:</strong></p>
<p>MCP servers provide external tools via standardized protocol:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a># Load MCP server configuration
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>_, mcp_server = MCPServerService.get_by_id(mcp[&quot;mcp_id&quot;])
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a># mcp_server.command: e.g., &quot;npx -y @modelcontextprotocol/server-github&quot;
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a># mcp_server.variables: JSON dict of env vars
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a># Create MCP session
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>tool_call_session = MCPToolCallSession(mcp_server, mcp_server.variables)
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a># Register each tool from MCP server
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>for tnm, meta in mcp[&quot;tools&quot;].items():
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>    # Convert MCP metadata to OpenAI format
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>    self.tool_meta.append(mcp_tool_metadata_to_openai_tool(meta))
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a>    # Store session (multiple tools share same session)
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a>    self.tools[tnm] = tool_call_session
</code></pre></div>
<strong>MCP Server Types:</strong></p>
<ul>
<li><strong>GitHub MCP</strong>: <code>@modelcontextprotocol/server-github</code> - Repository operations</li>
<li><strong>Filesystem MCP</strong>: <code>@modelcontextprotocol/server-filesystem</code> - File system access</li>
<li><strong>Custom MCP</strong>: User-defined servers following MCP protocol</li>
</ul>
<p><strong>Tool Invocation Routing:</strong></p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a># In LLMToolPluginCallSession.tool_call_async()
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>async def tool_call_async(self, name: str, arguments: dict) -&gt; Any:
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>    tool_obj = self.tools_map[name]
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>    if isinstance(tool_obj, MCPToolCallSession):
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>        # MCP tool: Call via MCP protocol with timeout
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a>        resp = await asyncio.to_thread(tool_obj.tool_call, name, arguments, 60)
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>    else:
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>        # Component tool: Direct invocation
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a>        if hasattr(tool_obj, &quot;invoke_async&quot;) and asyncio.iscoroutinefunction(tool_obj.invoke_async):
<a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a>            resp = await tool_obj.invoke_async(**arguments)
<a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a>        else:
<a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a>            resp = await asyncio.to_thread(tool_obj.invoke, **arguments)
<a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a>
<a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a>    # Log to Redis
<a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a>    self.callback(name, arguments, resp, elapsed_time=timer()-st)
<a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a>    return resp
</code></pre></div>
<strong>Sources:</strong> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/component/agent_with_tools.py#L84-L128">agent/component/agent_with_tools.py84-128</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/tools/base.py#L46-L70">agent/tools/base.py46-70</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/common/mcp_tool_call_conn.py#L1-L100">common/mcp_tool_call_conn.py1-100</a> (referenced for MCP integration)</p>
<h3 id="react-loop-implementation">ReAct Loop Implementation<a class="headerlink" href="#react-loop-implementation" title="Permanent link">&para;</a></h3>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>async def _react_with_tools_streamly_async_simple(self, prompt, history, use_tools, user_defined_prompt, schema_prompt=&quot;&quot;):
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>    hist = deepcopy(history)
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>    # Optimize multi-turn conversations
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>    if len(hist) &gt; 3:
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>        user_request = await full_question(messages=history, chat_mdl=self.chat_mdl)
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a>    else:
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a>        user_request = history[-1][&quot;content&quot;]
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a>
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a>    # Build task description
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a>    task_desc = build_task_desc(prompt, user_request, user_defined_prompt)
<a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a>    self.callback(&quot;analyze_task&quot;, {}, task_desc, elapsed_time=...)
<a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a>
<a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a>    # ReAct loop (max 5 rounds)
<a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a>    for _ in range(self._param.max_rounds + 1):
<a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a>        # Step 1: Plan next action
<a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a>        response, tk = await next_step_async(self.chat_mdl, hist, tool_metas, task_desc, user_defined_prompt)
<a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a>        hist.append({&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: response})
<a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a>
<a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a>        # Step 2: Parse tool calls
<a id="__codelineno-11-21" name="__codelineno-11-21" href="#__codelineno-11-21"></a>        functions = json_repair.loads(re.sub(r&quot;```.*&quot;, &quot;&quot;, response))
<a id="__codelineno-11-22" name="__codelineno-11-22" href="#__codelineno-11-22"></a>
<a id="__codelineno-11-23" name="__codelineno-11-23" href="#__codelineno-11-23"></a>        # Step 3: Execute tools concurrently
<a id="__codelineno-11-24" name="__codelineno-11-24" href="#__codelineno-11-24"></a>        tool_tasks = []
<a id="__codelineno-11-25" name="__codelineno-11-25" href="#__codelineno-11-25"></a>        for func in functions:
<a id="__codelineno-11-26" name="__codelineno-11-26" href="#__codelineno-11-26"></a>            name = func[&quot;name&quot;]
<a id="__codelineno-11-27" name="__codelineno-11-27" href="#__codelineno-11-27"></a>            args = func[&quot;arguments&quot;]
<a id="__codelineno-11-28" name="__codelineno-11-28" href="#__codelineno-11-28"></a>
<a id="__codelineno-11-29" name="__codelineno-11-29" href="#__codelineno-11-29"></a>            if name == COMPLETE_TASK:
<a id="__codelineno-11-30" name="__codelineno-11-30" href="#__codelineno-11-30"></a>                # Generate final answer
<a id="__codelineno-11-31" name="__codelineno-11-31" href="#__codelineno-11-31"></a>                async for txt, tkcnt in complete():
<a id="__codelineno-11-32" name="__codelineno-11-32" href="#__codelineno-11-32"></a>                    yield txt, tkcnt
<a id="__codelineno-11-33" name="__codelineno-11-33" href="#__codelineno-11-33"></a>                return
<a id="__codelineno-11-34" name="__codelineno-11-34" href="#__codelineno-11-34"></a>
<a id="__codelineno-11-35" name="__codelineno-11-35" href="#__codelineno-11-35"></a>            tool_tasks.append(asyncio.create_task(use_tool_async(name, args)))
<a id="__codelineno-11-36" name="__codelineno-11-36" href="#__codelineno-11-36"></a>
<a id="__codelineno-11-37" name="__codelineno-11-37" href="#__codelineno-11-37"></a>        results = await asyncio.gather(*tool_tasks) if tool_tasks else []
<a id="__codelineno-11-38" name="__codelineno-11-38" href="#__codelineno-11-38"></a>
<a id="__codelineno-11-39" name="__codelineno-11-39" href="#__codelineno-11-39"></a>        # Step 4: Build observation and continue
<a id="__codelineno-11-40" name="__codelineno-11-40" href="#__codelineno-11-40"></a>        reflection = build_observation(results)
<a id="__codelineno-11-41" name="__codelineno-11-41" href="#__codelineno-11-41"></a>        append_user_content(hist, reflection)
<a id="__codelineno-11-42" name="__codelineno-11-42" href="#__codelineno-11-42"></a>        self.callback(&quot;reflection&quot;, {}, str(reflection), elapsed_time=...)
<a id="__codelineno-11-43" name="__codelineno-11-43" href="#__codelineno-11-43"></a>
<a id="__codelineno-11-44" name="__codelineno-11-44" href="#__codelineno-11-44"></a>    # Max rounds exceeded - force completion
<a id="__codelineno-11-45" name="__codelineno-11-45" href="#__codelineno-11-45"></a>    final_instruction = &quot;Provide comprehensive final answer based on gathered information...&quot;
<a id="__codelineno-11-46" name="__codelineno-11-46" href="#__codelineno-11-46"></a>    append_user_content(hist, final_instruction)
<a id="__codelineno-11-47" name="__codelineno-11-47" href="#__codelineno-11-47"></a>    async for txt, tkcnt in complete():
<a id="__codelineno-11-48" name="__codelineno-11-48" href="#__codelineno-11-48"></a>        yield txt, tkcnt
</code></pre></div>
<strong>Key Prompts:</strong></p>
<ul>
<li><code>analyze_task_async()</code> - Understands goal and available tools</li>
<li><code>next_step_async()</code> - Plans which tool(s) to call next</li>
<li><code>build_observation()</code> - Formats tool results for reflection</li>
<li><code>COMPLETE_TASK</code> - Special function name signaling workflow completion</li>
</ul>
<p><strong>Sources:</strong> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/component/agent_with_tools.py#L275-L433">agent/component/agent_with_tools.py275-433</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/rag/prompts/generator.py#L360-L397">rag/prompts/generator.py360-397</a></p>
<h3 id="tool-system-architecture">Tool System Architecture<a class="headerlink" href="#tool-system-architecture" title="Permanent link">&para;</a></h3>
<p>Tools extend from <code>ToolBase</code> (which extends <code>ComponentBase</code>) and expose metadata in OpenAI function calling format:</p>
<p><pre class="mermaid"><code>flowchart TD
    ToolParamBase["ToolParamBase"]
    ToolBase["ToolBase"]
    ComponentBase["ComponentBase"]
    ComponentParamBase["ComponentParamBase"]
    MetaAttr["self.meta: ToolMeta{name, description, parameters}"]
    InitInputs["_init_inputs()self.inputs from meta['parameters']"]
    InitAttrs["_init_attr_by_meta()setattr for each parameter"]
    GetMeta["get_meta() → OpenAI function schema"]
    Invoke["invoke(**kwargs)Call _invoke with error handling"]
    InvokeAsync["invoke_async(**kwargs)Async wrapper"]
    RetrieveChunks["_retrieve_chunks(res_list, ...)Format results as chunksCall canvas.add_reference()"]
    LLMToolSession["LLMToolPluginCallSession"]
    ToolsMap["self.tools_map:Dict[str, ComponentBase | MCPToolCallSession]"]
    ToolCall["tool_call(name, arguments)→ asyncio.run(tool_call_async)"]
    ToolCallAsync["tool_call_async(name, arguments)→ tool_obj.invoke_async or tool_obj.invoke"]
    Callback["self.callback(name, arguments, resp, elapsed_time)→ canvas.tool_use_callback()"]

    ToolParamBase --&gt; ComponentParamBase
    ToolBase --&gt; ComponentBase
    ToolParamBase --&gt; MetaAttr
    ToolParamBase --&gt; InitInputs
    ToolParamBase --&gt; InitAttrs
    ToolParamBase --&gt; GetMeta
    ToolBase --&gt; Invoke
    ToolBase --&gt; InvokeAsync
    ToolBase --&gt; RetrieveChunks
    LLMToolSession --&gt; ToolsMap
    LLMToolSession --&gt; ToolCall
    LLMToolSession --&gt; ToolCallAsync
    ToolCallAsync --&gt; Callback</code></pre>
<strong>Tool Metadata Structure (ToolMeta TypedDict):</strong></p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>class ToolMeta(TypedDict):
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>    name: str                      # Tool function name
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>    displayName: str               # UI display name
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>    description: str               # Tool purpose description
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>    displayDescription: str        # UI description
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>    parameters: dict[str, ToolParameter]  # Parameter schemas
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a>class ToolParameter(TypedDict):
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a>    type: str                      # &quot;string&quot;, &quot;number&quot;, &quot;boolean&quot;, &quot;object&quot;, &quot;array&quot;
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a>    description: str               # Parameter description
<a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a>    displayDescription: str        # UI description
<a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a>    enum: List[str]                # Allowed values (optional)
<a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a>    required: bool                 # Is required
</code></pre></div>
<strong>OpenAI Function Schema Format:</strong></p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a># Output of ToolParamBase.get_meta()
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>{
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>    &quot;type&quot;: &quot;function&quot;,
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>    &quot;function&quot;: {
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>        &quot;name&quot;: &quot;exesql&quot;,  # From self.meta[&quot;name&quot;] or self.function_name
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>        &quot;description&quot;: &quot;Execute SQL query against database&quot;,
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>        &quot;parameters&quot;: {
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>            &quot;type&quot;: &quot;object&quot;,
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a>            &quot;properties&quot;: {
<a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a>                &quot;sql&quot;: {
<a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a>                    &quot;type&quot;: &quot;string&quot;,
<a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a>                    &quot;description&quot;: &quot;SQL query to execute&quot;
<a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a>                }
<a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a>            },
<a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a>            &quot;required&quot;: [&quot;sql&quot;]
<a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a>        }
<a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a>    }
<a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a>}
</code></pre></div>
<strong>Tool Execution Flow:</strong></p>
<ol>
<li><strong>Agent Preparation</strong>: <code>Agent.__init__()</code> loads tools from <code>self._param.tools</code> and <code>self._param.mcp</code></li>
<li><strong>Indexing</strong>: Tools stored in <code>self.tools</code> dict with indexed names (e.g., <code>retrieval_0</code>, <code>retrieval_1</code>)</li>
<li><strong>Session Creation</strong>: <code>LLMToolPluginCallSession(self.tools, self.callback)</code> wraps tool execution</li>
<li><strong>LLM Planning</strong>: <code>next_step_async()</code> returns JSON tool call list</li>
<li><strong>Concurrent Execution</strong>: <code>asyncio.gather(*[use_tool_async(name, args) for ...])</code></li>
<li><strong>Invocation</strong>: <code>tool_call_async(name, args)</code> calls <code>tool_obj.invoke_async()</code> or <code>tool_obj.invoke()</code></li>
<li><strong>Callback Logging</strong>: <code>self.callback(name, args, result, elapsed_time)</code> logs to Redis</li>
<li><strong>Result Formatting</strong>: <code>_retrieve_chunks()</code> for search tools, formats as knowledge base chunks</li>
</ol>
<p><strong>Sources:</strong> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/tools/base.py#L29-L68">agent/tools/base.py29-68</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/tools/base.py#L73-L119">agent/tools/base.py73-119</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/tools/base.py#L122-L211">agent/tools/base.py122-211</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/component/agent_with_tools.py#L84-L113">agent/component/agent_with_tools.py84-113</a></p>
<hr />
<h2 id="llm-component">LLM Component<a class="headerlink" href="#llm-component" title="Permanent link">&para;</a></h2>
<h3 id="basic-llm-invocation">Basic LLM Invocation<a class="headerlink" href="#basic-llm-invocation" title="Permanent link">&para;</a></h3>
<p>The <code>LLM</code> component provides basic language model interaction:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>class LLM(ComponentBase):
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>    component_name = &quot;LLM&quot;
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>    def __init__(self, canvas, component_id, param: ComponentParamBase):
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>        super().__init__(canvas, component_id, param)
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>        self.chat_mdl = LLMBundle(
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>            self._canvas.get_tenant_id(),
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>            TenantLLMService.llm_id2llm_type(self._param.llm_id),
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a>            self._param.llm_id,
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a>            max_retries=self._param.max_retries,
<a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a>            retry_interval=self._param.delay_after_error
<a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a>        )
<a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a>        self.imgs = []
</code></pre></div>
<strong>Sources:</strong> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/component/llm.py#L82-L91">agent/component/llm.py82-91</a></p>
<h3 id="prompt-preparation">Prompt Preparation<a class="headerlink" href="#prompt-preparation" title="Permanent link">&para;</a></h3>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>def _prepare_prompt_variables(self):
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>    # Handle visual files
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>    if self._param.visual_files_var:
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>        self.imgs = self._canvas.get_variable_value(self._param.visual_files_var)
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>        self.imgs = [img for img in self.imgs if img[:len(&quot;data:image/&quot;)] == &quot;data:image/&quot;]
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>    # Resolve all input variables
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>    args = {}
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a>    vars = self.get_input_elements() if not self._param.debug_inputs else self._param.debug_inputs
<a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a>    for k, o in vars.items():
<a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a>        args[k] = o[&quot;value&quot;]
<a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a>        if not isinstance(args[k], str):
<a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a>            args[k] = json.dumps(args[k], ensure_ascii=False)
<a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a>        self.set_input_value(k, args[k])
<a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a>
<a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a>    # Build message history with system prompt
<a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a>    msg, sys_prompt = self._sys_prompt_and_msg(
<a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a>        self._canvas.get_history(self._param.message_history_window_size)[:-1],
<a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a>        args
<a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a>    )
<a id="__codelineno-15-21" name="__codelineno-15-21" href="#__codelineno-15-21"></a>
<a id="__codelineno-15-22" name="__codelineno-15-22" href="#__codelineno-15-22"></a>    # Extract user-defined prompts
<a id="__codelineno-15-23" name="__codelineno-15-23" href="#__codelineno-15-23"></a>    user_defined_prompt, sys_prompt = self._extract_prompts(sys_prompt)
<a id="__codelineno-15-24" name="__codelineno-15-24" href="#__codelineno-15-24"></a>
<a id="__codelineno-15-25" name="__codelineno-15-25" href="#__codelineno-15-25"></a>    # Add citation prompt if needed
<a id="__codelineno-15-26" name="__codelineno-15-26" href="#__codelineno-15-26"></a>    if self._param.cite and self._canvas.get_reference()[&quot;chunks&quot;]:
<a id="__codelineno-15-27" name="__codelineno-15-27" href="#__codelineno-15-27"></a>        sys_prompt += citation_prompt(user_defined_prompt)
<a id="__codelineno-15-28" name="__codelineno-15-28" href="#__codelineno-15-28"></a>
<a id="__codelineno-15-29" name="__codelineno-15-29" href="#__codelineno-15-29"></a>    return sys_prompt, msg, user_defined_prompt
</code></pre></div>
<strong>Sources:</strong> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/component/llm.py#L128-L157">agent/component/llm.py128-157</a></p>
<h3 id="streaming-vs-blocking-execution">Streaming vs Blocking Execution<a class="headerlink" href="#streaming-vs-blocking-execution" title="Permanent link">&para;</a></h3>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>async def _invoke_async(self, **kwargs):
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>    prompt, msg, _ = self._prepare_prompt_variables()
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>    # Check if downstream is Message component
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>    downstreams = self._canvas.get_component(self._id)[&quot;downstream&quot;]
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>    ex = self.exception_handler()
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a>    if any([self._canvas.get_component_obj(cid).component_name.lower() == &quot;message&quot;
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a>            for cid in downstreams]) and not (ex and ex[&quot;goto&quot;]):
<a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a>        # Stream output
<a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a>        self.set_output(&quot;content&quot;, partial(self._stream_output_async, prompt, deepcopy(msg)))
<a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a>        return
<a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a>
<a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a>    # Blocking execution
<a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a>    _, msg_fit = message_fit_in(
<a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a>        [{&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: prompt}, *deepcopy(msg)],
<a id="__codelineno-16-17" name="__codelineno-16-17" href="#__codelineno-16-17"></a>        int(self.chat_mdl.max_length * 0.97)
<a id="__codelineno-16-18" name="__codelineno-16-18" href="#__codelineno-16-18"></a>    )
<a id="__codelineno-16-19" name="__codelineno-16-19" href="#__codelineno-16-19"></a>    ans = await self._generate_async(msg_fit)
<a id="__codelineno-16-20" name="__codelineno-16-20" href="#__codelineno-16-20"></a>    self.set_output(&quot;content&quot;, ans)
</code></pre></div>
<strong>Streaming Logic:</strong> If downstream component is <code>Message</code>, output is a <code>partial</code> generator that streams tokens</p>
<p><strong>Sources:</strong> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/component/llm.py#L263-L342">agent/component/llm.py263-342</a></p>
<h3 id="structured-output">Structured Output<a class="headerlink" href="#structured-output" title="Permanent link">&para;</a></h3>
<p>LLM components support JSON schema-constrained generation:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>output_structure = self._param.outputs[&quot;structured&quot;]
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>if output_structure and isinstance(output_structure, dict) and output_structure.get(&quot;properties&quot;):
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>    schema = json.dumps(output_structure, ensure_ascii=False, indent=2)
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>    prompt_with_schema = prompt + structured_output_prompt(schema)
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>    for _ in range(self._param.max_retries + 1):
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a>        ans = await self._generate_async(msg_fit)
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a>        try:
<a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a>            self.set_output(&quot;structured&quot;, json_repair.loads(clean_formated_answer(ans)))
<a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a>            return
<a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a>        except Exception:
<a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a>            msg_fit.append({&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;The answer can&#39;t not be parsed as JSON&quot;})
</code></pre></div>
<strong>Sources:</strong> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/component/llm.py#L276-L306">agent/component/llm.py276-306</a></p>
<hr />
<h2 id="categorize-component">Categorize Component<a class="headerlink" href="#categorize-component" title="Permanent link">&para;</a></h2>
<p>The <code>Categorize</code> component performs intent classification and routing:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>class Categorize(LLM):
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>    component_name = &quot;Categorize&quot;
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>    def __init__(self):
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a>        self.category_description = {
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a>            &quot;Category1&quot;: {
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a>                &quot;description&quot;: &quot;Description of when to use this category&quot;,
<a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a>                &quot;examples&quot;: [&quot;Example query 1&quot;, &quot;Example query 2&quot;],
<a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a>                &quot;to&quot;: [&quot;component_id_1&quot;, &quot;component_id_2&quot;]  # Downstream components
<a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a>            },
<a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a>            &quot;Category2&quot;: {
<a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a>                &quot;description&quot;: &quot;...&quot;,
<a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a>                &quot;examples&quot;: [...],
<a id="__codelineno-18-14" name="__codelineno-18-14" href="#__codelineno-18-14"></a>                &quot;to&quot;: [...]
<a id="__codelineno-18-15" name="__codelineno-18-15" href="#__codelineno-18-15"></a>            }
<a id="__codelineno-18-16" name="__codelineno-18-16" href="#__codelineno-18-16"></a>        }
</code></pre></div>
<strong>Prompt Generation:</strong></p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>def update_prompt(self):
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>    self.sys_prompt = &quot;&quot;&quot;
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>You are an advanced classification system that categorizes user questions into specific types.
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a>Analyze the input question and classify it into ONE of the following categories:
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a>{}
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a>
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a>Here&#39;s description of each category:
<a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a> - {}
<a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a>
<a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a>---- Instructions ----
<a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a> - Consider both explicit mentions and implied context
<a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a> - Prioritize the most specific applicable category
<a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a> - Return only the category name without explanations
<a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a> - Use &quot;Other&quot; only when no other category fits
<a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a>&quot;&quot;&quot;.format(
<a id="__codelineno-19-16" name="__codelineno-19-16" href="#__codelineno-19-16"></a>        &quot;\n - &quot;.join(list(self.category_description.keys())),
<a id="__codelineno-19-17" name="__codelineno-19-17" href="#__codelineno-19-17"></a>        &quot;\n&quot;.join(descriptions)
<a id="__codelineno-19-18" name="__codelineno-19-18" href="#__codelineno-19-18"></a>    )
</code></pre></div>
<strong>Execution:</strong></p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>async def _invoke_async(self, **kwargs):
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>    msg = self._canvas.get_history(self._param.message_history_window_size)
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>    ans = await chat_mdl.async_chat(self._param.sys_prompt, msg, self._param.gen_conf())
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a>
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a>    # Count category mentions in response
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a>    category_counts = {}
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a>    for c in self._param.category_description.keys():
<a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a>        category_counts[c] = ans.lower().count(c.lower())
<a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a>
<a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a>    # Select category with highest count
<a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a>    max_category = max(category_counts.items(), key=lambda x: x[1])[0]
<a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a>    cpn_ids = self._param.category_description[max_category][&quot;to&quot;]
<a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a>
<a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a>    # Set next components in path
<a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a>    self.set_output(&quot;category_name&quot;, max_category)
<a id="__codelineno-20-16" name="__codelineno-20-16" href="#__codelineno-20-16"></a>    self.set_output(&quot;_next&quot;, cpn_ids)
</code></pre></div>
<strong>Sources:</strong> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/component/categorize.py#L29-L154">agent/component/categorize.py29-154</a></p>
<hr />
<h2 id="canvas-api-endpoints">Canvas API Endpoints<a class="headerlink" href="#canvas-api-endpoints" title="Permanent link">&para;</a></h2>
<h3 id="completion-endpoint">Completion Endpoint<a class="headerlink" href="#completion-endpoint" title="Permanent link">&para;</a></h3>
<p><strong>Route:</strong> <code>POST /canvas/completion</code></p>
<p><strong>Request:</strong></p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>{
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>  &quot;id&quot;: &quot;canvas-id&quot;,
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>  &quot;query&quot;: &quot;User question&quot;,
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a>  &quot;files&quot;: [{&quot;id&quot;: &quot;file-id&quot;, &quot;mime_type&quot;: &quot;image/png&quot;, ...}],
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a>  &quot;inputs&quot;: {&quot;var1&quot;: &quot;value1&quot;},
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a>  &quot;user_id&quot;: &quot;user-id&quot;
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a>}
</code></pre></div>
<strong>Response:</strong> Server-Sent Events (SSE) stream</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>@manager.route(&#39;/completion&#39;, methods=[&#39;POST&#39;])
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>@validate_request(&quot;id&quot;)
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>@login_required
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a>async def run():
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a>    req = await get_request_json()
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a>    e, cvs = await asyncio.to_thread(UserCanvasService.get_by_id, req[&quot;id&quot;])
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a>
<a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a>    canvas = Canvas(cvs.dsl, current_user.id, canvas_id=cvs.id)
<a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a>
<a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a>    async def sse():
<a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a>        async for ans in canvas.run(query=query, files=files, user_id=user_id, inputs=inputs):
<a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a>            yield &quot;data:&quot; + json.dumps(ans, ensure_ascii=False) + &quot;\n\n&quot;
<a id="__codelineno-22-13" name="__codelineno-22-13" href="#__codelineno-22-13"></a>
<a id="__codelineno-22-14" name="__codelineno-22-14" href="#__codelineno-22-14"></a>        # Update DSL with new state
<a id="__codelineno-22-15" name="__codelineno-22-15" href="#__codelineno-22-15"></a>        cvs.dsl = json.loads(str(canvas))
<a id="__codelineno-22-16" name="__codelineno-22-16" href="#__codelineno-22-16"></a>        UserCanvasService.update_by_id(req[&quot;id&quot;], cvs.to_dict())
<a id="__codelineno-22-17" name="__codelineno-22-17" href="#__codelineno-22-17"></a>
<a id="__codelineno-22-18" name="__codelineno-22-18" href="#__codelineno-22-18"></a>    resp = Response(sse(), mimetype=&quot;text/event-stream&quot;)
<a id="__codelineno-22-19" name="__codelineno-22-19" href="#__codelineno-22-19"></a>    resp.headers.add_header(&quot;Cache-control&quot;, &quot;no-cache&quot;)
<a id="__codelineno-22-20" name="__codelineno-22-20" href="#__codelineno-22-20"></a>    resp.headers.add_header(&quot;Connection&quot;, &quot;keep-alive&quot;)
<a id="__codelineno-22-21" name="__codelineno-22-21" href="#__codelineno-22-21"></a>    resp.headers.add_header(&quot;X-Accel-Buffering&quot;, &quot;no&quot;)
<a id="__codelineno-22-22" name="__codelineno-22-22" href="#__codelineno-22-22"></a>    return resp
</code></pre></div>
<strong>Sources:</strong> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/apps/canvas_app.py#L126-L180">api/apps/canvas_app.py126-180</a></p>
<h3 id="sse-event-types">SSE Event Types<a class="headerlink" href="#sse-event-types" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Event Type</th>
<th>Description</th>
<th>Data Fields</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>workflow_started</code></td>
<td>Workflow begins</td>
<td><code>inputs</code></td>
</tr>
<tr>
<td><code>node_started</code></td>
<td>Component begins execution</td>
<td><code>component_id</code>, <code>component_name</code>, <code>component_type</code>, <code>thoughts</code></td>
</tr>
<tr>
<td><code>node_finished</code></td>
<td>Component completes</td>
<td><code>component_id</code>, <code>inputs</code>, <code>outputs</code>, <code>error</code>, <code>elapsed_time</code></td>
</tr>
<tr>
<td><code>message</code></td>
<td>Streaming text chunk</td>
<td><code>content</code>, <code>audio_binary</code> (optional), <code>start_to_think</code>/<code>end_to_think</code> flags</td>
</tr>
<tr>
<td><code>message_end</code></td>
<td>Message component completes</td>
<td><code>status</code>, <code>attachment</code>, <code>reference</code></td>
</tr>
<tr>
<td><code>workflow_finished</code></td>
<td>Workflow completes</td>
<td><code>inputs</code>, <code>outputs</code>, <code>elapsed_time</code></td>
</tr>
<tr>
<td><code>user_inputs</code></td>
<td>Mid-workflow user input required</td>
<td><code>inputs</code>, <code>tips</code></td>
</tr>
</tbody>
</table>
<p><strong>Event Structure:</strong></p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>{
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>  &quot;event&quot;: &quot;node_finished&quot;,
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>  &quot;message_id&quot;: &quot;msg-uuid&quot;,
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a>  &quot;created_at&quot;: 1234567890,
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a>  &quot;task_id&quot;: &quot;task-uuid&quot;,
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a>  &quot;data&quot;: {
<a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a>    &quot;component_id&quot;: &quot;retrieval_0&quot;,
<a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a>    &quot;component_name&quot;: &quot;Retrieval&quot;,
<a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a>    &quot;component_type&quot;: &quot;Retrieval&quot;,
<a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a>    &quot;inputs&quot;: {...},
<a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a>    &quot;outputs&quot;: {...},
<a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a>    &quot;error&quot;: null,
<a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a>    &quot;elapsed_time&quot;: 1.23
<a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a>  }
<a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a>}
</code></pre></div>
<strong>Sources:</strong> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/canvas.py#L391-L649">agent/canvas.py391-649</a></p>
<h3 id="debug-endpoint">Debug Endpoint<a class="headerlink" href="#debug-endpoint" title="Permanent link">&para;</a></h3>
<p><strong>Route:</strong> <code>POST /canvas/debug</code></p>
<p><strong>Purpose:</strong> Test individual components in isolation</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>@manager.route(&#39;/debug&#39;, methods=[&#39;POST&#39;])
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a>@validate_request(&quot;id&quot;, &quot;component_id&quot;, &quot;params&quot;)
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>@login_required
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a>async def debug():
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a>    req = await get_request_json()
<a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a>    e, user_canvas = UserCanvasService.get_by_id(req[&quot;id&quot;])
<a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a>    canvas = Canvas(json.dumps(user_canvas.dsl), current_user.id, canvas_id=user_canvas.id)
<a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a>    canvas.reset()
<a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a>
<a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a>    component = canvas.get_component(req[&quot;component_id&quot;])[&quot;obj&quot;]
<a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a>    component.reset()
<a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a>
<a id="__codelineno-24-13" name="__codelineno-24-13" href="#__codelineno-24-13"></a>    if isinstance(component, LLM):
<a id="__codelineno-24-14" name="__codelineno-24-14" href="#__codelineno-24-14"></a>        component.set_debug_inputs(req[&quot;params&quot;])
<a id="__codelineno-24-15" name="__codelineno-24-15" href="#__codelineno-24-15"></a>
<a id="__codelineno-24-16" name="__codelineno-24-16" href="#__codelineno-24-16"></a>    component.invoke(**{k: o[&quot;value&quot;] for k,o in req[&quot;params&quot;].items()})
<a id="__codelineno-24-17" name="__codelineno-24-17" href="#__codelineno-24-17"></a>    outputs = component.output()
<a id="__codelineno-24-18" name="__codelineno-24-18" href="#__codelineno-24-18"></a>
<a id="__codelineno-24-19" name="__codelineno-24-19" href="#__codelineno-24-19"></a>    # Resolve streaming outputs
<a id="__codelineno-24-20" name="__codelineno-24-20" href="#__codelineno-24-20"></a>    for k in outputs.keys():
<a id="__codelineno-24-21" name="__codelineno-24-21" href="#__codelineno-24-21"></a>        if isinstance(outputs[k], partial):
<a id="__codelineno-24-22" name="__codelineno-24-22" href="#__codelineno-24-22"></a>            txt = &quot;&quot;
<a id="__codelineno-24-23" name="__codelineno-24-23" href="#__codelineno-24-23"></a>            iter_obj = outputs&lt;FileRef file-url=&quot;https://github.com/infiniflow/ragflow/blob/80a16e71/k&quot; undefined  file-path=&quot;k&quot;&gt;Hii&lt;/FileRef&gt;
<a id="__codelineno-24-24" name="__codelineno-24-24" href="#__codelineno-24-24"></a>            if inspect.isasyncgen(iter_obj):
<a id="__codelineno-24-25" name="__codelineno-24-25" href="#__codelineno-24-25"></a>                async for c in iter_obj:
<a id="__codelineno-24-26" name="__codelineno-24-26" href="#__codelineno-24-26"></a>                    txt += c
<a id="__codelineno-24-27" name="__codelineno-24-27" href="#__codelineno-24-27"></a>            else:
<a id="__codelineno-24-28" name="__codelineno-24-28" href="#__codelineno-24-28"></a>                for c in iter_obj:
<a id="__codelineno-24-29" name="__codelineno-24-29" href="#__codelineno-24-29"></a>                    txt += c
<a id="__codelineno-24-30" name="__codelineno-24-30" href="#__codelineno-24-30"></a>            outputs[k] = txt
<a id="__codelineno-24-31" name="__codelineno-24-31" href="#__codelineno-24-31"></a>
<a id="__codelineno-24-32" name="__codelineno-24-32" href="#__codelineno-24-32"></a>    return get_json_result(data=outputs)
</code></pre></div>
<strong>Sources:</strong> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/apps/canvas_app.py#L279-L313">api/apps/canvas_app.py279-313</a></p>
<h3 id="other-endpoints">Other Endpoints<a class="headerlink" href="#other-endpoints" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Route</th>
<th>Method</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/canvas/set</code></td>
<td>POST</td>
<td>Create or update canvas</td>
</tr>
<tr>
<td><code>/canvas/get/&lt;canvas_id&gt;</code></td>
<td>GET</td>
<td>Retrieve canvas configuration</td>
</tr>
<tr>
<td><code>/canvas/rm</code></td>
<td>POST</td>
<td>Delete canvases by IDs</td>
</tr>
<tr>
<td><code>/canvas/reset</code></td>
<td>POST</td>
<td>Reset canvas state (clear history)</td>
</tr>
<tr>
<td><code>/canvas/cancel/&lt;task_id&gt;</code></td>
<td>PUT</td>
<td>Cancel running task</td>
</tr>
<tr>
<td><code>/canvas/trace</code></td>
<td>GET</td>
<td>Get tool execution trace logs</td>
</tr>
<tr>
<td><code>/canvas/&lt;canvas_id&gt;/sessions</code></td>
<td>GET</td>
<td>List conversation sessions</td>
</tr>
<tr>
<td><code>/canvas/input_form</code></td>
<td>GET</td>
<td>Get component input form schema</td>
</tr>
</tbody>
</table>
<p><strong>Sources:</strong> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/apps/canvas_app.py#L47-L559">api/apps/canvas_app.py47-559</a></p>
<hr />
<h2 id="state-management">State Management<a class="headerlink" href="#state-management" title="Permanent link">&para;</a></h2>
<h3 id="conversation-history">Conversation History<a class="headerlink" href="#conversation-history" title="Permanent link">&para;</a></h3>
<p>History is stored as <code>(role, content)</code> tuples:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>class Canvas(Graph):
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>    def load(self):
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>        self.history = self.dsl[&quot;history&quot;]  # [(role, content), ...]
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a>
<a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a>    def add_user_input(self, question):
<a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a>        self.history.append((&quot;user&quot;, question))
<a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a>
<a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a>    def get_history(self, window_size):
<a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a>        convs = []
<a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a>        if window_size &lt;= 0:
<a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a>            return convs
<a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a>        for role, obj in self.history[window_size * -2:]:
<a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a>            if isinstance(obj, dict):
<a id="__codelineno-25-14" name="__codelineno-25-14" href="#__codelineno-25-14"></a>                convs.append({&quot;role&quot;: role, &quot;content&quot;: obj.get(&quot;content&quot;, &quot;&quot;)})
<a id="__codelineno-25-15" name="__codelineno-25-15" href="#__codelineno-25-15"></a>            else:
<a id="__codelineno-25-16" name="__codelineno-25-16" href="#__codelineno-25-16"></a>                convs.append({&quot;role&quot;: role, &quot;content&quot;: str(obj)})
<a id="__codelineno-25-17" name="__codelineno-25-17" href="#__codelineno-25-17"></a>        return convs
</code></pre></div>
<strong>Window Size:</strong> Controlled by <code>message_history_window_size</code> parameter (default 13)</p>
<p><strong>Sources:</strong> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/canvas.py#L292-L317">agent/canvas.py292-317</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/canvas.py#L705-L717">agent/canvas.py705-717</a></p>
<h3 id="retrieval-state">Retrieval State<a class="headerlink" href="#retrieval-state" title="Permanent link">&para;</a></h3>
<p>Retrieved chunks and document aggregations are stored per turn:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>self.retrieval = [
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a>    {
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a>        &quot;chunks&quot;: {
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a>            &quot;chunk_id_hash&quot;: {
<a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a>                &quot;id&quot;: &quot;chunk-uuid&quot;,
<a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a>                &quot;content&quot;: &quot;...&quot;,
<a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a>                &quot;document_name&quot;: &quot;...&quot;,
<a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a>                &quot;similarity&quot;: 0.95
<a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a>            }
<a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a>        },
<a id="__codelineno-26-11" name="__codelineno-26-11" href="#__codelineno-26-11"></a>        &quot;doc_aggs&quot;: {
<a id="__codelineno-26-12" name="__codelineno-26-12" href="#__codelineno-26-12"></a>            &quot;doc_name&quot;: {
<a id="__codelineno-26-13" name="__codelineno-26-13" href="#__codelineno-26-13"></a>                &quot;doc_id&quot;: &quot;...&quot;,
<a id="__codelineno-26-14" name="__codelineno-26-14" href="#__codelineno-26-14"></a>                &quot;count&quot;: 5,
<a id="__codelineno-26-15" name="__codelineno-26-15" href="#__codelineno-26-15"></a>                &quot;url&quot;: &quot;...&quot;
<a id="__codelineno-26-16" name="__codelineno-26-16" href="#__codelineno-26-16"></a>            }
<a id="__codelineno-26-17" name="__codelineno-26-17" href="#__codelineno-26-17"></a>        }
<a id="__codelineno-26-18" name="__codelineno-26-18" href="#__codelineno-26-18"></a>    }
<a id="__codelineno-26-19" name="__codelineno-26-19" href="#__codelineno-26-19"></a>]
<a id="__codelineno-26-20" name="__codelineno-26-20" href="#__codelineno-26-20"></a>
<a id="__codelineno-26-21" name="__codelineno-26-21" href="#__codelineno-26-21"></a>def add_reference(self, chunks, doc_infos):
<a id="__codelineno-26-22" name="__codelineno-26-22" href="#__codelineno-26-22"></a>    if not self.retrieval:
<a id="__codelineno-26-23" name="__codelineno-26-23" href="#__codelineno-26-23"></a>        self.retrieval = [{&quot;chunks&quot;: {}, &quot;doc_aggs&quot;: {}}]
<a id="__codelineno-26-24" name="__codelineno-26-24" href="#__codelineno-26-24"></a>
<a id="__codelineno-26-25" name="__codelineno-26-25" href="#__codelineno-26-25"></a>    r = self.retrieval[-1]
<a id="__codelineno-26-26" name="__codelineno-26-26" href="#__codelineno-26-26"></a>    for ck in chunks_format({&quot;chunks&quot;: chunks}):
<a id="__codelineno-26-27" name="__codelineno-26-27" href="#__codelineno-26-27"></a>        cid = hash_str2int(ck[&quot;id&quot;], 500)
<a id="__codelineno-26-28" name="__codelineno-26-28" href="#__codelineno-26-28"></a>        if cid not in r:
<a id="__codelineno-26-29" name="__codelineno-26-29" href="#__codelineno-26-29"></a>            r[&quot;chunks&quot;][cid] = ck
<a id="__codelineno-26-30" name="__codelineno-26-30" href="#__codelineno-26-30"></a>
<a id="__codelineno-26-31" name="__codelineno-26-31" href="#__codelineno-26-31"></a>    for doc in doc_infos:
<a id="__codelineno-26-32" name="__codelineno-26-32" href="#__codelineno-26-32"></a>        if doc[&quot;doc_name&quot;] not in r:
<a id="__codelineno-26-33" name="__codelineno-26-33" href="#__codelineno-26-33"></a>            r[&quot;doc_aggs&quot;][doc[&quot;doc_name&quot;]] = doc
</code></pre></div>
<strong>Citation Support:</strong> Components can access <code>self._canvas.get_reference()</code> to inject <code>[ID:x]</code> markers</p>
<p><strong>Sources:</strong> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/canvas.py#L786-L804">agent/canvas.py786-804</a></p>
<h3 id="memory-system">Memory System<a class="headerlink" href="#memory-system" title="Permanent link">&para;</a></h3>
<p>The memory system stores episodic summaries:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>self.memory = []  # List of (user, assist, summary) tuples
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>def add_memory(self, user: str, assist: str, summ: str):
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a>    self.memory.append((user, assist, summ))
<a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a>
<a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a>def get_memory(self) -&gt; list[Tuple]:
<a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a>    return self.memory
</code></pre></div>
<strong>Note:</strong> Full memory implementation (4 types: raw, semantic, episodic, procedural) is referenced in architecture diagrams but not fully implemented in current codebase</p>
<p><strong>Sources:</strong> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/canvas.py#L806-L810">agent/canvas.py806-810</a></p>
<h3 id="global-variables">Global Variables<a class="headerlink" href="#global-variables" title="Permanent link">&para;</a></h3>
<p>System and environment variables:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>self.globals = {
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a>    &quot;sys.query&quot;: &quot;&quot;,
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a>    &quot;sys.user_id&quot;: tenant_id,
<a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a>    &quot;sys.conversation_turns&quot;: 0,
<a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a>    &quot;sys.files&quot;: []
<a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a>}
<a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a>
<a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a>def reset(self, mem=False):
<a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a>    for k in self.globals.keys():
<a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a>        if k.startswith(&quot;sys.&quot;):
<a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a>            # Reset to default type values
<a id="__codelineno-28-12" name="__codelineno-28-12" href="#__codelineno-28-12"></a>            if isinstance(self.globals[k], str):
<a id="__codelineno-28-13" name="__codelineno-28-13" href="#__codelineno-28-13"></a>                self.globals[k] = &quot;&quot;
<a id="__codelineno-28-14" name="__codelineno-28-14" href="#__codelineno-28-14"></a>            elif isinstance(self.globals[k], int):
<a id="__codelineno-28-15" name="__codelineno-28-15" href="#__codelineno-28-15"></a>                self.globals[k] = 0
<a id="__codelineno-28-16" name="__codelineno-28-16" href="#__codelineno-28-16"></a>            # ...
<a id="__codelineno-28-17" name="__codelineno-28-17" href="#__codelineno-28-17"></a>        if k.startswith(&quot;env.&quot;):
<a id="__codelineno-28-18" name="__codelineno-28-18" href="#__codelineno-28-18"></a>            # Restore from variables definition
<a id="__codelineno-28-19" name="__codelineno-28-19" href="#__codelineno-28-19"></a>            key = k[4:]
<a id="__codelineno-28-20" name="__codelineno-28-20" href="#__codelineno-28-20"></a>            if key in self.variables:
<a id="__codelineno-28-21" name="__codelineno-28-21" href="#__codelineno-28-21"></a>                variable = self.variables[key]
<a id="__codelineno-28-22" name="__codelineno-28-22" href="#__codelineno-28-22"></a>                self.globals[k] = variable[&quot;value&quot;]
</code></pre></div>
<strong>Sources:</strong> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/canvas.py#L282-L360">agent/canvas.py282-360</a></p>
<h3 id="task-cancellation">Task Cancellation<a class="headerlink" href="#task-cancellation" title="Permanent link">&para;</a></h3>
<p>Tasks can be canceled via Redis flag:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a>def is_canceled(self) -&gt; bool:
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a>    return has_canceled(self.task_id)
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a>
<a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a>def cancel_task(self) -&gt; bool:
<a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a>    try:
<a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a>        REDIS_CONN.set(f&quot;{self.task_id}-cancel&quot;, &quot;x&quot;)
<a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a>    except Exception as e:
<a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a>        logging.exception(e)
<a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a>        return False
<a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a>    return True
<a id="__codelineno-29-11" name="__codelineno-29-11" href="#__codelineno-29-11"></a>
<a id="__codelineno-29-12" name="__codelineno-29-12" href="#__codelineno-29-12"></a># Checked throughout execution
<a id="__codelineno-29-13" name="__codelineno-29-13" href="#__codelineno-29-13"></a>if self.is_canceled():
<a id="__codelineno-29-14" name="__codelineno-29-14" href="#__codelineno-29-14"></a>    msg = f&quot;Task {self.task_id} has been canceled&quot;
<a id="__codelineno-29-15" name="__codelineno-29-15" href="#__codelineno-29-15"></a>    logging.info(msg)
<a id="__codelineno-29-16" name="__codelineno-29-16" href="#__codelineno-29-16"></a>    raise TaskCanceledException(msg)
</code></pre></div>
<strong>Endpoint:</strong> <code>PUT /canvas/cancel/&lt;task_id&gt;</code></p>
<p><strong>Sources:</strong> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/canvas.py#L267-L277">agent/canvas.py267-277</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/apps/canvas_app.py#L211-L218">api/apps/canvas_app.py211-218</a></p>
<hr />
<h2 id="tool-execution-tracing">Tool Execution Tracing<a class="headerlink" href="#tool-execution-tracing" title="Permanent link">&para;</a></h2>
<h3 id="callback-mechanism">Callback Mechanism<a class="headerlink" href="#callback-mechanism" title="Permanent link">&para;</a></h3>
<p>Tool calls are logged to Redis for debugging:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>def tool_use_callback(self, agent_id: str, func_name: str, params: dict, result: Any, elapsed_time=None):
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a>    agent_ids = agent_id.split(&quot;--&gt;&quot;)
<a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a>    agent_name = self.get_component_name(agent_ids[0])
<a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a>    path = agent_name if len(agent_ids) &lt; 2 else agent_name+&quot;--&gt;&quot;+&quot;--&gt;&quot;.join(agent_ids[1:])
<a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a>
<a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a>    try:
<a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a>        bin = REDIS_CONN.get(f&quot;{self.task_id}-{self.message_id}-logs&quot;)
<a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a>        if bin:
<a id="__codelineno-30-9" name="__codelineno-30-9" href="#__codelineno-30-9"></a>            obj = json.loads(bin.encode(&quot;utf-8&quot;))
<a id="__codelineno-30-10" name="__codelineno-30-10" href="#__codelineno-30-10"></a>            if obj[-1][&quot;component_id&quot;] == agent_ids[0]:
<a id="__codelineno-30-11" name="__codelineno-30-11" href="#__codelineno-30-11"></a>                obj[-1][&quot;trace&quot;].append({
<a id="__codelineno-30-12" name="__codelineno-30-12" href="#__codelineno-30-12"></a>                    &quot;path&quot;: path,
<a id="__codelineno-30-13" name="__codelineno-30-13" href="#__codelineno-30-13"></a>                    &quot;tool_name&quot;: func_name,
<a id="__codelineno-30-14" name="__codelineno-30-14" href="#__codelineno-30-14"></a>                    &quot;arguments&quot;: params,
<a id="__codelineno-30-15" name="__codelineno-30-15" href="#__codelineno-30-15"></a>                    &quot;result&quot;: result,
<a id="__codelineno-30-16" name="__codelineno-30-16" href="#__codelineno-30-16"></a>                    &quot;elapsed_time&quot;: elapsed_time
<a id="__codelineno-30-17" name="__codelineno-30-17" href="#__codelineno-30-17"></a>                })
<a id="__codelineno-30-18" name="__codelineno-30-18" href="#__codelineno-30-18"></a>            else:
<a id="__codelineno-30-19" name="__codelineno-30-19" href="#__codelineno-30-19"></a>                obj.append({
<a id="__codelineno-30-20" name="__codelineno-30-20" href="#__codelineno-30-20"></a>                    &quot;component_id&quot;: agent_ids[0],
<a id="__codelineno-30-21" name="__codelineno-30-21" href="#__codelineno-30-21"></a>                    &quot;trace&quot;: [...]
<a id="__codelineno-30-22" name="__codelineno-30-22" href="#__codelineno-30-22"></a>                })
<a id="__codelineno-30-23" name="__codelineno-30-23" href="#__codelineno-30-23"></a>        else:
<a id="__codelineno-30-24" name="__codelineno-30-24" href="#__codelineno-30-24"></a>            obj = [{...}]
<a id="__codelineno-30-25" name="__codelineno-30-25" href="#__codelineno-30-25"></a>
<a id="__codelineno-30-26" name="__codelineno-30-26" href="#__codelineno-30-26"></a>        REDIS_CONN.set_obj(f&quot;{self.task_id}-{self.message_id}-logs&quot;, obj, 60*10)
<a id="__codelineno-30-27" name="__codelineno-30-27" href="#__codelineno-30-27"></a>    except Exception as e:
<a id="__codelineno-30-28" name="__codelineno-30-28" href="#__codelineno-30-28"></a>        logging.exception(e)
</code></pre></div>
<strong>TTL:</strong> Trace logs expire after 10 minutes</p>
<p><strong>Sources:</strong> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/canvas.py#L762-L784">agent/canvas.py762-784</a></p>
<h3 id="trace-retrieval">Trace Retrieval<a class="headerlink" href="#trace-retrieval" title="Permanent link">&para;</a></h3>
<p>Tool execution traces are stored in Redis and can be retrieved via the trace endpoint:</p>
<p><strong>Route:</strong> <code>GET /canvas/trace?canvas_id=&lt;id&gt;&amp;message_id=&lt;id&gt;</code></p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a>@manager.route(&#39;/trace&#39;, methods=[&#39;GET&#39;])
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a>def trace():
<a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a>    cvs_id = request.args.get(&quot;canvas_id&quot;)
<a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a>    msg_id = request.args.get(&quot;message_id&quot;)
<a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a>
<a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a>    # Redis key format: &quot;{task_id}-{message_id}-logs&quot;
<a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a>    binary = REDIS_CONN.get(f&quot;{cvs_id}-{msg_id}-logs&quot;)
<a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a>    if not binary:
<a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a>        return get_json_result(data={})
<a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a>
<a id="__codelineno-31-11" name="__codelineno-31-11" href="#__codelineno-31-11"></a>    return get_json_result(data=json.loads(binary.encode(&quot;utf-8&quot;)))
</code></pre></div>
<strong>Trace Storage (Canvas.tool_use_callback):</strong></p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a>def tool_use_callback(self, agent_id: str, func_name: str, params: dict, result: Any, elapsed_time=None):
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a>    &quot;&quot;&quot;Called after each tool execution to log trace&quot;&quot;&quot;
<a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a>    agent_ids = agent_id.split(&quot;--&gt;&quot;)
<a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a>    agent_name = self.get_component_name(agent_ids[0])
<a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a>
<a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a>    # Build hierarchical path: &quot;Agent--&gt;Retrieval&quot; or &quot;Agent--&gt;SubAgent--&gt;Tool&quot;
<a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a>    path = agent_name if len(agent_ids) &lt; 2 else agent_name+&quot;--&gt;&quot;+&quot;--&gt;&quot;.join(agent_ids[1:])
<a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a>
<a id="__codelineno-32-9" name="__codelineno-32-9" href="#__codelineno-32-9"></a>    # Load existing trace log from Redis
<a id="__codelineno-32-10" name="__codelineno-32-10" href="#__codelineno-32-10"></a>    bin = REDIS_CONN.get(f&quot;{self.task_id}-{self.message_id}-logs&quot;)
<a id="__codelineno-32-11" name="__codelineno-32-11" href="#__codelineno-32-11"></a>    if bin:
<a id="__codelineno-32-12" name="__codelineno-32-12" href="#__codelineno-32-12"></a>        obj = json.loads(bin.encode(&quot;utf-8&quot;))
<a id="__codelineno-32-13" name="__codelineno-32-13" href="#__codelineno-32-13"></a>        # Append to existing component&#39;s trace
<a id="__codelineno-32-14" name="__codelineno-32-14" href="#__codelineno-32-14"></a>        if obj[-1][&quot;component_id&quot;] == agent_ids[0]:
<a id="__codelineno-32-15" name="__codelineno-32-15" href="#__codelineno-32-15"></a>            obj[-1][&quot;trace&quot;].append({
<a id="__codelineno-32-16" name="__codelineno-32-16" href="#__codelineno-32-16"></a>                &quot;path&quot;: path,
<a id="__codelineno-32-17" name="__codelineno-32-17" href="#__codelineno-32-17"></a>                &quot;tool_name&quot;: func_name,
<a id="__codelineno-32-18" name="__codelineno-32-18" href="#__codelineno-32-18"></a>                &quot;arguments&quot;: params,
<a id="__codelineno-32-19" name="__codelineno-32-19" href="#__codelineno-32-19"></a>                &quot;result&quot;: result,
<a id="__codelineno-32-20" name="__codelineno-32-20" href="#__codelineno-32-20"></a>                &quot;elapsed_time&quot;: elapsed_time
<a id="__codelineno-32-21" name="__codelineno-32-21" href="#__codelineno-32-21"></a>            })
<a id="__codelineno-32-22" name="__codelineno-32-22" href="#__codelineno-32-22"></a>        # Or create new component entry
<a id="__codelineno-32-23" name="__codelineno-32-23" href="#__codelineno-32-23"></a>        else:
<a id="__codelineno-32-24" name="__codelineno-32-24" href="#__codelineno-32-24"></a>            obj.append({&quot;component_id&quot;: agent_ids[0], &quot;trace&quot;: [...]})
<a id="__codelineno-32-25" name="__codelineno-32-25" href="#__codelineno-32-25"></a>    else:
<a id="__codelineno-32-26" name="__codelineno-32-26" href="#__codelineno-32-26"></a>        obj = [{&quot;component_id&quot;: agent_ids[0], &quot;trace&quot;: [...]}]
<a id="__codelineno-32-27" name="__codelineno-32-27" href="#__codelineno-32-27"></a>
<a id="__codelineno-32-28" name="__codelineno-32-28" href="#__codelineno-32-28"></a>    # Save with 10 minute TTL
<a id="__codelineno-32-29" name="__codelineno-32-29" href="#__codelineno-32-29"></a>    REDIS_CONN.set_obj(f&quot;{self.task_id}-{self.message_id}-logs&quot;, obj, 60*10)
</code></pre></div>
<strong>Response Format:</strong></p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a>[
<a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a>  {
<a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a>    &quot;component_id&quot;: &quot;agent_0&quot;,
<a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a>    &quot;trace&quot;: [
<a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a>      {
<a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a>        &quot;path&quot;: &quot;Agent--&gt;wikipedia_0&quot;,
<a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a>        &quot;tool_name&quot;: &quot;wikipedia_0&quot;,
<a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a>        &quot;arguments&quot;: {&quot;query&quot;: &quot;Python programming&quot;},
<a id="__codelineno-33-9" name="__codelineno-33-9" href="#__codelineno-33-9"></a>        &quot;result&quot;: &quot;Python is a high-level programming language...&quot;,
<a id="__codelineno-33-10" name="__codelineno-33-10" href="#__codelineno-33-10"></a>        &quot;elapsed_time&quot;: 1.23
<a id="__codelineno-33-11" name="__codelineno-33-11" href="#__codelineno-33-11"></a>      },
<a id="__codelineno-33-12" name="__codelineno-33-12" href="#__codelineno-33-12"></a>      {
<a id="__codelineno-33-13" name="__codelineno-33-13" href="#__codelineno-33-13"></a>        &quot;path&quot;: &quot;Agent--&gt;retrieval_0&quot;,
<a id="__codelineno-33-14" name="__codelineno-33-14" href="#__codelineno-33-14"></a>        &quot;tool_name&quot;: &quot;retrieval_0&quot;,
<a id="__codelineno-33-15" name="__codelineno-33-15" href="#__codelineno-33-15"></a>        &quot;arguments&quot;: {&quot;query&quot;: &quot;Python examples&quot;, &quot;kb_ids&quot;: [&quot;kb-123&quot;]},
<a id="__codelineno-33-16" name="__codelineno-33-16" href="#__codelineno-33-16"></a>        &quot;result&quot;: &quot;...&quot;,
<a id="__codelineno-33-17" name="__codelineno-33-17" href="#__codelineno-33-17"></a>        &quot;elapsed_time&quot;: 0.87
<a id="__codelineno-33-18" name="__codelineno-33-18" href="#__codelineno-33-18"></a>      }
<a id="__codelineno-33-19" name="__codelineno-33-19" href="#__codelineno-33-19"></a>    ]
<a id="__codelineno-33-20" name="__codelineno-33-20" href="#__codelineno-33-20"></a>  }
<a id="__codelineno-33-21" name="__codelineno-33-21" href="#__codelineno-33-21"></a>]
</code></pre></div>
<strong>Trace Events Logged:</strong></p>
<ul>
<li><code>analyze_task</code> - Task analysis prompt and response</li>
<li><code>Multi-turn conversation optimization</code> - Full question reconstruction</li>
<li>Tool calls (e.g., <code>wikipedia_0</code>, <code>retrieval_0</code>, <code>exesql_0</code>)</li>
<li><code>reflection</code> - Observation formatting after tool execution</li>
<li><code>gen_citations</code> - Citation generation</li>
</ul>
<p><strong>Redis Key TTL:</strong> 10 minutes (<code>60*10</code> seconds)</p>
<p><strong>Sources:</strong> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/canvas.py#L762-L784">agent/canvas.py762-784</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/apps/canvas_app.py#L495-L507">api/apps/canvas_app.py495-507</a></p>
<hr />
<h2 id="component-registration-and-discovery">Component Registration and Discovery<a class="headerlink" href="#component-registration-and-discovery" title="Permanent link">&para;</a></h2>
<p>Components are automatically discovered and registered via dynamic module loading in <code>agent/component/__init__.py</code>:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a>import os
<a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a>import importlib
<a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a>import inspect
<a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a>from typing import Dict, Type
<a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a>
<a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a>_package_path = os.path.dirname(__file__)
<a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a>__all_classes: Dict[str, Type] = {}
<a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a>
<a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a>def _import_submodules() -&gt; None:
<a id="__codelineno-34-10" name="__codelineno-34-10" href="#__codelineno-34-10"></a>    &quot;&quot;&quot;Auto-import all .py files in agent/component/ directory&quot;&quot;&quot;
<a id="__codelineno-34-11" name="__codelineno-34-11" href="#__codelineno-34-11"></a>    for filename in os.listdir(_package_path):
<a id="__codelineno-34-12" name="__codelineno-34-12" href="#__codelineno-34-12"></a>        if filename.startswith(&quot;__&quot;) or not filename.endswith(&quot;.py&quot;) or filename.startswith(&quot;base&quot;):
<a id="__codelineno-34-13" name="__codelineno-34-13" href="#__codelineno-34-13"></a>            continue
<a id="__codelineno-34-14" name="__codelineno-34-14" href="#__codelineno-34-14"></a>        module_name = filename[:-3]
<a id="__codelineno-34-15" name="__codelineno-34-15" href="#__codelineno-34-15"></a>
<a id="__codelineno-34-16" name="__codelineno-34-16" href="#__codelineno-34-16"></a>        try:
<a id="__codelineno-34-17" name="__codelineno-34-17" href="#__codelineno-34-17"></a>            module = importlib.import_module(f&quot;.{module_name}&quot;, package=__name__)
<a id="__codelineno-34-18" name="__codelineno-34-18" href="#__codelineno-34-18"></a>            _extract_classes_from_module(module)
<a id="__codelineno-34-19" name="__codelineno-34-19" href="#__codelineno-34-19"></a>        except ImportError as e:
<a id="__codelineno-34-20" name="__codelineno-34-20" href="#__codelineno-34-20"></a>            print(f&quot;Warning: Failed to import module {module_name}: {str(e)}&quot;)
<a id="__codelineno-34-21" name="__codelineno-34-21" href="#__codelineno-34-21"></a>
<a id="__codelineno-34-22" name="__codelineno-34-22" href="#__codelineno-34-22"></a>def _extract_classes_from_module(module: ModuleType) -&gt; None:
<a id="__codelineno-34-23" name="__codelineno-34-23" href="#__codelineno-34-23"></a>    &quot;&quot;&quot;Extract all classes from module and register in __all_classes&quot;&quot;&quot;
<a id="__codelineno-34-24" name="__codelineno-34-24" href="#__codelineno-34-24"></a>    for name, obj in inspect.getmembers(module):
<a id="__codelineno-34-25" name="__codelineno-34-25" href="#__codelineno-34-25"></a>        if (inspect.isclass(obj) and
<a id="__codelineno-34-26" name="__codelineno-34-26" href="#__codelineno-34-26"></a>            obj.__module__ == module.__name__ and
<a id="__codelineno-34-27" name="__codelineno-34-27" href="#__codelineno-34-27"></a>            not name.startswith(&quot;_&quot;)):
<a id="__codelineno-34-28" name="__codelineno-34-28" href="#__codelineno-34-28"></a>            __all_classes[name] = obj
<a id="__codelineno-34-29" name="__codelineno-34-29" href="#__codelineno-34-29"></a>            globals()[name] = obj
<a id="__codelineno-34-30" name="__codelineno-34-30" href="#__codelineno-34-30"></a>
<a id="__codelineno-34-31" name="__codelineno-34-31" href="#__codelineno-34-31"></a># Execute at module load time
<a id="__codelineno-34-32" name="__codelineno-34-32" href="#__codelineno-34-32"></a>_import_submodules()
<a id="__codelineno-34-33" name="__codelineno-34-33" href="#__codelineno-34-33"></a>
<a id="__codelineno-34-34" name="__codelineno-34-34" href="#__codelineno-34-34"></a>def component_class(class_name):
<a id="__codelineno-34-35" name="__codelineno-34-35" href="#__codelineno-34-35"></a>    &quot;&quot;&quot;Factory function to resolve component/tool class by name&quot;&quot;&quot;
<a id="__codelineno-34-36" name="__codelineno-34-36" href="#__codelineno-34-36"></a>    for module_name in [&quot;agent.component&quot;, &quot;agent.tools&quot;, &quot;rag.flow&quot;]:
<a id="__codelineno-34-37" name="__codelineno-34-37" href="#__codelineno-34-37"></a>        try:
<a id="__codelineno-34-38" name="__codelineno-34-38" href="#__codelineno-34-38"></a>            return getattr(importlib.import_module(module_name), class_name)
<a id="__codelineno-34-39" name="__codelineno-34-39" href="#__codelineno-34-39"></a>        except Exception:
<a id="__codelineno-34-40" name="__codelineno-34-40" href="#__codelineno-34-40"></a>            pass
<a id="__codelineno-34-41" name="__codelineno-34-41" href="#__codelineno-34-41"></a>    assert False, f&quot;Can&#39;t import {class_name}&quot;
</code></pre></div>
<strong>Discovery Flow:</strong></p>
<ol>
<li><strong>Auto-Import</strong>: <code>_import_submodules()</code> scans <code>agent/component/</code> directory at module load time</li>
<li><strong>Class Extraction</strong>: <code>_extract_classes_from_module()</code> uses <code>inspect.getmembers()</code> to find all classes</li>
<li><strong>Registration</strong>: Classes stored in <code>__all_classes</code> dict and added to module <code>globals()</code></li>
<li><strong>Factory Resolution</strong>: <code>component_class(name)</code> searches <code>agent.component</code>, <code>agent.tools</code>, <code>rag.flow</code> modules</li>
</ol>
<p><strong>Usage in Graph.load():</strong></p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a>def load(self):
<a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a>    &quot;&quot;&quot;Load and instantiate components from DSL&quot;&quot;&quot;
<a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a>    self.components = self.dsl[&quot;components&quot;]
<a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a>    for k, cpn in self.components.items():
<a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a>        cpn_nms.add(cpn[&quot;obj&quot;][&quot;component_name&quot;])
<a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a>
<a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a>        # 1. Get parameter class (e.g., &quot;LLMParam&quot;)
<a id="__codelineno-35-8" name="__codelineno-35-8" href="#__codelineno-35-8"></a>        param = component_class(cpn[&quot;obj&quot;][&quot;component_name&quot;] + &quot;Param&quot;)()
<a id="__codelineno-35-9" name="__codelineno-35-9" href="#__codelineno-35-9"></a>
<a id="__codelineno-35-10" name="__codelineno-35-10" href="#__codelineno-35-10"></a>        # 2. Update with DSL configuration
<a id="__codelineno-35-11" name="__codelineno-35-11" href="#__codelineno-35-11"></a>        param.update(cpn[&quot;obj&quot;][&quot;params&quot;])
<a id="__codelineno-35-12" name="__codelineno-35-12" href="#__codelineno-35-12"></a>
<a id="__codelineno-35-13" name="__codelineno-35-13" href="#__codelineno-35-13"></a>        # 3. Validate parameters
<a id="__codelineno-35-14" name="__codelineno-35-14" href="#__codelineno-35-14"></a>        try:
<a id="__codelineno-35-15" name="__codelineno-35-15" href="#__codelineno-35-15"></a>            param.check()
<a id="__codelineno-35-16" name="__codelineno-35-16" href="#__codelineno-35-16"></a>        except Exception as e:
<a id="__codelineno-35-17" name="__codelineno-35-17" href="#__codelineno-35-17"></a>            raise ValueError(self.get_component_name(k) + f&quot;: {e}&quot;)
<a id="__codelineno-35-18" name="__codelineno-35-18" href="#__codelineno-35-18"></a>
<a id="__codelineno-35-19" name="__codelineno-35-19" href="#__codelineno-35-19"></a>        # 4. Get component class (e.g., &quot;LLM&quot;)
<a id="__codelineno-35-20" name="__codelineno-35-20" href="#__codelineno-35-20"></a>        # 5. Instantiate component
<a id="__codelineno-35-21" name="__codelineno-35-21" href="#__codelineno-35-21"></a>        cpn[&quot;obj&quot;] = component_class(cpn[&quot;obj&quot;][&quot;component_name&quot;])(self, k, param)
</code></pre></div>
<strong>Component Resolution Order:</strong></p>
<ol>
<li>Check <code>agent.component</code> module (built-in components)</li>
<li>Check <code>agent.tools</code> module (tool components)</li>
<li>Check <code>rag.flow</code> module (pipeline components)</li>
<li>Raise <code>AssertionError</code> if not found</li>
</ol>
<p><strong>Sources:</strong> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/component/__init__.py#L16-L58">agent/component/__init__.py16-58</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/canvas.py#L29-L29">agent/canvas.py29</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/canvas.py#L91-L103">agent/canvas.py91-103</a></p>
<hr />
<h2 id="summary">Summary<a class="headerlink" href="#summary" title="Permanent link">&para;</a></h2>
<p>The Agent and Workflow System provides a flexible, DSL-based orchestration engine with the following key characteristics:</p>
<p><strong>Architecture:</strong></p>
<ul>
<li><code>Graph</code> base class with <code>Canvas</code> agent extension</li>
<li>JSON DSL defining components, connections, and state</li>
<li>Factory-based component registration</li>
</ul>
<p><strong>Execution:</strong></p>
<ul>
<li>Asynchronous batch execution with <code>ThreadPoolExecutor</code> + <code>asyncio.gather</code></li>
<li>Dynamic path extension based on component logic (branching, loops)</li>
<li>Server-Sent Events streaming for real-time progress</li>
</ul>
<p><strong>Components:</strong></p>
<ul>
<li>Abstract <code>ComponentBase</code> with lifecycle (<code>invoke</code>, <code>_invoke</code>, <code>reset</code>, <code>output</code>)</li>
<li>Built-in components: LLM, Agent, Retrieval, Categorize, Message, etc.</li>
<li>Tool-based components for external integrations</li>
</ul>
<p><strong>Agent System:</strong></p>
<ul>
<li>ReAct algorithm with multi-round tool orchestration</li>
<li>Concurrent tool execution with reflection</li>
<li>MCP server integration for external tools</li>
</ul>
<p><strong>State Management:</strong></p>
<ul>
<li>Conversation history with window size control</li>
<li>Retrieval state (chunks + doc aggregations)</li>
<li>Global variables (<code>sys.*</code>, <code>env.*</code>) and component outputs</li>
<li>Memory system for episodic summaries</li>
</ul>
<p><strong>Variable Resolution:</strong></p>
<ul>
<li>Pattern-based resolution: <code>{sys.query}</code>, <code>{env.key}</code>, <code>{cpn_id@field}</code></li>
<li>Nested path support: <code>{retrieval_0@chunks.0.content}</code></li>
<li>Streaming output via <code>partial</code> generators</li>
</ul>
<p><strong>Sources:</strong> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/canvas.py">agent/canvas.py</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/component/base.py">agent/component/base.py</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/component/agent_with_tools.py">agent/component/agent_with_tools.py</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/component/llm.py">agent/component/llm.py</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/apps/canvas_app.py">api/apps/canvas_app.py</a></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.tabs", "navigation.sections", "navigation.top", "search.suggest", "search.highlight", "content.code.copy"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>