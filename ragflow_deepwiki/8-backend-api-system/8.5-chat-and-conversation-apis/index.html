
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://wiki.neurosama.uk/ragflow_deepwiki/8-backend-api-system/8.5-chat-and-conversation-apis/">
      
      
        <link rel="prev" href="../8.4-document-and-file-management-apis/">
      
      
        <link rel="next" href="../">
      
      
        
          <link rel="alternate" href="./" hreflang="en">
        
          <link rel="alternate" href="../../../zh/ragflow_deepwiki/8-backend-api-system/8.5-chat-and-conversation-apis/" hreflang="zh">
        
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Chat and Conversation APIs - DeepWiki</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#chat-and-conversation-apis" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="DeepWiki" class="md-header__button md-logo" aria-label="DeepWiki" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            DeepWiki
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Chat and Conversation APIs
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="Select language">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7 1.62-4.33L19.12 17z"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="./" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="../../../zh/ragflow_deepwiki/8-backend-api-system/8.5-chat-and-conversation-apis/" hreflang="zh" class="md-select__link">
              中文
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/Chesszyh/Wiki" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  Welcome to DeepWiki

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../celery_deepwiki/1-celery-overview/1.1-installation-and-setup/" class="md-tabs__link">
          
  
  
  Celery deepwiki

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../lc0_deepwiki/1-lc0-overview/" class="md-tabs__link">
          
  
  
  Lc0 deepwiki

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../linux_deepwiki/1-linux-kernel-overview/" class="md-tabs__link">
          
  
  
  Linux deepwiki

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../1-overview/" class="md-tabs__link">
          
  
  
  Ragflow deepwiki

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../redis_deepwiki/1-redis-overview/" class="md-tabs__link">
          
  
  
  Redis deepwiki

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../stockfish_deepwiki/2-core-data-structures-and-types/" class="md-tabs__link">
          
  
  
  Stockfish deepwiki

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="DeepWiki" class="md-nav__button md-logo" aria-label="DeepWiki" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    DeepWiki
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Chesszyh/Wiki" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Welcome to DeepWiki
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Celery deepwiki
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Celery deepwiki
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    1 celery overview
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    1 celery overview
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/1-celery-overview/1.1-installation-and-setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Installation and Setup
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/1-celery-overview/1.2-core-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Core Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/1-celery-overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Celery Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    2 the celery application
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    2 the celery application
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/2-the-celery-application/2.1-application-initialization-and-configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Application Initialization and Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/2-the-celery-application/2.2-task-registration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Task Registration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/2-the-celery-application/2.3-message-brokers-and-routing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Message Brokers and Routing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/2-the-celery-application/2.4-amqp-layer-and-message-protocol/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AMQP Layer and Message Protocol
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/2-the-celery-application/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The Celery Application
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5" >
        
          
          <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    3 tasks
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    3 tasks
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/3-tasks/3.1-task-definition-and-invocation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Task Definition and Invocation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/3-tasks/3.2-task-lifecycle-and-states/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Task Lifecycle and States
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/3-tasks/3.3-error-handling-and-retry/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Error Handling and Retry
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/3-tasks/3.4-time-limits-and-rate-limits/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Time Limits and Rate Limits
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/3-tasks/3.5-task-options-and-customization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Task Options and Customization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/3-tasks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tasks
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_7" >
        
          
          <label class="md-nav__link" for="__nav_2_7" id="__nav_2_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    4 canvas workflows
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    4 canvas workflows
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/4-canvas-workflows/4.1-signatures/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Signature and Composition
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/4-canvas-workflows/4.2-workflow-primitives/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Workflow Primitives
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/4-canvas-workflows/4.3-advanced-canvas-features/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Advanced Canvas Features
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/4-canvas-workflows/4.4-chord-execution/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chord Execution
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/4-canvas-workflows/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Canvas Workflows
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_9" >
        
          
          <label class="md-nav__link" for="__nav_2_9" id="__nav_2_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    5 workers
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    5 workers
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/5-workers/5.1-worker-architecture-and-bootsteps/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Worker Architecture and Bootsteps
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/5-workers/5.2-worker-lifecycle-and-shutdown/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Worker Lifecycle and Shutdown
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/5-workers/5.3-concurrency-models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Concurrency Models
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/5-workers/5.4-worker-configuration-and-control/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Worker Configuration and Control
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/5-workers/5.5-consumer-and-event-loops/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Consumer and Event Loops
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/5-workers/5.6-autoscaling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Autoscaling
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/5-workers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Workers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_11" >
        
          
          <label class="md-nav__link" for="__nav_2_11" id="__nav_2_11_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    6 result backends
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_11">
            <span class="md-nav__icon md-icon"></span>
            
  
    6 result backends
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/6-result-backends/6.1-backend-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Backend Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/6-result-backends/6.2-backend-implementations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Backend Implementations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/6-result-backends/6.3-result-storage-and-retrieval/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Result Serialization and Retrieval
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/6-result-backends/6.4-chord-coordination/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chord Coordination
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/6-result-backends/6.5-backend-resilience/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Error Handling and Resilience
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/6-result-backends/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Result Backends
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_13" >
        
          
          <label class="md-nav__link" for="__nav_2_13" id="__nav_2_13_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    7 periodic tasks (beat)
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_13">
            <span class="md-nav__icon md-icon"></span>
            
  
    7 periodic tasks (beat)
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/7-periodic-tasks-%28beat%29/7.1-beat-scheduler-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Beat Scheduler Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/7-periodic-tasks-%28beat%29/7.2-schedule-types/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Schedule Types
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/7-periodic-tasks-%28beat%29/7.3-time-and-timezone-handling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Time and Timezone Handling
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/7-periodic-tasks-%28beat%29/7.4-persistent-storage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Persistent Storage
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/7-periodic-tasks-%28beat%29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Periodic Tasks (Beat)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_15" >
        
          
          <label class="md-nav__link" for="__nav_2_15" id="__nav_2_15_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    8 monitoring and control
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_15_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_15">
            <span class="md-nav__icon md-icon"></span>
            
  
    8 monitoring and control
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/8-monitoring-and-control/8.1-remote-control-commands/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Remote Control Commands
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/8-monitoring-and-control/8.2-worker-inspection/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Worker Inspection
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/8-monitoring-and-control/8.3-event-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Event System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/8-monitoring-and-control/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Monitoring and Control
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_17" >
        
          
          <label class="md-nav__link" for="__nav_2_17" id="__nav_2_17_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    9 command line interface
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_17_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_17">
            <span class="md-nav__icon md-icon"></span>
            
  
    9 command line interface
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/9-command-line-interface/9.1-cli-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CLI Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/9-command-line-interface/9.2-worker-and-beat-commands/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Worker and Beat Commands
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/9-command-line-interface/9.3-management-commands/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Management Commands
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/9-command-line-interface/9.4-multi-worker-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Multi-worker Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/9-command-line-interface/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Command Line Interface
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_19" >
        
          
          <label class="md-nav__link" for="__nav_2_19" id="__nav_2_19_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    10 development and testing
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_19_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_19">
            <span class="md-nav__icon md-icon"></span>
            
  
    10 development and testing
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/10-development-and-testing/10.1-testing-infrastructure/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Testing Infrastructure
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/10-development-and-testing/10.2-test-matrix-and-environments/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Test Matrix and Environments
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/10-development-and-testing/10.3-integration-and-smoke-tests/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Integration and Smoke Tests
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/10-development-and-testing/10.4-code-quality-and-documentation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Code Quality and Documentation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/10-development-and-testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Development and Testing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_21" >
        
          
          <label class="md-nav__link" for="__nav_2_21" id="__nav_2_21_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    11 packaging and distribution
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_21_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_21">
            <span class="md-nav__icon md-icon"></span>
            
  
    11 packaging and distribution
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/11-packaging-and-distribution/11.1-package-structure/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Package Structure
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/11-packaging-and-distribution/11.2-dependencies-and-extras/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dependencies and Extras
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/11-packaging-and-distribution/11.3-version-management-and-release/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Version Management and Release
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../celery_deepwiki/11-packaging-and-distribution/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Packaging and Distribution
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Lc0 deepwiki
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Lc0 deepwiki
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/1-lc0-overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lc0 Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    2 building and installation
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    2 building and installation
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/2-building-and-installation/2.1-build-system-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Build System Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/2-building-and-installation/2.2-linux-and-macos-build-process/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Linux and macOS Build Process
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/2-building-and-installation/2.3-windows-build-process/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Windows Build Process
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/2-building-and-installation/2.4-version-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Version Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/2-building-and-installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Building and Installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    3 core engine architecture
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    3 core engine architecture
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/3-core-engine-architecture/3.1-uci-protocol-implementation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    UCI Protocol Implementation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/3-core-engine-architecture/3.2-configuration-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuration System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/3-core-engine-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Core Engine Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_6" >
        
          
          <label class="md-nav__link" for="__nav_3_6" id="__nav_3_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    4 chess representation
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    4 chess representation
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/4-chess-representation/4.1-bitboards-and-move-generation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Bitboards
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/4-chess-representation/4.2-position-encoding-and-history/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Position Encoding and History
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/4-chess-representation/4.3-syzygy-tablebase-integration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Syzygy Tablebase Integration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/4-chess-representation/4.4-pgn-and-game-import/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    PGN and Game Import
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/4-chess-representation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chess Representation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_8" >
        
          
          <label class="md-nav__link" for="__nav_3_8" id="__nav_3_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    5 search algorithm
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    5 search algorithm
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/5-search-algorithm/5.1-mcts-implementation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MCTS Implementation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/5-search-algorithm/5.2-search-parameters-and-stopping-conditions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Search Parameters and Stopping Conditions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/5-search-algorithm/5.3-search-tree-caching/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Caching System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/5-search-algorithm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Search Algorithm
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_10" >
        
          
          <label class="md-nav__link" for="__nav_3_10" id="__nav_3_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    6 neural network system
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    6 neural network system
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/6-neural-network-system/6.1-network-interface-and-backend-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Network Interface and Backend Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/6-neural-network-system/6.2-weights-loading-and-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Weights Loading and Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/6-neural-network-system/6.3-cuda-and-cudnn-backend/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CUDA and cuDNN Backend
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/6-neural-network-system/6.4-onnx-integration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ONNX Integration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/6-neural-network-system/6.5-xla-and-hlo-support/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    XLA and HLO Support
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/6-neural-network-system/6.6-memory-caching-and-performance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Memory Caching and Performance
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/6-neural-network-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Neural Network System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_12" >
        
          
          <label class="md-nav__link" for="__nav_3_12" id="__nav_3_12_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    7 self play system
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_12">
            <span class="md-nav__icon md-icon"></span>
            
  
    7 self play system
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/7-self-play-system/7.1-tournament-organization-and-game-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tournament Organization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/7-self-play-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Self-Play System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_14" >
        
          
          <label class="md-nav__link" for="__nav_3_14" id="__nav_3_14_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    8 utilities and infrastructure
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_14">
            <span class="md-nav__icon md-icon"></span>
            
  
    8 utilities and infrastructure
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/8-utilities-and-infrastructure/8.1-fast-mathematical-functions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Fast Mathematical Functions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/8-utilities-and-infrastructure/8.2-threading-and-synchronization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Threading and Synchronization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/8-utilities-and-infrastructure/8.3-benchmarking-and-performance-testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Benchmarking and Performance Testing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/8-utilities-and-infrastructure/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Utilities and Infrastructure
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_16" >
        
          
          <label class="md-nav__link" for="__nav_3_16" id="__nav_3_16_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    9 continuous integration and deployment
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_16_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_16">
            <span class="md-nav__icon md-icon"></span>
            
  
    9 continuous integration and deployment
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/9-continuous-integration-and-deployment/9.1-circleci-workflows/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CircleCI Workflows
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/9-continuous-integration-and-deployment/9.2-windows-build-and-packaging/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Windows Build and Packaging
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lc0_deepwiki/9-continuous-integration-and-deployment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Continuous Integration and Deployment
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Linux deepwiki
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Linux deepwiki
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux_deepwiki/1-linux-kernel-overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Linux Kernel Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    2 rust for linux
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    2 rust for linux
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux_deepwiki/2-rust-for-linux/2.1-rust-kernel-apis-and-abstractions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Rust Kernel APIs and Abstractions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux_deepwiki/2-rust-for-linux/2.2-nova-drm-graphics-driver/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Nova DRM Graphics Driver
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux_deepwiki/2-rust-for-linux/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Rust for Linux
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" >
        
          
          <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    3 virtualization (kvm)
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    3 virtualization (kvm)
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux_deepwiki/3-virtualization-%28kvm%29/3.1-kvm-x86-virtualization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    KVM x86 Virtualization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux_deepwiki/3-virtualization-%28kvm%29/3.2-kvm-arm64-virtualization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    KVM ARM64 Virtualization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux_deepwiki/3-virtualization-%28kvm%29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Virtualization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_6" >
        
          
          <label class="md-nav__link" for="__nav_4_6" id="__nav_4_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    4 core kernel infrastructure
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    4 core kernel infrastructure
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux_deepwiki/4-core-kernel-infrastructure/4.1-process-scheduling-and-sched_ext/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Process Scheduling and sched_ext
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux_deepwiki/4-core-kernel-infrastructure/4.2-tracing-and-observability/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tracing and Observability
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux_deepwiki/4-core-kernel-infrastructure/4.3-build-system-and-kbuild/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Build System and Kbuild
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux_deepwiki/4-core-kernel-infrastructure/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Core Kernel Infrastructure
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_8" >
        
          
          <label class="md-nav__link" for="__nav_4_8" id="__nav_4_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    5 storage and io
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    5 storage and io
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux_deepwiki/5-storage-and-io/5.1-io_uring-asynchronous-io/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    io_uring Asynchronous I/O
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux_deepwiki/5-storage-and-io/5.2-btrfs-copy-on-write-filesystem/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Btrfs Copy-on-Write Filesystem
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux_deepwiki/5-storage-and-io/5.3-ufs-storage-controller/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    UFS Storage Controller
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux_deepwiki/5-storage-and-io/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Storage and I/O
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_10" >
        
          
          <label class="md-nav__link" for="__nav_4_10" id="__nav_4_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    6 graphics and display
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    6 graphics and display
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux_deepwiki/6-graphics-and-display/6.1-amdgpu-driver/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AMDGPU Driver
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux_deepwiki/6-graphics-and-display/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Graphics and Display
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Ragflow deepwiki
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Ragflow deepwiki
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../1-overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    2 getting started and deployment
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    2 getting started and deployment
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2-getting-started-and-deployment/2.1-docker-compose-deployment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Docker Compose Deployment
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2-getting-started-and-deployment/2.4-build-system-and-cicd/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Build System and CI/CD
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2-getting-started-and-deployment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Getting Started and Deployment
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_4" >
        
          
          <label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    3 system architecture
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    3 system architecture
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../3-system-architecture/3.1-core-application-services/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Core Application Services
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../3-system-architecture/3.2-data-storage-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Data Storage Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../3-system-architecture/3.3-task-execution-and-queue-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Task Execution and Queue System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../3-system-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    System Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_6" >
        
          
          <label class="md-nav__link" for="__nav_5_6" id="__nav_5_6_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    4 frontend application
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    4 frontend application
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../4-frontend-application/4.1-internationalization-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Internationalization System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../4-frontend-application/4.2-application-structure-and-ui-features/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Application Structure and Routing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../4-frontend-application/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Frontend Application
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_8" >
        
          
          <label class="md-nav__link" for="__nav_5_8" id="__nav_5_8_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    5 llm integration system
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    5 llm integration system
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../5-llm-integration-system/5.1-model-factory-pattern-and-registration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Model Factory Pattern and Registration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../5-llm-integration-system/5.2-provider-implementations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Provider Implementations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../5-llm-integration-system/5.3-error-handling-and-retry-logic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Error Handling and Retry Logic
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../5-llm-integration-system/5.4-tenant-configuration-and-usage-tracking/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tenant Configuration and Usage Tracking
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../5-llm-integration-system/5.5-tool-calling-and-function-use/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tool Calling and Function Use
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../5-llm-integration-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LLM Integration System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_10" >
        
          
          <label class="md-nav__link" for="__nav_5_10" id="__nav_5_10_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    6 document processing pipeline
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    6 document processing pipeline
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../6-document-processing-pipeline/6.1-document-parsing-strategies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Document Parsing Strategies
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../6-document-processing-pipeline/6.2-chunking-methods/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chunking Methods
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../6-document-processing-pipeline/6.3-content-enhancement-and-embedding/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Content Enhancement and Embedding
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../6-document-processing-pipeline/6.4-layout-recognition-and-ocr/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Layout Recognition and OCR
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../6-document-processing-pipeline/6.5-knowledge-graph-construction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Knowledge Graph Construction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../6-document-processing-pipeline/6.6-raptor-hierarchical-summarization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    RAPTOR Hierarchical Summarization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../6-document-processing-pipeline/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Document Processing Pipeline
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_12" >
        
          
          <label class="md-nav__link" for="__nav_5_12" id="__nav_5_12_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    7 data source integration
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_12">
            <span class="md-nav__icon md-icon"></span>
            
  
    7 data source integration
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../7-data-source-integration/7.1-connector-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Connector Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../7-data-source-integration/7.2-synchronization-and-scheduling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Synchronization and Scheduling
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../7-data-source-integration/7.3-supported-data-sources/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Supported Data Sources
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../7-data-source-integration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Data Source Integration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_14" checked>
        
          
          <label class="md-nav__link" for="__nav_5_14" id="__nav_5_14_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    8 backend api system
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_14_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_14">
            <span class="md-nav__icon md-icon"></span>
            
  
    8 backend api system
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../8.1-api-architecture-and-sdk/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    API Architecture and SDK
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../8.2-authentication-and-authorization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Authentication and Multi-tenancy
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../8.3-dataset-and-knowledge-base-apis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dataset and Knowledge Base APIs
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../8.4-document-and-file-management-apis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Document and File Management APIs
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Chat and Conversation APIs
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Chat and Conversation APIs
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        Overview
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chat-completion-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chat Completion Flow
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Chat Completion Flow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#end-to-end-rag-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      
        End-to-End RAG Pipeline
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retrieval-pipeline-integration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Retrieval Pipeline Integration
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#session-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        Session Architecture
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Session Architecture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#system-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        System Architecture
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chat-data-models" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chat Data Models
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chat-completion-apis" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chat Completion APIs
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Chat Completion APIs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragflow-native-format" class="md-nav__link">
    <span class="md-ellipsis">
      
        RAGFlow Native Format
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#openai-compatible-format" class="md-nav__link">
    <span class="md-ellipsis">
      
        OpenAI-Compatible Format
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#streaming-response-mechanism" class="md-nav__link">
    <span class="md-ellipsis">
      
        Streaming Response Mechanism
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#session-management" class="md-nav__link">
    <span class="md-ellipsis">
      
        Session Management
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Session Management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#session-lifecycle" class="md-nav__link">
    <span class="md-ellipsis">
      
        Session Lifecycle
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-session" class="md-nav__link">
    <span class="md-ellipsis">
      
        Create Session
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-session" class="md-nav__link">
    <span class="md-ellipsis">
      
        Update Session
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#list-sessions" class="md-nav__link">
    <span class="md-ellipsis">
      
        List Sessions
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete-sessions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Delete Sessions
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agent-session-apis" class="md-nav__link">
    <span class="md-ellipsis">
      
        Agent Session APIs
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Agent Session APIs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-agent-session" class="md-nav__link">
    <span class="md-ellipsis">
      
        Create Agent Session
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#list-agent-sessions" class="md-nav__link">
    <span class="md-ellipsis">
      
        List Agent Sessions
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete-agent-sessions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Delete Agent Sessions
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-features" class="md-nav__link">
    <span class="md-ellipsis">
      
        Advanced Features
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Advanced Features">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#query-refinement" class="md-nav__link">
    <span class="md-ellipsis">
      
        Query Refinement
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metadata-filtering" class="md-nav__link">
    <span class="md-ellipsis">
      
        Metadata Filtering
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#citation-mechanisms" class="md-nav__link">
    <span class="md-ellipsis">
      
        Citation Mechanisms
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sql-based-retrieval" class="md-nav__link">
    <span class="md-ellipsis">
      
        SQL-based Retrieval
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#empty-response-handling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Empty Response Handling
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning-mode" class="md-nav__link">
    <span class="md-ellipsis">
      
        Reasoning Mode
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agent-completions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Agent Completions
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#performance-optimizations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Performance Optimizations
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Performance Optimizations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#token-budgeting" class="md-nav__link">
    <span class="md-ellipsis">
      
        Token Budgeting
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#timing-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        Timing Metrics
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#langfuse-integration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Langfuse Integration
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Error Handling
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Error Handling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#validation-errors" class="md-nav__link">
    <span class="md-ellipsis">
      
        Validation Errors
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#duplicate-id-handling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Duplicate ID Handling
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#session-query-and-filtering" class="md-nav__link">
    <span class="md-ellipsis">
      
        Session Query and Filtering
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Backend API System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_16" >
        
          
          <label class="md-nav__link" for="__nav_5_16" id="__nav_5_16_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    9 agent and workflow system
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_16_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_16">
            <span class="md-nav__icon md-icon"></span>
            
  
    9 agent and workflow system
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../9-agent-and-workflow-system/9.1-canvas-engine-and-dsl/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Canvas Engine and DSL
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../9-agent-and-workflow-system/9.2-component-system-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Component System Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../9-agent-and-workflow-system/9.3-built-in-components/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Built-in Components
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../9-agent-and-workflow-system/9.4-workflow-execution-and-streaming/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Workflow Execution and Streaming
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../9-agent-and-workflow-system/9.5-state-and-variable-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    State and Variable Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../9-agent-and-workflow-system/9.6-agent-tools-and-react-loop/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Agent Tools and ReAct Loop
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../9-agent-and-workflow-system/9.7-canvas-api-and-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Canvas API and Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../9-agent-and-workflow-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Agent and Workflow System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_18" >
        
          
          <label class="md-nav__link" for="__nav_5_18" id="__nav_5_18_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    10 retrieval and rag system
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_18_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_18">
            <span class="md-nav__icon md-icon"></span>
            
  
    10 retrieval and rag system
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../10-retrieval-and-rag-system/10.1-query-processing-and-refinement/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Query Processing and Refinement
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../10-retrieval-and-rag-system/10.2-hybrid-search-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Hybrid Search Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../10-retrieval-and-rag-system/10.3-reranking-and-metadata-filtering/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Reranking and Metadata Filtering
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../10-retrieval-and-rag-system/10.4-response-generation-and-citations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Response Generation and Citations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../10-retrieval-and-rag-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Retrieval and RAG System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Redis deepwiki
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Redis deepwiki
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/1-redis-overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Redis Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2" >
        
          
          <label class="md-nav__link" for="__nav_6_2" id="__nav_6_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    2 redis core
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    2 redis core
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/2-redis-core/2.1-server-architecture-and-lifecycle/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Server Architecture and Lifecycle
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/2-redis-core/2.2-client-connection-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Client Connection Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/2-redis-core/2.3-command-processing-pipeline/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Command Processing Pipeline
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/2-redis-core/2.4-configuration-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuration Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/2-redis-core/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Redis Core
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_4" >
        
          
          <label class="md-nav__link" for="__nav_6_4" id="__nav_6_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    3 data storage and management
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    3 data storage and management
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/3-data-storage-and-management/3.1-core-data-types-implementation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Core Data Types Implementation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/3-data-storage-and-management/3.2-streams-and-blocking-operations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Streams and Blocking Operations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/3-data-storage-and-management/3.3-hyperloglog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    HyperLogLog
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/3-data-storage-and-management/3.4-memory-efficient-data-structures/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Memory-Efficient Data Structures
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/3-data-storage-and-management/3.5-dictionary-and-key-value-store/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dictionary and Key-Value Store
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/3-data-storage-and-management/3.6-dynamic-string-library/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dynamic String Library
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/3-data-storage-and-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Data Storage and Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_6" >
        
          
          <label class="md-nav__link" for="__nav_6_6" id="__nav_6_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    4 memory management
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    4 memory management
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/4-memory-management/4.1-eviction-and-expiration-policies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Eviction and Expiration Policies
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/4-memory-management/4.2-memory-allocators-and-build-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Memory Allocators and Build System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/4-memory-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Memory Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_8" >
        
          
          <label class="md-nav__link" for="__nav_6_8" id="__nav_6_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    5 scripting and extensions
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    5 scripting and extensions
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/5-scripting-and-extensions/5.1-lua-scripting-and-redis-functions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lua Scripting and Redis Functions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/5-scripting-and-extensions/5.2-redis-module-api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Redis Module API
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/5-scripting-and-extensions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Scripting and Extensions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_10" >
        
          
          <label class="md-nav__link" for="__nav_6_10" id="__nav_6_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    6 high availability and distribution
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    6 high availability and distribution
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/6-high-availability-and-distribution/6.1-redis-cluster/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Redis Cluster
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/6-high-availability-and-distribution/6.2-redis-sentinel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Redis Sentinel
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/6-high-availability-and-distribution/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    High Availability and Scaling
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/7-persistence-and-replication/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Persistence and Replication
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_13" >
        
          
          <label class="md-nav__link" for="__nav_6_13" id="__nav_6_13_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    8 security
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_13">
            <span class="md-nav__icon md-icon"></span>
            
  
    8 security
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/8-security/8.1-access-control-lists/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Access Control Lists
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/8-security/8.2-network-security-and-tls/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Network Security and TLS
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/8-security/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Security
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_15" >
        
          
          <label class="md-nav__link" for="__nav_6_15" id="__nav_6_15_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    9 client tools
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_15_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_15">
            <span class="md-nav__icon md-icon"></span>
            
  
    9 client tools
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/9-client-tools/9.1-redis-cli-and-benchmark-tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Redis CLI and Benchmark Tools
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/9-client-tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Client Tools
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_17" >
        
          
          <label class="md-nav__link" for="__nav_6_17" id="__nav_6_17_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    10 development and testing
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_17_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_17">
            <span class="md-nav__icon md-icon"></span>
            
  
    10 development and testing
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/10-development-and-testing/10.1-build-system-and-dependencies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Build System and Dependencies
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/10-development-and-testing/10.2-testing-framework/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Testing Framework
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/10-development-and-testing/10.3-continuous-integration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Continuous Integration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redis_deepwiki/10-development-and-testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Development and Testing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Stockfish deepwiki
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Stockfish deepwiki
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stockfish_deepwiki/2-core-data-structures-and-types/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Core Data Structures and Types
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_2" >
        
          
          <label class="md-nav__link" for="__nav_7_2" id="__nav_7_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    3 board representation
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    3 board representation
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stockfish_deepwiki/3-board-representation/3.1-position-and-state-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Position and State Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stockfish_deepwiki/3-board-representation/3.2-bitboards-and-low-level-operations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Bitboards and Low-level Operations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stockfish_deepwiki/3-board-representation/3.3-move-generation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Move Generation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stockfish_deepwiki/3-board-representation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Board Representation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_4" >
        
          
          <label class="md-nav__link" for="__nav_7_4" id="__nav_7_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    4 search system
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    4 search system
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stockfish_deepwiki/4-search-system/4.1-search-algorithm-and-iterative-deepening/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Search Algorithm and Iterative Deepening
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stockfish_deepwiki/4-search-system/4.2-thread-management-and-parallel-search/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Thread Management and Parallel Search
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stockfish_deepwiki/4-search-system/4.3-move-ordering-and-move-picker/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Move Ordering and Move Picker
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stockfish_deepwiki/4-search-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Search System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_6" >
        
          
          <label class="md-nav__link" for="__nav_7_6" id="__nav_7_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    5 evaluation system
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    5 evaluation system
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stockfish_deepwiki/5-evaluation-system/5.1-nnue-neural-network-evaluation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    NNUE Neural Network Evaluation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stockfish_deepwiki/5-evaluation-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Evaluation System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_8" >
        
          
          <label class="md-nav__link" for="__nav_7_8" id="__nav_7_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    6 external interface
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    6 external interface
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stockfish_deepwiki/6-external-interface/6.1-uci-protocol-handler/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    UCI Protocol Handler
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stockfish_deepwiki/6-external-interface/6.2-uci-options-and-configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    UCI Options and Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stockfish_deepwiki/6-external-interface/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    External Interface
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_10" >
        
          
          <label class="md-nav__link" for="__nav_7_10" id="__nav_7_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    7 infrastructure and support
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    7 infrastructure and support
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stockfish_deepwiki/7-infrastructure-and-support/7.1-build-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Build System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stockfish_deepwiki/7-infrastructure-and-support/7.2-utilities-and-support-functions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Utilities and Support Functions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stockfish_deepwiki/7-infrastructure-and-support/7.3-testing-and-benchmarking/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Testing and Benchmarking
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stockfish_deepwiki/7-infrastructure-and-support/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Infrastructure and Support
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        Overview
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chat-completion-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chat Completion Flow
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Chat Completion Flow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#end-to-end-rag-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      
        End-to-End RAG Pipeline
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retrieval-pipeline-integration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Retrieval Pipeline Integration
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#session-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        Session Architecture
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Session Architecture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#system-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        System Architecture
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chat-data-models" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chat Data Models
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chat-completion-apis" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chat Completion APIs
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Chat Completion APIs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ragflow-native-format" class="md-nav__link">
    <span class="md-ellipsis">
      
        RAGFlow Native Format
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#openai-compatible-format" class="md-nav__link">
    <span class="md-ellipsis">
      
        OpenAI-Compatible Format
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#streaming-response-mechanism" class="md-nav__link">
    <span class="md-ellipsis">
      
        Streaming Response Mechanism
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#session-management" class="md-nav__link">
    <span class="md-ellipsis">
      
        Session Management
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Session Management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#session-lifecycle" class="md-nav__link">
    <span class="md-ellipsis">
      
        Session Lifecycle
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-session" class="md-nav__link">
    <span class="md-ellipsis">
      
        Create Session
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-session" class="md-nav__link">
    <span class="md-ellipsis">
      
        Update Session
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#list-sessions" class="md-nav__link">
    <span class="md-ellipsis">
      
        List Sessions
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete-sessions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Delete Sessions
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agent-session-apis" class="md-nav__link">
    <span class="md-ellipsis">
      
        Agent Session APIs
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Agent Session APIs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-agent-session" class="md-nav__link">
    <span class="md-ellipsis">
      
        Create Agent Session
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#list-agent-sessions" class="md-nav__link">
    <span class="md-ellipsis">
      
        List Agent Sessions
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete-agent-sessions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Delete Agent Sessions
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-features" class="md-nav__link">
    <span class="md-ellipsis">
      
        Advanced Features
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Advanced Features">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#query-refinement" class="md-nav__link">
    <span class="md-ellipsis">
      
        Query Refinement
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metadata-filtering" class="md-nav__link">
    <span class="md-ellipsis">
      
        Metadata Filtering
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#citation-mechanisms" class="md-nav__link">
    <span class="md-ellipsis">
      
        Citation Mechanisms
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sql-based-retrieval" class="md-nav__link">
    <span class="md-ellipsis">
      
        SQL-based Retrieval
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#empty-response-handling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Empty Response Handling
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning-mode" class="md-nav__link">
    <span class="md-ellipsis">
      
        Reasoning Mode
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agent-completions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Agent Completions
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#performance-optimizations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Performance Optimizations
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Performance Optimizations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#token-budgeting" class="md-nav__link">
    <span class="md-ellipsis">
      
        Token Budgeting
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#timing-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        Timing Metrics
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#langfuse-integration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Langfuse Integration
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Error Handling
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Error Handling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#validation-errors" class="md-nav__link">
    <span class="md-ellipsis">
      
        Validation Errors
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#duplicate-id-handling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Duplicate ID Handling
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#session-query-and-filtering" class="md-nav__link">
    <span class="md-ellipsis">
      
        Session Query and Filtering
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="chat-and-conversation-apis">Chat and Conversation APIs<a class="headerlink" href="#chat-and-conversation-apis" title="Permanent link">&para;</a></h1>
<p>Relevant source files</p>
<ul>
<li><a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/tools/retrieval.py">agent/tools/retrieval.py</a></li>
<li><a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/apps/sdk/chat.py">api/apps/sdk/chat.py</a></li>
<li><a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/apps/sdk/dataset.py">api/apps/sdk/dataset.py</a></li>
<li><a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/apps/sdk/dify_retrieval.py">api/apps/sdk/dify_retrieval.py</a></li>
<li><a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/apps/sdk/doc.py">api/apps/sdk/doc.py</a></li>
<li><a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/apps/sdk/session.py">api/apps/sdk/session.py</a></li>
<li><a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/canvas_service.py">api/db/services/canvas_service.py</a></li>
<li><a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/conversation_service.py">api/db/services/conversation_service.py</a></li>
<li><a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/utils/api_utils.py">api/utils/api_utils.py</a></li>
<li><a href="https://github.com/infiniflow/ragflow/blob/80a16e71/docs/references/http_api_reference.md">docs/references/http_api_reference.md</a></li>
<li><a href="https://github.com/infiniflow/ragflow/blob/80a16e71/docs/references/python_api_reference.md">docs/references/python_api_reference.md</a></li>
<li><a href="https://github.com/infiniflow/ragflow/blob/80a16e71/docs/release_notes.md">docs/release_notes.md</a></li>
<li><a href="https://github.com/infiniflow/ragflow/blob/80a16e71/rag/advanced_rag/__init__.py">rag/advanced_rag/__init__.py</a></li>
<li><a href="https://github.com/infiniflow/ragflow/blob/80a16e71/rag/benchmark.py">rag/benchmark.py</a></li>
<li><a href="https://github.com/infiniflow/ragflow/blob/80a16e71/sdk/python/ragflow_sdk/modules/chat.py">sdk/python/ragflow_sdk/modules/chat.py</a></li>
<li><a href="https://github.com/infiniflow/ragflow/blob/80a16e71/sdk/python/ragflow_sdk/ragflow.py">sdk/python/ragflow_sdk/ragflow.py</a></li>
</ul>
<p>This document details the chat completion and conversation management APIs in RAGFlow, covering both native and OpenAI-compatible endpoints. These APIs enable RAG-based question answering with knowledge base retrieval, automatic citation insertion, and multi-turn conversation tracking.</p>
<p>For general API authentication and structure, see <a href="/infiniflow/ragflow/8.1-api-architecture-and-sdk">8.1 API Architecture and SDK</a>. For dataset and retrieval configuration, see <a href="/infiniflow/ragflow/8.3-dataset-and-knowledge-base-apis">8.3 Dataset and Knowledge Base APIs</a>.</p>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p>RAGFlow provides two types of conversational interfaces:</p>
<ul>
<li><strong>Chat Assistants</strong> (<code>Dialog</code> model): RAG-based question answering that retrieves knowledge from datasets, generates responses with LLMs, and inserts citations. Conversations are tracked via <code>Conversation</code> sessions.</li>
<li><strong>Agent Workflows</strong> (<code>UserCanvas</code> model): Multi-step reasoning workflows that execute component graphs (see <a href="/infiniflow/ragflow/9-agent-and-workflow-system">9 Agent and Workflow System</a>). Conversations are tracked via <code>API4Conversation</code> sessions.</li>
</ul>
<p>Both interfaces support streaming responses, session persistence, and OpenAI-compatible endpoints for seamless integration with existing tools.</p>
<p>Sources: <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/apps/sdk/session.py#L1-L1028">api/apps/sdk/session.py1-1028</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/dialog_service.py#L1-L846">api/db/services/dialog_service.py1-846</a></p>
<h2 id="chat-completion-flow">Chat Completion Flow<a class="headerlink" href="#chat-completion-flow" title="Permanent link">&para;</a></h2>
<h3 id="end-to-end-rag-pipeline">End-to-End RAG Pipeline<a class="headerlink" href="#end-to-end-rag-pipeline" title="Permanent link">&para;</a></h3>
<p><strong>RAG Chat Completion Request-to-Response Flow</strong></p>
<p><pre class="mermaid"><code>flowchart TD
    REQ["POST /api/v1/chats/{chat_id}/completions"]
    REQ_VALIDATE["@token_requiredsession.py:125"]
    REQ_GET_JSON["get_request_json()"]
    DIALOG_QUERY["DialogService.query(tenant_id, id, status)"]
    CONV_QUERY["ConversationService.query(id, dialog_id)"]
    DIALOG_GET["DialogService.get_by_id(chat_id)"]
    RAG_COMP["rag_completionconversation_service.py:93"]
    CALL_CHAT["dialog_service.chat(dialog, messages, stream)"]
    CHAT_FUNC["chat()dialog_service.py:351"]
    CHECK_KB["dialog.kb_ids?"]
    CHAT_SOLO["chat_solo()dialog_service.py:181"]
    GET_MODELS["get_models(dialog)Returns: embd_mdl, chat_mdl,rerank_mdl, tts_mdl"]
    REFINE_MT["prompt_config.get('refine_multiturn')?"]
    FULL_Q["full_question()prompts/generator.py"]
    CROSS_LANG["prompt_config.get('cross_languages')?"]
    TRANSLATE["cross_languages()prompts/generator.py"]
    KEYWORD["prompt_config.get('keyword')?"]
    EXTRACT_KW["keyword_extraction()prompts/generator.py"]
    RETRIEVAL["settings.retriever.retrievalrag/nlp/search.py:359"]
    DEALER_SEARCH["Dealer.searchsearch.py:73"]
    GET_VEC["Dealer.get_vectorsearch.py:52"]
    HYBRID["docStoreConn.search(MatchText, MatchDense, FusionExpr)"]
    RERANK_CHK["rerank_mdl?"]
    RERANK_MODEL["rerank_by_modelsearch.py:330"]
    RERANK_BASE["reranksearch.py:291"]
    KB_PROMPT["kb_prompt(kbinfos, max_tokens)prompts/generator.py"]
    BUILD_MSG["msg[0] = system promptmsg.extend(messages)"]
    MSG_FIT["message_fit_in(msg, max_tokens*0.95)"]
    STREAM_LOOP["chat_mdl.chat_streamly(prompt, msg[1:], gen_conf)"]
    TOKEN_CHK["num_tokens_from_string(delta) &gt;= 16?"]
    YIELD_CHUNK["yield chunk withaudio_binary from tts()"]
    FINAL_ANS["Last answer chunk"]
    DECORATE["decorate_answer(answer)"]
    CITATION_CHK["[ID:n] pattern found?"]
    AUTO_CITE["retriever.insert_citationssearch.py:175"]
    REPAIR_CITE["repair_bad_citation_formatsdialog_service.py:250"]
    SSE_RESP["Response(mimetype='text/event-stream')"]
    CONV_APPEND["ConversationService.append_message()"]

    REQ --&gt; REQ_VALIDATE
    REQ --&gt; VALIDATE_REQ_GET_JSON
    REQ --&gt; GET_JSON_DIALOG_QUERY
    DIALOG --&gt; QUERY_CONV_QUERY
    CONV --&gt; QUERY_DIALOG_GET
    DIALOG --&gt; GET_RAG_COMP
    RAG --&gt; COMP_CALL_CHAT
    CALL --&gt; CHAT_CHAT_FUNC
    CHAT --&gt; FUNC_CHECK_KB
    CHECK --&gt; KB_CHAT_SOLO
    CHECK --&gt; KB_GET_MODELS
    GET --&gt; MODELS_REFINE_MT
    REFINE --&gt; MT_FULL_Q
    REFINE --&gt; MT_CROSS_LANG
    FULL --&gt; Q_CROSS_LANG
    CROSS --&gt; LANG_TRANSLATE
    CROSS --&gt; LANG_KEYWORD
    TRANSLATE --&gt; KEYWORD
    KEYWORD --&gt; EXTRACT_KW
    KEYWORD --&gt; RETRIEVAL
    EXTRACT --&gt; KW_RETRIEVAL
    RETRIEVAL --&gt; DEALER_SEARCH
    DEALER --&gt; SEARCH_GET_VEC
    GET --&gt; VEC_HYBRID
    HYBRID --&gt; RERANK_CHK
    RERANK --&gt; CHK_RERANK_MODEL
    RERANK --&gt; CHK_RERANK_BASE
    RERANK --&gt; MODEL_KB_PROMPT
    RERANK --&gt; BASE_KB_PROMPT
    KB --&gt; PROMPT_BUILD_MSG
    BUILD --&gt; MSG_MSG_FIT
    MSG --&gt; FIT_STREAM_LOOP
    STREAM --&gt; LOOP_TOKEN_CHK
    TOKEN --&gt; CHK_STREAM_LOOP
    TOKEN --&gt; CHK_YIELD_CHUNK
    YIELD --&gt; CHUNK_STREAM_LOOP
    STREAM --&gt; LOOP_FINAL_ANS
    FINAL --&gt; ANS_DECORATE
    DECORATE --&gt; CITATION_CHK
    CITATION --&gt; CHK_AUTO_CITE
    CITATION --&gt; CHK_REPAIR_CITE
    AUTO --&gt; CITE_REPAIR_CITE
    REPAIR --&gt; CITE_SSE_RESP
    SSE --&gt; RESP_CONV_APPEND
    CHAT --&gt; SOLO_SSE_RESP</code></pre>
Sources: <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/apps/sdk/session.py#L124-L173">api/apps/sdk/session.py124-173</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/conversation_service.py#L93-L147">api/db/services/conversation_service.py93-147</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/dialog_service.py#L281-L563">api/db/services/dialog_service.py281-563</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/dialog_service.py#L182-L216">api/db/services/dialog_service.py182-216</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/dialog_service.py#L219-L241">api/db/services/dialog_service.py219-241</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/rag/nlp/search.py#L360-L424">rag/nlp/search.py360-424</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/rag/nlp/search.py#L74-L170">rag/nlp/search.py74-170</a></p>
<h3 id="retrieval-pipeline-integration">Retrieval Pipeline Integration<a class="headerlink" href="#retrieval-pipeline-integration" title="Permanent link">&para;</a></h3>
<p>The chat API integrates with RAGFlow's hybrid search system documented in <a href="/infiniflow/ragflow/10-retrieval-and-rag-system">10 Retrieval and RAG System</a>. Key retrieval parameters from the <code>Dialog</code> model:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Default</th>
<th>Purpose</th>
<th>Code Location</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>kb_ids</code></td>
<td>list[str]</td>
<td>[]</td>
<td>Knowledge base IDs to search</td>
<td><a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/db_models.py#L540-L577">api/db/db_models.py540-577</a></td>
</tr>
<tr>
<td><code>top_n</code></td>
<td>int</td>
<td>6</td>
<td>Chunks to retrieve before reranking</td>
<td><a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/dialog_service.py#L404-L404">api/db/services/dialog_service.py404</a></td>
</tr>
<tr>
<td><code>top_k</code></td>
<td>int</td>
<td>1024</td>
<td>Top results in initial search</td>
<td><a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/dialog_service.py#L408-L408">api/db/services/dialog_service.py408</a></td>
</tr>
<tr>
<td><code>similarity_threshold</code></td>
<td>float</td>
<td>0.2</td>
<td>Minimum cosine similarity score</td>
<td><a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/dialog_service.py#L405-L405">api/db/services/dialog_service.py405</a></td>
</tr>
<tr>
<td><code>vector_similarity_weight</code></td>
<td>float</td>
<td>0.3</td>
<td>Vector vs keyword weight (0-1)</td>
<td><a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/dialog_service.py#L406-L406">api/db/services/dialog_service.py406</a></td>
</tr>
<tr>
<td><code>rerank_id</code></td>
<td>str</td>
<td>None</td>
<td>Optional reranking model ID</td>
<td><a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/dialog_service.py#L236-L237">api/db/services/dialog_service.py236-237</a></td>
</tr>
<tr>
<td><code>do_refer</code></td>
<td>bool</td>
<td>True</td>
<td>Enable/disable citation insertion</td>
<td><a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/db_models.py#L540-L577">api/db/db_models.py540-577</a></td>
</tr>
</tbody>
</table>
<p><strong>Retrieval Function Call</strong> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/dialog_service.py#L398-L412">api/db/services/dialog_service.py398-412</a>:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>kbinfos = retriever.retrieval(
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    &quot; &quot;.join(questions),               # Concatenated query questions
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    embd_mdl,                          # LLMBundle with EMBEDDING type
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    tenant_ids,                        # List of tenant IDs from kbs
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    dialog.kb_ids,                     # Knowledge base IDs
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    1,                                 # page (always 1 for chat)
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    dialog.top_n,                      # Number of chunks to retrieve
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>    dialog.similarity_threshold,       # Minimum similarity threshold
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>    dialog.vector_similarity_weight,   # Vector vs text weight
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>    doc_ids=attachments,               # Optional document ID filtering
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>    top=dialog.top_k,                  # Search breadth parameter
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>    aggs=False,                        # Don&#39;t aggregate by document
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>    rerank_mdl=rerank_mdl,            # Optional reranking model
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>    rank_feature=label_question(&quot; &quot;.join(questions), kbs)  # Tag-based ranking
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>)
</code></pre></div>
<strong>Retrieval Implementation in</strong> <code>Dealer.retrieval()</code> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/rag/nlp/search.py#L359-L424">rag/nlp/search.py359-424</a>:</p>
<ol>
<li>
<p><strong>Request Assembly</strong> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/rag/nlp/search.py#L382-L392">rag/nlp/search.py382-392</a>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>req = {
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>    &quot;kb_ids&quot;: kb_ids,
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>    &quot;doc_ids&quot;: doc_ids,
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>    &quot;page&quot;: math.ceil(page_size * page / RERANK_LIMIT),
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>    &quot;size&quot;: RERANK_LIMIT,  # Multiple of page_size for reranking
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>    &quot;question&quot;: question,
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>    &quot;vector&quot;: True,
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>    &quot;topk&quot;: top,
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>    &quot;similarity&quot;: similarity_threshold,
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>    &quot;available_int&quot;: 1,
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>}
</code></pre></div>
</li>
<li>
<p><strong>Index Name Resolution</strong> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/rag/nlp/search.py#L397-L397">rag/nlp/search.py397</a>: Converts <code>tenant_ids</code> to index names via <code>[index_name(tid) for tid in tenant_ids]</code> where <code>index_name(uid)</code> returns <code>f"ragflow_{uid}"</code> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/rag/nlp/search.py#L33-L33">rag/nlp/search.py33</a></p>
</li>
<li>
<p><strong>Hybrid Search via</strong> <code>Dealer.search()</code> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/rag/nlp/search.py#L73-L169">rag/nlp/search.py73-169</a>:</p>
<ul>
<li>Generates query vector via <code>Dealer.get_vector()</code> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/rag/nlp/search.py#L52-L60">rag/nlp/search.py52-60</a> which calls <code>embd_mdl.encode_queries(txt)</code></li>
<li>Constructs <code>MatchDenseExpr</code> with vector column name <code>f"q_{len(embedding_data)}_vec"</code></li>
<li>Builds <code>MatchText</code> expression via <code>FulltextQueryer.question()</code> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/rag/nlp/query.py">rag/nlp/query.py</a></li>
<li>Creates <code>FusionExpr</code> with <code>"weighted_sum"</code> fusion method and weights <code>"0.05,0.95"</code> (5% text, 95% vector)</li>
<li>Executes <code>docStoreConn.search()</code> with filters, match expressions, and ordering</li>
<li>
<p><strong>Reranking</strong> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/rag/nlp/search.py#L399-L423">rag/nlp/search.py399-423</a>:</p>
</li>
<li>
<p>If <code>rerank_mdl</code> exists: calls <code>rerank_by_model()</code> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/rag/nlp/search.py#L330-L351">rag/nlp/search.py330-351</a> for LLM-based scoring</p>
</li>
<li>Else: calls <code>rerank()</code> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/rag/nlp/search.py#L291-L328">rag/nlp/search.py291-328</a> for hybrid similarity using token and vector weights</li>
<li><strong>TOC Enhancement</strong> (optional) <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/dialog_service.py#L486-L489">api/db/services/dialog_service.py486-489</a>: If <code>prompt_config.get("toc_enhance")</code>, calls <code>retriever.retrieval_by_toc()</code> to expand with table-of-contents context</li>
</ul>
</li>
<li>
<p><strong>Knowledge Graph</strong> (optional) <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/dialog_service.py#L496-L500">api/db/services/dialog_service.py496-500</a>: If <code>prompt_config.get("use_kg")</code>, calls <code>settings.kg_retriever.retrieval()</code> to add graph entities</p>
</li>
</ol>
<p><strong>Return Value</strong>: <code>kbinfos</code> dict <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/rag/nlp/search.py#L375-L377">rag/nlp/search.py375-377</a>:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>{
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>    &quot;total&quot;: int,              # Total matching chunks
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>    &quot;chunks&quot;: list[dict],      # Ranked chunk objects with content_with_weight, doc_id, similarity scores, vector
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>    &quot;doc_aggs&quot;: list[dict]     # Document aggregations with doc_id, doc_name, count
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>}
</code></pre></div>
Sources: <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/dialog_service.py#L398-L427">api/db/services/dialog_service.py398-427</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/rag/nlp/search.py#L360-L424">rag/nlp/search.py360-424</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/rag/nlp/search.py#L74-L170">rag/nlp/search.py74-170</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/rag/nlp/search.py#L53-L61">rag/nlp/search.py53-61</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/rag/nlp/search.py#L34-L34">rag/nlp/search.py34</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/rag/nlp/search.py#L292-L352">rag/nlp/search.py292-352</a></p>
<h2 id="session-architecture">Session Architecture<a class="headerlink" href="#session-architecture" title="Permanent link">&para;</a></h2>
<h3 id="system-architecture">System Architecture<a class="headerlink" href="#system-architecture" title="Permanent link">&para;</a></h3>
<p><pre class="mermaid"><code>flowchart TD
    HTTPClient["HTTP ClientcURL, Postman"]
    PythonSDK["Python SDKragflow_sdk"]
    OpenAIClient["OpenAI SDKCompatible"]
    ChatRoutes["Chat Session Routes/chats//sessions/chats//completions"]
    AgentRoutes["Agent Session Routes/agents//sessions/agents//completions"]
    OpenAIRoutes["OpenAI Routes/chats_openai//chat/completions/agents_openai//chat/completions"]
    ConversationService["ConversationServiceapi/db/services/conversation_service.py"]
    API4ConversationService["API4ConversationServiceapi/db/services/api_service.py"]
    DialogService["DialogServiceRAG chat logic"]
    CanvasService["CanvasAgent workflow execution"]
    ConversationTable["Conversation TableChat sessionsmessage, reference"]
    API4ConversationTable["API4Conversation TableAgent sessionsmessage, dsl, reference"]
    DialogTable["Dialog TableChat configs"]
    UserCanvasTable["UserCanvas TableAgent configs"]

    HTTPClient --&gt; ChatRoutes
    HTTPClient --&gt; AgentRoutes
    PythonSDK --&gt; ChatRoutes
    PythonSDK --&gt; AgentRoutes
    OpenAIClient --&gt; OpenAIRoutes
    ChatRoutes --&gt; ConversationService
    AgentRoutes --&gt; API4ConversationService
    OpenAIRoutes --&gt; ConversationService
    OpenAIRoutes --&gt; API4ConversationService
    ConversationService --&gt; DialogService
    API4ConversationService --&gt; CanvasService
    ConversationService --&gt; ConversationTable
    API4ConversationService --&gt; API4ConversationTable
    DialogService --&gt; DialogTable
    CanvasService --&gt; UserCanvasTable</code></pre>
Sources: <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/apps/sdk/session.py#L1-L1028">api/apps/sdk/session.py1-1028</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/conversation_service.py#L1-L287">api/db/services/conversation_service.py1-287</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/canvas_service.py#L1-L280">api/db/services/canvas_service.py1-280</a></p>
<h3 id="chat-data-models">Chat Data Models<a class="headerlink" href="#chat-data-models" title="Permanent link">&para;</a></h3>
<p><strong>Database Schema and Response Structure</strong></p>
<p><pre class="mermaid"><code>flowchart TD
    D_id["Dialog.id(chat_id)"]
    D_tenant["Dialog.tenant_id"]
    D_kb["Dialog.kb_idsListField"]
    D_llm["Dialog.llm_id"]
    D_rerank["Dialog.rerank_id"]
    D_prompt["Dialog.prompt_configJSONField"]
    D_topn["Dialog.top_n"]
    D_thresh["Dialog.similarity_threshold"]
    D_weight["Dialog.vector_similarity_weight"]
    D_do_refer["Dialog.do_refer"]
    C_id["Conversation.id(session_id)"]
    C_dialog["Conversation.dialog_idFK to Dialog.id"]
    C_message["Conversation.messageJSONField: List[dict]"]
    C_reference["Conversation.referenceJSONField: List[dict]"]
    C_user["Conversation.user_id"]
    M_role["role: 'user' or 'assistant'"]
    M_content["content: str"]
    M_id["id: Optional[str]"]
    R_chunks["chunks: List[dict]"]
    R_doc_aggs["doc_aggs: List[dict]"]
    CH_id["id or chunk_id"]
    CH_content["content_with_weight"]
    CH_doc_id["doc_id"]
    CH_docnm["docnm_kwd"]
    CH_kb_id["kb_id"]
    CH_sim["similarity"]
    CH_vector["vector (for citation)"]
    RESP_answer["answer: str"]
    RESP_ref["reference: dict"]
    RESP_prompt["prompt: str (with timing)"]
    RESP_time["created_at: timestamp"]

    C --&gt; dialog_D_id
    C --&gt; message_M_role
    C --&gt; message_M_content
    C --&gt; message_M_id
    C --&gt; reference_R_chunks
    C --&gt; reference_R_doc_aggs
    R --&gt; chunks_CH_id
    R --&gt; chunks_CH_content
    R --&gt; chunks_CH_doc_id
    R --&gt; chunks_CH_docnm
    R --&gt; chunks_CH_kb_id
    R --&gt; chunks_CH_sim
    R --&gt; chunks_CH_vector
    RESP --&gt; ref_R_chunks
    RESP --&gt; ref_R_doc_aggs</code></pre>
Sources: <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/db_models.py#L540-L577">api/db/db_models.py540-577</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/db_models.py#L404-L421">api/db/db_models.py404-421</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/conversation_service.py#L93-L147">api/db/services/conversation_service.py93-147</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/dialog_service.py#L528-L604">api/db/services/dialog_service.py528-604</a></p>
<h2 id="chat-completion-apis">Chat Completion APIs<a class="headerlink" href="#chat-completion-apis" title="Permanent link">&para;</a></h2>
<h3 id="ragflow-native-format">RAGFlow Native Format<a class="headerlink" href="#ragflow-native-format" title="Permanent link">&para;</a></h3>
<p><strong>Endpoint</strong>: <code>POST /api/v1/chats/&lt;chat_id&gt;/completions</code></p>
<p>Executes RAG-based chat completion with RAGFlow's native streaming format.</p>
<p><strong>Route Handler</strong>: <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/apps/sdk/session.py#L124-L172">api/apps/sdk/session.py124-172</a></p>
<p><strong>Request Parameters</strong>:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>{
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>  &quot;session_id&quot;: &quot;optional_session_id&quot;,
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>  &quot;question&quot;: &quot;User question&quot;,
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>  &quot;stream&quot;: true,
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>  &quot;quote&quot;: true,
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>  &quot;doc_ids&quot;: &quot;comma-separated doc IDs for filtering&quot;
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>}
</code></pre></div>
| Parameter | Type | Required | Default | Description |
| --- | --- | --- | --- | --- |
| <code>session_id</code> | string | No | Creates new | Existing conversation session ID |
| <code>question</code> | string | Yes | - | User's question |
| <code>stream</code> | boolean | No | true | Enable SSE streaming |
| <code>quote</code> | boolean | No | true | Enable citation insertion |
| <code>doc_ids</code> | string | No | null | Comma-separated document IDs to filter retrieval |</p>
<p><strong>Streaming Response (SSE)</strong> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/conversation_service.py#L116-L137">api/db/services/conversation_service.py116-137</a>:</p>
<p>Intermediate chunks:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>data:{&quot;code&quot;:0,&quot;data&quot;:{&quot;answer&quot;:&quot;Response chunk&quot;,&quot;reference&quot;:{},&quot;audio_binary&quot;:&quot;&quot;}}
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>data:{&quot;code&quot;:0,&quot;data&quot;:{&quot;answer&quot;:&quot;More content&quot;,&quot;reference&quot;:{}}}
</code></pre></div>
Final chunk with complete metadata:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>data:{&quot;code&quot;:0,&quot;data&quot;:{&quot;answer&quot;:&quot;Final answer&quot;,&quot;reference&quot;:{&quot;chunks&quot;:[{&quot;id&quot;:&quot;abc123&quot;,&quot;content&quot;:&quot;...&quot;,&quot;doc_id&quot;:&quot;doc1&quot;,&quot;similarity&quot;:0.85}],&quot;doc_aggs&quot;:[{&quot;doc_id&quot;:&quot;doc1&quot;,&quot;doc_name&quot;:&quot;file.pdf&quot;,&quot;count&quot;:3}]},&quot;prompt&quot;:&quot;## Time elapsed:\n  - Total: 2543.1ms\n  - Retrieval: 678.9ms\n  - Generate answer: 1234.5ms&quot;,&quot;created_at&quot;:1234567890}}
</code></pre></div>
<strong>Implementation Flow</strong> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/apps/sdk/session.py#L124-L172">api/apps/sdk/session.py124-172</a>:</p>
<ol>
<li>Validates <code>Dialog</code> ownership via <code>DialogService.query(tenant_id, id, status)</code></li>
<li>Validates <code>Conversation</code> if <code>session_id</code> provided via <code>ConversationService.query(id, dialog_id)</code></li>
<li>Delegates to <code>rag_completion()</code> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/conversation_service.py#L93-L147">api/db/services/conversation_service.py93-147</a></li>
<li>Returns SSE <code>Response</code> with <code>mimetype='text/event-stream'</code> and CORS headers</li>
</ol>
<p><strong>Response Fields</strong>:</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
<th>Present In</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>answer</code></td>
<td>string</td>
<td>Generated response (partial or complete)</td>
<td>All chunks</td>
</tr>
<tr>
<td><code>reference</code></td>
<td>dict</td>
<td>Retrieved chunks and doc aggregations</td>
<td>Final chunk only</td>
</tr>
<tr>
<td><code>audio_binary</code></td>
<td>string</td>
<td>Base64 encoded audio if TTS enabled</td>
<td>All chunks</td>
</tr>
<tr>
<td><code>prompt</code></td>
<td>string</td>
<td>System prompt with timing metrics</td>
<td>Final chunk only</td>
</tr>
<tr>
<td><code>created_at</code></td>
<td>integer</td>
<td>Unix timestamp</td>
<td>Final chunk only</td>
</tr>
</tbody>
</table>
<p><strong>Citation Format</strong>: Citations are inserted as <code>[ID:0]</code>, <code>[ID:1]</code>, etc., linking to indices in the <code>reference.chunks</code> array. See <code>insert_citations()</code> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/rag/nlp/search.py#L175-L262">rag/nlp/search.py175-262</a> and <code>repair_bad_citation_formats()</code> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/dialog_service.py#L250-L276">api/db/services/dialog_service.py250-276</a></p>
<p>Sources: <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/apps/sdk/session.py#L124-L172">api/apps/sdk/session.py124-172</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/conversation_service.py#L93-L147">api/db/services/conversation_service.py93-147</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/dialog_service.py#L281-L563">api/db/services/dialog_service.py281-563</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/rag/nlp/search.py#L176-L263">rag/nlp/search.py176-263</a></p>
<h3 id="openai-compatible-format">OpenAI-Compatible Format<a class="headerlink" href="#openai-compatible-format" title="Permanent link">&para;</a></h3>
<p><strong>Endpoint</strong>: <code>POST /api/v1/chats_openai/&lt;chat_id&gt;/chat/completions</code></p>
<p>OpenAI SDK-compatible chat completion endpoint matching <a href="https://platform.openai.com/docs/api-reference/chat/create">OpenAI's API format</a>.</p>
<p><strong>Route Handler</strong>: <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/apps/sdk/session.py#L175-L443">api/apps/sdk/session.py175-443</a></p>
<p><strong>Request Parameters</strong>:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>{
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>  &quot;model&quot;: &quot;model_name&quot;,
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>  &quot;messages&quot;: [
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>    {&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;System prompt&quot;},
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>    {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;Question&quot;}
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>  ],
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>  &quot;stream&quot;: true,
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>  &quot;reference&quot;: true
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>}
</code></pre></div>
The <code>reference</code> parameter is passed via OpenAI SDK's <code>extra_body</code> parameter:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>completion = client.chat.completions.create(
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>    model=model,
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>    messages=messages,
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>    stream=True,
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>    extra_body={&quot;reference&quot;: True}
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>)
</code></pre></div>
<strong>Implementation Details</strong>:</p>
<p><strong>Message Processing</strong> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/apps/sdk/session.py#L287-L294">api/apps/sdk/session.py287-294</a>:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a># Filter system and non-sense assistant messages
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>msg = []
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>for m in messages:
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>    if m[&quot;role&quot;] == &quot;system&quot;:
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>        continue
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>    if m[&quot;role&quot;] == &quot;assistant&quot; and not msg:
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>        continue
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>    msg.append(m)
</code></pre></div>
-   <strong>System Message Filtering</strong>: System messages are excluded to avoid conflicts with <code>Dialog.prompt_config["system"]</code> which is already injected by the RAG pipeline
-   <strong>Leading Assistant Filtering</strong>: Assistant messages at the start are filtered to ensure conversations begin with user input</p>
<p><strong>Streaming Response Generator</strong> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/apps/sdk/session.py#L305-L392">api/apps/sdk/session.py305-392</a>:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>def streamed_response_generator(chat_id, dia, msg):
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>    token_used = 0
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>    answer_cache = &quot;&quot;
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>    reasoning_cache = &quot;&quot;
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>    last_ans = {}
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>    response = {
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>        &quot;id&quot;: f&quot;chatcmpl-{chat_id}&quot;,
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>        &quot;choices&quot;: [{
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>            &quot;delta&quot;: {
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>                &quot;content&quot;: &quot;&quot;,
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>                &quot;role&quot;: &quot;assistant&quot;,
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a>                &quot;function_call&quot;: None,
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a>                &quot;tool_calls&quot;: None,
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a>                &quot;reasoning_content&quot;: &quot;&quot;,
<a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a>            },
<a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a>            &quot;finish_reason&quot;: None,
<a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a>            &quot;index&quot;: 0,
<a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a>            &quot;logprobs&quot;: None,
<a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a>        }],
<a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a>        &quot;created&quot;: int(time.time()),
<a id="__codelineno-9-22" name="__codelineno-9-22" href="#__codelineno-9-22"></a>        &quot;model&quot;: &quot;model&quot;,
<a id="__codelineno-9-23" name="__codelineno-9-23" href="#__codelineno-9-23"></a>        &quot;object&quot;: &quot;chat.completion.chunk&quot;,
<a id="__codelineno-9-24" name="__codelineno-9-24" href="#__codelineno-9-24"></a>        &quot;system_fingerprint&quot;: &quot;&quot;,
<a id="__codelineno-9-25" name="__codelineno-9-25" href="#__codelineno-9-25"></a>        &quot;usage&quot;: None,
<a id="__codelineno-9-26" name="__codelineno-9-26" href="#__codelineno-9-26"></a>    }
<a id="__codelineno-9-27" name="__codelineno-9-27" href="#__codelineno-9-27"></a>
<a id="__codelineno-9-28" name="__codelineno-9-28" href="#__codelineno-9-28"></a>    try:
<a id="__codelineno-9-29" name="__codelineno-9-29" href="#__codelineno-9-29"></a>        for ans in chat(dia, msg, True, toolcall_session=toolcall_session,
<a id="__codelineno-9-30" name="__codelineno-9-30" href="#__codelineno-9-30"></a>                       tools=tools, quote=need_reference):
<a id="__codelineno-9-31" name="__codelineno-9-31" href="#__codelineno-9-31"></a>            last_ans = ans
<a id="__codelineno-9-32" name="__codelineno-9-32" href="#__codelineno-9-32"></a>            answer = ans[&quot;answer&quot;]
<a id="__codelineno-9-33" name="__codelineno-9-33" href="#__codelineno-9-33"></a>
<a id="__codelineno-9-34" name="__codelineno-9-34" href="#__codelineno-9-34"></a>            # Extract reasoning from  tags
<a id="__codelineno-9-35" name="__codelineno-9-35" href="#__codelineno-9-35"></a>            reasoning_match = re.search(r&quot;&quot;, answer, flags=re.DOTALL)
<a id="__codelineno-9-36" name="__codelineno-9-36" href="#__codelineno-9-36"></a>            if reasoning_match:
<a id="__codelineno-9-37" name="__codelineno-9-37" href="#__codelineno-9-37"></a>                reasoning_part = reasoning_match.group(1)
<a id="__codelineno-9-38" name="__codelineno-9-38" href="#__codelineno-9-38"></a>                content_part = answer[reasoning_match.end():]
<a id="__codelineno-9-39" name="__codelineno-9-39" href="#__codelineno-9-39"></a>            else:
<a id="__codelineno-9-40" name="__codelineno-9-40" href="#__codelineno-9-40"></a>                reasoning_part = &quot;&quot;
<a id="__codelineno-9-41" name="__codelineno-9-41" href="#__codelineno-9-41"></a>                content_part = answer
<a id="__codelineno-9-42" name="__codelineno-9-42" href="#__codelineno-9-42"></a>
<a id="__codelineno-9-43" name="__codelineno-9-43" href="#__codelineno-9-43"></a>            # Calculate incremental chunks
<a id="__codelineno-9-44" name="__codelineno-9-44" href="#__codelineno-9-44"></a>            reasoning_incremental = &quot;&quot;
<a id="__codelineno-9-45" name="__codelineno-9-45" href="#__codelineno-9-45"></a>            if reasoning_part:
<a id="__codelineno-9-46" name="__codelineno-9-46" href="#__codelineno-9-46"></a>                if reasoning_part.startswith(reasoning_cache):
<a id="__codelineno-9-47" name="__codelineno-9-47" href="#__codelineno-9-47"></a>                    reasoning_incremental = reasoning_part.replace(reasoning_cache, &quot;&quot;, 1)
<a id="__codelineno-9-48" name="__codelineno-9-48" href="#__codelineno-9-48"></a>                else:
<a id="__codelineno-9-49" name="__codelineno-9-49" href="#__codelineno-9-49"></a>                    reasoning_incremental = reasoning_part
<a id="__codelineno-9-50" name="__codelineno-9-50" href="#__codelineno-9-50"></a>                reasoning_cache = reasoning_part
<a id="__codelineno-9-51" name="__codelineno-9-51" href="#__codelineno-9-51"></a>
<a id="__codelineno-9-52" name="__codelineno-9-52" href="#__codelineno-9-52"></a>            content_incremental = &quot;&quot;
<a id="__codelineno-9-53" name="__codelineno-9-53" href="#__codelineno-9-53"></a>            if content_part:
<a id="__codelineno-9-54" name="__codelineno-9-54" href="#__codelineno-9-54"></a>                if content_part.startswith(answer_cache):
<a id="__codelineno-9-55" name="__codelineno-9-55" href="#__codelineno-9-55"></a>                    content_incremental = content_part.replace(answer_cache, &quot;&quot;, 1)
<a id="__codelineno-9-56" name="__codelineno-9-56" href="#__codelineno-9-56"></a>            else:
<a id="__codelineno-9-57" name="__codelineno-9-57" href="#__codelineno-9-57"></a>                content_incremental = content_part
<a id="__codelineno-9-58" name="__codelineno-9-58" href="#__codelineno-9-58"></a>            answer_cache = content_part
<a id="__codelineno-9-59" name="__codelineno-9-59" href="#__codelineno-9-59"></a>
<a id="__codelineno-9-60" name="__codelineno-9-60" href="#__codelineno-9-60"></a>            token_used += len(reasoning_incremental) + len(content_incremental)
<a id="__codelineno-9-61" name="__codelineno-9-61" href="#__codelineno-9-61"></a>
<a id="__codelineno-9-62" name="__codelineno-9-62" href="#__codelineno-9-62"></a>            if not any([reasoning_incremental, content_incremental]):
<a id="__codelineno-9-63" name="__codelineno-9-63" href="#__codelineno-9-63"></a>                continue
<a id="__codelineno-9-64" name="__codelineno-9-64" href="#__codelineno-9-64"></a>
<a id="__codelineno-9-65" name="__codelineno-9-65" href="#__codelineno-9-65"></a>            # Build response chunk
<a id="__codelineno-9-66" name="__codelineno-9-66" href="#__codelineno-9-66"></a>            response[&quot;choices&quot;][0][&quot;delta&quot;][&quot;reasoning_content&quot;] = reasoning_incremental or None
<a id="__codelineno-9-67" name="__codelineno-9-67" href="#__codelineno-9-67"></a>            response[&quot;choices&quot;][0][&quot;delta&quot;][&quot;content&quot;] = content_incremental or None
<a id="__codelineno-9-68" name="__codelineno-9-68" href="#__codelineno-9-68"></a>
<a id="__codelineno-9-69" name="__codelineno-9-69" href="#__codelineno-9-69"></a>            yield f&quot;data:{json.dumps(response, ensure_ascii=False)}\n\n&quot;
<a id="__codelineno-9-70" name="__codelineno-9-70" href="#__codelineno-9-70"></a>
<a id="__codelineno-9-71" name="__codelineno-9-71" href="#__codelineno-9-71"></a>    except Exception as e:
<a id="__codelineno-9-72" name="__codelineno-9-72" href="#__codelineno-9-72"></a>        response[&quot;choices&quot;][0][&quot;delta&quot;][&quot;content&quot;] = &quot;**ERROR**: &quot; + str(e)
<a id="__codelineno-9-73" name="__codelineno-9-73" href="#__codelineno-9-73"></a>        yield f&quot;data:{json.dumps(response, ensure_ascii=False)}\n\n&quot;
</code></pre></div>
<strong>Key Behaviors</strong>:</p>
<ul>
<li><strong>Reasoning Extraction</strong>: Parses `` tags for chain-of-thought content</li>
<li><strong>Incremental Delta</strong>: Computes delta by comparing with cached previous content</li>
<li><strong>Token Counting</strong>: Tracks token usage for final usage statistics</li>
<li><strong>Error Handling</strong>: Catches exceptions and streams error messages</li>
</ul>
<p><strong>Response Format</strong> (streaming):</p>
<p>Intermediate chunks:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>{
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>  &quot;id&quot;: &quot;chatcmpl-{chat_id}&quot;,
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>  &quot;object&quot;: &quot;chat.completion.chunk&quot;,
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>  &quot;created&quot;: 1755084508,
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>  &quot;model&quot;: &quot;model&quot;,
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>  &quot;choices&quot;: [{
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a>    &quot;delta&quot;: {
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>      &quot;content&quot;: &quot;Token chunk&quot;,
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>      &quot;role&quot;: &quot;assistant&quot;,
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a>      &quot;reasoning_content&quot;: &quot;Optional thinking process&quot;
<a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a>    },
<a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a>    &quot;finish_reason&quot;: null,
<a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a>    &quot;index&quot;: 0
<a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a>  }],
<a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a>  &quot;usage&quot;: null
<a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a>}
</code></pre></div>
Final chunk <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/apps/sdk/session.py#L382-L391">api/apps/sdk/session.py382-391</a>:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>{
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>  &quot;choices&quot;: [{
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>    &quot;delta&quot;: {
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>      &quot;content&quot;: null,
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>      &quot;reasoning_content&quot;: null,
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>      &quot;reference&quot;: {&quot;chunks&quot;: [...], &quot;doc_aggs&quot;: [...]},
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a>      &quot;final_content&quot;: &quot;Complete answer&quot;
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a>    },
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a>    &quot;finish_reason&quot;: &quot;stop&quot;
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a>  }],
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a>  &quot;usage&quot;: {
<a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a>    &quot;prompt_tokens&quot;: 5,
<a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a>    &quot;completion_tokens&quot;: 188,
<a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a>    &quot;total_tokens&quot;: 193
<a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a>  }
<a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a>}
</code></pre></div>
<strong>Non-streaming Response</strong> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/apps/sdk/session.py#L402-L440">api/apps/sdk/session.py402-440</a>:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>for ans in chat(dia, msg, False, quote=need_reference):
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>    answer = ans
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>    break
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>response = {
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>    &quot;choices&quot;: [{
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>        &quot;message&quot;: {
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a>            &quot;role&quot;: &quot;assistant&quot;,
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a>            &quot;content&quot;: answer[&quot;answer&quot;],
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a>        },
<a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a>        &quot;finish_reason&quot;: &quot;stop&quot;
<a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a>    }],
<a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a>    &quot;usage&quot;: {
<a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a>        &quot;prompt_tokens&quot;: len(prompt),
<a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a>        &quot;completion_tokens&quot;: len(answer[&quot;answer&quot;]),
<a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a>        &quot;total_tokens&quot;: len(prompt) + len(answer[&quot;answer&quot;]),
<a id="__codelineno-12-17" name="__codelineno-12-17" href="#__codelineno-12-17"></a>        &quot;completion_tokens_details&quot;: {
<a id="__codelineno-12-18" name="__codelineno-12-18" href="#__codelineno-12-18"></a>            &quot;reasoning_tokens&quot;: context_token_used,
<a id="__codelineno-12-19" name="__codelineno-12-19" href="#__codelineno-12-19"></a>            &quot;accepted_prediction_tokens&quot;: len(answer[&quot;answer&quot;]),
<a id="__codelineno-12-20" name="__codelineno-12-20" href="#__codelineno-12-20"></a>            &quot;rejected_prediction_tokens&quot;: 0
<a id="__codelineno-12-21" name="__codelineno-12-21" href="#__codelineno-12-21"></a>        }
<a id="__codelineno-12-22" name="__codelineno-12-22" href="#__codelineno-12-22"></a>    }
<a id="__codelineno-12-23" name="__codelineno-12-23" href="#__codelineno-12-23"></a>}
<a id="__codelineno-12-24" name="__codelineno-12-24" href="#__codelineno-12-24"></a>
<a id="__codelineno-12-25" name="__codelineno-12-25" href="#__codelineno-12-25"></a>if need_reference:
<a id="__codelineno-12-26" name="__codelineno-12-26" href="#__codelineno-12-26"></a>    response[&quot;choices&quot;][0][&quot;message&quot;][&quot;reference&quot;] = chunks_format(answer.get(&quot;reference&quot;, []))
</code></pre></div>
<strong>Reference Formatting</strong>: When <code>reference=true</code>, the final response includes a <code>reference</code> field formatted via <code>chunks_format()</code> from <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/rag/prompts/generator.py#LNaN-LNaN">rag/prompts/generator.py</a> which restructures the chunks dict into OpenAI-compatible format with keys like <code>content</code>, <code>document_id</code>, <code>document_name</code>, <code>dataset_id</code>, <code>similarity</code>, etc.</p>
<p>Sources: <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/apps/sdk/session.py#L175-L443">api/apps/sdk/session.py175-443</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/docs/references/http_api_reference.md#L28-L173">docs/references/http_api_reference.md28-173</a></p>
<h3 id="streaming-response-mechanism">Streaming Response Mechanism<a class="headerlink" href="#streaming-response-mechanism" title="Permanent link">&para;</a></h3>
<blockquote>
<p><strong>[Mermaid sequence]</strong>
<em>(图表结构无法解析)</em></p>
</blockquote>
<p><strong>Token Threshold Logic</strong> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/dialog_service.py#L547-L549">api/db/services/dialog_service.py547-549</a>:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>delta_ans = ans[len(last_ans):]
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>if num_tokens_from_string(delta_ans) &lt; 16:
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>    continue
</code></pre></div>
Chunks are only yielded when accumulated new tokens exceed 16 to reduce HTTP overhead and improve client-side rendering performance. This batching strategy reduces the number of SSE events sent to the client.</p>
<p><strong>Citation Insertion Flow</strong> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/dialog_service.py#L466-L483">api/db/services/dialog_service.py466-483</a>:</p>
<ol>
<li>
<p><strong>Check Existing Citations</strong> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/dialog_service.py#L468-L468">api/db/services/dialog_service.py468</a>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>if embd_mdl and not re.search(r&quot;\[ID:([0-9]+)\]&quot;, answer):
</code></pre></div>
<p>If no <code>[ID:n]</code> patterns found, proceed to auto-insertion</p>
</li>
<li>
<p><strong>Auto-Insert Citations</strong> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/dialog_service.py#L469-L476">api/db/services/dialog_service.py469-476</a>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>answer, idx = retriever.insert_citations(
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>    answer,
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>    [ck[&quot;content_ltks&quot;] for ck in kbinfos[&quot;chunks&quot;]],
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>    [ck[&quot;vector&quot;] for ck in kbinfos[&quot;chunks&quot;]],
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>    embd_mdl,
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>    tkweight=1 - dialog.vector_similarity_weight,
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>    vtweight=dialog.vector_similarity_weight,
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>)
</code></pre></div>
<p><strong>insert_citations Implementation</strong> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/rag/nlp/search.py#L176-L263">rag/nlp/search.py176-263</a>:</p>
<ul>
<li>Splits answer into sentences using regex <code>r"([^\|][；。？!！\n]|[a-z][.?;!][ \n])"</code></li>
<li>Filters sentences with length &gt;= 5 characters</li>
<li>Embeds each sentence via <code>embd_mdl.encode(pieces_)</code></li>
<li>Computes hybrid similarity between sentences and chunks using <code>qryr.hybrid_similarity()</code></li>
<li>Inserts <code>[ID:n]</code> markers where similarity exceeds threshold (starts at 0.63, decreases iteratively to 0.3)</li>
<li>Returns modified answer and set of cited chunk indices</li>
<li><strong>Extract Manual Citations</strong> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/dialog_service.py#L477-L481">api/db/services/dialog_service.py477-481</a>:</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>else:
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>    for match in re.finditer(r&quot;\[ID:([0-9]+)\]&quot;, answer):
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>        i = int(match.group(1))
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>        if i &lt; len(kbinfos[&quot;chunks&quot;]):
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>            idx.add(i)
</code></pre></div>
<p>Parse existing <code>[ID:n]</code> patterns to populate <code>idx</code> set with chunk indices</p>
</li>
<li>
<p><strong>Repair Bad Citation Formats</strong> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/dialog_service.py#L483-L483">api/db/services/dialog_service.py483</a>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>answer, idx = repair_bad_citation_formats(answer, kbinfos, idx)
</code></pre></div>
<p><strong>repair_bad_citation_formats</strong> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/dialog_service.py#L252-L278">api/db/services/dialog_service.py252-278</a> converts:</p>
<ul>
<li><code>(ID: 12)</code> → <code>[ID:12]</code></li>
<li><code>[ID: 12]</code> → <code>[ID:12]</code></li>
<li><code>【ID: 12】</code> → <code>[ID:12]</code></li>
<li><code>ref12</code> → <code>[ID:12]</code> (case insensitive)</li>
</ul>
</li>
</ol>
<p>Sources: <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/dialog_service.py#L466-L483">api/db/services/dialog_service.py466-483</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/rag/nlp/search.py#L176-L263">rag/nlp/search.py176-263</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/dialog_service.py#L252-L278">api/db/services/dialog_service.py252-278</a></p>
<h2 id="session-management">Session Management<a class="headerlink" href="#session-management" title="Permanent link">&para;</a></h2>
<h3 id="session-lifecycle">Session Lifecycle<a class="headerlink" href="#session-lifecycle" title="Permanent link">&para;</a></h3>
<h3 id="create-session">Create Session<a class="headerlink" href="#create-session" title="Permanent link">&para;</a></h3>
<p><strong>Endpoint</strong>: <code>POST /api/v1/chats/&lt;chat_id&gt;/sessions</code></p>
<p>Creates a new conversation session for a chat assistant. The session is initialized with a prologue message from the assistant's prompt configuration.</p>
<p><strong>Route Handler</strong>: <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/apps/sdk/session.py#L49-L75">api/apps/sdk/session.py49-75</a></p>
<p><strong>Request Parameters</strong>:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>{
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>  &quot;name&quot;: &quot;Session name&quot;,
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>  &quot;user_id&quot;: &quot;optional_user_identifier&quot;
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>}
</code></pre></div>
| Parameter | Type | Required | Description |
| --- | --- | --- | --- |
| <code>name</code> | string | No | Session display name (default: "New session") |
| <code>user_id</code> | string | No | User identifier for tracking |</p>
<p><strong>Implementation Flow</strong> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/apps/sdk/session.py#L49-L75">api/apps/sdk/session.py49-75</a>:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>@manager.route(&quot;/chats/&lt;chat_id&gt;/sessions&quot;, methods=[&quot;POST&quot;])
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>@token_required
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>async def create(tenant_id, chat_id):
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a>    req = await get_request_json()
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a>    req[&quot;dialog_id&quot;] = chat_id
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a>
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a>    # Validate ownership
<a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a>    dia = DialogService.query(
<a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a>        tenant_id=tenant_id,
<a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a>        id=req[&quot;dialog_id&quot;],
<a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a>        status=StatusEnum.VALID.value
<a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a>    )
<a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a>    if not dia:
<a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a>        return get_error_data_result(message=&quot;You do not own the assistant.&quot;)
<a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a>
<a id="__codelineno-19-16" name="__codelineno-19-16" href="#__codelineno-19-16"></a>    # Build session object with prologue
<a id="__codelineno-19-17" name="__codelineno-19-17" href="#__codelineno-19-17"></a>    conv = {
<a id="__codelineno-19-18" name="__codelineno-19-18" href="#__codelineno-19-18"></a>        &quot;id&quot;: get_uuid(),
<a id="__codelineno-19-19" name="__codelineno-19-19" href="#__codelineno-19-19"></a>        &quot;dialog_id&quot;: req[&quot;dialog_id&quot;],
<a id="__codelineno-19-20" name="__codelineno-19-20" href="#__codelineno-19-20"></a>        &quot;name&quot;: req.get(&quot;name&quot;, &quot;New session&quot;),
<a id="__codelineno-19-21" name="__codelineno-19-21" href="#__codelineno-19-21"></a>        &quot;message&quot;: [{
<a id="__codelineno-19-22" name="__codelineno-19-22" href="#__codelineno-19-22"></a>            &quot;role&quot;: &quot;assistant&quot;,
<a id="__codelineno-19-23" name="__codelineno-19-23" href="#__codelineno-19-23"></a>            &quot;content&quot;: dia[0].prompt_config.get(&quot;prologue&quot;)
<a id="__codelineno-19-24" name="__codelineno-19-24" href="#__codelineno-19-24"></a>        }],
<a id="__codelineno-19-25" name="__codelineno-19-25" href="#__codelineno-19-25"></a>        &quot;user_id&quot;: req.get(&quot;user_id&quot;, &quot;&quot;),
<a id="__codelineno-19-26" name="__codelineno-19-26" href="#__codelineno-19-26"></a>        &quot;reference&quot;: [{}],
<a id="__codelineno-19-27" name="__codelineno-19-27" href="#__codelineno-19-27"></a>    }
<a id="__codelineno-19-28" name="__codelineno-19-28" href="#__codelineno-19-28"></a>
<a id="__codelineno-19-29" name="__codelineno-19-29" href="#__codelineno-19-29"></a>    # Validate and save
<a id="__codelineno-19-30" name="__codelineno-19-30" href="#__codelineno-19-30"></a>    if not conv.get(&quot;name&quot;):
<a id="__codelineno-19-31" name="__codelineno-19-31" href="#__codelineno-19-31"></a>        return get_error_data_result(message=&quot;`name` can not be empty.&quot;)
<a id="__codelineno-19-32" name="__codelineno-19-32" href="#__codelineno-19-32"></a>    ConversationService.save(**conv)
<a id="__codelineno-19-33" name="__codelineno-19-33" href="#__codelineno-19-33"></a>
<a id="__codelineno-19-34" name="__codelineno-19-34" href="#__codelineno-19-34"></a>    # Retrieve saved record and format response
<a id="__codelineno-19-35" name="__codelineno-19-35" href="#__codelineno-19-35"></a>    e, conv = ConversationService.get_by_id(conv[&quot;id&quot;])
<a id="__codelineno-19-36" name="__codelineno-19-36" href="#__codelineno-19-36"></a>    if not e:
<a id="__codelineno-19-37" name="__codelineno-19-37" href="#__codelineno-19-37"></a>        return get_error_data_result(message=&quot;Fail to create a session!&quot;)
<a id="__codelineno-19-38" name="__codelineno-19-38" href="#__codelineno-19-38"></a>    conv = conv.to_dict()
<a id="__codelineno-19-39" name="__codelineno-19-39" href="#__codelineno-19-39"></a>    conv[&quot;messages&quot;] = conv.pop(&quot;message&quot;)
<a id="__codelineno-19-40" name="__codelineno-19-40" href="#__codelineno-19-40"></a>    conv[&quot;chat_id&quot;] = conv.pop(&quot;dialog_id&quot;)
<a id="__codelineno-19-41" name="__codelineno-19-41" href="#__codelineno-19-41"></a>    del conv[&quot;reference&quot;]
<a id="__codelineno-19-42" name="__codelineno-19-42" href="#__codelineno-19-42"></a>    return get_result(data=conv)
</code></pre></div>
<strong>Response</strong>:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>{
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>  &quot;code&quot;: 0,
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>  &quot;data&quot;: {
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a>    &quot;id&quot;: &quot;session_uuid&quot;,
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a>    &quot;chat_id&quot;: &quot;chat_id&quot;,
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a>    &quot;name&quot;: &quot;Session name&quot;,
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a>    &quot;messages&quot;: [
<a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a>      {
<a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a>        &quot;role&quot;: &quot;assistant&quot;,
<a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a>        &quot;content&quot;: &quot;Prologue message from Dialog.prompt_config[&#39;prologue&#39;]&quot;
<a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a>      }
<a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a>    ],
<a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a>    &quot;user_id&quot;: &quot;user_id&quot;
<a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a>  }
<a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a>}
</code></pre></div>
<strong>Database Schema</strong>: The <code>Conversation</code> model <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/db_models.py#L404-L421">api/db/db_models.py404-421</a> stores:</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Nullable</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>String(UUID)</td>
<td>No</td>
<td>Primary key</td>
</tr>
<tr>
<td><code>dialog_id</code></td>
<td>String</td>
<td>No</td>
<td>Foreign key to Dialog.id</td>
</tr>
<tr>
<td><code>message</code></td>
<td>JSONField</td>
<td>Yes</td>
<td>List of message dicts with role, content, id</td>
</tr>
<tr>
<td><code>reference</code></td>
<td>JSONField</td>
<td>Yes</td>
<td>List of reference dicts for each assistant message</td>
</tr>
<tr>
<td><code>user_id</code></td>
<td>String</td>
<td>Yes</td>
<td>User identifier for tracking</td>
</tr>
<tr>
<td><code>name</code></td>
<td>String</td>
<td>Yes</td>
<td>Session display name</td>
</tr>
<tr>
<td><code>source</code></td>
<td>String</td>
<td>Yes</td>
<td>Session source (e.g., "agent" for Canvas)</td>
</tr>
</tbody>
</table>
<p>Sources: <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/apps/sdk/session.py#L49-L75">api/apps/sdk/session.py49-75</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/conversation_service.py#L18-L28">api/db/services/conversation_service.py18-28</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/db_models.py#L404-L421">api/db/db_models.py404-421</a></p>
<h3 id="update-session">Update Session<a class="headerlink" href="#update-session" title="Permanent link">&para;</a></h3>
<p><strong>Endpoint</strong>: <code>PUT /api/v1/chats/&lt;chat_id&gt;/sessions/&lt;session_id&gt;</code></p>
<p>Updates session metadata. Message content and references cannot be modified through this endpoint.</p>
<p><strong>Route Handler</strong>: <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/apps/sdk/session.py#L102-L121">api/apps/sdk/session.py102-121</a></p>
<p><strong>Request</strong>:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>{
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>  &quot;name&quot;: &quot;Updated session name&quot;
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>}
</code></pre></div>
<strong>Validation</strong>:</p>
<ul>
<li>Rejects updates to <code>message</code> or <code>reference</code> fields</li>
<li>Validates <code>name</code> is not empty</li>
<li>Verifies tenant ownership of both chat and session</li>
</ul>
<p>Sources: <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/apps/sdk/session.py#L102-L121">api/apps/sdk/session.py102-121</a></p>
<h3 id="list-sessions">List Sessions<a class="headerlink" href="#list-sessions" title="Permanent link">&para;</a></h3>
<p><strong>Endpoint</strong>: <code>GET /api/v1/chats/&lt;chat_id&gt;/sessions</code></p>
<p>Retrieves paginated list of sessions for a chat assistant with optional filtering.</p>
<p><strong>Route Handler</strong>: <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/apps/sdk/session.py#L661-L714">api/apps/sdk/session.py661-714</a></p>
<p><strong>Query Parameters</strong>:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>string</td>
<td>null</td>
<td>Filter by session ID</td>
</tr>
<tr>
<td><code>name</code></td>
<td>string</td>
<td>null</td>
<td>Filter by session name</td>
</tr>
<tr>
<td><code>user_id</code></td>
<td>string</td>
<td>null</td>
<td>Filter by user ID</td>
</tr>
<tr>
<td><code>page</code></td>
<td>integer</td>
<td>1</td>
<td>Page number</td>
</tr>
<tr>
<td><code>page_size</code></td>
<td>integer</td>
<td>30</td>
<td>Items per page</td>
</tr>
<tr>
<td><code>orderby</code></td>
<td>string</td>
<td>"create_time"</td>
<td>Sort field</td>
</tr>
<tr>
<td><code>desc</code></td>
<td>boolean</td>
<td>true</td>
<td>Sort descending</td>
</tr>
</tbody>
</table>
<p><strong>Implementation</strong> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/apps/sdk/session.py#L661-L714">api/apps/sdk/session.py661-714</a>:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>@manager.route(&quot;/chats/&lt;chat_id&gt;/sessions&quot;, methods=[&quot;GET&quot;])
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>@token_required
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>def list_session(tenant_id, chat_id):
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a>    # Validate ownership
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a>    if not DialogService.query(tenant_id=tenant_id, id=chat_id, status=StatusEnum.VALID.value):
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a>        return get_error_data_result(message=f&quot;You don&#39;t own the assistant {chat_id}.&quot;)
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a>
<a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a>    # Parse query parameters
<a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a>    id = request.args.get(&quot;id&quot;)
<a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a>    name = request.args.get(&quot;name&quot;)
<a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a>    page_number = int(request.args.get(&quot;page&quot;, 1))
<a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a>    items_per_page = int(request.args.get(&quot;page_size&quot;, 30))
<a id="__codelineno-22-13" name="__codelineno-22-13" href="#__codelineno-22-13"></a>    orderby = request.args.get(&quot;orderby&quot;, &quot;create_time&quot;)
<a id="__codelineno-22-14" name="__codelineno-22-14" href="#__codelineno-22-14"></a>    user_id = request.args.get(&quot;user_id&quot;)
<a id="__codelineno-22-15" name="__codelineno-22-15" href="#__codelineno-22-15"></a>    desc = request.args.get(&quot;desc&quot;, &quot;true&quot;).lower() != &quot;false&quot;
<a id="__codelineno-22-16" name="__codelineno-22-16" href="#__codelineno-22-16"></a>
<a id="__codelineno-22-17" name="__codelineno-22-17" href="#__codelineno-22-17"></a>    # Query sessions
<a id="__codelineno-22-18" name="__codelineno-22-18" href="#__codelineno-22-18"></a>    convs = ConversationService.get_list(
<a id="__codelineno-22-19" name="__codelineno-22-19" href="#__codelineno-22-19"></a>        chat_id, page_number, items_per_page, orderby, desc, id, name, user_id
<a id="__codelineno-22-20" name="__codelineno-22-20" href="#__codelineno-22-20"></a>    )
<a id="__codelineno-22-21" name="__codelineno-22-21" href="#__codelineno-22-21"></a>
<a id="__codelineno-22-22" name="__codelineno-22-22" href="#__codelineno-22-22"></a>    # Process each conversation
<a id="__codelineno-22-23" name="__codelineno-22-23" href="#__codelineno-22-23"></a>    for conv in convs:
<a id="__codelineno-22-24" name="__codelineno-22-24" href="#__codelineno-22-24"></a>        # Merge references with messages
<a id="__codelineno-22-25" name="__codelineno-22-25" href="#__codelineno-22-25"></a>        messages = conv[&quot;message&quot;]
<a id="__codelineno-22-26" name="__codelineno-22-26" href="#__codelineno-22-26"></a>        references = conv.get(&quot;reference&quot;, [])
<a id="__codelineno-22-27" name="__codelineno-22-27" href="#__codelineno-22-27"></a>
<a id="__codelineno-22-28" name="__codelineno-22-28" href="#__codelineno-22-28"></a>        for i, message in enumerate(messages):
<a id="__codelineno-22-29" name="__codelineno-22-29" href="#__codelineno-22-29"></a>            if message[&quot;role&quot;] == &quot;assistant&quot; and i &lt; len(references):
<a id="__codelineno-22-30" name="__codelineno-22-30" href="#__codelineno-22-30"></a>                reference = references[i]
<a id="__codelineno-22-31" name="__codelineno-22-31" href="#__codelineno-22-31"></a>                if not isinstance(reference, dict) or not reference:
<a id="__codelineno-22-32" name="__codelineno-22-32" href="#__codelineno-22-32"></a>                    continue
<a id="__codelineno-22-33" name="__codelineno-22-33" href="#__codelineno-22-33"></a>
<a id="__codelineno-22-34" name="__codelineno-22-34" href="#__codelineno-22-34"></a>                # Map chunk fields
<a id="__codelineno-22-35" name="__codelineno-22-35" href="#__codelineno-22-35"></a>                chunks = reference.get(&quot;chunks&quot;, [])
<a id="__codelineno-22-36" name="__codelineno-22-36" href="#__codelineno-22-36"></a>                mapped_chunks = []
<a id="__codelineno-22-37" name="__codelineno-22-37" href="#__codelineno-22-37"></a>                for chunk in chunks:
<a id="__codelineno-22-38" name="__codelineno-22-38" href="#__codelineno-22-38"></a>                    mapped_chunk = {
<a id="__codelineno-22-39" name="__codelineno-22-39" href="#__codelineno-22-39"></a>                        &quot;id&quot;: chunk.get(&quot;chunk_id&quot;) or chunk.get(&quot;id&quot;),
<a id="__codelineno-22-40" name="__codelineno-22-40" href="#__codelineno-22-40"></a>                        &quot;content&quot;: chunk.get(&quot;content_with_weight&quot;) or chunk.get(&quot;content_ltks&quot;) or chunk.get(&quot;content&quot;),
<a id="__codelineno-22-41" name="__codelineno-22-41" href="#__codelineno-22-41"></a>                        &quot;document_id&quot;: chunk.get(&quot;doc_id&quot;),
<a id="__codelineno-22-42" name="__codelineno-22-42" href="#__codelineno-22-42"></a>                        &quot;document_name&quot;: chunk.get(&quot;docnm_kwd&quot;),
<a id="__codelineno-22-43" name="__codelineno-22-43" href="#__codelineno-22-43"></a>                        &quot;dataset_id&quot;: chunk.get(&quot;kb_id&quot;)[0] if isinstance(chunk.get(&quot;kb_id&quot;), list) else chunk.get(&quot;kb_id&quot;),
<a id="__codelineno-22-44" name="__codelineno-22-44" href="#__codelineno-22-44"></a>                        &quot;image_id&quot;: chunk.get(&quot;img_id&quot;, &quot;&quot;),
<a id="__codelineno-22-45" name="__codelineno-22-45" href="#__codelineno-22-45"></a>                        &quot;similarity&quot;: chunk.get(&quot;similarity&quot;, 0.0),
<a id="__codelineno-22-46" name="__codelineno-22-46" href="#__codelineno-22-46"></a>                        &quot;term_similarity&quot;: chunk.get(&quot;term_similarity&quot;, 0.0),
<a id="__codelineno-22-47" name="__codelineno-22-47" href="#__codelineno-22-47"></a>                        &quot;vector_similarity&quot;: chunk.get(&quot;vector_similarity&quot;, 0.0),
<a id="__codelineno-22-48" name="__codelineno-22-48" href="#__codelineno-22-48"></a>                        &quot;positions&quot;: chunk.get(&quot;positions&quot;, [])
<a id="__codelineno-22-49" name="__codelineno-22-49" href="#__codelineno-22-49"></a>                    }
<a id="__codelineno-22-50" name="__codelineno-22-50" href="#__codelineno-22-50"></a>                    mapped_chunks.append(mapped_chunk)
<a id="__codelineno-22-51" name="__codelineno-22-51" href="#__codelineno-22-51"></a>
<a id="__codelineno-22-52" name="__codelineno-22-52" href="#__codelineno-22-52"></a>                message[&quot;reference&quot;] = mapped_chunks
<a id="__codelineno-22-53" name="__codelineno-22-53" href="#__codelineno-22-53"></a>
<a id="__codelineno-22-54" name="__codelineno-22-54" href="#__codelineno-22-54"></a>        conv[&quot;messages&quot;] = messages
<a id="__codelineno-22-55" name="__codelineno-22-55" href="#__codelineno-22-55"></a>        conv[&quot;chat_id&quot;] = conv.pop(&quot;dialog_id&quot;)
<a id="__codelineno-22-56" name="__codelineno-22-56" href="#__codelineno-22-56"></a>        del conv[&quot;message&quot;]
<a id="__codelineno-22-57" name="__codelineno-22-57" href="#__codelineno-22-57"></a>        del conv[&quot;reference&quot;]
<a id="__codelineno-22-58" name="__codelineno-22-58" href="#__codelineno-22-58"></a>
<a id="__codelineno-22-59" name="__codelineno-22-59" href="#__codelineno-22-59"></a>    return get_result(data=convs)
</code></pre></div>
<strong>Response Format</strong>:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>{
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>  &quot;code&quot;: 0,
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>  &quot;data&quot;: [
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a>    {
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a>      &quot;id&quot;: &quot;session_id&quot;,
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a>      &quot;chat_id&quot;: &quot;chat_id&quot;,
<a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a>      &quot;name&quot;: &quot;Session name&quot;,
<a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a>      &quot;messages&quot;: [
<a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a>        {
<a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a>          &quot;role&quot;: &quot;user&quot;,
<a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a>          &quot;content&quot;: &quot;Question&quot;
<a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a>        },
<a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a>        {
<a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a>          &quot;role&quot;: &quot;assistant&quot;,
<a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a>          &quot;content&quot;: &quot;Answer with [ID:0] citation&quot;,
<a id="__codelineno-23-16" name="__codelineno-23-16" href="#__codelineno-23-16"></a>          &quot;reference&quot;: [
<a id="__codelineno-23-17" name="__codelineno-23-17" href="#__codelineno-23-17"></a>            {
<a id="__codelineno-23-18" name="__codelineno-23-18" href="#__codelineno-23-18"></a>              &quot;id&quot;: &quot;chunk_id&quot;,
<a id="__codelineno-23-19" name="__codelineno-23-19" href="#__codelineno-23-19"></a>              &quot;content&quot;: &quot;chunk content text&quot;,
<a id="__codelineno-23-20" name="__codelineno-23-20" href="#__codelineno-23-20"></a>              &quot;document_id&quot;: &quot;doc_id&quot;,
<a id="__codelineno-23-21" name="__codelineno-23-21" href="#__codelineno-23-21"></a>              &quot;document_name&quot;: &quot;document.pdf&quot;,
<a id="__codelineno-23-22" name="__codelineno-23-22" href="#__codelineno-23-22"></a>              &quot;dataset_id&quot;: &quot;kb_id&quot;,
<a id="__codelineno-23-23" name="__codelineno-23-23" href="#__codelineno-23-23"></a>              &quot;image_id&quot;: &quot;&quot;,
<a id="__codelineno-23-24" name="__codelineno-23-24" href="#__codelineno-23-24"></a>              &quot;similarity&quot;: 0.85,
<a id="__codelineno-23-25" name="__codelineno-23-25" href="#__codelineno-23-25"></a>              &quot;term_similarity&quot;: 0.75,
<a id="__codelineno-23-26" name="__codelineno-23-26" href="#__codelineno-23-26"></a>              &quot;vector_similarity&quot;: 0.92,
<a id="__codelineno-23-27" name="__codelineno-23-27" href="#__codelineno-23-27"></a>              &quot;positions&quot;: [[1, 100, 200, 300, 400]]
<a id="__codelineno-23-28" name="__codelineno-23-28" href="#__codelineno-23-28"></a>            }
<a id="__codelineno-23-29" name="__codelineno-23-29" href="#__codelineno-23-29"></a>          ]
<a id="__codelineno-23-30" name="__codelineno-23-30" href="#__codelineno-23-30"></a>        }
<a id="__codelineno-23-31" name="__codelineno-23-31" href="#__codelineno-23-31"></a>      ]
<a id="__codelineno-23-32" name="__codelineno-23-32" href="#__codelineno-23-32"></a>    }
<a id="__codelineno-23-33" name="__codelineno-23-33" href="#__codelineno-23-33"></a>  ]
<a id="__codelineno-23-34" name="__codelineno-23-34" href="#__codelineno-23-34"></a>}
</code></pre></div>
<strong>Reference Chunk Field Mapping</strong> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/apps/sdk/session.py#L684-L705">api/apps/sdk/session.py684-705</a>:</p>
<table>
<thead>
<tr>
<th>Internal Field</th>
<th>API Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>chunk_id</code> or <code>id</code></td>
<td><code>id</code></td>
<td>string</td>
<td>Chunk unique identifier</td>
</tr>
<tr>
<td><code>content_with_weight</code> or <code>content_ltks</code> or <code>content</code></td>
<td><code>content</code></td>
<td>string</td>
<td>Chunk text content</td>
</tr>
<tr>
<td><code>doc_id</code></td>
<td><code>document_id</code></td>
<td>string</td>
<td>Parent document ID</td>
</tr>
<tr>
<td><code>docnm_kwd</code></td>
<td><code>document_name</code></td>
<td>string</td>
<td>Document filename</td>
</tr>
<tr>
<td><code>kb_id[0]</code> if list else <code>kb_id</code></td>
<td><code>dataset_id</code></td>
<td>string</td>
<td>Knowledge base ID (extracts first if list)</td>
</tr>
<tr>
<td><code>img_id</code></td>
<td><code>image_id</code></td>
<td>string</td>
<td>Associated image ID (default: "")</td>
</tr>
<tr>
<td><code>similarity</code></td>
<td><code>similarity</code></td>
<td>float</td>
<td>Combined similarity score (default: 0.0)</td>
</tr>
<tr>
<td><code>term_similarity</code></td>
<td><code>term_similarity</code></td>
<td>float</td>
<td>Keyword match score (default: 0.0)</td>
</tr>
<tr>
<td><code>vector_similarity</code></td>
<td><code>vector_similarity</code></td>
<td>float</td>
<td>Vector cosine similarity (default: 0.0)</td>
</tr>
<tr>
<td><code>positions</code></td>
<td><code>positions</code></td>
<td>list[list[int]]</td>
<td>Bounding boxes <code>[page, x, y, w, h]</code> (default: [])</td>
</tr>
</tbody>
</table>
<p>Sources: <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/apps/sdk/session.py#L661-L714">api/apps/sdk/session.py661-714</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/conversation_service.py#L34-L49">api/db/services/conversation_service.py34-49</a></p>
<h3 id="delete-sessions">Delete Sessions<a class="headerlink" href="#delete-sessions" title="Permanent link">&para;</a></h3>
<p><strong>Endpoint</strong>: <code>DELETE /api/v1/chats/&lt;chat_id&gt;/sessions</code></p>
<p>Deletes one or more sessions. Supports bulk deletion with error handling for partial failures.</p>
<p><strong>Route Handler</strong>: <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/apps/sdk/session.py#L780-L828">api/apps/sdk/session.py780-828</a></p>
<p><strong>Request</strong>:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>{
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a>  &quot;ids&quot;: [&quot;session_id_1&quot;, &quot;session_id_2&quot;]
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>}
</code></pre></div>
If <code>ids</code> is <code>null</code>, all sessions for the chat are deleted. If <code>ids</code> is an empty array, no sessions are deleted.</p>
<p><strong>Response</strong> (partial success):</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>{
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>  &quot;code&quot;: 0,
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>  &quot;data&quot;: {
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a>    &quot;success_count&quot;: 1,
<a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a>    &quot;errors&quot;: [&quot;Session session_id_2 not found&quot;]
<a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a>  },
<a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a>  &quot;message&quot;: &quot;Partially deleted 1 sessions with 1 errors&quot;
<a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a>}
</code></pre></div>
Sources: <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/apps/sdk/session.py#L780-L828">api/apps/sdk/session.py780-828</a></p>
<h2 id="agent-session-apis">Agent Session APIs<a class="headerlink" href="#agent-session-apis" title="Permanent link">&para;</a></h2>
<h3 id="create-agent-session">Create Agent Session<a class="headerlink" href="#create-agent-session" title="Permanent link">&para;</a></h3>
<p><strong>Endpoint</strong>: <code>POST /api/v1/agents/&lt;agent_id&gt;/sessions</code></p>
<p>Creates a new session for an agent (Canvas workflow). Initializes the Canvas state machine and stores the DSL.</p>
<p><strong>Route Handler</strong>: <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/apps/sdk/session.py#L78-L99">api/apps/sdk/session.py78-99</a></p>
<p><strong>Query Parameters</strong>:</p>
<ul>
<li><code>user_id</code>: Optional user identifier (defaults to <code>tenant_id</code>)</li>
</ul>
<p><strong>Implementation</strong> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/apps/sdk/session.py#L78-L99">api/apps/sdk/session.py78-99</a>:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>@manager.route(&quot;/agents/&lt;agent_id&gt;/sessions&quot;, methods=[&quot;POST&quot;])
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a>@token_required
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a>def create_agent_session(tenant_id, agent_id):
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a>    user_id = request.args.get(&quot;user_id&quot;, tenant_id)
<a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a>
<a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a>    # Load agent configuration
<a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a>    e, cvs = UserCanvasService.get_by_id(agent_id)
<a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a>    if not e:
<a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a>        return get_error_data_result(&quot;Agent not found.&quot;)
<a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a>
<a id="__codelineno-26-11" name="__codelineno-26-11" href="#__codelineno-26-11"></a>    # Validate ownership
<a id="__codelineno-26-12" name="__codelineno-26-12" href="#__codelineno-26-12"></a>    if not UserCanvasService.query(user_id=tenant_id, id=agent_id):
<a id="__codelineno-26-13" name="__codelineno-26-13" href="#__codelineno-26-13"></a>        return get_error_data_result(&quot;You cannot access the agent.&quot;)
<a id="__codelineno-26-14" name="__codelineno-26-14" href="#__codelineno-26-14"></a>
<a id="__codelineno-26-15" name="__codelineno-26-15" href="#__codelineno-26-15"></a>    # Ensure DSL is string format
<a id="__codelineno-26-16" name="__codelineno-26-16" href="#__codelineno-26-16"></a>    if not isinstance(cvs.dsl, str):
<a id="__codelineno-26-17" name="__codelineno-26-17" href="#__codelineno-26-17"></a>        cvs.dsl = json.dumps(cvs.dsl, ensure_ascii=False)
<a id="__codelineno-26-18" name="__codelineno-26-18" href="#__codelineno-26-18"></a>
<a id="__codelineno-26-19" name="__codelineno-26-19" href="#__codelineno-26-19"></a>    # Initialize Canvas state machine
<a id="__codelineno-26-20" name="__codelineno-26-20" href="#__codelineno-26-20"></a>    session_id = get_uuid()
<a id="__codelineno-26-21" name="__codelineno-26-21" href="#__codelineno-26-21"></a>    canvas = Canvas(cvs.dsl, tenant_id, agent_id)
<a id="__codelineno-26-22" name="__codelineno-26-22" href="#__codelineno-26-22"></a>    canvas.reset()
<a id="__codelineno-26-23" name="__codelineno-26-23" href="#__codelineno-26-23"></a>
<a id="__codelineno-26-24" name="__codelineno-26-24" href="#__codelineno-26-24"></a>    # Create session record
<a id="__codelineno-26-25" name="__codelineno-26-25" href="#__codelineno-26-25"></a>    cvs.dsl = json.loads(str(canvas))
<a id="__codelineno-26-26" name="__codelineno-26-26" href="#__codelineno-26-26"></a>    conv = {
<a id="__codelineno-26-27" name="__codelineno-26-27" href="#__codelineno-26-27"></a>        &quot;id&quot;: session_id,
<a id="__codelineno-26-28" name="__codelineno-26-28" href="#__codelineno-26-28"></a>        &quot;dialog_id&quot;: cvs.id,
<a id="__codelineno-26-29" name="__codelineno-26-29" href="#__codelineno-26-29"></a>        &quot;user_id&quot;: user_id,
<a id="__codelineno-26-30" name="__codelineno-26-30" href="#__codelineno-26-30"></a>        &quot;message&quot;: [{&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: canvas.get_prologue()}],
<a id="__codelineno-26-31" name="__codelineno-26-31" href="#__codelineno-26-31"></a>        &quot;source&quot;: &quot;agent&quot;,
<a id="__codelineno-26-32" name="__codelineno-26-32" href="#__codelineno-26-32"></a>        &quot;dsl&quot;: cvs.dsl
<a id="__codelineno-26-33" name="__codelineno-26-33" href="#__codelineno-26-33"></a>    }
<a id="__codelineno-26-34" name="__codelineno-26-34" href="#__codelineno-26-34"></a>    API4ConversationService.save(**conv)
<a id="__codelineno-26-35" name="__codelineno-26-35" href="#__codelineno-26-35"></a>
<a id="__codelineno-26-36" name="__codelineno-26-36" href="#__codelineno-26-36"></a>    conv[&quot;agent_id&quot;] = conv.pop(&quot;dialog_id&quot;)
<a id="__codelineno-26-37" name="__codelineno-26-37" href="#__codelineno-26-37"></a>    return get_result(data=conv)
</code></pre></div>
<strong>Canvas Initialization</strong>:</p>
<ul>
<li><code>Canvas(cvs.dsl, tenant_id, agent_id)</code>: Parses DSL JSON and builds component graph</li>
<li><code>canvas.reset()</code>: Initializes component states and variables</li>
<li><code>canvas.get_prologue()</code>: Retrieves welcome message from Begin component's <code>prologue</code> parameter</li>
</ul>
<p><strong>Response</strong>:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>{
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>  &quot;code&quot;: 0,
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>  &quot;data&quot;: {
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a>    &quot;id&quot;: &quot;session_id&quot;,
<a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a>    &quot;agent_id&quot;: &quot;agent_id&quot;,
<a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a>    &quot;user_id&quot;: &quot;user_id&quot;,
<a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a>    &quot;message&quot;: [
<a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a>      {
<a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a>        &quot;role&quot;: &quot;assistant&quot;,
<a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a>        &quot;content&quot;: &quot;Welcome message from Begin component&quot;
<a id="__codelineno-27-11" name="__codelineno-27-11" href="#__codelineno-27-11"></a>      }
<a id="__codelineno-27-12" name="__codelineno-27-12" href="#__codelineno-27-12"></a>    ],
<a id="__codelineno-27-13" name="__codelineno-27-13" href="#__codelineno-27-13"></a>    &quot;source&quot;: &quot;agent&quot;,
<a id="__codelineno-27-14" name="__codelineno-27-14" href="#__codelineno-27-14"></a>    &quot;dsl&quot;: {
<a id="__codelineno-27-15" name="__codelineno-27-15" href="#__codelineno-27-15"></a>      &quot;components&quot;: {...},
<a id="__codelineno-27-16" name="__codelineno-27-16" href="#__codelineno-27-16"></a>      &quot;history&quot;: [...],
<a id="__codelineno-27-17" name="__codelineno-27-17" href="#__codelineno-27-17"></a>      &quot;path&quot;: [...],
<a id="__codelineno-27-18" name="__codelineno-27-18" href="#__codelineno-27-18"></a>      ...
<a id="__codelineno-27-19" name="__codelineno-27-19" href="#__codelineno-27-19"></a>    }
<a id="__codelineno-27-20" name="__codelineno-27-20" href="#__codelineno-27-20"></a>  }
<a id="__codelineno-27-21" name="__codelineno-27-21" href="#__codelineno-27-21"></a>}
</code></pre></div>
<strong>DSL Structure</strong>: The <code>dsl</code> field contains the complete Canvas workflow definition:</p>
<ul>
<li><code>components</code>: Dict mapping component IDs to component definitions with <code>obj_name</code>, <code>params</code>, <code>downstream</code></li>
<li><code>history</code>: List of execution history entries</li>
<li><code>path</code>: List of component IDs in execution order</li>
<li><code>messages</code>: List of conversation messages</li>
</ul>
<p><strong>Database Schema</strong>: The <code>API4Conversation</code> model extends <code>Conversation</code> with:</p>
<ul>
<li><code>source</code>: String indicating origin ("agent" for Canvas workflows)</li>
<li><code>dsl</code>: JSON field storing Canvas workflow state</li>
</ul>
<p>Sources: <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/apps/sdk/session.py#L78-L99">api/apps/sdk/session.py78-99</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/agent/canvas.py">agent/canvas.py</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/api_service.py">api/db/services/api_service.py</a></p>
<h3 id="list-agent-sessions">List Agent Sessions<a class="headerlink" href="#list-agent-sessions" title="Permanent link">&para;</a></h3>
<p><strong>Endpoint</strong>: <code>GET /api/v1/agents/&lt;agent_id&gt;/sessions</code></p>
<p>Retrieves agent sessions with optional DSL filtering.</p>
<p><strong>Route Handler</strong>: <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/apps/sdk/session.py#L717-L777">api/apps/sdk/session.py717-777</a></p>
<p><strong>Query Parameters</strong>:</p>
<ul>
<li><code>id</code>: Filter by session ID</li>
<li><code>user_id</code>: Filter by user ID</li>
<li><code>page</code>: Page number (default: 1)</li>
<li><code>page_size</code>: Items per page (default: 30)</li>
<li><code>orderby</code>: Sort field (default: "update_time")</li>
<li><code>desc</code>: Sort descending (default: true)</li>
<li><code>dsl</code>: Include DSL in response (default: true, set to "False"/"false" to exclude)</li>
</ul>
<p><strong>DSL Filtering</strong>: The <code>dsl</code> parameter controls whether the full workflow DSL is included in the response. This is useful for reducing payload size when listing many sessions.</p>
<p><strong>Reference Processing</strong>: Similar to chat sessions, references are merged with assistant messages and field names are normalized. Additional type checking prevents errors when reference data is malformed.</p>
<p>Sources: <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/apps/sdk/session.py#L717-L777">api/apps/sdk/session.py717-777</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/api_service.py">api/db/services/api_service.py</a></p>
<h3 id="delete-agent-sessions">Delete Agent Sessions<a class="headerlink" href="#delete-agent-sessions" title="Permanent link">&para;</a></h3>
<p><strong>Endpoint</strong>: <code>DELETE /api/v1/agents/&lt;agent_id&gt;/sessions</code></p>
<p>Deletes agent sessions with the same bulk operation semantics as chat sessions.</p>
<p><strong>Route Handler</strong>: <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/apps/sdk/session.py#L831-L883">api/apps/sdk/session.py831-883</a></p>
<p>Sources: <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/apps/sdk/session.py#L831-L883">api/apps/sdk/session.py831-883</a></p>
<h2 id="advanced-features">Advanced Features<a class="headerlink" href="#advanced-features" title="Permanent link">&para;</a></h2>
<h3 id="query-refinement">Query Refinement<a class="headerlink" href="#query-refinement" title="Permanent link">&para;</a></h3>
<p>The chat system supports several query preprocessing strategies configured in <code>Dialog.prompt_config</code>:</p>
<p><strong>Multi-turn Query Refinement</strong> (<code>refine_multiturn=true</code>):</p>
<ul>
<li>Calls <code>full_question()</code> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/rag/prompts/generator.py#LNaN-LNaN">rag/prompts/generator.py</a> to rewrite the current question incorporating previous conversation context</li>
<li>Uses the chat LLM to generate a standalone question</li>
<li>Enabled by default for multi-turn conversations <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/dialog_service.py#L399-L402">api/db/services/dialog_service.py399-402</a></li>
</ul>
<p><strong>Cross-language Search</strong> (<code>cross_languages</code> list):</p>
<ul>
<li>Translates the query to multiple languages for multilingual retrieval</li>
<li>Calls <code>cross_languages()</code> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/rag/prompts/generator.py#LNaN-LNaN">rag/prompts/generator.py</a></li>
<li>Example: <code>["Chinese", "Japanese"]</code> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/dialog_service.py#L405-L406">api/db/services/dialog_service.py405-406</a></li>
</ul>
<p><strong>Keyword Enhancement</strong> (<code>keyword=true</code>):</p>
<ul>
<li>Extracts additional search keywords using LLM</li>
<li>Calls <code>keyword_extraction()</code> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/rag/prompts/generator.py#LNaN-LNaN">rag/prompts/generator.py</a></li>
<li>Appends extracted keywords to the query <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/dialog_service.py#L420-L421">api/db/services/dialog_service.py420-421</a></li>
</ul>
<p>Sources: <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/dialog_service.py#L343-L363">api/db/services/dialog_service.py343-363</a></p>
<h3 id="metadata-filtering">Metadata Filtering<a class="headerlink" href="#metadata-filtering" title="Permanent link">&para;</a></h3>
<p>The chat API supports filtering retrieved chunks by metadata fields:</p>
<p><strong>Auto Filtering</strong> (<code>meta_data_filter.method="auto"</code>):</p>
<ul>
<li>Uses LLM to generate filter conditions from the user query</li>
<li>Calls <code>gen_meta_filter()</code> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/rag/prompts/generator.py#LNaN-LNaN">rag/prompts/generator.py</a></li>
<li>Applies filters via <code>meta_filter()</code> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/dialog_service.py#L410-L413">api/db/services/dialog_service.py410-413</a></li>
</ul>
<p><strong>Manual Filtering</strong> (<code>meta_data_filter.method="manual"</code>):</p>
<ul>
<li>Applies pre-configured filter conditions</li>
<li>Supports operators: <code>=</code>, <code>≠</code>, <code>&gt;</code>, <code>&lt;</code>, <code>≥</code>, <code>≤</code>, <code>contains</code>, <code>start with</code>, <code>end with</code>, <code>empty</code>, <code>not empty</code></li>
<li>See <code>convert_conditions()</code> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/dialog_service.py#L273-L288">api/db/services/dialog_service.py273-288</a></li>
</ul>
<p><strong>Filter Structure</strong>:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>{
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a>  &quot;method&quot;: &quot;manual&quot;,
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a>  &quot;manual&quot;: [
<a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a>    {&quot;key&quot;: &quot;author&quot;, &quot;op&quot;: &quot;=&quot;, &quot;value&quot;: &quot;John&quot;},
<a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a>    {&quot;key&quot;: &quot;year&quot;, &quot;op&quot;: &quot;&gt;&quot;, &quot;value&quot;: &quot;2020&quot;}
<a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a>  ]
<a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a>}
</code></pre></div>
Sources: <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/dialog_service.py#L351-L360">api/db/services/dialog_service.py351-360</a></p>
<h3 id="citation-mechanisms">Citation Mechanisms<a class="headerlink" href="#citation-mechanisms" title="Permanent link">&para;</a></h3>
<p>The system supports automatic citation insertion with multiple fallback strategies:</p>
<p><strong>Primary Strategy - Semantic Citation</strong>:</p>
<ul>
<li>If no <code>[ID:n]</code> patterns exist in the LLM response, calls <code>retriever.insert_citations()</code> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/rag/nlp/search.py#L174-L262">rag/nlp/search.py174-262</a></li>
<li>Computes hybrid similarity between answer sentences and retrieved chunks</li>
<li>Inserts citation markers at optimal positions based on similarity threshold (0.63, decreases to 0.3)</li>
<li>Uses both token similarity (TF-IDF) and vector similarity <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/rag/nlp/search.py#L229-L243">rag/nlp/search.py229-243</a></li>
</ul>
<p><strong>Citation Repair</strong>:</p>
<ul>
<li>Detects malformed citation formats with patterns defined in <code>BAD_CITATION_PATTERNS</code> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/dialog_service.py#L236-L241">api/db/services/dialog_service.py236-241</a>:<ul>
<li><code>(ID: 12)</code> → <code>[ID:12]</code></li>
<li><code>【ID: 12】</code> → <code>[ID:12]</code></li>
<li><code>ref12</code> → <code>[ID:12]</code></li>
</ul>
</li>
<li>Converts to standard <code>[ID:n]</code> format via <code>repair_bad_citation_formats()</code> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/dialog_service.py#L244-L271">api/db/services/dialog_service.py244-271</a></li>
</ul>
<p><strong>Citation Validation</strong>:</p>
<ul>
<li>Validates citation indices are within bounds of <code>kbinfos["chunks"]</code></li>
<li>Filters document aggregations to only cited documents <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/dialog_service.py#L541-L545">api/db/services/dialog_service.py541-545</a></li>
</ul>
<p>Sources: <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/dialog_service.py#L466-L494">api/db/services/dialog_service.py466-494</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/rag/nlp/search.py#L176-L263">rag/nlp/search.py176-263</a></p>
<h3 id="sql-based-retrieval">SQL-based Retrieval<a class="headerlink" href="#sql-based-retrieval" title="Permanent link">&para;</a></h3>
<p>For datasets with field mappings, the system can use SQL queries instead of vector search:</p>
<p><strong>Activation</strong>: Checks <code>KnowledgebaseService.get_field_map(dialog.kb_ids)</code> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/dialog_service.py#L382-L389">api/db/services/dialog_service.py382-389</a></p>
<p><strong>SQL Generation</strong>:</p>
<ul>
<li>LLM generates SQL based on field schema and question</li>
<li>Applies refinement if database returns errors (max 2 retries)</li>
<li>See <code>use_sql()</code> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/dialog_service.py#L621-L743">api/db/services/dialog_service.py621-743</a></li>
</ul>
<p><strong>Response Format</strong>:</p>
<ul>
<li>Returns Markdown table with rows and source citations</li>
<li>Each row has a <code>##n$$</code> marker for citation linkage <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/dialog_service.py#L709-L723">api/db/services/dialog_service.py709-723</a></li>
</ul>
<p>Sources: <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/dialog_service.py#L326-L333">api/db/services/dialog_service.py326-333</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/dialog_service.py#L567-L690">api/db/services/dialog_service.py567-690</a></p>
<h3 id="empty-response-handling">Empty Response Handling<a class="headerlink" href="#empty-response-handling" title="Permanent link">&para;</a></h3>
<p>When no chunks are retrieved (e.g., no matching documents), the system returns a configured empty response:</p>
<p><strong>Configuration</strong>: Set in <code>Dialog.prompt_config["empty_response"]</code></p>
<p><strong>Behavior</strong>: If <code>knowledges</code> list is empty and <code>empty_response</code> is configured, returns the empty message without calling the LLM <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/dialog_service.py#L491-L495">api/db/services/dialog_service.py491-495</a></p>
<p>Sources: <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/dialog_service.py#L434-L438">api/db/services/dialog_service.py434-438</a></p>
<h3 id="reasoning-mode">Reasoning Mode<a class="headerlink" href="#reasoning-mode" title="Permanent link">&para;</a></h3>
<p>The chat system supports reasoning mode for deep research tasks:</p>
<p><strong>Activation</strong>: Set <code>prompt_config["reasoning"]=true</code></p>
<p><strong>Implementation</strong>:</p>
<ul>
<li>Uses <code>DeepResearcher</code> from <code>agentic_reasoning</code> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/dialog_service.py#L432-L453">api/db/services/dialog_service.py432-453</a></li>
<li>Performs iterative retrieval and reasoning</li>
<li>Streams thinking process to client <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/dialog_service.py#L448-L453">api/db/services/dialog_service.py448-453</a></li>
</ul>
<p>Sources: <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/dialog_service.py#L373-L394">api/db/services/dialog_service.py373-394</a></p>
<h2 id="agent-completions">Agent Completions<a class="headerlink" href="#agent-completions" title="Permanent link">&para;</a></h2>
<p>Agent completion endpoints execute Canvas workflows. These are documented separately in <a href="/infiniflow/ragflow/8-backend-api-system">8 Agent and Workflow System</a>.</p>
<p><strong>Endpoints</strong>:</p>
<ul>
<li><code>POST /api/v1/agents/&lt;agent_id&gt;/completions</code> - RAGFlow native format</li>
<li><code>POST /api/v1/agents_openai/&lt;agent_id&gt;/chat/completions</code> - OpenAI-compatible format</li>
</ul>
<p><strong>Key Differences from Chat</strong>:</p>
<ul>
<li>Executes component DAGs instead of RAG pipeline</li>
<li>Stores workflow state in <code>API4Conversation.dsl</code></li>
<li>Supports multi-step reasoning with tool calling</li>
<li>Returns structured event streams</li>
</ul>
<p>For detailed documentation, see <a href="/infiniflow/ragflow/9-agent-and-workflow-system">9 Agent and Workflow System</a> and <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/canvas_service.py#L140-L280">api/db/services/canvas_service.py140-280</a></p>
<p>Sources: <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/apps/sdk/session.py#L446-L658">api/apps/sdk/session.py446-658</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/canvas_service.py#L179-L278">api/db/services/canvas_service.py179-278</a></p>
<h2 id="performance-optimizations">Performance Optimizations<a class="headerlink" href="#performance-optimizations" title="Permanent link">&para;</a></h2>
<h3 id="token-budgeting">Token Budgeting<a class="headerlink" href="#token-budgeting" title="Permanent link">&para;</a></h3>
<p>The chat system implements sophisticated token management to fit within LLM context windows:</p>
<p><strong>Message Fitting</strong>: <code>message_fit_in()</code> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/rag/prompts/generator.py#LNaN-LNaN">rag/prompts/generator.py</a> truncates message history to fit in <code>max_tokens * 0.95</code>:</p>
<ol>
<li>Prioritizes system prompt (always included)</li>
<li>Keeps most recent messages</li>
<li>Truncates older messages if needed</li>
<li>Ensures at least 2 messages (system + user) <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/dialog_service.py#L505-L506">api/db/services/dialog_service.py505-506</a></li>
</ol>
<p><strong>Context Selection</strong>: <code>kb_prompt()</code> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/rag/prompts/generator.py#LNaN-LNaN">rag/prompts/generator.py</a> formats retrieved chunks to fit in available tokens:</p>
<ul>
<li>Truncates each chunk to fit</li>
<li>Stops adding chunks when token limit reached</li>
<li>Returns formatted strings for insertion in prompt</li>
</ul>
<p><strong>Dynamic max_tokens</strong>: If generation config includes <code>max_tokens</code>, it's reduced by used_token_count to prevent overflow <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/dialog_service.py#L509-L511">api/db/services/dialog_service.py509-511</a></p>
<p>Sources: <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/dialog_service.py#L449-L454">api/db/services/dialog_service.py449-454</a></p>
<h3 id="timing-metrics">Timing Metrics<a class="headerlink" href="#timing-metrics" title="Permanent link">&para;</a></h3>
<p>Each response includes detailed timing breakdown in the <code>prompt</code> field:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a>## Time elapsed:
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a>  - Total: 2543.1ms
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a>  - Check LLM: 123.4ms
<a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a>  - Check Langfuse tracer: 45.2ms
<a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a>  - Bind models: 67.8ms
<a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a>  - Query refinement(LLM): 234.5ms
<a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a>  - Retrieval: 678.9ms
<a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a>  - Generate answer: 1234.5ms
<a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a>
<a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a>## Token usage:
<a id="__codelineno-29-11" name="__codelineno-29-11" href="#__codelineno-29-11"></a>  - Generated tokens(approximately): 156
<a id="__codelineno-29-12" name="__codelineno-29-12" href="#__codelineno-29-12"></a>  - Token speed: 126/s
</code></pre></div>
<strong>Instrumentation Points</strong>:</p>
<ul>
<li><code>check_llm_ts</code>: LLM config validation <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/dialog_service.py#L297-L297">api/db/services/dialog_service.py297</a></li>
<li><code>check_langfuse_tracer_ts</code>: Langfuse tracer initialization <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/dialog_service.py#L309-L309">api/db/services/dialog_service.py309</a></li>
<li><code>bind_models_ts</code>: Model loading <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/dialog_service.py#L314-L314">api/db/services/dialog_service.py314</a></li>
<li><code>refine_question_ts</code>: Query preprocessing <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/dialog_service.py#L364-L364">api/db/services/dialog_service.py364</a></li>
<li><code>retrieval_ts</code>: Retrieval pipeline <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/dialog_service.py#L433-L433">api/db/services/dialog_service.py433</a></li>
<li><code>finish_chat_ts</code>: Response generation <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/dialog_service.py#L498-L498">api/db/services/dialog_service.py498</a></li>
</ul>
<p>Sources: <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/dialog_service.py#L500-L523">api/db/services/dialog_service.py500-523</a></p>
<h3 id="langfuse-integration">Langfuse Integration<a class="headerlink" href="#langfuse-integration" title="Permanent link">&para;</a></h3>
<p>The chat system supports LLM call tracing via <a href="https://langfuse.com/">Langfuse</a>:</p>
<p><strong>Activation</strong>: Configure Langfuse credentials in <code>TenantLangfuseService</code> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/dialog_service.py#L301-L308">api/db/services/dialog_service.py301-308</a></p>
<p><strong>Traced Operations</strong>:</p>
<ul>
<li>Prompt text and token counts <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/dialog_service.py#L534-L536">api/db/services/dialog_service.py534-536</a></li>
<li>Generation parameters and model config</li>
<li>Response output and timing <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/dialog_service.py#L526-L530">api/db/services/dialog_service.py526-530</a></li>
</ul>
<p><strong>Trace Context</strong>: Each chat creates a trace with unique <code>trace_id</code> for request tracking <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/dialog_service.py#L306-L307">api/db/services/dialog_service.py306-307</a></p>
<p>Sources: <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/dialog_service.py#L301-L536">api/db/services/dialog_service.py301-536</a></p>
<h2 id="error-handling">Error Handling<a class="headerlink" href="#error-handling" title="Permanent link">&para;</a></h2>
<h3 id="validation-errors">Validation Errors<a class="headerlink" href="#validation-errors" title="Permanent link">&para;</a></h3>
<p>Common validation failures and error codes:</p>
<table>
<thead>
<tr>
<th>Error Code</th>
<th>Scenario</th>
<th>Message</th>
</tr>
</thead>
<tbody>
<tr>
<td>102</td>
<td>User doesn't own chat/agent</td>
<td>"You do not own the assistant/agent"</td>
</tr>
<tr>
<td>102</td>
<td>Session not found</td>
<td>"Session does not exist"</td>
</tr>
<tr>
<td>102</td>
<td>Last message not from user</td>
<td>"The last content of this conversation is not from user."</td>
</tr>
<tr>
<td>101</td>
<td>Empty name</td>
<td>"<code>name</code> can not be empty."</td>
</tr>
</tbody>
</table>
<p><strong>Error Response Format</strong>:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>{
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a>  &quot;code&quot;: 102,
<a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a>  &quot;message&quot;: &quot;Error description&quot;
<a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a>}
</code></pre></div>
Sources: <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/apps/sdk/session.py#L56-L56">api/apps/sdk/session.py56</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/apps/sdk/session.py#L110-L112">api/apps/sdk/session.py110-112</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/apps/sdk/session.py#L259-L261">api/apps/sdk/session.py259-261</a></p>
<h3 id="duplicate-id-handling">Duplicate ID Handling<a class="headerlink" href="#duplicate-id-handling" title="Permanent link">&para;</a></h3>
<p>Session deletion operations use <code>check_duplicate_ids()</code> to detect and filter duplicate session IDs in bulk delete requests, returning informative messages about duplicates while still deleting unique sessions.</p>
<p>Sources: <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/apps/sdk/session.py#L802-L826">api/apps/sdk/session.py802-826</a></p>
<h2 id="session-query-and-filtering">Session Query and Filtering<a class="headerlink" href="#session-query-and-filtering" title="Permanent link">&para;</a></h2>
<p>The session listing endpoints support flexible querying via <code>ConversationService.get_list()</code> and <code>API4ConversationService.get_list()</code>:</p>
<p><strong>Filtering</strong>:</p>
<ul>
<li>By ID: Direct session lookup</li>
<li>By name: Exact name match</li>
<li>By user_id: Filter sessions for specific user</li>
</ul>
<p><strong>Pagination</strong>:</p>
<ul>
<li>Offset-based pagination with <code>page</code> and <code>page_size</code></li>
<li>Default: page=1, page_size=30</li>
</ul>
<p><strong>Sorting</strong>:</p>
<ul>
<li>Chat sessions: Default sort by <code>create_time</code></li>
<li>Agent sessions: Default sort by <code>update_time</code></li>
<li><code>desc</code> parameter controls ascending/descending order</li>
</ul>
<p>Sources: <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/db/services/conversation_service.py#L34-L49">api/db/services/conversation_service.py34-49</a> <a href="https://github.com/infiniflow/ragflow/blob/80a16e71/api/apps/sdk/session.py#L495-L546">api/apps/sdk/session.py495-546</a></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["navigation.tabs", "navigation.sections", "navigation.top", "search.suggest", "search.highlight", "content.code.copy"], "search": "../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>